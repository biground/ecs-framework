var es;!function(t){class e{constructor(s=!0,i=!0){this._globalManagers=[],this._coroutineManager=new t.CoroutineManager,this._timerManager=new t.TimerManager,this._frameCounterElapsedTime=0,this._frameCounter=0,this._totalMemory=0,e._instance=this,e.emitter=new t.Emitter,e.emitter.addObserver(t.CoreEvents.frameUpdated,this.update,this),e.registerGlobalManager(this._coroutineManager),e.registerGlobalManager(new t.TweenManager),e.registerGlobalManager(this._timerManager),e.entitySystemsEnabled=i,this.debug=s,this.initialize()}static get Instance(){return this._instance}static get scene(){return this._instance?this._instance._scene:null}static set scene(t){null==this._instance._scene?(this._instance._scene=t,this._instance.onSceneChanged(),this._instance._scene.begin()):this._instance._nextScene=t}static create(e=!0){return null==this._instance&&(this._instance=new t.Core(e)),this._instance}static registerGlobalManager(t){this._instance._globalManagers.push(t),t.enabled=!0}static unregisterGlobalManager(e){new t.List(this._instance._globalManagers).remove(e),e.enabled=!1}static getGlobalManager(t){for(let s=0,i=e._instance._globalManagers.length;s<i;++s){let i=e._instance._globalManagers[s];if(i instanceof t)return i}return null}static startSceneTransition(t){return this._instance._sceneTransition=t,t}static startCoroutine(t){return this._instance._coroutineManager.startCoroutine(t)}static schedule(t,e=!1,s=null,i){return this._instance._timerManager.schedule(t,e,s,i)}startDebugDraw(){if(this.debug&&(this._frameCounter++,this._frameCounterElapsedTime+=t.Time.deltaTime,this._frameCounterElapsedTime>=1)){let t=window.performance.memory;null!=t&&(this._totalMemory=Number((t.totalJSHeapSize/1048576).toFixed(2))),this._titleMemory&&this._titleMemory(this._totalMemory,this._frameCounter),this._frameCounter=0,this._frameCounterElapsedTime-=1}}onSceneChanged(){e.emitter.emit(t.CoreEvents.sceneChanged),t.Time.sceneChanged()}initialize(){}update(s=-1){if(!e.paused){if(t.Time.update(s,-1!==s),null!=this._scene){for(const t of this._globalManagers)t.enabled&&t.update();null!=this._sceneTransition&&this._sceneTransition._loadsNewScene||this._scene.update()}null!=this._nextScene&&(this._scene.end(),this._scene=this._nextScene,this._nextScene=null,this.onSceneChanged(),this._scene.begin()),this.startDebugDraw(),this.draw()}}draw(){null!=this._sceneTransition&&this._sceneTransition.preRender(),null==this._sceneTransition||this._sceneTransition.hasPreviousSceneRender||(null!=this._scene&&e.startCoroutine(this._sceneTransition.onBeginTransition()),this._sceneTransition.render())}}e.paused=!1,e.debugRenderEndabled=!1,t.Core=e}(es||(es={})),function(t){class e{constructor(){this._enabled=!0,this._updateOrder=0,this.id=e._idGenerator++}get transform(){return this.entity.transform}get enabled(){return this.entity?this.entity.enabled&&this._enabled:this._enabled}set enabled(t){this.setEnabled(t)}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}initialize(){}onAddedToEntity(){}onRemovedFromEntity(){}onEntityTransformChanged(t){}onEnabled(){}onDisabled(){}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled()),this}setUpdateOrder(t){return this._updateOrder!=t&&(this._updateOrder=t),this}addComponent(t){return this.entity.addComponent(t)}getComponent(t){return this.entity.getComponent(t)}getComponents(t,e){return this.entity.getComponents(t,e)}hasComponent(t){return this.entity.hasComponent(t)}removeComponent(t){t?this.entity.removeComponent(t):this.entity.removeComponent(this)}}e._idGenerator=0,t.Component=e}(es||(es={})),function(t){class e{constructor(t,s){this.index_=0,this.index_=void 0!==s?e.INDEX++:s,this.type_=t}getName(){return t.getClassName(this.type_)}getIndex(){return this.index_}toString(){return"ComponentType["+t.getClassName(e)+"] ("+this.index_+")"}}e.INDEX=0,t.ComponentType=e}(es||(es={})),function(t){let e;!function(t){t[t.sceneChanged=0]="sceneChanged",t[t.frameUpdated=1]="frameUpdated",t[t.renderChanged=2]="renderChanged"}(e=t.CoreEvents||(t.CoreEvents={}))}(es||(es={})),function(t){class e{compare(t,e){let s=t.updateOrder-e.updateOrder;return 0==s&&(s=t.id-e.id),s}}t.EntityComparer=e;class s{constructor(e,s){this.updateInterval=1,this._tag=0,this._enabled=!0,this._updateOrder=0,this.components=new t.ComponentList(this),this.transform=new t.Transform(this),this.componentBits=new t.Bits,this.name=e,this.id=s}get isDestroyed(){return this._isDestroyed}get tag(){return this._tag}set tag(t){this.setTag(t)}get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}get parent(){return this.transform.parent}set parent(t){this.transform.setParent(t)}get childCount(){return this.transform.childCount}get position(){return this.transform.position}set position(t){this.transform.setPosition(t.x,t.y)}get localPosition(){return this.transform.localPosition}set localPosition(t){this.transform.setLocalPosition(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.setRotation(t)}get rotationDegrees(){return this.transform.rotationDegrees}set rotationDegrees(t){this.transform.setRotationDegrees(t)}get localRotation(){return this.transform.localRotation}set localRotation(t){this.transform.setLocalRotation(t)}get localRotationDegrees(){return this.transform.localRotationDegrees}set localRotationDegrees(t){this.transform.setLocalRotationDegrees(t)}get scale(){return this.transform.scale}set scale(t){this.transform.setScale(t)}get localScale(){return this.transform.localScale}set localScale(t){this.transform.setLocalScale(t)}get worldInverseTransform(){return this.transform.worldInverseTransform}get localToWorldTransform(){return this.transform.localToWorldTransform}get worldToLocalTransform(){return this.transform.worldToLocalTransform}onTransformChanged(t){this.components.onEntityTransformChanged(t)}setParent(e){return e instanceof t.Transform?this.transform.setParent(e):e instanceof s&&this.transform.setParent(e.transform),this}setPosition(t,e){return this.transform.setPosition(t,e),this}setLocalPosition(t){return this.transform.setLocalPosition(t),this}setRotation(t){return this.transform.setRotation(t),this}setRotationDegrees(t){return this.transform.setRotationDegrees(t),this}setLocalRotation(t){return this.transform.setLocalRotation(t),this}setLocalRotationDegrees(t){return this.transform.setLocalRotationDegrees(t),this}setScale(e){return e instanceof t.Vector2?this.transform.setScale(e):this.transform.setScale(new t.Vector2(e,e)),this}setLocalScale(e){return e instanceof t.Vector2?this.transform.setLocalScale(e):this.transform.setLocalScale(new t.Vector2(e,e)),this}setTag(t){return this._tag!=t&&(this.scene&&this.scene.entities.removeFromTagList(this),this._tag=t,this.scene&&this.scene.entities.addToTagList(this)),this}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.components.onEntityEnabled():this.components.onEntityDisabled()),this}setUpdateOrder(t){if(this._updateOrder!=t)return this._updateOrder=t,this.scene&&(this.scene.entities.markEntityListUnsorted(),this.scene.entities.markTagUnsorted(this.tag)),this}destroy(){this._isDestroyed=!0,this.scene.identifierPool.checkIn(this.id),this.scene.entities.remove(this),this.transform.parent=null;for(let t=this.transform.childCount-1;t>=0;t--){this.transform.getChild(t).entity.destroy()}}detachFromScene(){this.scene.entities.remove(this),this.components.deregisterAllComponents();for(let t=0;t<this.transform.childCount;t++)this.transform.getChild(t).entity.detachFromScene()}attachToScene(t){this.scene=t,t.entities.add(this),this.components.registerAllComponents();for(let e=0;e<this.transform.childCount;e++)this.transform.getChild(e).entity.attachToScene(t)}onAddedToScene(){}onRemovedFromScene(){this._isDestroyed&&this.components.removeAllComponents()}update(){this.components.update()}createComponent(t){let e=new t;return this.addComponent(e),e}addComponent(t){return t.entity=this,this.components.add(t),t.initialize(),t}getComponent(t){return this.components.getComponent(t,!1)}getComponentInScene(t){return this.components.getComponent(t,!0)}tryGetComponent(t,e){return e.value=this.components.getComponent(t,!1),null!=e.value}hasComponent(t){return null!=this.components.getComponent(t,!1)}getOrCreateComponent(t){let e=this.components.getComponent(t,!1);return e||(e=this.addComponent(new t)),e}getComponents(t,e){return this.components.getComponents(t,e)}removeComponent(t){this.components.remove(t)}removeComponentForType(t){let e=this.getComponent(t);return!!e&&(this.removeComponent(e),!0)}removeAllComponents(){for(let t=0;t<this.components.count;t++)this.removeComponent(this.components.buffer[t])}tweenPositionTo(e,s=.3){const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.position),i.initialize(i,e,s),i}tweenLocalPositionTo(e,s=.3){const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.localPosition),i.initialize(i,e,s),i}tweenScaleTo(e,s=.3){if("number"==typeof e)return this.tweenScaleTo(new t.Vector2(e,e),s);const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.scale),i.initialize(i,e,s),i}tweenLocalScaleTo(e,s=.3){if("number"==typeof e)return this.tweenLocalScaleTo(new t.Vector2(e,e),s);const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.localScale),i.initialize(i,e,s),i}tweenRotationDegreesTo(e,s=.3){const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.rotationDegrees),i.initialize(i,new t.Vector2(e,e),s),i}tweenLocalRotationDegreesTo(e,s=.3){const i=t.Pool.obtain(t.TransformVector2Tween);return i.setTargetAndType(this.transform,t.TransformTargetType.localRotationDegrees),i.initialize(i,new t.Vector2(e,e),s),i}compareTo(t){let e=this._updateOrder-t._updateOrder;return 0==e&&(e=this.id-t.id),e}equals(t){return 0==this.compareTo(t)}toString(){return`[Entity: name: ${this.name}, tag: ${this.tag}, enabled: ${this.enabled}, depth: ${this.updateOrder}]`}}s.entityComparer=new e,t.Entity=s}(es||(es={})),function(t){class e{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}static get zero(){return new e(0,0)}static get one(){return new e(1,1)}static get unitX(){return new e(1,0)}static get unitY(){return new e(0,1)}static get up(){return new e(0,-1)}static get down(){return new e(0,1)}static get left(){return new e(-1,0)}static get right(){return new e(1,0)}static add(t,s){let i=e.zero;return i.x=t.x+s.x,i.y=t.y+s.y,i}static divide(t,s){let i=e.zero;return i.x=t.x/s.x,i.y=t.y/s.y,i}static divideScaler(t,s){let i=e.zero;return i.x=t.x/s,i.y=t.y/s,i}static sqrDistance(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}static clamp(s,i,n){return new e(t.MathHelper.clamp(s.x,i.x,n.x),t.MathHelper.clamp(s.y,i.y,n.y))}static lerp(s,i,n){return new e(t.MathHelper.lerp(s.x,i.x,n),t.MathHelper.lerp(s.y,i.y,n))}static lerpPrecise(s,i,n){return new e(t.MathHelper.lerpPrecise(s.x,i.x,n),t.MathHelper.lerpPrecise(s.y,i.y,n))}static transform(t,s){return new e(t.x*s.m11+t.y*s.m21+s.m31,t.x*s.m12+t.y*s.m22+s.m32)}static transformNormal(t,s){return new e(t.x*s.m11+t.y*s.m21,t.x*s.m12+t.y*s.m22)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static angle(e,s){return e=e.normalize(),s=s.normalize(),Math.acos(t.MathHelper.clamp(e.dot(s),-1,1))*t.MathHelper.Rad2Deg}static negate(t){return t.x=-t.x,t.y=-t.y,t}static reflect(e,s){let i=t.Vector2.zero,n=2*(e.x*s.x+e.y*s.y);return i.x=e.x-s.x*n,i.y=e.y-s.y*n,i}static smoothStep(s,i,n){return new e(t.MathHelper.smoothStep(s.x,i.x,n),t.MathHelper.smoothStep(s.y,i.y,n))}setTo(t,e){this.x=t,this.y=e}negate(){return this.scale(-1)}add(t){return new e(this.x+t.x,this.y+t.y)}addEqual(t){return this.x+=t.x,this.y+=t.y,this}divide(t){return new e(this.x/t.x,this.y/t.y)}divideScaler(t){return new e(this.x/t,this.y/t)}multiply(t){return new e(t.x*this.x,t.y*this.y)}multiplyScaler(t){return this.x*=t,this.y*=t,this}sub(t){return new e(this.x-t.x,this.y-t.y)}subEqual(t){return this.x-=t.x,this.y-=t.y,this}dot(t){return this.x*t.x+this.y*t.y}scale(t){return new e(this.x*t,this.y*t)}scaleEqual(t){return this.x*=t,this.y*=t,this}transform(t){return new e(this.x*t.m11+this.y*t.m21+t.m31,this.x*t.m12+this.y*t.m22+t.m32)}normalize(){const t=this.distance();return t>0?new e(this.x/t,this.y/t):new e(0,1)}normalizeEqual(){const t=this.distance();return t>0?(this.setTo(this.x/t,this.y/t),this):(this.setTo(0,1),this)}magnitude(){return this.distance()}distance(t){return t||(t=e.zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}lengthSquared(){return this.x*this.x+this.y*this.y}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}round(){return new e(Math.round(this.x),Math.round(this.y))}angleBetween(e,s){let i=e.sub(this),n=s.sub(this);return t.Vector2Ext.angle(i,n)}getDistance(t){return Math.sqrt(this.getDistanceSquared(t))}getDistanceSquared(t){const e=t.x-this.x,s=t.y-this.y;return e*e+s*s}isBetween(t,e){const s=e.sub(t).cross(this.sub(t));return Math.abs(s)<Number.EPSILON&&this.dot(e.sub(t))>=0&&this.dot(t.sub(e))>=0}cross(t){return this.x*t.y-this.y*t.x}getAngle(){return Math.atan2(this.y,this.x)}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}isValid(){return t.MathHelper.isValid(this.x)&&t.MathHelper.isValid(this.y)}static min(t,s){return new e(t.x<s.x?t.x:s.x,t.y<s.y?t.y:s.y)}static max(t,s){return new e(t.x>s.x?t.x:s.x,t.y>s.y?t.y:s.y)}static hermite(s,i,n,r,o){return new e(t.MathHelper.hermite(s.x,i.x,n.x,r.x,o),t.MathHelper.hermite(s.y,i.y,n.y,r.y,o))}static unsignedAngle(e,s,i=!0){e.normalizeEqual(),s.normalizeEqual();const n=Math.acos(t.MathHelper.clamp(e.dot(s),-1,1))*t.MathHelper.Rad2Deg;return i?Math.round(n):n}static fromAngle(t,s=1){return new e(s*Math.cos(t),s*Math.sin(t))}clone(){return new e(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this}}t.Vector2=e}(es||(es={})),function(t){t.Scene=class extends fairygui.GComponent{constructor(){super(),this._sceneComponents=[],this.entities=new t.EntityList(this),this.entityProcessors=new t.EntityProcessorList,this.identifierPool=new t.IdentifierPool}onConstruct(){var t;null===(t=this.initialize)||void 0===t||t.call(this)}initialize(){}onStart(){}onUnload(){}begin(){t.Physics.reset(),null!=this.entityProcessors&&this.entityProcessors.begin(),this._didSceneBegin=!0,this.onStart()}end(){this._didSceneBegin=!1,this.entities.removeAllEntities();for(let t=0;t<this._sceneComponents.length;t++)this._sceneComponents[t].onRemovedFromScene();this._sceneComponents.length=0,t.Physics.clear(),this.entityProcessors&&this.entityProcessors.end(),this.onUnload()}update(){this.entities.updateLists();for(let t=this._sceneComponents.length-1;t>=0;t--)this._sceneComponents[t].enabled&&this._sceneComponents[t].update();null!=this.entityProcessors&&this.entityProcessors.update(),this.entities.update(),null!=this.entityProcessors&&this.entityProcessors.lateUpdate()}addSceneComponent(t){return t.scene=this,t.onEnabled(),this._sceneComponents.push(t),this._sceneComponents.sort(t.compare),t}getSceneComponent(t){for(let e=0;e<this._sceneComponents.length;e++){let s=this._sceneComponents[e];if(s instanceof t)return s}return null}getOrCreateSceneComponent(t){let e=this.getSceneComponent(t);return null==e&&(e=this.addSceneComponent(new t)),e}removeSceneComponent(e){new t.List(this._sceneComponents).remove(e),e.onRemovedFromScene()}createEntity(e){let s=new t.Entity(e,this.identifierPool.checkOut());return this.addEntity(s)}addEntity(t){this.entities.add(t),t.scene=this;for(let e=0;e<t.transform.childCount;e++)this.addEntity(t.transform.getChild(e).entity);return t}destroyAllEntities(){for(let t=0;t<this.entities.count;t++)this.entities.buffer[t].destroy()}findEntity(t){return this.entities.findEntity(t)}findEntityRight(t){return this.entities.findEntityRight(t)}findEntityById(t){return this.entities.findEntityById(t)}findEntitiesWithTag(t){return this.entities.entitiesWithTag(t)}findEntityWithTag(t){return this.entities.entityWithTag(t)}findComponentOfType(t){return this.entities.findComponentOfType(t)}findComponentsOfType(t){return this.entities.findComponentsOfType(t)}findEntitiesOfComponent(...t){return this.entities.findEntitiesOfComponent(...t)}addEntityProcessor(t){return t.scene=this,this.entityProcessors.add(t),t.setUpdateOrder(this.entityProcessors.count-1),this.entityProcessors.clearDirty(),t}removeEntityProcessor(t){this.entityProcessors.remove(t)}getEntityProcessor(t){return this.entityProcessors.getProcessor(t)}}}(es||(es={})),function(t){t.SceneTransition=class{get hasPreviousSceneRender(){return!!this._hasPreviousSceneRender||(this._hasPreviousSceneRender=!0,!1)}constructor(t){this._loadsNewScene=!1,this._hasPreviousSceneRender=!1,this._isNewSceneLoaded=!1,this.sceneLoadAction=t,this._loadsNewScene=null!=t}*LoadNextScene(){for(null!=this.onScreenObscured&&this.onScreenObscured(),this._loadsNewScene||(this._isNewSceneLoaded=!0,yield"break"),t.Core.scene=this.sceneLoadAction(),this._isNewSceneLoaded=!0;!this._isNewSceneLoaded;)yield null}*onBeginTransition(){yield null,yield t.Core.startCoroutine(this.LoadNextScene()),this.transitionComplete()}preRender(){}render(){}transitionComplete(){t.Core.Instance._sceneTransition=null,null!=this.onTransitionCompleted&&this.onTransitionCompleted()}}}(es||(es={})),function(t){let e,s;!function(t){t[t.position=0]="position",t[t.scale=1]="scale",t[t.rotation=2]="rotation"}(e=t.ComponentTransform||(t.ComponentTransform={})),function(t){t[t.clean=0]="clean",t[t.positionDirty=1]="positionDirty",t[t.scaleDirty=2]="scaleDirty",t[t.rotationDirty=4]="rotationDirty"}(s=t.DirtyType||(t.DirtyType={}));t.Transform=class{constructor(e){this._localTransform=t.Matrix2D.identity,this._worldTransform=t.Matrix2D.identity,this._rotationMatrix=t.Matrix2D.identity,this._translationMatrix=t.Matrix2D.identity,this._scaleMatrix=t.Matrix2D.identity,this._children=[],this._worldToLocalTransform=t.Matrix2D.identity,this._worldInverseTransform=t.Matrix2D.identity,this._position=t.Vector2.zero,this._scale=t.Vector2.one,this._rotation=0,this._localPosition=t.Vector2.zero,this._localScale=t.Vector2.one,this._localRotation=0,this.entity=e,this.scale=this._localScale=t.Vector2.one}get childCount(){return this._children.length}get rotationDegrees(){return t.MathHelper.toDegrees(this._rotation)}set rotationDegrees(e){this.setRotation(t.MathHelper.toRadians(e))}get localRotationDegrees(){return t.MathHelper.toDegrees(this._localRotation)}set localRotationDegrees(e){this.localRotation=t.MathHelper.toRadians(e)}get localToWorldTransform(){return this.updateTransform(),this._worldTransform}get parent(){return this._parent}set parent(t){this.setParent(t)}get worldToLocalTransform(){return this._worldToLocalDirty&&(null==this.parent?this._worldToLocalTransform=t.Matrix2D.identity:(this.parent.updateTransform(),this._worldToLocalTransform=t.Matrix2D.invert(this.parent._worldTransform)),this._worldToLocalDirty=!1),this._worldToLocalTransform}get worldInverseTransform(){return this.updateTransform(),this._worldInverseDirty&&(this._worldInverseTransform=t.Matrix2D.invert(this._worldTransform),this._worldInverseDirty=!1),this._worldInverseTransform}get position(){return this.updateTransform(),this._positionDirty&&(null==this.parent?this._position=this._localPosition:(this.parent.updateTransform(),t.Vector2Ext.transformR(this._localPosition,this.parent._worldTransform,this._position)),this._positionDirty=!1),this._position}set position(t){this.setPosition(t.x,t.y)}get scale(){return this.updateTransform(),this._scale}set scale(t){this.setScale(t)}get rotation(){return this.updateTransform(),this._rotation}set rotation(t){this.setRotation(t)}get localPosition(){return this.updateTransform(),this._localPosition}set localPosition(t){this.setLocalPosition(t)}get localScale(){return this.updateTransform(),this._localScale}set localScale(t){this.setLocalScale(t)}get localRotation(){return this.updateTransform(),this._localRotation}set localRotation(t){this.setLocalRotation(t)}getChild(t){return this._children[t]}setParent(t){if(this._parent==t)return this;if(null!=this._parent){const t=this._parent._children.findIndex(t=>t==this);-1!=t&&this._parent._children.splice(t,1)}return null!=t&&t._children.push(this),this._parent=t,this.setDirty(s.positionDirty),this}setPosition(e,s){let i=new t.Vector2(e,s);return i.equals(this._position)?this:(this._position=i,null!=this.parent?this.localPosition=t.Vector2.transform(this._position,this.worldToLocalTransform):this.localPosition=i,this._positionDirty=!1,this)}setLocalPosition(t){return t.equals(this._localPosition)?this:(this._localPosition=t,this._localDirty=this._positionDirty=this._localPositionDirty=this._localRotationDirty=this._localScaleDirty=!0,this.setDirty(s.positionDirty),this)}setRotation(t){return this._rotation=t,null!=this.parent?this.localRotation=this.parent.rotation+t:this.localRotation=t,this.setDirty(s.rotationDirty),this}setRotationDegrees(e){return this.setRotation(t.MathHelper.toRadians(e))}lookAt(e){const s=this.position.x>e.x?-1:1,i=this.position.sub(e).normalize();this.rotation=s*Math.acos(i.dot(t.Vector2.unitY))}setLocalRotation(t){return this._localRotation=t,this._localDirty=this._positionDirty=this._localPositionDirty=this._localRotationDirty=this._localScaleDirty=!0,this.setDirty(s.rotationDirty),this}setLocalRotationDegrees(e){return this.setLocalRotation(t.MathHelper.toRadians(e))}setScale(e){return this._scale=e,null!=this.parent?this.localScale=t.Vector2.divide(e,this.parent._scale):this.localScale=e,this.setDirty(s.scaleDirty),this}setLocalScale(t){return this._localScale=t,this._localDirty=this._positionDirty=this._localScaleDirty=!0,this.setDirty(s.scaleDirty),this}roundPosition(){this.position=t.Vector2Ext.round(this._position)}updateTransform(){this.hierarchyDirty!=s.clean&&(null!=this.parent&&this.parent.updateTransform(),this._localDirty&&(this._localPositionDirty&&(t.Matrix2D.createTranslation(this._localPosition.x,this._localPosition.y,this._translationMatrix),this._localPositionDirty=!1),this._localRotationDirty&&(t.Matrix2D.createRotation(this._localRotation,this._rotationMatrix),this._localRotationDirty=!1),this._localScaleDirty&&(t.Matrix2D.createScale(this._localScale.x,this._localScale.y,this._scaleMatrix),this._localScaleDirty=!1),t.Matrix2D.multiply(this._scaleMatrix,this._rotationMatrix,this._localTransform),t.Matrix2D.multiply(this._localTransform,this._translationMatrix,this._localTransform),null==this.parent&&(this._worldTransform=this._localTransform,this._rotation=this._localRotation,this._scale=this._localScale,this._worldInverseDirty=!0),this._localDirty=!1),null!=this.parent&&(t.Matrix2D.multiply(this._localTransform,this.parent._worldTransform,this._worldTransform),this._rotation=this._localRotation+this.parent._rotation,this._scale=this.parent._scale.multiply(this._localScale),this._worldInverseDirty=!0),this._worldToLocalDirty=!0,this._positionDirty=!0,this.hierarchyDirty=s.clean)}setDirty(t){if(0==(this.hierarchyDirty&t)){switch(this.hierarchyDirty|=t,t){case s.positionDirty:this.entity.onTransformChanged(e.position);break;case s.rotationDirty:this.entity.onTransformChanged(e.rotation);break;case s.scaleDirty:this.entity.onTransformChanged(e.scale)}for(let e=0;e<this._children.length;e++)this._children[e].setDirty(t)}}copyFrom(t){this._position=t.position.clone(),this._localPosition=t._localPosition.clone(),this._rotation=t._rotation,this._localRotation=t._localRotation,this._scale=t._scale,this._localScale=t._localScale,this.setDirty(s.positionDirty),this.setDirty(s.rotationDirty),this.setDirty(s.scaleDirty)}toString(){return`[Transform: parent: ${this.parent}, position: ${this.position}, rotation: ${this.rotation},\n                scale: ${this.scale}, localPosition: ${this._localPosition}, localRotation: ${this._localRotation},\n                localScale: ${this._localScale}]`}}}(es||(es={})),function(t){t.IUpdatableComparer=class{compare(t,e){return t.updateOrder-e.updateOrder}},t.isIUpdatable=(t=>void 0!==t.update)}(es||(es={})),function(t){t.SceneComponent=class{constructor(){this.updateOrder=0,this._enabled=!0}get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}onEnabled(){}onDisabled(){}onRemovedFromScene(){}update(){}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled()),this}setUpdateOrder(t){return this.updateOrder!=t&&(this.updateOrder=t),this}compare(t){return this.updateOrder-t.updateOrder}}}(es||(es={})),function(t){t.TriggerListenerHelper=class{static getITriggerListener(e,s){if(e.components._components.length>0)for(let i=0;i<e.components._components.length;i++){const n=e.components._components[i];t.isITriggerListener(n)&&s.push(n)}for(let i in e.components._componentsToAdd){let n=e.components._componentsToAdd[i];t.isITriggerListener(n)&&s.push(n)}return s}},t.isITriggerListener=(t=>void 0!==t.onTriggerEnter)}(es||(es={})),function(t){class e extends t.Component{constructor(){super(...arguments),this.castSortOrder=0,this.isTrigger=!1,this.physicsLayer=new t.Ref(1),this.collidesWithLayers=new t.Ref(t.Physics.allLayers),this.shouldColliderScaleAndRotateWithTransform=!0,this.registeredPhysicsBounds=new t.Rectangle,this._isPositionDirty=!0,this._isRotationDirty=!0,this._localOffset=t.Vector2.zero}get absolutePosition(){return t.Vector2.add(this.entity.transform.position,this._localOffset)}get rotation(){return this.shouldColliderScaleAndRotateWithTransform&&null!=this.entity?this.entity.transform.rotation:0}get bounds(){return(this._isPositionDirty||this._isRotationDirty)&&(this.shape.recalculateBounds(this),this.drawCollider&&this.drawCollider.call(this),this._isPositionDirty=this._isRotationDirty=!1),this.shape.bounds}get localOffset(){return this._localOffset}set localOffset(t){this.setLocalOffset(t)}setLocalOffset(t){return this._localOffset.equals(t)||(this.unregisterColliderWithPhysicsSystem(),this._localOffset.setTo(t.x,t.y),this._localOffsetLength=this._localOffset.magnitude(),this._isPositionDirty=!0,this.registerColliderWithPhysicsSystem()),this}setShouldColliderScaleAndRotateWithTransform(t){return this.shouldColliderScaleAndRotateWithTransform=t,this._isPositionDirty=this._isRotationDirty=!0,this}onAddedToEntity(){this._isParentEntityAddedToScene=!0,this.registerColliderWithPhysicsSystem()}onRemovedFromEntity(){this.unregisterColliderWithPhysicsSystem(),this._isParentEntityAddedToScene=!1}onEntityTransformChanged(e){switch(e){case t.ComponentTransform.position:case t.ComponentTransform.scale:this._isPositionDirty=!0;break;case t.ComponentTransform.rotation:this._isRotationDirty=!0}this._isColliderRegistered&&t.Physics.updateCollider(this)}onEnabled(){this.registerColliderWithPhysicsSystem(),this._isPositionDirty=this._isRotationDirty=!0}onDisabled(){this.unregisterColliderWithPhysicsSystem()}registerColliderWithPhysicsSystem(){this._isParentEntityAddedToScene&&!this._isColliderRegistered&&(t.Physics.addCollider(this),this._isColliderRegistered=!0)}unregisterColliderWithPhysicsSystem(){this._isParentEntityAddedToScene&&this._isColliderRegistered&&t.Physics.removeCollider(this),this._isColliderRegistered=!1}overlaps(t){return this.shape.overlaps(t.shape)}collidesWith(t,e,s){const i=this.entity.position;this.entity.position=this.entity.position.add(e);const n=this.shape.collidesWithShape(t.shape,s);return n&&(s.value.collider=t),this.entity.position=i,n}collidesWithNonMotion(t,e){return this.shape.collidesWithShape(t.shape,e)?(e.value.collider=t,!0):(e.value.collider=null,!1)}collidesWithAny(e,s){s.value=new t.CollisionResult;let i=this.bounds.clone();i.x+=e.x,i.y+=e.y;let n=t.Physics.boxcastBroadphaseExcludingSelf(this,i,this.collidesWithLayers.value),r=this.shape.position;this.shape.position=t.Vector2.add(this.shape.position,e);let o=!1;for(let t=0;t<n.length;t++){const i=n[t];i.isTrigger||this.collidesWithNonMotion(i,s)&&(e=e.sub(s.value.minimumTranslationVector),this.shape.position=this.shape.position.sub(s.value.minimumTranslationVector),o=!0)}return this.shape.position=r,o}collidesWithAnyNonMotion(e){e.value=new t.CollisionResult;let s=t.Physics.boxcastBroadphaseExcludingSelfNonRect(this,this.collidesWithLayers.value);for(let t of s)if(!t.isTrigger&&this.collidesWithNonMotion(t,e))return!0;return!1}}e.lateSortOrder=999,t.Collider=e}(es||(es={})),function(t){t.BoxCollider=class extends t.Collider{constructor(e=0,s=0,i=1,n=1){super(),this._localOffset=new t.Vector2(e+i/2,s+n/2),this.shape=new t.Box(i,n)}get width(){return this.shape.width}set width(t){this.setWidth(t)}get height(){return this.shape.height}set height(t){this.setHeight(t)}setSize(e,s){let i=this.shape;return e==i.width&&s==i.height||(i.updateBox(e,s),this._isPositionDirty=!0,this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}setWidth(e){let s=this.shape;return e!=s.width&&(s.updateBox(e,s.height),this._isPositionDirty=!0,null!=this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}setHeight(e){let s=this.shape;e!=s.height&&(s.updateBox(s.width,e),this._isPositionDirty=!0,this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this))}toString(){return`[BoxCollider: bounds: ${this.bounds}]`}}}(es||(es={})),function(t){t.CircleCollider=class extends t.Collider{constructor(e=1){super(),this.shape=new t.Circle(e)}get radius(){return this.shape.radius}set radius(t){this.setRadius(t)}setRadius(e){let s=this.shape;return e!=s.radius&&(s.radius=e,s._originalRadius=e,this._isPositionDirty=!0,null!=this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}toString(){return`[CircleCollider: bounds: ${this.bounds}, radius: ${this.shape.radius}]`}}}(es||(es={})),function(t){t.PolygonCollider=class extends t.Collider{constructor(e){super(),e[0]==e[e.length-1]&&(e=e.slice(0,e.length-1));let s=t.Polygon.findPolygonCenter(e);this.setLocalOffset(s),t.Polygon.recenterPolygonVerts(e),this.shape=new t.Polygon(e)}}}(es||(es={})),function(t){t.SectorCollider=class extends t.Collider{constructor(e,s,i,n){super(),this.shape=new t.Sector(e,s,i,n)}}}(es||(es={})),function(t){function e(e){switch(typeof e){case"boolean":case"number":case"string":return""+e;case"function":return t.getClassName(e);default:return e.uuid=e.uuid?e.uuid:t.UUID.randomUUID(),e.uuid}}t.HashMap=class{constructor(){this.clear()}clear(){this.map_={},this.keys_={}}values(){const t=[],e=this.map_;for(const s in e)t.push(e[s]);return t}contains(t){const e=this.map_;for(const s in e)if(t===e[s])return!0;return!1}containsKey(t){return e(t)in this.map_}containsValue(t){const e=this.map_;for(const s in e)if(t===e[s])return!0;return!1}get(t){return this.map_[e(t)]}isEmpty(){return 0===Object.keys(this.map_).length}keys(){const t=this.map_,e=[];for(const s in t)e.push(t[s]);return e}put(t,s){const i=e(t);this.map_[i]=s,this.keys_[i]=t}remove(t){const s=this.map_,i=e(t),n=s[i];return delete s[i],delete this.keys_[i],n}size(){return Object.keys(this.map_).length}}}(es||(es={})),function(t){t.EntitySystem=class{get useTime(){return this._useTime}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}constructor(e){this._entities=[],this._updateOrder=0,this._startTime=0,this._endTime=0,this._useTime=0,this._matcher=e||t.Matcher.empty(),this.initialize()}get scene(){return this._scene}set scene(t){this._scene=t,this._entities=[]}get matcher(){return this._matcher}setUpdateOrder(t){this._updateOrder=t,this.scene.entityProcessors.setDirty()}initialize(){}onChanged(t){let e=!!this._entities.find(e=>e.id==t.id),s=this._matcher.isInterestedEntity(t);s&&!e?this.add(t):!s&&e&&this.remove(t)}add(t){this._entities.find(e=>e.id==t.id)||this._entities.push(t),this.onAdded(t)}onAdded(t){}remove(e){new t.List(this._entities).remove(e),this.onRemoved(e)}onRemoved(t){}update(){this.checkProcessing()&&(this.begin(),this.process(this._entities))}lateUpdate(){this.checkProcessing()&&(this.lateProcess(this._entities),this.end())}begin(){t.Core.Instance.debug&&(this._startTime=Date.now())}process(t){}lateProcess(t){}end(){t.Core.Instance.debug&&(this._endTime=Date.now(),this._useTime=this._endTime-this._startTime)}checkProcessing(){return!0}}}(es||(es={})),function(t){t.DelayedIteratingSystem=class extends t.EntitySystem{constructor(t){super(t),this.delay=0,this.running=!1,this.acc=0}process(t){const e=t.length;if(0!==e){this.delay=Number.MAX_VALUE;for(let s=0;s<e;s++){const e=t[s];this.processDelta(e,this.acc);const i=this.getRemainingDelay(e);i<=0?this.processExpired(e):this.offerDelay(i)}this.acc=0}else this.stop()}checkProcessing(){return!!this.running&&(this.acc+=t.Time.deltaTime,this.acc>=this.delay)}offerDelay(t){this.running?this.delay=Math.min(this.delay,t):(this.running=!0,this.delay=t)}getInitialTimeDelay(){return this.delay}getRemainingTimeUntilProcessing(){return this.running?this.delay-this.acc:0}isRunning(){return this.running}stop(){this.running=!1,this.acc=0}}}(es||(es={})),function(t){t.EntityProcessingSystem=class extends t.EntitySystem{constructor(t){super(t),this.enabled=!0}lateProcessEntity(t){}process(t){if(0!==t.length)for(let e=0,s=t.length;e<s;e++){const s=t[e];this.processEntity(s)}}lateProcess(t){if(0!==t.length)for(let e=0,s=t.length;e<s;e++){const s=t[e];this.lateProcessEntity(s)}}checkProcessing(){return this.enabled}}}(es||(es={})),function(t){t.IntervalSystem=class extends t.EntitySystem{constructor(t,e){super(t),this.acc=0,this.intervalRemainder=0,this.interval=e}checkProcessing(){return this.acc+=t.Time.deltaTime,this.acc>=this.interval&&(this.intervalRemainder=this.acc-this.interval,this.acc=0,!0)}getIntervalDelta(){return this.interval+this.intervalRemainder}}}(es||(es={})),function(t){t.IntervalIteratingSystem=class extends t.IntervalSystem{constructor(t,e){super(t,e)}process(t){t.forEach(t=>this.processEntity(t))}}}(es||(es={})),function(t){t.PassiveSystem=class extends t.EntitySystem{onChanged(t){}process(t){this.begin(),this.end()}}}(es||(es={})),function(t){t.ProcessingSystem=class extends t.EntitySystem{onChanged(t){}process(t){this.begin(),this.processSystem(),this.end()}}}(es||(es={})),function(t){t.Bits=class{constructor(){this._bit={}}set(t,e){this._bit[t]=e}get(t){let e=this._bit[t];return null==e?0:e}}}(es||(es={})),function(t){class e{constructor(t){this._components=[],this._updatableComponents=[],this._componentsToAdd={},this._componentsToRemove={},this._componentsToAddList=[],this._componentsToRemoveList=[],this._tempBufferList=[],this.componentsByType=new Map,this.componentsToAddByType=new Map,this._entity=t}get count(){return this._components.length}get buffer(){return this._components}markEntityListUnsorted(){this._isComponentListUnsorted=!0}add(t){this._componentsToAdd[t.id]=t,this._componentsToAddList.push(t),this.addComponentsToAddByType(t)}remove(t){if(this._componentsToAdd[t.id]){const e=this._componentsToAddList.findIndex(e=>e.id===t.id);return-1!==e&&this._componentsToAddList.splice(e,1),delete this._componentsToAdd[t.id],void this.removeComponentsToAddByType(t)}this._componentsToRemove[t.id]=t,this._componentsToRemoveList.push(t)}removeAllComponents(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;++t)this.handleRemove(this._components[t]);this.componentsByType.clear(),this.componentsToAddByType.clear(),this._components.length=0,this._updatableComponents.length=0,this._componentsToAdd={},this._componentsToRemove={},this._componentsToAddList.length=0,this._componentsToRemoveList.length=0}deregisterAllComponents(){if(this._components.length>0)for(const e of this._components)t.isIUpdatable(e)&&new t.List(this._updatableComponents).remove(e),this.decreaseBits(e),this._entity.scene.entityProcessors.onComponentRemoved(this._entity)}registerAllComponents(){if(this._components.length>0)for(const e of this._components)t.isIUpdatable(e)&&this._updatableComponents.push(e),this.addBits(e),this._entity.scene.entityProcessors.onComponentAdded(this._entity)}decreaseBits(e){const s=this._entity.componentBits,i=t.ComponentTypeManager.getIndexFor(t.TypeUtils.getType(e));s.set(i,s.get(i)-1)}addBits(e){const s=this._entity.componentBits,i=t.ComponentTypeManager.getIndexFor(t.TypeUtils.getType(e));s.set(i,s.get(i)+1)}updateLists(){if(this._componentsToRemoveList.length>0){for(const t of this._componentsToRemoveList){this.handleRemove(t);const e=this._components.findIndex(e=>e.id===t.id);-1!==e&&this._components.splice(e,1),this.removeComponentsByType(t)}this._componentsToRemove={},this._componentsToRemoveList.length=0}if(this._componentsToAddList.length>0){for(const e of this._componentsToAddList)t.isIUpdatable(e)&&this._updatableComponents.push(e),this.addBits(e),this._entity.scene.entityProcessors.onComponentAdded(this._entity),this.addComponentsByType(e),this._components.push(e),this._tempBufferList.push(e);this._componentsToAdd={},this._componentsToAddList.length=0,this.componentsToAddByType.clear(),this._isComponentListUnsorted=!0}if(this._tempBufferList.length>0){for(const t of this._tempBufferList)t.onAddedToEntity(),t.enabled&&t.onEnabled();this._tempBufferList.length=0}}handleRemove(e){if(t.isIUpdatable(e)&&this._updatableComponents.length>0){const t=this._updatableComponents.findIndex(t=>t.id===e.id);-1!==t&&this._updatableComponents.splice(t,1)}this.decreaseBits(e),this._entity.scene.entityProcessors.onComponentRemoved(this._entity),e.onRemovedFromEntity(),e.entity=null}removeComponentsByType(e){const s=this.componentsByType.get(t.TypeUtils.getType(e)),i=s.findIndex(t=>t.id===e.id);-1!==i&&s.splice(i,1)}addComponentsByType(e){let s=this.componentsByType.get(t.TypeUtils.getType(e));s||(s=[]),s.push(e),this.componentsByType.set(t.TypeUtils.getType(e),s)}removeComponentsToAddByType(e){let s=this.componentsToAddByType.get(t.TypeUtils.getType(e)),i=s.findIndex(t=>t.id==e.id);-1!=i&&s.splice(i,1)}addComponentsToAddByType(e){let s=this.componentsToAddByType.get(t.TypeUtils.getType(e));s||(s=[]),s.push(e),this.componentsToAddByType.set(t.TypeUtils.getType(e),s)}getComponent(t,e){let s=this.componentsByType.get(t);if(s&&s.length>0)return s[0];if(!e){let e=this.componentsToAddByType.get(t);if(e&&e.length>0)return e[0]}return null}getComponents(t,e){e||(e=[]);let s=this.componentsByType.get(t);s&&(e=e.concat(s));let i=this.componentsToAddByType.get(t);return i&&(e=e.concat(i)),e}update(){if(this.updateLists(),this._updatableComponents.length>0)for(let t=0,e=this._updatableComponents.length;t<e;++t){let e=this._updatableComponents[t];e.enabled&&e.update()}}onEntityTransformChanged(t){if(this._components.length>0)for(let e=0,s=this._components.length;e<s;++e){let s=this._components[e];s.enabled&&s.onEntityTransformChanged(t)}if(this._componentsToAddList.length>0)for(let e=0,s=this._componentsToAddList.length;e<s;++e){let s=this._componentsToAddList[e];s.enabled&&s.onEntityTransformChanged(t)}}onEntityEnabled(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;t++)this._components[t].onEnabled()}onEntityDisabled(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;t++)this._components[t].onDisabled()}}e.compareUpdatableOrder=new t.IUpdatableComparer,t.ComponentList=e}(es||(es={})),function(t){t.ComponentTypeFactory=class{constructor(){this.componentTypes={},this.types=new t.Bag,this.componentTypeCount=0}getIndexFor(t){return this.getTypeFor(t).getIndex()}getTypeFor(e){if("number"==typeof e)return this.types.get(e);const s=t.getClassName(e);if(!this.componentTypes[s]){const i=this.componentTypeCount++,n=new t.ComponentType(e,i);this.componentTypes[s]=n,this.types.set(i,n)}return this.componentTypes[s]}}}(es||(es={})),function(t){class e{static add(t){this._componentTypesMask.has(t)||this._componentTypesMask.set(t,this._componentTypesMask.size)}static getIndexFor(t){let e=-1;return this._componentTypesMask.has(t)?e=this._componentTypesMask.get(t):(this.add(t),e=this._componentTypesMask.get(t)),e}}e._componentTypesMask=new Map,t.ComponentTypeManager=e}(es||(es={})),function(t){t.EntityList=class{constructor(t){this._entities=[],this._entitiesToAdded={},this._entitiesToRemove={},this._entitiesToAddedList=[],this._entitiesToRemoveList=[],this._entityDict=new Map,this._unsortedTags=new Set,this.scene=t}get count(){return this._entities.length}get buffer(){return this._entities}markEntityListUnsorted(){this._isEntityListUnsorted=!0}markTagUnsorted(t){this._unsortedTags.add(t)}add(t){this._entitiesToAdded[t.id]=t,this._entitiesToAddedList.push(t)}remove(t){if(this._entitiesToAdded[t.id]){const e=this._entitiesToAddedList.findIndex(e=>e.id===t.id);return-1!==e&&this._entitiesToAddedList.splice(e,1),void delete this._entitiesToAdded[t.id]}this._entitiesToRemoveList.push(t),this._entitiesToRemove[t.id]||(this._entitiesToRemove[t.id]=t)}removeAllEntities(){this._unsortedTags.clear(),this._entitiesToAdded={},this._entitiesToAddedList.length=0,this._isEntityListUnsorted=!1,this.updateLists();for(const t of this._entities)t._isDestroyed=!0,t.onRemovedFromScene(),t.scene=null;this._entities.length=0,this._entityDict.clear()}contains(t){return!!this._entitiesToAdded[t.id]}getTagList(t){let e=this._entityDict.get(t);return e||(e=new Set,this._entityDict.set(t,e)),e}addToTagList(t){this.getTagList(t.tag).add(t),this._unsortedTags.add(t.tag)}removeFromTagList(t){const e=this._entityDict.get(t.tag);e&&e.delete(t)}update(){for(let e=0;e<this._entities.length;e++){const s=this._entities[e];!s.enabled||1!==s.updateInterval&&t.Time.frameCount%s.updateInterval!=0||s.update()}}updateLists(){if(this._entitiesToRemoveList.length>0){for(const t of this._entitiesToRemoveList){this.removeFromTagList(t);const e=this._entities.findIndex(e=>e.id===t.id);-1!==e&&this._entities.splice(e,1),t.onRemovedFromScene(),t.scene=null,this.scene.entityProcessors.onEntityRemoved(t)}this._entitiesToRemove={},this._entitiesToRemoveList.length=0}if(this._entitiesToAddedList.length>0){for(const t of this._entitiesToAddedList)this._entities.push(t),t.scene=this.scene,this.addToTagList(t);for(const t of this._entitiesToAddedList)this.scene.entityProcessors.onEntityAdded(t);for(const t of this._entitiesToAddedList)t.onAddedToScene();this._entitiesToAdded={},this._entitiesToAddedList.length=0}}findEntity(t){if(this._entities.length>0)for(let e=0,s=this._entities.length;e<s;++e){let s=this._entities[e];if(s.name==t)return s}if(this._entitiesToAddedList.length>0)for(let e=0,s=this._entitiesToAddedList.length;e<s;++e){let s=this._entitiesToAddedList[e];if(s.name==t)return s}return null}findEntityRight(t){if(this._entities.length>0)for(let e=this._entities.length-1,s=0;e>=s;--e){let s=this._entities[e];if(s.name==t)return s}if(this._entitiesToAddedList.length>0)for(let e=this._entitiesToAddedList.length-1,s=0;e>=s;--e){let s=this._entitiesToAddedList[e];if(s.name==t)return s}return null}findEntityById(t){if(this._entities.length>0)for(let e=0,s=this._entities.length;e<s;++e){let s=this._entities[e];if(s.id==t)return s}return this._entitiesToAdded[t]}entitiesWithTag(e){const s=this.getTagList(e),i=t.ListPool.obtain(t.Entity);if(s.size>0)for(const t of s)i.push(t);return i}entityWithTag(t){let e=this.getTagList(t);if(e.size>0)for(let t of e)return t;return null}findComponentOfType(t){for(const e of this._entities)if(e.enabled){const s=e.getComponent(t);if(s)return s}for(const e of this._entitiesToAddedList)if(e.enabled){const s=e.getComponent(t);if(s)return s}return null}findComponentsOfType(e){const s=t.ListPool.obtain(e);for(const t of this._entities)t.enabled&&t.getComponents(e,s);for(const t of this._entitiesToAddedList)t.enabled&&t.getComponents(e,s);return s}findEntitiesOfComponent(...t){const e=[];for(const s of this._entities)if(s.enabled){if(0===t.length){e.push(s);continue}let i=!0;for(const e of t)if(!s.hasComponent(e)){i=!1;break}i&&e.push(s)}for(const s of this._entitiesToAddedList)if(s.enabled){if(0===t.length){e.push(s);continue}let i=!0;for(const e of t)if(!s.hasComponent(e)){i=!1;break}i&&e.push(s)}return e}}}(es||(es={})),function(t){t.EntityProcessorList=class{constructor(){this._processors=[],this._orderDirty=!1}get processors(){return this._processors}get count(){return this._processors.length}add(t){this._processors.push(t)}remove(e){new t.List(this._processors).remove(e)}onComponentAdded(t){this.notifyEntityChanged(t)}onComponentRemoved(t){this.notifyEntityChanged(t)}onEntityAdded(t){this.notifyEntityChanged(t)}onEntityRemoved(t){this.removeFromProcessors(t)}begin(){}update(){if(0!==this._processors.length){if(this._orderDirty){this._processors.sort((t,e)=>t.updateOrder-e.updateOrder);for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].setUpdateOrder(t);this.clearDirty()}for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].update()}}end(){}setDirty(){this._orderDirty=!0}clearDirty(){this._orderDirty=!1}getProcessor(t){if(0===this._processors.length)return null;for(let e=0,s=this._processors.length;e<s;++e){const s=this._processors[e];if(s instanceof t)return s}return null}notifyEntityChanged(t){if(0!==this._processors.length)for(let e=0,s=this._processors.length;e<s;++e)this._processors[e].onChanged(t)}removeFromProcessors(t){if(0!==this._processors.length)for(let e=0,s=this._processors.length;e<s;++e)this._processors[e].remove(t)}lateUpdate(){if(0!==this._processors.length)for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].lateUpdate()}}}(es||(es={})),function(t){class e{static isPrime(t){if(0!=(1&t)){let e=Math.sqrt(t);for(let s=3;s<=e;s+=2)if(t%s==0)return!1;return!0}return 2===t}static getPrime(t){if(t<0)throw new Error("参数错误 min 不能小于0");for(let e=0;e<this.primes.length;e++){let s=this.primes[e];if(s>=t)return s}for(let e=1|t;e<Number.MAX_VALUE;e+=2)if(this.isPrime(e)&&(e-1)%this.hashPrime!=0)return e;return t}static expandPrime(t){let e=2*t;return e>this.maxPrimeArrayLength&&this.maxPrimeArrayLength>t?this.maxPrimeArrayLength:this.getPrime(e)}static getHashCode(t){let e=0;if(0===t.length)return e;for(let s=0;s<t.length;s++){e=(e<<5)-e+t.charCodeAt(s),e&=e}return e}}e.hashCollisionThreshold=100,e.hashPrime=101,e.primes=[3,7,11,17,23,29,37,47,59,71,89,107,131,163,197,239,293,353,431,521,631,761,919,1103,1327,1597,1931,2333,2801,3371,4049,4861,5839,7013,8419,10103,12143,14591,17519,21023,25229,30293,36353,43627,52361,62851,75431,90523,108631,130363,156437,187751,225307,270371,324449,389357,467237,560689,672827,807403,968897,1162687,1395263,1674319,2009191,2411033,2893249,3471899,4166287,4999559,5999471,7199369],e.maxPrimeArrayLength=2146435069,t.HashHelpers=e}(es||(es={})),function(t){t.IdentifierPool=class{constructor(){this.nextAvailableId_=0,this.ids=new t.Bag}checkOut(){return this.ids.size()>0?this.ids.removeLast():this.nextAvailableId_++}checkIn(t){this.ids.add(t)}}}(es||(es={})),function(t){class e{constructor(){this.allSet=[],this.exclusionSet=[],this.oneSet=[]}static empty(){return new e}getAllSet(){return this.allSet}getExclusionSet(){return this.exclusionSet}getOneSet(){return this.oneSet}isInterestedEntity(t){return this.isInterested(t.componentBits)}isInterested(e){if(0!==this.allSet.length)for(let s=0;s<this.allSet.length;s++){const i=this.allSet[s];if(!e.get(t.ComponentTypeManager.getIndexFor(i)))return!1}if(0!==this.exclusionSet.length)for(let s=0;s<this.exclusionSet.length;s++){const i=this.exclusionSet[s];if(e.get(t.ComponentTypeManager.getIndexFor(i)))return!1}if(0!==this.oneSet.length){for(let s=0;s<this.oneSet.length;s++){const i=this.oneSet[s];if(e.get(t.ComponentTypeManager.getIndexFor(i)))return!0}return!1}return!0}all(...t){return this.allSet.push(...t),this}exclude(...t){return this.exclusionSet.push(...t),this}one(...t){return this.oneSet.push(...t),this}}t.Matcher=e}(es||(es={})),function(t){class e{static matchChineseWord(t){return t.match(/[\u4E00-\u9FA5]+/gim)}static lTrim(t){let e=0;for(;this.isWhiteSpace(t.charAt(e));)e++;return t.slice(e,t.length)}static rTrim(t){let e=t.length-1;for(;this.isWhiteSpace(t.charAt(e));)e--;return t.slice(0,e+1)}static trim(t){return null==t?null:this.rTrim(this.lTrim(t))}static isWhiteSpace(t){return" "==t||"\t"==t||"\r"==t||"\n"==t}static isNullOrEmpty(t){return""==t||null==t||void 0==t}static replaceMatch(t,e,s,i=!1){let n=t.length,r="",o=!1,a=1==i?e.toLowerCase():e;for(let e=0;e<n;e++)o=!1,t.charAt(e)==a.charAt(0)&&t.substr(e,a.length)==a&&(o=!0),o?(r+=s,e=e+a.length-1):r+=t.charAt(e);return r}static htmlSpecialChars(t,e=!1){let s=this.specialSigns.length;for(let i=0;i<s;i+=2){let s,n;if(s=this.specialSigns[i],n=this.specialSigns[i+1],e){let t=s;s=n,n=t}t=this.replaceMatch(t,s,n)}return t}static zfill(t,e=2){if(!t)return t;e=Math.floor(e);let s=t.length;if(s>=e)return t;let i=!1;"-"==t.substr(0,1)&&(i=!0,t=t.substr(1));let n=e-s;for(let e=0;e<n;e++)t="0"+t;return i&&(t="-"+t),t}static reverse(t){return t.length>1?this.reverse(t.substring(1))+t.substring(0,1):t}static cutOff(t,e,s,i=!0){e=Math.floor(e),s=Math.floor(s);let n=t.length;e>n&&(e=n);let r,o=e,a=e+s;return i?r=t.substring(0,o)+t.substr(a,n):(a=(o=n-1-e-s)+s,r=t.substring(0,o+1)+t.substr(a+1,n)),r}static strReplace(t,e){let s=0,i=e.length;for(;s<i;s++)null!=e[s]&&""!=e[s]||(e[s]="无"),t=t.replace("{"+s+"}",e[s]);return t}static format(t,...e){for(let s=0;s<e.length-1;s++){let i=new RegExp("\\{"+s+"\\}","gm");t=t.replace(i,e[s+1])}return t}}e.specialSigns=["&","&amp;","<","&lt;",">","&gt;",'"',"&quot;","'","&apos;","®","&reg;","©","&copy;","™","&trade;"],t.StringUtils=e}(es||(es={})),function(t){class e{static update(t,e){let s=0;e?s=t:(-1===t&&(t=Date.now()),-1===this._lastTime&&(this._lastTime=t),s=(t-this._lastTime)/1e3),s>this.maxDeltaTime&&(s=this.maxDeltaTime),this.totalTime+=s,this.deltaTime=s*this.timeScale,this.unscaledDeltaTime=s,this.timeSinceSceneLoad+=s,this.frameCount++,this._lastTime=t}static sceneChanged(){this.timeSinceSceneLoad=0}static checkEvery(t){return Math.floor(this.timeSinceSceneLoad/t)>Math.floor(this.deltaTime/t)}}e.totalTime=0,e.unscaledDeltaTime=0,e.deltaTime=0,e.timeScale=1,e.maxDeltaTime=Number.MAX_VALUE,e.frameCount=0,e.timeSinceSceneLoad=0,e._lastTime=-1,t.Time=e}(es||(es={})),function(t){t.TimeUtils=class{static monthId(t=null){let e=(t=t||new Date).getFullYear(),s=t.getMonth()+1;return parseInt(e+(s<10?"0":"")+s)}static dateId(t=null){let e=(t=t||new Date).getMonth()+1,s=e<10?"0":"",i=t.getDate(),n=i<10?"0":"";return parseInt(t.getFullYear()+s+e+n+i)}static weekId(t=null,e=!0){t=t||new Date;const s=new Date(t.getTime());s.setDate(1),s.setMonth(0);const i=s.getFullYear();let n=s.getDay();0==n&&(n=7);let r=!1;n<=4?(r=n>1,s.setDate(s.getDate()-(n-1))):s.setDate(s.getDate()+7-n+1);let o=this.diffDay(t,s,!1);if(o<0)return s.setDate(1),s.setMonth(0),s.setDate(s.getDate()-1),this.weekId(s,!1);const a=Math.floor(o/7),h=Math.floor(a)+1;if(53==h){s.setTime(t.getTime()),s.setDate(s.getDate()-1);let i=s.getDay();if(0==i&&(i=7),e&&(!r||i<4))return s.setFullYear(s.getFullYear()+1),s.setDate(1),s.setMonth(0),this.weekId(s,!1)}return parseInt(i+"00"+(h>9?"":"0")+h)}static diffDay(t,e,s=!1){let i=(t.getTime()-e.getTime())/864e5;return s?Math.ceil(i):Math.floor(i)}static getFirstDayOfWeek(t=new Date){let e=t.getDay()||7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+1-e,0,0,0,0)}static getFirstOfDay(t){return(t=t||new Date).setHours(0,0,0,0),t}static getNextFirstOfDay(t){return new Date(this.getFirstOfDay(t).getTime()+864e5)}static formatDate(t){let e=t.getFullYear(),s=t.getMonth()+1;s=s<10?"0"+s:s;let i=t.getDate();return e+"-"+s+"-"+(i=i<10?"0"+i:i)}static formatDateTime(t){let e=t.getFullYear(),s=t.getMonth()+1;s=s<10?"0"+s:s;let i=t.getDate();i=i<10?"0"+i:i;let n=t.getHours(),r=t.getMinutes();r=r<10?"0"+r:r;let o=t.getSeconds();return e+"-"+s+"-"+i+" "+n+":"+r+":"+(o=o<10?"0"+o:o)}static parseDate(t){let e=Date.parse(t);return isNaN(e)?new Date:new Date(Date.parse(t.replace(/-/g,"/")))}static secondToTime(t=0,e=":",s=!0){let i,n=Math.floor(t/3600),r=Math.floor(t%3600/60),o=Math.floor(t%3600%60),a=n.toString(),h=r.toString(),l=o.toString();return n<10&&(a="0"+a),r<10&&(h="0"+h),o<10&&(l="0"+l),i=s?a+e+h+e+l:h+e+l}static timeToMillisecond(t,e=":"){let s=t.split(e),i=0,n=s.length;for(let t=0;t<n;t++)i+=s[t]*Math.pow(60,n-1-t);return(i*=1e3).toString()}}}(es||(es={})),function(t){t.Bezier=class{static getPoint(e,s,i,n){let r=1-(n=t.MathHelper.clamp01(n));return e.scale(r*r).addEqual(s.scale(2*r*n)).addEqual(i.scale(n*n))}static getPointThree(e,s,i,n,r){const o=1-(r=t.MathHelper.clamp01(r));return e.scale(o*o*o).addEqual(s.scale(3*o*o*r)).addEqual(i.scale(3*o*r*r)).addEqual(n.scale(r*r*r))}static getFirstDerivative(t,e,s,i){return e.sub(t).scale(2*(1-i)).addEqual(s.sub(e).scale(2*i))}static getFirstDerivativeThree(e,s,i,n,r){let o=1-(r=t.MathHelper.clamp01(r));return s.sub(e).scale(3*o*o).addEqual(i.sub(s).scale(6*o*r)).addEqual(n.sub(i).scale(3*r*r))}static getOptimizedDrawingPoints(e,s,i,n,r=1){let o=t.ListPool.obtain(t.Vector2);return o.push(e),this.recursiveGetOptimizedDrawingPoints(e,s,i,n,o,r),o.push(n),o}static recursiveGetOptimizedDrawingPoints(e,s,i,n,r,o){let a=t.Vector2.divideScaler(e.add(s),2),h=t.Vector2.divideScaler(s.add(i),2),l=t.Vector2.divideScaler(i.add(n),2),c=t.Vector2.divideScaler(a.add(h),2),u=t.Vector2.divideScaler(h.add(l),2),d=t.Vector2.divideScaler(c.add(u),2),m=n.sub(e),p=Math.abs((s.x,n.x*m.y-(s.y-n.y)*m.x)),g=Math.abs((i.x-n.x)*m.y-(i.y-n.y)*m.x);(p+g)*(p+g)<o*(m.x*m.x+m.y*m.y)?r.push(d):(this.recursiveGetOptimizedDrawingPoints(e,a,c,d,r,o),this.recursiveGetOptimizedDrawingPoints(d,u,l,n,r,o))}}}(es||(es={})),function(t){t.BezierSpline=class{constructor(){this._points=[],this._curveCount=0}pointIndexAtTime(e){const s={time:0,range:0};return e>=1?(e=1,s.range=this._points.length-4):(e=t.MathHelper.clamp01(e)*this._curveCount,s.range=t.MathHelper.toInt(e),e-=s.range,s.range*=3),s.time=e,s}setControlPoint(t,e){if(t%3==0){const s=e.sub(this._points[t]);t>0&&this._points[t-1].addEqual(s),t+1<this._points.length&&this._points[t+1].addEqual(s)}this._points[t]=e}getPointAtTime(e){const s=this.pointIndexAtTime(e).range;return t.Bezier.getPointThree(this._points[s],this._points[s+1],this._points[s+2],this._points[s+3],e)}getVelocityAtTime(e){const s=this.pointIndexAtTime(e).range;return t.Bezier.getFirstDerivativeThree(this._points[s],this._points[s+1],this._points[s+2],this._points[s+3],e)}getDirectionAtTime(t){return this.getVelocityAtTime(t).normalize()}addCurve(t,e,s,i){0==this._points.length&&this._points.push(t),this._points.push(e),this._points.push(s),this._points.push(i),this._curveCount=(this._points.length-1)/3}reset(){this._points.length=0}getDrawingPoints(t){let e=[];for(let s=0;s<t;s++){let i=s/t;e[s]=this.getPointAtTime(i)}return e}}}(es||(es={})),function(t){t.Flags=class{static isFlagSet(t,e){return 0!=(t&e)}static isUnshiftedFlagSet(t,e){return 0!=(t&(e=1<<e))}static setFlagExclusive(t,e){t.value=1<<e}static setFlag(t,e){t.value|=1<<e}static unsetFlag(t,e){e=1<<e,t.value&=~e}static invertFlags(t){t.value=~t.value}static binaryStringRepresentation(t,e=10){let s=t.toString(2);for(;s.length<(e||2);)s="0"+s;return s}}}(es||(es={})),function(t){class e{static toDegrees(t){return 57.29577951308232*t}static toRadians(t){return.017453292519943295*t}static barycentric(t,e,s,i,n){return t+i/(1-i)*(e+(s-e)*n-t)}static catmullRom(t,e,s,i,n){const r=n*n;return(3*e-t-3*s+i)/2*(r*n)+(2*t-5*e+4*s-i/2)*r+(-t+s)/2*n+(e-t+s-i)/2}static map(t,e,s,i,n){return i+(t-e)*(n-i)/(s-e)}static map01(t,e,s){return 1*(t-e)/(s-e)}static map10(t,e,s){return 1-this.map01(t,e,s)}static smoothStep(t,e,s){return s=this.clamp01(s),s=this.hermite(t,0,e,0,s)}static wrapAngle(t){const e=(t+2*Math.PI)%(2*Math.PI);return e>Math.PI?e-2*Math.PI:e}static isPowerOfTwo(t){return!(t<=0)&&0==(t&t-1)}static lerp(t,s,i){return t+(s-t)*e.clamp01(i)}static betterLerp(t,s,i,n){return Math.abs(t-s)<n?s:e.lerp(t,s,i)}static lerpAngle(t,e,s){let i=this.repeat(e-t,360);return i>180&&(i-=360),t+i*this.clamp01(s)}static lerpAngleRadians(t,e,s){let i=this.repeat(e-t,2*Math.PI);return i>Math.PI&&(i-=2*Math.PI),t+i*this.clamp01(s)}static pingPong(t,e){return t=this.repeat(t,2*e),e-Math.abs(t-e)}static signThreshold(t,e){return Math.abs(t)>=e?Math.sign(t):0}static inverseLerp(t,e,s){const i=e-t;return 0===i?0:(s-t)/i}static lerpPrecise(t,e,s){return(1-s)*t+e*s}static clamp(t,e,s){return t<e?e:t>s?s:t}static snap(t,e){return Math.round(t/e)*e}static isEven(t){return t%2==0}static isOdd(t){return t%2!=0}static roundWithRoundedAmount(t,e){let s=Math.round(t);return e.value=t-s*Math.round(t/s),s}static clamp01(t){return t<0?0:t>1?1:t}static angleBetweenVectors(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static angleToVector(e,s){const i=Math.cos(e)*s,n=Math.sin(e)*s;return new t.Vector2(i,n)}static incrementWithWrap(t,e){return++t==e?0:t}static decrementWithWrap(t,e){return--t<0?e-1:t}static hypotenuse(t,e){let s=t*t+e*e;return Math.sqrt(s)}static closestPowerOfTwoGreaterThan(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}static roundToNearest(t,e){const s=t/e;return Math.round(s)*e}static withinEpsilon(t,e=this.Epsilon){return Math.abs(t)<e}static approach(t,e,s){return t<e?Math.min(t+s,e):Math.max(t-s,e)}static approachAngle(t,e,s){let i=this.deltaAngle(t,e);if(-s<i&&i<s)return e;let n=this.approach(t,t+i,s);return n=this.repeat(n,360)}static project(t,e){let s=t.dot(e)/e.lengthSquared();return e.scale(s)}static approachAngleRadians(t,e,s){let i=this.deltaAngleRadians(t,e);if(-s<i&&i<s)return e;let n=this.approach(t,t+i,s);return this.repeat(n,2*Math.PI)}static approximately(t,e,s=this.Epsilon){return Math.abs(t-e)<=s}static deltaAngle(t,e){let s=this.repeat(e-t,360);return s>180&&(s-=360),s}static between(t,e,s){return t>=e&&t<=s}static deltaAngleRadians(t,e){let s=this.repeat(e-t,2*Math.PI);return s>Math.PI&&(s-=2*Math.PI),s}static repeat(t,e){return t-Math.floor(t/e)*e}static floorToInt(t){const e=Math.floor(t);return this.toInt(e)}static rotateAround(e,s){const i=t.Time.totalTime*s,n=Math.cos(i),r=Math.sin(i),o=e.x+n,a=e.y+r;return new t.Vector2(o,a)}static rotateAround2(e,s,i){const{x:n,y:r}=s,{x:o,y:a}=e,h=this.toRadians(i),l=Math.cos(h),c=Math.sin(h),u=l*(o-n)-c*(a-r)+n,d=c*(o-n)+l*(a-r)+r;return new t.Vector2(u,d)}static pointOnCircle(e,s,i){const n=this.toRadians(i),r=Math.cos(n)*s,o=Math.sin(n)*s,a=r+e.x,h=o+e.y;return new t.Vector2(a,h)}static pointOnCircleRadians(e,s,i){const n=Math.cos(i)*s,r=Math.sin(i)*s,o=n+e.x,a=r+e.y;return new t.Vector2(o,a)}static lissajou(e=2,s=3,i=1,n=1,r=0){const o=Math.sin(t.Time.totalTime*e+r)*i,a=Math.cos(t.Time.totalTime*s)*n;return new t.Vector2(o,a)}static lissajouDamped(e=2,s=3,i=1,n=1,r=.5,o=0,a=5){const h=this.pingPong(t.Time.totalTime,a),l=Math.pow(Math.E,-o*h),c=l*Math.sin(t.Time.totalTime*e+r)*i,u=l*Math.cos(t.Time.totalTime*s)*n;return new t.Vector2(c,u)}static hermite(t,e,s,i,n){let r=n,o=r*r*r,a=r*r;if(0===n)return t;if(1===n)return s;return(2*t-2*s+i+e)*o+(3*s-3*t-2*e-i)*a+e*r+t}static isValid(t){return!Number.isNaN(t)&&t!==1/0}static smoothDamp(t,s,i,n,r,o){const a=2/(n=Math.max(1e-4,n)),h=a*o,l=1/(1+.48*h+.235*h*h),c=r*n;let u=t-s;const d=(i+a*(u=e.clamp(u,-c,c)))*o;i=(i-a*d)*l;let m=(s=t-u)+(u+d)*l;return t>s==m>s&&(i=((m=s)-s)/o),{value:m,currentVelocity:i}}static smoothDampVector(e,s,i,n,r,o){const a=t.Vector2.zero,h=this.smoothDamp(e.x,s.x,i.x,n,r,o);a.x=h.value,i.x=h.currentVelocity;const l=this.smoothDamp(e.y,s.y,i.y,n,r,o);return a.y=l.value,i.y=l.currentVelocity,a}static mapMinMax(t,s,i,n,r){return n+(e.clamp(t,s,i)-s)*(r-n)/(i-s)}static fromAngle(e){return new t.Vector2(Math.cos(e),Math.sin(e)).normalizeEqual()}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}}e.Epsilon=1e-5,e.Rad2Deg=57.29578,e.Deg2Rad=.0174532924,e.PiOver2=Math.PI/2,t.MathHelper=e}(es||(es={})),function(t){class e{static get Identity(){return this.identity}constructor(t,e,s,i,n,r,o,a,h,l,c,u,d,m,p,g){this.m11=t,this.m12=e,this.m13=s,this.m14=i,this.m21=n,this.m22=r,this.m23=o,this.m24=a,this.m31=h,this.m32=l,this.m33=c,this.m34=u,this.m41=d,this.m42=m,this.m43=p,this.m44=g}static createOrthographicOffCenter(t,s,i,n,r,o,a=new e){a.m11=2/(s-t),a.m12=0,a.m13=0,a.m14=0,a.m21=0,a.m22=2/(n-i),a.m23=0,a.m24=0,a.m31=0,a.m32=0,a.m33=1/(r-o),a.m34=0,a.m41=(t+s)/(t-s),a.m42=(n+i)/(i-n),a.m43=r/(r-o),a.m44=1}static createTranslation(t,e){e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0,e.m41=t.x,e.m42=t.y,e.m43=0,e.m44=1}static createRotationZ(t,s){s=e.Identity;var i=Math.cos(t),n=Math.sin(t);s.m11=i,s.m12=n,s.m21=-n,s.m22=i}static multiply(t,s,i=new e){let n=t.m11*s.m11+t.m12*s.m21+t.m13*s.m31+t.m14*s.m41,r=t.m11*s.m12+t.m12*s.m22+t.m13*s.m32+t.m14*s.m42,o=t.m11*s.m13+t.m12*s.m23+t.m13*s.m33+t.m14*s.m43,a=t.m11*s.m14+t.m12*s.m24+t.m13*s.m34+t.m14*s.m44,h=t.m21*s.m11+t.m22*s.m21+t.m23*s.m31+t.m24*s.m41,l=t.m21*s.m12+t.m22*s.m22+t.m23*s.m32+t.m24*s.m42,c=t.m21*s.m13+t.m22*s.m23+t.m23*s.m33+t.m24*s.m43,u=t.m21*s.m14+t.m22*s.m24+t.m23*s.m34+t.m24*s.m44,d=t.m31*s.m11+t.m32*s.m21+t.m33*s.m31+t.m34*s.m41,m=t.m31*s.m12+t.m32*s.m22+t.m33*s.m32+t.m34*s.m42,p=t.m31*s.m13+t.m32*s.m23+t.m33*s.m33+t.m34*s.m43,g=t.m31*s.m14+t.m32*s.m24+t.m33*s.m34+t.m34*s.m44,y=t.m41*s.m11+t.m42*s.m21+t.m43*s.m31+t.m44*s.m41,f=t.m41*s.m12+t.m42*s.m22+t.m43*s.m32+t.m44*s.m42,_=t.m41*s.m13+t.m42*s.m23+t.m43*s.m33+t.m44*s.m43,T=t.m41*s.m14+t.m42*s.m24+t.m43*s.m34+t.m44*s.m44;i.m11=n,i.m12=r,i.m13=o,i.m14=a,i.m21=h,i.m22=l,i.m23=c,i.m24=u,i.m31=d,i.m32=m,i.m33=p,i.m34=g,i.m41=y,i.m42=f,i.m43=_,i.m44=T}}e.identity=new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t.Matrix=e}(es||(es={})),function(t){class e{constructor(){this.m11=0,this.m12=0,this.m21=0,this.m22=0,this.m31=0,this.m32=0}static get identity(){return(new e).setIdentity()}setIdentity(){return this.setValues(1,0,0,1,0,0)}setValues(t,e,s,i,n,r){return this.m11=t,this.m12=e,this.m21=s,this.m22=i,this.m31=n,this.m32=r,this}get translation(){return new t.Vector2(this.m31,this.m32)}set translation(t){this.m31=t.x,this.m32=t.y}get rotation(){return Math.atan2(this.m21,this.m11)}set rotation(t){let e=Math.cos(t),s=Math.sin(t);this.m11=e,this.m12=s,this.m21=-s,this.m22=e}get rotationDegrees(){return t.MathHelper.toDegrees(this.rotation)}set rotationDegrees(e){this.rotation=t.MathHelper.toRadians(e)}get scale(){return new t.Vector2(this.m11,this.m22)}set scale(t){this.m11=t.x,this.m22=t.y}static createRotation(t,e){e.setIdentity();const s=Math.cos(t),i=Math.sin(t);e.m11=s,e.m12=i,e.m21=-1*i,e.m22=s}static createRotationOut(t,e){let s=Math.cos(t),i=Math.sin(t);e.m11=s,e.m12=i,e.m21=-i,e.m22=s}static createScale(t,e,s){s.m11=t,s.m12=0,s.m21=0,s.m22=e,s.m31=0,s.m32=0}static createScaleOut(t,e,s){s.m11=t,s.m12=0,s.m21=0,s.m22=e,s.m31=0,s.m32=0}static createTranslation(t,e,s){return s.m11=1,s.m12=0,s.m21=0,s.m22=1,s.m31=t,s.m32=e,s}static createTranslationOut(t,e){e.m11=1,e.m12=0,e.m21=0,e.m22=1,e.m31=t.x,e.m32=t.y}static invert(t){let e=1/t.determinant(),s=this.identity;return s.m11=t.m22*e,s.m12=-t.m12*e,s.m21=-t.m21*e,s.m22=t.m11*e,s.m31=(t.m32*t.m21-t.m31*t.m22)*e,s.m32=-(t.m32*t.m11-t.m31*t.m12)*e,s}add(t){return this.m11+=t.m11,this.m12+=t.m12,this.m21+=t.m21,this.m22+=t.m22,this.m31+=t.m31,this.m32+=t.m32,this}substract(t){return this.m11-=t.m11,this.m12-=t.m12,this.m21-=t.m21,this.m22-=t.m22,this.m31-=t.m31,this.m32-=t.m32,this}divide(t){return this.m11/=t.m11,this.m12/=t.m12,this.m21/=t.m21,this.m22/=t.m22,this.m31/=t.m31,this.m32/=t.m32,this}multiply(t){let e=this.m11*t.m11+this.m12*t.m21,s=this.m11*t.m12+this.m12*t.m22,i=this.m21*t.m11+this.m22*t.m21,n=this.m21*t.m12+this.m22*t.m22,r=this.m31*t.m11+this.m32*t.m21+t.m31,o=this.m31*t.m12+this.m32*t.m22+t.m32;return this.m11=e,this.m12=s,this.m21=i,this.m22=n,this.m31=r,this.m32=o,this}static multiply(t,e,s){const i=t.m11*e.m11+t.m12*e.m21,n=t.m11*e.m12+t.m12*e.m22,r=t.m21*e.m11+t.m22*e.m21,o=t.m21*e.m12+t.m22*e.m22,a=t.m31*e.m11+t.m32*e.m21+e.m31,h=t.m31*e.m12+t.m32*e.m22+e.m32;s.m11=i,s.m12=n,s.m21=r,s.m22=o,s.m31=a,s.m32=h}determinant(){return this.m11*this.m22-this.m12*this.m21}static lerp(t,e,s){return t.m11=t.m11+(e.m11-t.m11)*s,t.m12=t.m12+(e.m12-t.m12)*s,t.m21=t.m21+(e.m21-t.m21)*s,t.m22=t.m22+(e.m22-t.m22)*s,t.m31=t.m31+(e.m31-t.m31)*s,t.m32=t.m32+(e.m32-t.m32)*s,t}static transpose(t){let e=this.identity;return e.m11=t.m11,e.m12=t.m21,e.m21=t.m12,e.m22=t.m22,e.m31=0,e.m32=0,e}mutiplyTranslation(s,i){let n=new e;return e.createTranslation(s,i,n),t.MatrixHelper.multiply(this,n)}equals(t){return this==t}static toMatrix(e){let s=new t.Matrix;return s.m11=e.m11,s.m12=e.m12,s.m13=0,s.m14=0,s.m21=e.m21,s.m22=e.m22,s.m23=0,s.m24=0,s.m31=0,s.m32=0,s.m33=1,s.m34=0,s.m41=e.m31,s.m42=e.m32,s.m43=0,s.m44=1,s}toString(){return`{m11:${this.m11} m12:${this.m12} m21:${this.m21} m22:${this.m22} m31:${this.m31} m32:${this.m32}}`}}t.Matrix2D=e}(es||(es={})),function(t){t.MatrixHelper=class{static add(e,s){const i=new t.Matrix2D;return i.m11=e.m11+s.m11,i.m12=e.m12+s.m12,i.m21=e.m21+s.m21,i.m22=e.m22+s.m22,i.m31=e.m31+s.m31,i.m32=e.m32+s.m32,i}static divide(e,s){const i=new t.Matrix2D;return i.m11=e.m11/s.m11,i.m12=e.m12/s.m12,i.m21=e.m21/s.m21,i.m22=e.m22/s.m22,i.m31=e.m31/s.m31,i.m32=e.m32/s.m32,i}static multiply(e,s){const i=new t.Matrix2D;return s instanceof t.Matrix2D?(i.m11=e.m11*s.m11+e.m12*s.m21,i.m12=e.m11*s.m12+e.m12*s.m22,i.m21=e.m21*s.m11+e.m22*s.m21,i.m22=e.m21*s.m12+e.m22*s.m22,i.m31=e.m31*s.m11+e.m32*s.m21+s.m31,i.m32=e.m31*s.m12+e.m32*s.m22+s.m32):(i.m11=e.m11*s,i.m12=e.m12*s,i.m21=e.m21*s,i.m22=e.m22*s,i.m31=e.m31*s,i.m32=e.m32*s),i}static subtract(e,s){const i=new t.Matrix2D;return i.m11=e.m11-s.m11,i.m12=e.m12-s.m12,i.m21=e.m21-s.m21,i.m22=e.m22-s.m22,i.m31=e.m31-s.m31,i.m32=e.m32-s.m32,i}}}(es||(es={})),function(t){class e{static get empty(){return new e}static get maxRect(){return new e(Number.MIN_VALUE/2,Number.MIN_VALUE/2,Number.MAX_VALUE,Number.MAX_VALUE)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get max(){return new t.Vector2(this.right,this.bottom)}isEmpty(){return 0==this.width&&0==this.height&&0==this.x&&0==this.y}get location(){return new t.Vector2(this.x,this.y)}set location(t){this.x=t.x,this.y=t.y}get size(){return new t.Vector2(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get center(){return new t.Vector2(this.x+this.width/2,this.y+this.height/2)}constructor(e=0,s=0,i=0,n=0){this.x=0,this.y=0,this.width=0,this.height=0,this._tempMat=new t.Matrix2D,this._transformMat=new t.Matrix2D,this.x=e,this.y=s,this.width=i,this.height=n}static fromMinMax(t,s,i,n){return new e(t,s,i-t,n-s)}static rectEncompassingPoints(t){let e=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++){let o=t[r];o.x<e&&(e=o.x),o.x>i&&(i=o.x),o.y<s&&(s=o.y),o.y>n&&(n=o.y)}return this.fromMinMax(e,s,i,n)}getSide(e){switch(e){case t.Edge.top:return this.top;case t.Edge.bottom:return this.bottom;case t.Edge.left:return this.left;case t.Edge.right:return this.right;default:throw new Error("Argument Out Of Range")}}contains(t,e){return this.x<=t&&t<this.x+this.width&&this.y<=e&&e<this.y+this.height}inflate(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}intersects(t){return t.left<this.right&&this.left<t.right&&t.top<this.bottom&&this.top<t.bottom}rayIntersects(t){const e={intersected:!1,distance:0};let s=1/0;if(Math.abs(t.direction.x)<1e-6){if(t.start.x<this.x||t.start.x>this.x+this.width)return e}else{const i=1/t.direction.x;let n=(this.x-t.start.x)*i,r=(this.x+this.width-t.start.x)*i;if(n>r&&([r,n]=[n,r]),e.distance=Math.max(n,e.distance),s=Math.min(r,s),e.distance>s)return e}if(Math.abs(t.direction.y)<1e-6){if(t.start.y<this.y||t.start.y>this.y+this.height)return e}else{const i=1/t.direction.y;let n=(this.y-t.start.y)*i,r=(this.y+this.height-t.start.y)*i;if(n>r&&([r,n]=[n,r]),e.distance=Math.max(n,e.distance),s=Math.min(r,s),e.distance>s)return e}return e.intersected=!0,e}containsRect(t){return this.x<=t.x&&t.x<this.x+this.width&&this.y<=t.y&&t.y<this.y+this.height}getHalfSize(){return new t.Vector2(.5*this.width,.5*this.height)}getClosestPointOnBoundsToOrigin(){let e=this.max,s=Math.abs(this.location.x),i=new t.Vector2(this.location.x,0);return Math.abs(e.x)<s&&(s=Math.abs(e.x),i.x=e.x,i.y=0),Math.abs(e.y)<s&&(s=Math.abs(e.y),i.x=0,i.y=e.y),Math.abs(this.location.y)<s&&(s=Math.abs(this.location.y),i.x=0,i.y=this.location.y),i}getClosestPointOnRectangleToPoint(e){let s=t.Vector2.zero;return s.x=t.MathHelper.clamp(e.x,this.left,this.right),s.y=t.MathHelper.clamp(e.y,this.top,this.bottom),s}getClosestPointOnRectangleBorderToPoint(e,s){s.value=t.Vector2.zero;const i=t.Vector2.zero;if(i.x=t.MathHelper.clamp(e.x,this.left,this.right),i.y=t.MathHelper.clamp(e.y,this.top,this.bottom),this.contains(i.x,i.y)){let t=i.x-this.left,e=this.right-i.x,n=i.y-this.top,r=this.bottom-i.y,o=Math.min(t,e,n,r);o==n?(i.y=this.top,s.value.y=-1):o==r?(i.y=this.bottom,s.value.y=1):o==t?(i.x=this.left,s.value.x=-1):(i.x=this.right,s.value.x=1)}else i.x==this.left&&(s.value.x=-1),i.x==this.right&&(s.value.x=1),i.y==this.top&&(s.value.y=-1),i.y==this.bottom&&(s.value.y=1);return i}static intersect(t,s){if(t.intersects(s)){let i=Math.min(t.x+t.width,s.x+s.width),n=Math.max(t.x,s.x),r=Math.max(t.y,s.y),o=Math.min(t.y+t.height,s.y+s.height);return new e(n,r,i-n,o-r)}return new e(0,0,0,0)}offset(t,e){return this.x+=t,this.y+=e,this}static union(t,s){let i=Math.min(t.x,s.x),n=Math.min(t.y,s.y);return new e(i,n,Math.max(t.right,s.right)-i,Math.max(t.bottom,s.bottom)-n)}static overlap(t,s){let i=Math.max(t.x,s.x,0),n=Math.max(t.y,s.y,0);return new e(i,n,Math.max(Math.min(t.right,s.right)-i,0),Math.max(Math.min(t.bottom,s.bottom)-n,0))}calculateBounds(e,s,i,n,r,o,a){if(0==r)this.x=Math.trunc(e.x+s.x-i.x*n.x),this.y=Math.trunc(e.y+s.y-i.y*n.y),this.width=Math.trunc(o*n.x),this.height=Math.trunc(a*n.y);else{let h=e.x+s.x,l=e.y+s.y;t.Matrix2D.createTranslation(-h-i.x,-l-i.y,this._transformMat),t.Matrix2D.createScale(n.x,n.y,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat),t.Matrix2D.createRotation(r,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat),t.Matrix2D.createTranslation(h,l,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat);let c=new t.Vector2(h,l),u=new t.Vector2(h+o,l),d=new t.Vector2(h,l+a),m=new t.Vector2(h+o,l+a);t.Vector2Ext.transformR(c,this._transformMat,c),t.Vector2Ext.transformR(u,this._transformMat,u),t.Vector2Ext.transformR(d,this._transformMat,d),t.Vector2Ext.transformR(m,this._transformMat,m);let p=Math.trunc(Math.min(c.x,m.x,u.x,d.x)),g=Math.trunc(Math.max(c.x,m.x,u.x,d.x)),y=Math.trunc(Math.min(c.y,m.y,u.y,d.y)),f=Math.trunc(Math.max(c.y,m.y,u.y,d.y));this.location=new t.Vector2(p,y),this.width=Math.trunc(g-p),this.height=Math.trunc(f-y)}}getSweptBroadphaseBounds(t,s){let i=e.empty;return i.x=t>0?this.x:this.x+t,i.y=s>0?this.y:this.y+s,i.width=t>0?t+this.width:this.width-t,i.height=s>0?s+this.height:this.height-s,i}collisionCheck(t,e,s){e.value=s.value=0;let i=t.x-(this.x+this.width),n=t.x+t.width-this.x,r=t.y-(this.y+this.height),o=t.y+t.height-this.y;return!(i>0||n<0||r>0||o<0)&&(e.value=Math.abs(i)<n?i:n,s.value=Math.abs(r)<o?r:o,Math.abs(e.value)<Math.abs(s.value)?s.value=0:e.value=0,!0)}static getIntersectionDepth(e,s){let i=e.width/2,n=e.height/2,r=s.width/2,o=s.height/2,a=new t.Vector2(e.left+i,e.top+n),h=new t.Vector2(s.left+r,s.top+o),l=a.x-h.x,c=a.y-h.y,u=i+r,d=n+o;if(Math.abs(l)>=u||Math.abs(c)>=d)return t.Vector2.zero;let m=l>0?u-l:-u-l,p=c>0?d-c:-d-c;return new t.Vector2(m,p)}equals(t){return this===t}getHashCode(){return Math.trunc(this.x)^Math.trunc(this.y)^Math.trunc(this.width)^Math.trunc(this.height)}clone(){return new e(this.x,this.y,this.width,this.height)}}t.Rectangle=e}(es||(es={})),function(t){t.SubpixelFloat=class{constructor(){this.remainder=0}update(t){this.remainder+=t;let e=Math.trunc(this.remainder);return this.remainder-=e,e}reset(){this.remainder=0}}}(es||(es={})),function(t){t.SubpixelVector2=class{constructor(){this._x=new t.SubpixelFloat,this._y=new t.SubpixelFloat}update(t){t.x=this._x.update(t.x),t.y=this._y.update(t.y)}reset(){this._x.reset(),this._y.reset()}}}(es||(es={})),function(t){t.ColliderTriggerHelper=class{constructor(e){this._activeTriggerIntersections=new t.PairSet,this._previousTriggerIntersections=new t.PairSet,this._tempTriggerList=[],this._entity=e}update(){const e=[];let s=this.getColliders();if(s.length>0)for(let i=0;i<s.length;i++){let n=s[i],r=t.Physics.boxcastBroadphaseExcludingSelf(n,n.bounds,n.collidesWithLayers.value);for(let s=0;s<r.length;s++){let i=r[s];if((n.isTrigger||i.isTrigger)&&n.overlaps(i)){const s=new t.Pair(n,i);!this._activeTriggerIntersections.has(s)&&!this._previousTriggerIntersections.has(s)&&(i.castSortOrder>=t.Collider.lateSortOrder?e.push(s):this.notifyTriggerListeners(s,!0)),this._activeTriggerIntersections.add(s)}}}if(e.length>0)for(let t=0;t<e.length;t++){const s=e[t];this.notifyTriggerListeners(s,!0)}this.checkForExitedColliders()}getColliders(){const e=[];if(this._entity.components.buffer.length>0)for(let s=0;s<this._entity.components.buffer.length;s++){const i=this._entity.components.buffer[s];i instanceof t.Collider&&e.push(i)}return e}checkForExitedColliders(){this._previousTriggerIntersections.except(this._activeTriggerIntersections),this._previousTriggerIntersections.all.forEach(t=>{this.notifyTriggerListeners(t,!1)}),this._previousTriggerIntersections.clear(),this._previousTriggerIntersections.union(this._activeTriggerIntersections),this._activeTriggerIntersections.clear()}notifyTriggerListeners(e,s){if(t.TriggerListenerHelper.getITriggerListener(e.first.entity,this._tempTriggerList),this._tempTriggerList.length>0)for(let i=0;i<this._tempTriggerList.length;i++){const n=this._tempTriggerList[i];if(s?n.onTriggerEnter(e.second,e.first):n.onTriggerExit(e.second,e.first),this._tempTriggerList.length=0,e.second.entity){if(t.TriggerListenerHelper.getITriggerListener(e.second.entity,this._tempTriggerList),this._tempTriggerList.length>0)for(let t=0;t<this._tempTriggerList.length;t++){const i=this._tempTriggerList[t];s?i.onTriggerEnter(e.first,e.second):i.onTriggerExit(e.first,e.second)}this._tempTriggerList.length=0}}}}}(es||(es={})),function(t){let e;!function(t){t[t.center=0]="center",t[t.top=1]="top",t[t.bottom=2]="bottom",t[t.topLeft=9]="topLeft",t[t.topRight=5]="topRight",t[t.left=8]="left",t[t.right=4]="right",t[t.bottomLeft=10]="bottomLeft",t[t.bottomRight=6]="bottomRight"}(e=t.PointSectors||(t.PointSectors={}));t.Collisions=class{static lineToLine(t,e,s,i){const n=e.sub(t),r=i.sub(s),o=n.x*r.y-n.y*r.x;if(0==o)return!1;const a=s.sub(t),h=(a.x*r.y-a.y*r.x)/o;if(h<0||h>1)return!1;const l=(a.x*n.y-a.y*n.x)/o;return!(l<0||l>1)}static lineToLineIntersection(e,s,i,n,r=t.Vector2.zero){r.x=0,r.y=0;const o=s.sub(e),a=n.sub(i),h=o.x*a.y-o.y*a.x;if(0==h)return!1;const l=i.sub(e),c=(l.x*a.y-l.y*a.x)/h;if(c<0||c>1)return!1;const u=(l.x*o.y-l.y*o.x)/h;if(u<0||u>1)return!1;const d=e.add(o.scale(c));return r.x=d.x,r.y=d.y,!0}static closestPointOnLine(e,s,i){const n=s.sub(e);let r=i.sub(e).dot(n)/n.dot(n);return r=t.MathHelper.clamp(r,0,1),e.add(n.scale(r))}static circleToCircle(e,s,i,n){return t.Vector2.sqrDistance(e,i)<(s+n)*(s+n)}static circleToLine(e,s,i,n){return t.Vector2.sqrDistance(e,this.closestPointOnLine(i,n,e))<s*s}static circleToPoint(e,s,i){return t.Vector2.sqrDistance(e,i)<s*s}static rectToCircle(s,i,n){if(this.rectToPoint(s.x,s.y,s.width,s.height,i))return!0;let r,o;const a=this.getSector(s.x,s.y,s.width,s.height,i);return!!(0!=(a&e.top)&&(r=new t.Vector2(s.x,s.y),o=new t.Vector2(s.x+s.width,s.y),this.circleToLine(i,n,r,o))||0!=(a&e.bottom)&&(r=new t.Vector2(s.x,s.y+s.width),o=new t.Vector2(s.x+s.width,s.y+s.height),this.circleToLine(i,n,r,o))||0!=(a&e.left)&&(r=new t.Vector2(s.x,s.y),o=new t.Vector2(s.x,s.y+s.height),this.circleToLine(i,n,r,o))||0!=(a&e.right)&&(r=new t.Vector2(s.x+s.width,s.y),o=new t.Vector2(s.x+s.width,s.y+s.height),this.circleToLine(i,n,r,o)))}static rectToLine(s,i,n){const r=this.getSector(s.x,s.y,s.width,s.height,i),o=this.getSector(s.x,s.y,s.width,s.height,n);if(r==e.center||o==e.center)return!0;if(0!=(r&o))return!1;const a=r|o;return!!(0!=(a&e.top)&&this.lineToLine(new t.Vector2(s.x,s.y),new t.Vector2(s.x+s.width,s.y),i,n)||0!=(a&e.bottom)&&this.lineToLine(new t.Vector2(s.x,s.y+s.height),new t.Vector2(s.x+s.width,s.y+s.height),i,n)||0!=(a&e.left)&&this.lineToLine(new t.Vector2(s.x,s.y),new t.Vector2(s.x,s.y+s.height),i,n)||0!=(a&e.right)&&this.lineToLine(new t.Vector2(s.x+s.width,s.y),new t.Vector2(s.x+s.width,s.y+s.height),i,n))}static rectToPoint(t,e,s,i,n){return n.x>=t&&n.y>=e&&n.x<t+s&&n.y<e+i}static getSector(t,s,i,n,r){let o=e.center;return r.x<t?o|=e.left:r.x>=t+i&&(o|=e.right),r.y<s?o|=e.top:r.y>=s+n&&(o|=e.bottom),o}}}(es||(es={})),function(t){class e{constructor(e,s,i,n,r){this.fraction=0,this.distance=0,this.point=t.Vector2.zero,this.normal=t.Vector2.zero,this.collider=e,this.fraction=s,this.distance=i,this.point=n,this.centroid=t.Vector2.zero}setAllValues(t,e,s,i,n){this.collider=t,this.fraction=e,this.distance=s,this.point=i,this.normal=n}setValues(t,e,s,i){this.fraction=t,this.distance=e,this.point=s,this.normal=i}reset(){this.collider=null,this.fraction=this.distance=0}clone(){const t=new e;return t.setAllValues(this.collider,this.fraction,this.distance,this.point,this.normal),t}toString(){return`[RaycastHit] fraction: ${this.fraction}, distance: ${this.distance}, normal: ${this.normal}, centroid: ${this.centroid}, point: ${this.point}`}}t.RaycastHit=e}(es||(es={})),function(t){class e{static reset(){this._spatialHash=new t.SpatialHash(this.spatialHashCellSize),this._hitArray[0].reset(),this._colliderArray[0]=null}static clear(){this._spatialHash.clear()}static overlapCircle(t,s,i=e.allLayers){return this._colliderArray[0]=null,this._spatialHash.overlapCircle(t,s,this._colliderArray,i),this._colliderArray[0]}static overlapCircleAll(t,e,s,i=this.allLayers){return this._spatialHash.overlapCircle(t,e,s,i)}static boxcastBroadphase(t,e=this.allLayers){return this._spatialHash.aabbBroadphase(t,null,e)}static boxcastBroadphaseExcludingSelf(t,e,s=this.allLayers){return this._spatialHash.aabbBroadphase(e,t,s)}static boxcastBroadphaseExcludingSelfNonRect(t,e=this.allLayers){let s=t.bounds;return this._spatialHash.aabbBroadphase(s,t,e)}static boxcastBroadphaseExcludingSelfDelta(t,s,i,n=e.allLayers){let r=t.bounds.getSweptBroadphaseBounds(s,i);return this._spatialHash.aabbBroadphase(r,t,n)}static addCollider(t){e._spatialHash.register(t)}static removeCollider(t){e._spatialHash.remove(t)}static updateCollider(t){this._spatialHash.remove(t),this._spatialHash.register(t)}static linecast(t,s,i=this.allLayers,n=null){return this._hitArray[0].reset(),e.linecastAll(t,s,this._hitArray,i,n),this._hitArray[0]}static linecastAll(t,e,s,i=this.allLayers,n=null){return this._spatialHash.linecast(t,e,s,i,n)}static overlapRectangle(t,s=e.allLayers){return this._colliderArray[0]=null,this._spatialHash.overlapRectangle(t,this._colliderArray,s),this._colliderArray[0]}static overlapRectangleAll(t,s,i=e.allLayers){return 0==s.length?(console.warn("传入了一个空的结果数组。不会返回任何结果"),0):this._spatialHash.overlapRectangle(t,s,i)}}e.gravity=new t.Vector2(0,-300),e.spatialHashCellSize=100,e.allLayers=-1,e.raycastsHitTriggers=!1,e.raycastsStartInColliders=!1,e.debugRender=!1,e._hitArray=[new t.RaycastHit],e._colliderArray=[null],t.Physics=e}(es||(es={})),function(t){t.Ray2D=class{get start(){return this._start}get direction(){return this._direction}get end(){return this._end}constructor(t,e){this._start=t.clone(),this._end=e.clone(),this._direction=this._end.sub(this._start)}}}(es||(es={})),function(t){t.SpatialHash=class{constructor(i=100){this.gridBounds=new t.Rectangle,this._overlapTestBox=new t.Box(0,0),this._overlapTestCircle=new t.Circle(0),this._cellDict=new e,this._tempHashSet=new Set,this._cellSize=i,this._inverseCellSize=1/this._cellSize,this._raycastParser=new s}register(e){const s=e.bounds.clone();e.registeredPhysicsBounds=s;const i=this.cellCoords(s.x,s.y),n=this.cellCoords(s.right,s.bottom);this.gridBounds.contains(i.x,i.y)||(this.gridBounds=t.RectangleExt.union(this.gridBounds,i)),this.gridBounds.contains(n.x,n.y)||(this.gridBounds=t.RectangleExt.union(this.gridBounds,n));for(let t=i.x;t<=n.x;t++)for(let s=i.y;s<=n.y;s++)this.cellAtPosition(t,s,!0).push(e)}remove(e){const s=e.registeredPhysicsBounds.clone(),i=this.cellCoords(s.x,s.y),n=this.cellCoords(s.right,s.bottom);for(let s=i.x;s<=n.x;s++)for(let r=i.y;r<=n.y;r++){const i=this.cellAtPosition(s,r);null!=i&&new t.List(i).remove(e)}}removeWithBruteForce(t){this._cellDict.remove(t)}clear(){this._cellDict.clear()}aabbBroadphase(e,s,i){this._tempHashSet.clear();const n=this.cellCoords(e.x,e.y),r=this.cellCoords(e.right,e.bottom);for(let o=n.x;o<=r.x;o++)for(let a=n.y;a<=r.y;a++){const n=this.cellAtPosition(o,a);if(n&&n.length>0)for(let r=0;r<n.length;r++){const o=n[r];o!==s&&t.Flags.isFlagSet(i,o.physicsLayer.value)&&e.intersects(o.bounds)&&this._tempHashSet.add(o)}}return Array.from(this._tempHashSet)}linecast(e,s,i,n,r){const o=new t.Ray2D(e,s);this._raycastParser.start(o,i,n,r);let a=this.cellCoords(e.x,e.y);const h=this.cellCoords(s.x,s.y);let l=Math.sign(o.direction.x),c=Math.sign(o.direction.y);a.x===h.x&&(l=0),a.y===h.y&&(c=0);const u=l<0?0:l,d=c<0?0:c;let m=(a.x+u)*this._cellSize,p=(a.y+d)*this._cellSize,g=0!==o.direction.x?(m-o.start.x)/o.direction.x:Number.MAX_VALUE,y=0!==o.direction.y?(p-o.start.y)/o.direction.y:Number.MAX_VALUE;const f=0!==o.direction.x?this._cellSize/(o.direction.x*l):Number.MAX_VALUE,_=0!==o.direction.y?this._cellSize/(o.direction.y*c):Number.MAX_VALUE;let T=this.cellAtPosition(a.x,a.y);if(null!==T&&this._raycastParser.checkRayIntersection(a.x,a.y,T))return this._raycastParser.reset(),this._raycastParser.hitCounter;for(;a.x!==h.x||a.y!==h.y;)if(g<y?(a.x=t.MathHelper.toInt(t.MathHelper.approach(a.x,h.x,Math.abs(l))),g+=f):(a.y=t.MathHelper.toInt(t.MathHelper.approach(a.y,h.y,Math.abs(c))),y+=_),(T=this.cellAtPosition(a.x,a.y))&&this._raycastParser.checkRayIntersection(a.x,a.y,T))return this._raycastParser.reset(),this._raycastParser.hitCounter;return this._raycastParser.reset(),this._raycastParser.hitCounter}overlapRectangle(e,s,i){this._overlapTestBox.updateBox(e.width,e.height),this._overlapTestBox.position=e.location;let n=0;const r=this.aabbBroadphase(e,null,i);for(let i=0;i<r.length;i++){const o=r[i];if(o instanceof t.BoxCollider)s[n]=o,n++;else if(o instanceof t.CircleCollider)t.Collisions.rectToCircle(e,o.bounds.center,.5*o.bounds.width)&&(s[n]=o,n++);else{if(!(o instanceof t.PolygonCollider))throw new Error("overlapRectangle对这个类型没有实现!");o.shape.overlaps(this._overlapTestBox)&&(s[n]=o,n++)}if(n===s.length)return n}return n}overlapCircle(e,s,i,n){const r=new t.Rectangle(e.x-s,e.y-s,2*s,2*s);this._overlapTestCircle.radius=s,this._overlapTestCircle.position=e;let o=0;const a=this.aabbBroadphase(r,null,n);if(a.length>0)for(let e=0;e<a.length;e++){const s=a[e];if(s instanceof t.BoxCollider)s.shape.overlaps(this._overlapTestCircle)&&(i[o]=s,o++);else if(s instanceof t.CircleCollider)s.shape.overlaps(this._overlapTestCircle)&&(i[o]=s,o++);else{if(!(s instanceof t.PolygonCollider))throw new Error("对这个对撞机类型的overlapCircle没有实现!");s.shape.overlaps(this._overlapTestCircle)&&(i[o]=s,o++)}}return o}cellCoords(e,s){return new t.Vector2(Math.floor(e*this._inverseCellSize),Math.floor(s*this._inverseCellSize))}cellAtPosition(t,e,s=!1){let i=this._cellDict.tryGetValue(t,e);return i||s&&(i=[],this._cellDict.add(t,e,i)),i}};class e{constructor(){this._store=new Map}add(t,e,s){this._store.set(this.getKey(t,e),s)}remove(t){this._store.forEach(e=>{let s=e.indexOf(t);e.splice(s,1)})}tryGetValue(t,e){return this._store.get(this.getKey(t,e))}getKey(t,e){return`${t}_${e}`}clear(){this._store.clear()}}t.NumberDictionary=e;class s{constructor(){this._tempHit=new t.RaycastHit,this._checkedColliders=[],this._cellHits=[]}start(t,e,s,i){this._ray=t,this._hits=e,this._layerMask=s,this._ignoredColliders=i,this.hitCounter=0}checkRayIntersection(e,i,n){for(let e=0;e<n.length;e++){const s=n[e];if(-1!=this._checkedColliders.indexOf(s))continue;if(this._checkedColliders.push(s),s.isTrigger&&!t.Physics.raycastsHitTriggers)continue;if(!t.Flags.isFlagSet(this._layerMask,s.physicsLayer.value))continue;if(this._ignoredColliders&&this._ignoredColliders.has(s))continue;const i=s.bounds.rayIntersects(this._ray);if(i.intersected&&i.distance<=1){let e=new t.Out(this._tempHit);if(s.shape.collidesWithLine(this._ray.start,this._ray.end,e)){if(!t.Physics.raycastsStartInColliders&&s.shape.containsPoint(this._ray.start))continue;e.value.collider=s,this._cellHits.push(e.value)}}}if(0===this._cellHits.length)return!1;this._cellHits=this._cellHits.sort(s.compareRaycastHits);for(let t=0;t<this._cellHits.length;t++)if(this._hits[this.hitCounter]=this._cellHits[t],this.hitCounter++,this.hitCounter===this._hits.length)return!0;return!1}reset(){this._hits=null,this._checkedColliders.length=0,this._cellHits.length=0,this._ignoredColliders=null}}s.compareRaycastHits=((t,e)=>t.distance!==e.distance?t.distance-e.distance:t.collider.castSortOrder-e.collider.castSortOrder),t.RaycastResultParser=s}(es||(es={})),function(t){t.Shape=class{}}(es||(es={})),function(t){class e extends t.Shape{constructor(t,e){super(),this._areEdgeNormalsDirty=!0,this.isUnrotated=!0,this.setPoints(t),this.isBox=e}create(t,s){e.buildSymmetricalPolygon(t,s)}get edgeNormals(){return this._areEdgeNormalsDirty&&this.buildEdgeNormals(),this._edgeNormals}setPoints(t){this.points=t,this.recalculateCenterAndEdgeNormals(),this._originalPoints=[],this.points.forEach(t=>{this._originalPoints.push(t.clone())})}recalculateCenterAndEdgeNormals(){this._polygonCenter=e.findPolygonCenter(this.points),this._areEdgeNormalsDirty=!0}buildEdgeNormals(){let e,s=this.isBox?2:this.points.length;void 0!=this._edgeNormals&&this._edgeNormals.length==s||(this._edgeNormals=new Array(s));for(let i=0;i<s;i++){let s=this.points[i];e=i+1>=this.points.length?this.points[0]:this.points[i+1];let n=t.Vector2Ext.perpendicular(s,e);t.Vector2Ext.normalize(n),this._edgeNormals[i]=n}}static buildSymmetricalPolygon(e,s){const i=new Array(e);for(let n=0;n<e;n++){const r=2*Math.PI*(n/e);i[n]=new t.Vector2(Math.cos(r)*s,Math.sin(r)*s)}return i}static recenterPolygonVerts(t){const e=this.findPolygonCenter(t);for(let s=0;s<t.length;s++)t[s]=t[s].sub(e)}static findPolygonCenter(e){let s=0,i=0;for(let t=0;t<e.length;t++)s+=e[t].x,i+=e[t].y;return new t.Vector2(s/e.length,i/e.length)}static getFarthestPointInDirection(t,e){let s=0,i=t[s].dot(e);for(let n=1;n<t.length;n++){let r=t[n].dot(e);r>i&&(i=r,s=n)}return t[s]}static getClosestPointOnPolygonToPoint(e,s){const i={distanceSquared:Number.MAX_VALUE,edgeNormal:t.Vector2.zero,closestPoint:t.Vector2.zero};let n=0;for(let r=0;r<e.length;r++){let o=r+1;o===e.length&&(o=0);const a=t.ShapeCollisionsCircle.closestPointOnLine(e[r],e[o],s);if((n=t.Vector2.sqrDistance(s,a))<i.distanceSquared){i.distanceSquared=n,i.closestPoint=a;const t=e[o].sub(e[r]);i.edgeNormal.x=t.y,i.edgeNormal.y=-t.x}}return i.edgeNormal=i.edgeNormal.normalize(),i}static rotatePolygonVerts(e,s,i){let n=Math.cos(e),r=Math.sin(e);for(let e=0;e<s.length;e++){let o=s[e];i[e]=new t.Vector2(o.x*n+o.y*-r,o.x*r+o.y*n)}}recalculateBounds(e){if(this.center=e.localOffset,e.shouldColliderScaleAndRotateWithTransform){let s=!0;const i=new t.Matrix2D,n=new t.Matrix2D;t.Matrix2D.createTranslation(-this._polygonCenter.x,-this._polygonCenter.y,n);const r=e.entity.transform.scale;if(!r.equals(t.Vector2.one)){t.Matrix2D.createScale(r.x,r.y,i),t.Matrix2D.multiply(n,i,n),s=!1;const o=e.localOffset.multiply(r);this.center=o}const o=e.entity.transform.rotationDegrees;if(0!==o){const a=s?e._localOffsetLength:e.localOffset.multiply(r).magnitude(),h=Math.atan2(e.localOffset.y*r.y,e.localOffset.x*r.x)*t.MathHelper.Rad2Deg;this.center=t.MathHelper.pointOnCircle(t.Vector2.zero,a,o+h),t.Matrix2D.createRotation(t.MathHelper.Deg2Rad*o,i),t.Matrix2D.multiply(n,i,n)}t.Matrix2D.createTranslation(this._polygonCenter.x+e.transform.position.x+this.center.x,this._polygonCenter.y+e.transform.position.y+this.center.y,i),t.Matrix2D.multiply(n,i,n),this.points=this._originalPoints.map(t=>t.transform(n)),this.isUnrotated=0===o,e._isRotationDirty&&(this._areEdgeNormalsDirty=!0)}this.position=e.transform.position.add(this.center),this.bounds=t.Rectangle.rectEncompassingPoints(this.points).offset(this.position.x,this.position.y)}overlaps(s){let i=new t.Out;if(s instanceof e)return t.ShapeCollisionsPolygon.polygonToPolygon(this,s,i);if(s instanceof t.Circle)return!!t.ShapeCollisionsCircle.circleToPolygon(s,this,i)&&(i.value.invertResult(),!0);throw new Error(`overlaps of Pologon to ${s} are not supported`)}collidesWithShape(s,i){if(s instanceof e)return t.ShapeCollisionsPolygon.polygonToPolygon(this,s,i);if(s instanceof t.Circle)return!!t.ShapeCollisionsCircle.circleToPolygon(s,this,i)&&(i.value.invertResult(),!0);throw new Error(`overlaps of Polygon to ${s} are not supported`)}collidesWithLine(e,s,i){return t.ShapeCollisionsLine.lineToPoly(e,s,this,i)}containsPoint(t){t=t.sub(this.position);let e=!1;for(let s=0,i=this.points.length-1;s<this.points.length;i=s++)this.points[s].y>t.y!=this.points[i].y>t.y&&t.x<(this.points[i].x-this.points[s].x)*(t.y-this.points[s].y)/(this.points[i].y-this.points[s].y)+this.points[s].x&&(e=!e);return e}pointCollidesWithShape(e,s){return t.ShapeCollisionsPoint.pointToPoly(e,this,s)}}t.Polygon=e}(es||(es={})),function(t){class e extends t.Polygon{constructor(t,s){super(e.buildBox(t,s),!0),this.width=t,this.height=s}static buildBox(e,s){let i=e/2,n=s/2,r=new Array(4);return r[0]=new t.Vector2(-i,-n),r[1]=new t.Vector2(i,-n),r[2]=new t.Vector2(i,n),r[3]=new t.Vector2(-i,n),r}updateBox(e,s){this.width=e,this.height=s;let i=e/2,n=s/2;this.points[0]=new t.Vector2(-i,-n),this.points[1]=new t.Vector2(i,-n),this.points[2]=new t.Vector2(i,n),this.points[3]=new t.Vector2(-i,n);for(let t=0;t<this.points.length;t++)this._originalPoints[t]=this.points[t]}getEdges(){const e=[];for(let s=0;s<this.points.length;s++){const i=(s+1)%this.points.length;e.push(new t.Line(this.points[s],this.points[i]))}return e}overlaps(s){if(this.isUnrotated){if(s instanceof e&&s.isUnrotated)return this.bounds.intersects(s.bounds);if(s instanceof t.Circle)return t.Collisions.rectToCircle(this.bounds,s.position,s.radius)}return super.overlaps(s)}collidesWithShape(s,i){return s instanceof e&&s.isUnrotated?t.ShapeCollisionsBox.boxToBox(this,s,i):super.collidesWithShape(s,i)}containsPoint(t){return this.isUnrotated?this.bounds.contains(t.x,t.y):super.containsPoint(t)}pointCollidesWithShape(e,s){return this.isUnrotated?t.ShapeCollisionsPoint.pointToBox(e,this,s):super.pointCollidesWithShape(e,s)}getFurthestPoint(e){const s=this.width/2,i=this.height/2;let n=new t.Vector2(s,i),r=n.dot(e),o=new t.Vector2(-s,i),a=o.dot(e);return a>r&&(n.copyFrom(o),r=a),o.setTo(-s,-i),(a=o.dot(e))>r&&(n.copyFrom(o),r=a),o.setTo(s,-i),(a=o.dot(e))>r&&n.copyFrom(o),n}}t.Box=e}(es||(es={})),function(t){class e extends t.Shape{constructor(t){super(),this.radius=t,this._originalRadius=t}recalculateBounds(e){if(this.center=e.localOffset,e.shouldColliderScaleAndRotateWithTransform){const s=e.entity.transform.scale,i=1===s.x&&1===s.y,n=Math.max(s.x,s.y);if(this.radius=this._originalRadius*n,0!==e.entity.transform.rotation){const s=Math.atan2(e.localOffset.y,e.localOffset.x)*t.MathHelper.Rad2Deg,n=i?e._localOffsetLength:e.localOffset.multiply(e.entity.transform.scale).magnitude();this.center=t.MathHelper.pointOnCircle(t.Vector2.zero,n,e.entity.transform.rotation+s)}}this.position=e.transform.position.add(this.center),this.bounds=new t.Rectangle(this.position.x-this.radius,this.position.y-this.radius,2*this.radius,2*this.radius)}overlaps(s){const i=new t.Out;if(s instanceof t.Box&&s.isUnrotated)return t.Collisions.rectToCircle(s.bounds,this.position,this.radius);if(s instanceof e)return t.Collisions.circleToCircle(this.position,this.radius,s.position,s.radius);if(s instanceof t.Polygon)return t.ShapeCollisionsCircle.circleToPolygon(this,s,i);throw new Error(`overlaps of circle to ${s} are not supported`)}collidesWithShape(s,i){if(s instanceof t.Box&&s.isUnrotated)return t.ShapeCollisionsCircle.circleToBox(this,s,i);if(s instanceof e)return t.ShapeCollisionsCircle.circleToCircle(this,s,i);if(s instanceof t.Polygon)return t.ShapeCollisionsCircle.circleToPolygon(this,s,i);throw new Error(`Collisions of Circle to ${s} are not supported`)}collidesWithLine(e,s,i){return t.ShapeCollisionsLine.lineToCircle(e,s,this,i)}getPointAlongEdge(e){return new t.Vector2(this.position.x+this.radius*Math.cos(e),this.position.y+this.radius*Math.sin(e))}containsPoint(t){return t.sub(this.position).lengthSquared()<=this.radius*this.radius}pointCollidesWithShape(e,s){return t.ShapeCollisionsPoint.pointToCircle(e,this,s)}}t.Circle=e}(es||(es={})),function(t){t.CollisionResult=class{constructor(){this.normal=t.Vector2.zero,this.minimumTranslationVector=t.Vector2.zero,this.point=t.Vector2.zero}reset(){this.collider=null,this.normal.setTo(0,0),this.minimumTranslationVector.setTo(0,0),this.point&&this.point.setTo(0,0)}cloneTo(e){e.collider=this.collider,e.normal.setTo(this.normal.x,this.normal.y),e.minimumTranslationVector.setTo(this.minimumTranslationVector.x,this.minimumTranslationVector.y),this.point&&(e.point||(e.point=new t.Vector2(0,0)),e.point.setTo(this.point.x,this.point.y))}removeHorizontalTranslation(e){if(Math.sign(this.normal.x)!==Math.sign(e.x)||0===e.x&&0!==this.normal.x){const s=this.minimumTranslationVector.magnitude()/this.normal.y;1!=Math.abs(this.normal.x)&&Math.abs(s)<Math.abs(3*e.y)&&(this.minimumTranslationVector=new t.Vector2(0,-s))}}invertResult(){this.minimumTranslationVector=this.minimumTranslationVector.negate(),this.normal=this.normal.negate()}toString(){return`[CollisionResult] normal: ${this.normal}, minimumTranslationVector: ${this.minimumTranslationVector}`}}}(es||(es={})),function(t){t.Line=class{constructor(t,e){this.start=t.clone(),this.end=e.clone()}get direction(){return this.end.sub(this.start).normalize()}getNormal(){const e=this.direction.getAngle()-Math.PI/2;return new t.Vector2(Math.cos(e),Math.sin(e))}getDirection(t){return t.copyFrom(this.end).sub(this.start).normalize()}getLength(){return this.start.getDistance(this.end)}getLengthSquared(){return this.start.getDistanceSquared(this.end)}distanceToPoint(t,e){return Math.abs((this.end.y-this.start.y)*t.x-(this.end.x-this.start.x)*t.y+this.end.x*this.start.y-this.end.y*this.start.x)/(2*t.magnitude())}getFurthestPoint(t){return this.start.dot(t)>this.end.dot(t)?this.start:this.end}getClosestPoint(t,e){const s=e.copyFrom(this.end).sub(this.start),i=t.sub(this.start).dot(s)/s.lengthSquared();return i<0?e.copyFrom(this.start):i>1?e.copyFrom(this.end):e.copyFrom(s).multiplyScaler(i).add(this.start)}}}(es||(es={})),function(t){t.Projection=class{constructor(){this.min=Number.MAX_VALUE,this.max=-Number.MAX_VALUE}project(t,e){const s=e.points;let i=t.dot(s[0]),n=i;for(let e=1;e<s.length;e++){const r=s[e],o=t.dot(r);o<i?i=o:o>n&&(n=o)}this.min=i,this.max=n}overlap(t){return this.max>=t.min&&t.max>=this.min}getOverlap(t){return Math.min(this.max,t.max)-Math.max(this.min,t.min)}}}(es||(es={})),function(t){t.RealtimeCollisions=class{static intersectMovingCircleBox(e,s,i,n){const r=s.bounds;r.inflate(e.radius,e.radius);const o=new t.Ray2D(e.position.sub(i),e.position),a=r.rayIntersects(o);if(!a.intersected&&a.distance>1)return!1;const h=o.start.add(o.direction.scale(n));let l,c=0;h.x<s.bounds.left&&(l|=1),h.x>s.bounds.right&&(c|=1),h.y<s.bounds.top&&(l|=2),h.y>s.bounds.bottom&&(c|=2);const u=l+c;return 3==u&&console.log(`m == 3. corner ${t.Time.frameCount}`),!0}static corner(e,s){let i=t.Vector2.zero;return i.x=0==(1&s)?e.right:e.left,i.y=0==(1&s)?e.bottom:e.top,i}static testCircleBox(t,e,s){const i=e.bounds.getClosestPointOnRectangleToPoint(t.position).sub(t.position);return i.dot(i)<=t.radius*t.radius}}}(es||(es={})),function(t){t.Sector=class extends t.Shape{get sectorAngle(){let t=this.endAngle-this.startAngle;return t<0&&(t+=360),t}constructor(t,e,s,i){super(),this.center=t,this.radius=e,this.startAngle=s,this.endAngle=i,this.angle=i-s,this.radiusSquared=e*e,this.points=this.getPoints(),this.calculateProperties()}getCentroid(){const e=(Math.cos(this.startAngle)+Math.cos(this.endAngle))*this.radius/3,s=(Math.sin(this.startAngle)+Math.sin(this.endAngle))*this.radius/3;return new t.Vector2(e+this.center.x,s+this.center.y)}getAngle(){return this.startAngle}recalculateBounds(e){const s=this.center.add(e.localOffset),i=s.x-this.radius,n=s.y-this.radius,r=2*this.radius,o=2*this.radius,a=new t.Rectangle(i,n,r,o);this.bounds=a,this.center=s}overlaps(e){let s=new t.Out;if(e instanceof t.Polygon)return t.ShapeCollisionSector.sectorToPolygon(this,e,s);if(e instanceof t.Circle)return!!t.ShapeCollisionSector.sectorToCircle(this,e,s)&&(s.value.invertResult(),!0);throw new Error(`overlaps of Sector to ${e} are not supported`)}collidesWithShape(e,s){if(e instanceof t.Box)return t.ShapeCollisionSector.sectorToBox(this,e,s);if(e instanceof t.Polygon)return t.ShapeCollisionSector.sectorToPolygon(this,e,s);if(e instanceof t.Circle)return t.ShapeCollisionSector.sectorToCircle(this,e,s);throw new Error(`overlaps of Polygon to ${e} are not supported`)}collidesWithLine(e,s,i){const n=e.sub(this.center),r=s.sub(this.center),o=n.getAngle();let a=r.getAngle()-o;if(a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),a>=this.startAngle&&a<=this.endAngle){const r=n.getLength(),a=this.startAngle-o,h=r*Math.cos(a),l=r*Math.sin(a),c=new t.Vector2(h,l);if(c.isBetween(e,s)){const n=c.sub(e).getLength(),r=n/e.getDistance(s),o=c.sub(this.center).normalize(),a=c.add(this.center),h=new t.RaycastHit;return h.setValues(r,n,a,o),i.value=h,!0}}return!1}containsPoint(t){const e=t.sub(this.center);if(e.lengthSquared()>this.radiusSquared)return!1;const s=e.getAngle(),i=this.startAngle;this.angle;let n=s-i;return n<0&&(n+=2*Math.PI),!(n>this.angle)}pointCollidesWithShape(e,s){return this.containsPoint(e)?(s&&(s.value=new t.CollisionResult,s.value.normal=e.sub(this.center).normalize(),s.value.minimumTranslationVector=s.value.normal.scale(this.radius-e.sub(this.center).getLength()),s.value.point=e),!0):(s&&(s.value=null),!1)}getPoints(){let e=new Array(this.numberOfPoints);for(let s=0;s<this.numberOfPoints;s++){let i=this.startAngle+s*this.angleStep;e[s]=t.Vector2.fromAngle(i,this.radius).add(this.center)}return e}calculateProperties(){this.numberOfPoints=Math.max(10,Math.floor(.1*this.radius)),this.angleStep=(this.endAngle-this.startAngle)/(this.numberOfPoints-1)}getFurthestPoint(e){let s=-Number.MAX_VALUE,i=new t.Vector2;for(let t=0;t<this.numberOfPoints;t++){let n=this.points[t].dot(e);n>s&&(s=n,i.copyFrom(this.points[t]))}return i}}}(es||(es={})),function(t){t.ShapeCollisionSector=class{static sectorToPolygon(e,s,i){const n=s.points.length;let r=!1;const o=new t.Vector2,a=new t.Vector2,h=new t.Out;for(let o=0;o<n;o++){const n=s.points[o];if(e.containsPoint(n)){i&&(i.value=new t.CollisionResult,i.value.point=n.clone(),i.value.normal=n.sub(e.center).normalize()),r=!0;break}}if(!r&&s.containsPoint(e.center)&&(i&&(i.value=new t.CollisionResult,i.value.point=e.center.clone(),i.value.normal=new t.Vector2(0,0)),r=!0),!r)for(let l=0;l<n;l++){const c=s.points[l],u=s.points[(l+1)%n];if(o.copyFrom(c),a.copyFrom(u),e.collidesWithLine(o,a,h)){i&&(i.value=new t.CollisionResult,i.value.point.copyFrom(h.value.point),i.value.normal.copyFrom(h.value.normal)),r=!0;break}}return r}static sectorToCircle(e,s,i){const n=s.radius*s.radius,r=e.center.getDistanceSquared(s.center),o=Math.abs(s.center.sub(e.center).getAngle()-e.getAngle()),a=e.endAngle-e.startAngle;return r<=n&&o<=a/2?(i&&(i.value=new t.CollisionResult,i.value.normal=s.center.sub(e.center).normalize(),i.value.point=s.center.clone().add(i.value.normal.clone().multiplyScaler(s.radius))),!0):(i&&(i.value=null),!1)}static sectorToBox(e,s,i){i.value=new t.CollisionResult;let n=s.getEdges();for(let t=0;t<n.length;t++){let r=n[t].getNormal(),o=s.getFurthestPoint(r),a=e.getFurthestPoint(r.negate()),h=r.dot(a.sub(o));if(h>0)return!1;i.value&&Math.abs(h)<i.value.minimumTranslationVector.getLength()&&(i.value.minimumTranslationVector=r.clone().multiplyScaler(h),i.value.normal=r)}return!0}}}(es||(es={})),function(t){t.ShapeCollisionsBox=class{static boxToBox(e,s,i){i.value=new t.CollisionResult;const n=this.minkowskiDifference(e,s);return!!n.contains(0,0)&&(i.value.minimumTranslationVector=n.getClosestPointOnBoundsToOrigin(),!i.value.minimumTranslationVector.equals(t.Vector2.zero)&&(i.value.normal=i.value.minimumTranslationVector.scale(-1),i.value.normal=i.value.normal.normalize(),!0))}static boxToBoxCast(e,s,i,n){const r=this.minkowskiDifference(e,s);if(r.contains(0,0)){const e=r.getClosestPointOnBoundsToOrigin();return!e.equals(t.Vector2.zero)&&(n.normal=new t.Vector2(-e.x,-e.y),n.normal=n.normal.normalize(),n.distance=0,n.fraction=0,!0)}{const s=new t.Ray2D(t.Vector2.zero,i.scale(-1)),o=r.rayIntersects(s);if(o.intersected&&o.distance<=1)return n.fraction=o.distance,n.distance=i.magnitude()*o.distance,n.normal=i.scale(-1),n.normal=n.normal.normalize(),n.centroid=e.bounds.center.add(i.scale(o.distance)),!0}return!1}static minkowskiDifference(e,s){const i=e.position.sub(e.bounds.center),n=e.bounds.location.add(i.sub(s.bounds.max)),r=e.bounds.size.add(s.bounds.size);return new t.Rectangle(n.x,n.y,r.x,r.y)}}}(es||(es={})),function(t){t.ShapeCollisionsCircle=class{static circleToCircleCast(e,s,i,n){n.value=new t.RaycastHit;let r=e.position.add(i),o=this.closestPointOnLine(e.position,r,s.position),a=t.Vector2.sqrDistance(s.position,o);const h=(e.radius+s.radius)*(e.radius+s.radius);if(a<=h){const l=i.normalize();o===r&&(r=e.position.add(i.add(l.scale(s.radius))),o=this.closestPointOnLine(e.position,r,s.position),a=t.Vector2.sqrDistance(s.position,o));const c=Math.sqrt(h-a);return n.value.centroid=o.sub(l.scale(c)),n.value.normal=n.value.centroid.sub(s.position).normalize(),n.value.fraction=(n.value.centroid.x-e.position.x)/i.x,n.value.distance=t.Vector2.distance(e.position,n.value.centroid),n.value.point=s.position.add(n.value.normal.scale(s.radius)),!0}return!1}static circleToCircle(e,s,i){i.value=new t.CollisionResult;const n=t.Vector2.sqrDistance(e.position,s.position),r=e.radius+s.radius;if(n<r*r){i.value.normal=e.position.sub(s.position).normalize();const t=r-Math.sqrt(n);return i.value.minimumTranslationVector=i.value.normal.scale(-t),i.value.point=s.position.add(i.value.normal.scale(s.radius)),!0}return!1}static circleToBox(e,s,i){i.value=new t.CollisionResult;const n=new t.Out,r=s.bounds.getClosestPointOnRectangleBorderToPoint(e.position,n);if(i.value.normal=n.value,s.containsPoint(e.position)){i.value.point=r;const t=r.add(i.value.normal.scale(e.radius));return i.value.minimumTranslationVector=e.position.sub(t),!0}const o=t.Vector2.sqrDistance(r,e.position);if(0==o)i.value.minimumTranslationVector=i.value.normal.scale(e.radius);else if(o<=e.radius*e.radius){i.value.normal=e.position.sub(r);const t=i.value.normal.magnitude()-e.radius;return i.value.point=r,i.value.normal=i.value.normal.normalize(),i.value.minimumTranslationVector=i.value.normal.scale(t),!0}return!1}static circleToPolygon(e,s,i){i.value=new t.CollisionResult;const n=e.position.sub(s.position),r=t.Polygon.getClosestPointOnPolygonToPoint(s.points,n);i.value.normal=r.edgeNormal;const o=s.containsPoint(e.position);if(r.distanceSquared>e.radius*e.radius&&!o)return!1;let a;if(o)a=i.value.normal.scale(Math.sqrt(r.distanceSquared)-e.radius);else if(0===r.distanceSquared)a=i.value.normal.scale(e.radius);else{const t=Math.sqrt(r.distanceSquared);a=n.sub(r.closestPoint).scale((e.radius-t)/t*-1)}return i.value.minimumTranslationVector=a,i.value.point=r.closestPoint.add(s.position),!0}static closestPointOnLine(e,s,i){const n=s.sub(e);let r=i.sub(e).dot(n)/n.dot(n);return r=t.MathHelper.clamp(r,0,1),e.add(n.scaleEqual(r))}}}(es||(es={})),function(t){class e{static lineToPoly(s,i,n,r){r.value=new t.RaycastHit;let o=t.Vector2.zero,a=t.Vector2.zero,h=Number.MAX_VALUE,l=!1;for(let r=n.points.length-1,c=0;c<n.points.length;r=c,c++){const u=t.Vector2.add(n.position,n.points[r]),d=t.Vector2.add(n.position,n.points[c]),m=t.Vector2.zero;if(e.lineToLine(u,d,s,i,m)){l=!0;let e=(m.x-s.x)/(i.x-s.x);if((Number.isNaN(e)||Math.abs(e)==1/0)&&(e=(m.y-s.y)/(i.y-s.y)),e<h){const s=d.sub(u);o=new t.Vector2(s.y,-s.x),h=e,a=m}}}if(l){o=o.normalize();const e=t.Vector2.distance(s,a);return r.value.setValues(h,e,a,o),!0}return!1}static lineToLine(t,e,s,i,n){const r=e.sub(t),o=i.sub(s),a=r.x*o.y-r.y*o.x;if(0==a)return!1;const h=s.sub(t),l=(h.x*o.y-h.y*o.x)/a;if(l<0||l>1)return!1;const c=(h.x*r.y-h.y*r.x)/a;if(c<0||c>1)return!1;const u=t.add(r.scale(l));return n.x=u.x,n.y=u.y,!0}static lineToCircle(e,s,i,n){n.value=new t.RaycastHit;const r=t.Vector2.distance(e,s),o=t.Vector2.divideScaler(s.sub(e),r),a=e.sub(i.position),h=a.dot(o),l=a.dot(a)-i.radius*i.radius;if(l>0&&h>0)return!1;let c=h*h-l;return!(c<0)&&(n.value.fraction=-h-Math.sqrt(c),n.value.fraction<0&&(n.value.fraction=0),n.value.point=e.add(o.scale(n.value.fraction)),n.value.distance=t.Vector2.distance(e,n.value.point),n.value.normal=n.value.point.sub(i.position).normalize(),n.value.fraction=n.value.distance/r,!0)}}t.ShapeCollisionsLine=e}(es||(es={})),function(t){t.ShapeCollisionsPoint=class{static pointToCircle(e,s,i){i.value=new t.CollisionResult;let n=t.Vector2.sqrDistance(e,s.position),r=1+s.radius;if(n<r*r){i.value.normal=e.sub(s.position).normalize();let t=r-Math.sqrt(n);return i.value.minimumTranslationVector=i.value.normal.scale(-t),i.value.point=s.position.add(i.value.normal.scale(s.radius)),!0}return!1}static pointToBox(e,s,i){if(i.value=new t.CollisionResult,s.containsPoint(e)){const n=new t.Out;return i.value.point=s.bounds.getClosestPointOnRectangleBorderToPoint(e,n),i.value.normal=n.value,i.value.minimumTranslationVector=e.sub(i.value.point),!0}return!1}static pointToPoly(e,s,i){if(i.value=new t.CollisionResult,s.containsPoint(e)){const n=t.Polygon.getClosestPointOnPolygonToPoint(s.points,e.sub(s.position));return i.value.normal=n.edgeNormal,i.value.minimumTranslationVector=i.value.normal.scale(Math.sqrt(n.distanceSquared)),i.value.point=n.closestPoint.sub(s.position),!0}return!1}}}(es||(es={})),function(t){t.ShapeCollisionsPolygon=class{static polygonToPolygon(e,s,i){i.value=new t.CollisionResult;let n=!0;const r=e.edgeNormals,o=s.edgeNormals;let a,h=Number.POSITIVE_INFINITY,l=t.Vector2.zero,c=e.position.sub(s.position);for(let t=0;t<r.length+o.length;t++){a=t<r.length?r[t]:o[t-r.length];let i=0,{min:u,max:d}=this.getInterval(a,e);const{min:m,max:p}=this.getInterval(a,s),g=c.dot(a);if(u+=g,d+=g,(i=this.intervalDistance(u,d,m,p))>0&&(n=!1),!n)return!1;(i=Math.abs(i))<h&&(h=i,l.setTo(a.x,a.y),l.dot(c)<0&&(l=l.scale(-1)))}return i.value.normal=l,i.value.minimumTranslationVector=l.scale(-h),!0}static getInterval(t,e){const s={min:0,max:0};let i;i=e.points[0].dot(t),s.max=i,s.min=i;for(let n=1;n<e.points.length;n++)(i=e.points[n].dot(t))<s.min?s.min=i:i>s.max&&(s.max=i);return s}static intervalDistance(t,e,s,i){return t<s?s-e:t-i}}}(es||(es={})),function(t){t.AbstractTweenable=class{constructor(){this.discriminator="ITweenable"}recycleSelf(){}isRunning(){return this._isCurrentlyManagedByTweenManager&&!this._isPaused}start(){this._isCurrentlyManagedByTweenManager?this._isPaused=!1:(t.TweenManager.addTween(this),this._isCurrentlyManagedByTweenManager=!0,this._isPaused=!1)}pause(){this._isPaused=!0}resume(){this._isPaused=!1}stop(e=!1){t.TweenManager.removeTween(this),this._isCurrentlyManagedByTweenManager=!1,this._isPaused=!0}}}(es||(es={})),function(t){class e{constructor(t,e){this._target=t,this._propertyName=e}getTargetObject(){return this._target}setTweenedValue(t){this._target[this._propertyName]=t}getTweenedValue(){return this._target[this._propertyName]}}t.PropertyTweens=class{static NumberPropertyTo(s,i,n,r){let o=new e(s,i),a=t.TweenManager.cacheNumberTweens?t.Pool.obtain(t.NumberTween):new t.NumberTween;return a.initialize(o,n,r),a}static Vector2PropertyTo(s,i,n,r){let o=new e(s,i),a=t.TweenManager.cacheVector2Tweens?t.Pool.obtain(t.Vector2Tween):new t.Vector2Tween;return a.initialize(o,n,r),a}}}(es||(es={})),function(t){t.TransformSpringTween=class extends t.AbstractTweenable{get targetType(){return this._targetType}constructor(t,e,s){super(),this.dampingRatio=.23,this.angularFrequency=25,this._transform=t,this._targetType=e,this.setTargetValue(s)}setTargetValue(e){this._velocity=t.Vector2.zero,this._targetValue=e,this._isCurrentlyManagedByTweenManager||this.start()}updateDampingRatioWithHalfLife(t){this.dampingRatio=-t/this.angularFrequency*Math.log(.5)}tick(){return this._isPaused||this.setTweenedValue(t.Lerps.fastSpring(this.getCurrentValueOfTweenedTargetType(),this._targetValue,this._velocity,this.dampingRatio,this.angularFrequency)),!1}setTweenedValue(e){switch(this._targetType){case t.TransformTargetType.position:this._transform.position=e;break;case t.TransformTargetType.localPosition:this._transform.localPosition=e;break;case t.TransformTargetType.scale:this._transform.scale=e;break;case t.TransformTargetType.localScale:this._transform.localScale=e;break;case t.TransformTargetType.rotationDegrees:this._transform.rotationDegrees=e.x;case t.TransformTargetType.localRotationDegrees:this._transform.localRotationDegrees=e.x}}getCurrentValueOfTweenedTargetType(){switch(this._targetType){case t.TransformTargetType.position:return this._transform.position;case t.TransformTargetType.localPosition:return this._transform.localPosition;case t.TransformTargetType.scale:return this._transform.scale;case t.TransformTargetType.localScale:return this._transform.localScale;case t.TransformTargetType.rotationDegrees:return new t.Vector2(this._transform.rotationDegrees);case t.TransformTargetType.localRotationDegrees:return new t.Vector2(this._transform.localRotationDegrees,0);default:return t.Vector2.zero}}}}(es||(es={})),function(t){let e,s;!function(t){t[t.none=0]="none",t[t.restartFromBeginning=1]="restartFromBeginning",t[t.pingpong=2]="pingpong"}(e=t.LoopType||(t.LoopType={})),function(t){t[t.running=0]="running",t[t.paused=1]="paused",t[t.complete=2]="complete"}(s=t.TweenState||(t.TweenState={}));t.Tween=class{constructor(){this._shouldRecycleTween=!0,this._tweenState=s.complete,this._timeScale=1}setEaseType(t){return this._easeType=t,this}setDelay(t){return this._delay=t,this._elapsedTime=-this._delay,this}setDuration(t){return this._duration=t,this}setTimeScale(t){return this._timeScale=t,this}setIsTimeScaleIndependent(){return this._isTimeScaleIndependent=!0,this}setCompletionHandler(t){return this._completionHandler=t,this}setLoops(t,s=1,i=0){return this._loopType=t,this._delayBetweenLoops=i,s<0&&(s=-1),t==e.pingpong&&(s*=2),this._loops=s,this}setLoopCompletionHanlder(t){return this._loopCompleteHandler=t,this}setFrom(t){return this._isFromValueOverridden=!0,this._fromValue=t,this}prepareForReuse(t,e,s){return this.initialize(this._target,e,s),this}setRecycleTween(t){return this._shouldRecycleTween=t,this}setContext(t){return this.context=t,this}setNextTween(t){return this._nextTween=t,this}tick(){if(this._tweenState==s.paused)return!1;let t=this.calculateElapsedTimeExcess();this._elapsedTime>=0&&this._elapsedTime<=this._duration&&this.updateValue(),this._loopType!=e.none&&this._tweenState==s.complete&&0!=this._loops&&this.handleLooping(t);let i=this.calculateDeltaTime();return this.updateElapsedTime(i),this._tweenState==s.complete&&(this.handleCompletion(),!0)}calculateElapsedTimeExcess(){let t=0;return!this._isRunningInReverse&&this._elapsedTime>=this._duration?(t=this._elapsedTime-this._duration,this._elapsedTime=this._duration,this._tweenState=s.complete):this._isRunningInReverse&&this._elapsedTime<=0&&(t=0-this._elapsedTime,this._elapsedTime=0,this._tweenState=s.complete),t}calculateDeltaTime(){let e=this._isTimeScaleIndependent?t.Time.unscaledDeltaTime:t.Time.deltaTime;return e*=this._timeScale,this._isRunningInReverse&&(e=-e),e}updateElapsedTime(t){this._elapsedTime+=t,this._isRunningInReverse?(this._elapsedTime=Math.max(0,this._elapsedTime),this._elapsedTime=Math.min(this._elapsedTime,this._duration)):this._elapsedTime=Math.min(this._elapsedTime,this._duration)}handleCompletion(){this._completionHandler&&this._completionHandler(this),null!=this._nextTween&&(this._nextTween.start(),this._nextTween=null)}recycleSelf(){this._shouldRecycleTween&&(this._target=null,this._nextTween=null)}isRunning(){return this._tweenState==s.running}start(){this._isFromValueOverridden||(this._fromValue=this._target.getTweenedValue()),this._tweenState==s.complete&&(this._tweenState=s.running,t.TweenManager.addTween(this))}pause(){this._tweenState=s.paused}resume(){this._tweenState=s.running}stop(i=!1){this._tweenState=s.complete,i?(this._elapsedTime=this._isRunningInReverse?0:this._duration,this._loopType=e.none,this._loops=0):t.TweenManager.removeTween(this)}jumpToElapsedTime(e){this._elapsedTime=t.MathHelper.clamp(e,0,this._duration),this.updateValue()}reverseTween(){this._isRunningInReverse=!this._isRunningInReverse}*waitForCompletion(){for(;this._tweenState!=s.complete;)yield null}getTargetObject(){return this._target.getTargetObject()}resetState(){this.context=null,this._completionHandler=this._loopCompleteHandler=null,this._isFromValueOverridden=!1,this._isTimeScaleIndependent=!1,this._tweenState=s.complete,this._isRelative=!1,this._easeType=t.TweenManager.defaultEaseType,null!=this._nextTween&&(this._nextTween.recycleSelf(),this._nextTween=null),this._delay=0,this._duration=0,this._timeScale=1,this._elapsedTime=0,this._loopType=e.none,this._delayBetweenLoops=0,this._loops=0,this._isRunningInReverse=!1}initialize(t,e,s){this.resetState(),this._target=t,this._toValue=e,this._duration=s}handleLooping(t){this._loops--,this._loopType==e.pingpong&&this.reverseTween(),this._loopType!=e.restartFromBeginning&&this._loops%2!=0||this._loopCompleteHandler&&this._completionHandler(this),0!=this._loops&&(this._tweenState=s.running,this._loopType==e.restartFromBeginning?this._elapsedTime=t-this._delayBetweenLoops:this._isRunningInReverse?this._elapsedTime+=this._delayBetweenLoops-t:this._elapsedTime=t-this._delayBetweenLoops,0==this._delayBetweenLoops&&t>0&&this.updateValue())}}}(es||(es={})),function(t){class e extends t.Tween{static create(){return t.TweenManager.cacheNumberTweens?t.Pool.obtain(e):new e}constructor(t,e,s){super(),this.initialize(t,e,s)}setIsRelative(){return this._isRelative=!0,this._toValue+=this._fromValue,this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheNumberTweens&&t.Pool.free(e,this)}}t.NumberTween=e;class s extends t.Tween{static create(){return t.TweenManager.cacheVector2Tweens?t.Pool.obtain(s):new s}constructor(t,e,s){super(),this.initialize(t,e,s)}setIsRelative(){return this._isRelative=!0,this._toValue.add(this._fromValue),this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheVector2Tweens&&t.Pool.free(s,this)}}t.Vector2Tween=s;class i extends t.Tween{static create(){return t.TweenManager.cacheRectTweens?t.Pool.obtain(i):new i}constructor(t,e,s){super(),this.initialize(t,e,s)}setIsRelative(){return this._isRelative=!0,this._toValue=new t.Rectangle(this._toValue.x+this._fromValue.x,this._toValue.y+this._fromValue.y,this._toValue.width+this._fromValue.width,this._toValue.height+this._fromValue.height),this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheRectTweens&&t.Pool.free(i,this)}}t.RectangleTween=i}(es||(es={})),function(t){let e;!function(t){t[t.position=0]="position",t[t.localPosition=1]="localPosition",t[t.scale=2]="scale",t[t.localScale=3]="localScale",t[t.rotationDegrees=4]="rotationDegrees",t[t.localRotationDegrees=5]="localRotationDegrees"}(e=t.TransformTargetType||(t.TransformTargetType={}));t.TransformVector2Tween=class extends t.Vector2Tween{setTweenedValue(t){switch(this._targetType){case e.position:this._transform.position=t;break;case e.localPosition:this._transform.localPosition=t;break;case e.scale:this._transform.scale=t;break;case e.localScale:this._transform.localScale=t;break;case e.rotationDegrees:this._transform.rotationDegrees=t.x;case e.localRotationDegrees:this._transform.localRotationDegrees=t.x}}getTweenedValue(){switch(this._targetType){case e.position:return this._transform.position;case e.localPosition:return this._transform.localPosition;case e.scale:return this._transform.scale;case e.localScale:return this._transform.localScale;case e.rotationDegrees:return new t.Vector2(this._transform.rotationDegrees,this._transform.rotationDegrees);case e.localRotationDegrees:return new t.Vector2(this._transform.localRotationDegrees,0)}}getTargetObject(){return this._transform}setTargetAndType(t,e){this._transform=t,this._targetType=e}updateValue(){this._targetType!=e.rotationDegrees&&this._targetType!=e.localRotationDegrees||this._isRelative?this.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration)):this.setTweenedValue(t.Lerps.easeAngle(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){this._shouldRecycleTween&&(this._target=null,this._nextTween=null,this._transform=null,t.Pool.free(t.Vector2Tween,this))}}}(es||(es={})),function(t){let e;!function(t){t[t.linear=0]="linear",t[t.sineIn=1]="sineIn",t[t.sineOut=2]="sineOut",t[t.sineInOut=3]="sineInOut",t[t.quadIn=4]="quadIn",t[t.quadOut=5]="quadOut",t[t.quadInOut=6]="quadInOut",t[t.quintIn=7]="quintIn",t[t.quintOut=8]="quintOut",t[t.quintInOut=9]="quintInOut",t[t.cubicIn=10]="cubicIn",t[t.cubicOut=11]="cubicOut",t[t.cubicInOut=12]="cubicInOut",t[t.quartIn=13]="quartIn",t[t.quartOut=14]="quartOut",t[t.quartInOut=15]="quartInOut",t[t.expoIn=16]="expoIn",t[t.expoOut=17]="expoOut",t[t.expoInOut=18]="expoInOut",t[t.circleIn=19]="circleIn",t[t.circleOut=20]="circleOut",t[t.circleInOut=21]="circleInOut",t[t.elasticIn=22]="elasticIn",t[t.elasticOut=23]="elasticOut",t[t.elasticInOut=24]="elasticInOut",t[t.punch=25]="punch",t[t.backIn=26]="backIn",t[t.backOut=27]="backOut",t[t.backInOut=28]="backInOut",t[t.bounceIn=29]="bounceIn",t[t.bounceOut=30]="bounceOut",t[t.bounceInOut=31]="bounceInOut"}(e=t.EaseType||(t.EaseType={}));t.EaseHelper=class{static oppositeEaseType(t){switch(t){case e.linear:return t;case e.backIn:return e.backOut;case e.backOut:return e.backIn;case e.backInOut:return t;case e.bounceIn:return e.bounceOut;case e.bounceOut:return e.bounceIn;case e.bounceInOut:return t;case e.circleIn:return e.circleOut;case e.circleOut:return e.circleIn;case e.circleInOut:return t;case e.cubicIn:return e.cubicOut;case e.cubicOut:return e.cubicIn;case e.circleInOut:case e.punch:return t;case e.expoIn:return e.expoOut;case e.expoOut:return e.expoIn;case e.expoInOut:return t;case e.quadIn:return e.quadOut;case e.quadOut:return e.quadIn;case e.quadInOut:return t;case e.quartIn:return e.quadOut;case e.quartOut:return e.quartIn;case e.quadInOut:return t;case e.sineIn:return e.sineOut;case e.sineOut:return e.sineIn;case e.sineInOut:default:return t}}static ease(s,i,n){switch(s){case e.linear:return t.Easing.Linear.easeNone(i,n);case e.backIn:return t.Easing.Back.easeIn(i,n);case e.backOut:return t.Easing.Back.easeOut(i,n);case e.backInOut:return t.Easing.Back.easeInOut(i,n);case e.bounceIn:return t.Easing.Bounce.easeIn(i,n);case e.bounceOut:return t.Easing.Bounce.easeOut(i,n);case e.bounceInOut:return t.Easing.Bounce.easeInOut(i,n);case e.circleIn:return t.Easing.Circular.easeIn(i,n);case e.circleOut:return t.Easing.Circular.easeOut(i,n);case e.circleInOut:return t.Easing.Circular.easeInOut(i,n);case e.cubicIn:return t.Easing.Cubic.easeIn(i,n);case e.cubicOut:return t.Easing.Cubic.easeOut(i,n);case e.cubicInOut:return t.Easing.Cubic.easeInOut(i,n);case e.elasticIn:return t.Easing.Elastic.easeIn(i,n);case e.elasticOut:return t.Easing.Elastic.easeOut(i,n);case e.elasticInOut:return t.Easing.Elastic.easeInOut(i,n);case e.punch:return t.Easing.Elastic.punch(i,n);case e.expoIn:return t.Easing.Exponential.easeIn(i,n);case e.expoOut:return t.Easing.Exponential.easeOut(i,n);case e.expoInOut:return t.Easing.Exponential.easeInOut(i,n);case e.quadIn:return t.Easing.Quadratic.easeIn(i,n);case e.quadOut:return t.Easing.Quadratic.easeOut(i,n);case e.quadInOut:return t.Easing.Quadratic.easeInOut(i,n);case e.quintIn:return t.Easing.Quintic.easeIn(i,n);case e.quintOut:return t.Easing.Quintic.easeOut(i,n);case e.quintInOut:return t.Easing.Quintic.easeInOut(i,n);case e.sineIn:return t.Easing.Sinusoidal.easeIn(i,n);case e.sineOut:return t.Easing.Sinusoidal.easeOut(i,n);case e.sineInOut:return t.Easing.Sinusoidal.easeInOut(i,n);default:return t.Easing.Linear.easeNone(i,n)}}}}(es||(es={})),function(t){t.GlobalManager=class{get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}setEnabled(t){this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled())}onEnabled(){}onDisabled(){}update(){}}}(es||(es={})),function(t){class e extends t.GlobalManager{static get activeTweens(){return this._instance._activeTweens}constructor(){super(),this._activeTweens=[],this._tempTweens=[],e._instance=this}update(){this._isUpdating=!0;for(let t=this._activeTweens.length-1;t>=0;--t){let e=this._activeTweens[t];e.tick()&&this._tempTweens.push(e)}this._isUpdating=!1;for(let e=0;e<this._tempTweens.length;e++)this._tempTweens[e].recycleSelf(),new t.List(this._activeTweens).remove(this._tempTweens[e]);this._tempTweens.length=0}static addTween(t){e._instance._activeTweens.push(t)}static removeTween(s){e._instance._isUpdating?e._instance._tempTweens.push(s):(s.recycleSelf(),new t.List(e._instance._activeTweens).remove(s))}static stopAllTweens(t=!1){for(let s=e._instance._activeTweens.length-1;s>=0;--s)e._instance._activeTweens[s].stop(t)}static allTweensWithContext(t){let s=[];for(let i=0;i<e._instance._activeTweens.length;i++)e._instance._activeTweens[i].context==t&&s.push(e._instance._activeTweens[i]);return s}static stopAllTweensWithContext(t,s=!1){for(let i=e._instance._activeTweens.length-1;i>=0;--i)e._instance._activeTweens[i].context==t&&e._instance._activeTweens[i].stop(s)}static allTweenWithTarget(t){let s=[];for(let i=0;i<e._instance._activeTweens.length;i++)if(e._instance._activeTweens[i]){e._instance._activeTweens[i].getTargetObject()==t&&s.push(e._instance._activeTweens[i])}return s}static allTweensWithTargetEntity(e){let s=[];for(let i=0;i<this._instance._activeTweens.length;i++)if("ITweenControl"==this._instance._activeTweens[i].discriminator){let n=this._instance._activeTweens[i].getTargetObject();(n instanceof t.Entity&&n==e||n instanceof t.Component&&n.entity==e||n instanceof t.Transform&&n.entity==e)&&s.push(this._instance._activeTweens[i])}return s}static stopAllTweensWithTarget(t,s=!1){for(let i=e._instance._activeTweens.length-1;i>=0;--i)if(e._instance._activeTweens[i]){let n=e._instance._activeTweens[i];n.getTargetObject()==t&&n.stop(s)}}}e.defaultEaseType=t.EaseType.quartIn,e.removeAllTweensOnLevelLoad=!1,e.cacheNumberTweens=!0,e.cacheVector2Tweens=!0,e.cacheColorTweens=!0,e.cacheRectTweens=!1,t.TweenManager=e}(es||(es={})),function(t){let e;!function(t){t.Linear=class{static easeNone(t,e){return t/e}};t.Quadratic=class{static easeIn(t,e){return(t/=e)*t}static easeOut(t,e){return-1*(t/=e)*(t-2)}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t:-.5*(--t*(t-2)-1)}};t.Back=class{static easeIn(t,e,s=1.70158){return(t/=e)*t*((s+1)*t-s)}static easeOut(t,e,s=1.70158){return(t=t/e-1)*t*((s+1)*t+s)+1}static easeInOut(t,e,s=1.70158){return(t/=e/2)<1?t*t*((1+(s*=1.525))*t-s)*.5:.5*((t-=2)*t*((1+(s*=1.525))*t+s)+2)}};t.Bounce=class{static easeOut(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static easeIn(t,e){return 1-this.easeOut(e-t,e)}static easeInOut(t,e){return t<e/2?.5*this.easeIn(2*t,e):.5*this.easeOut(2*t-e,e)+.5}};t.Circular=class{static easeIn(t,e){return-(Math.sqrt(1-(t/=e)*t)-1)}static easeOut(t,e){return Math.sqrt(1-(t=t/e-1)*t)}static easeInOut(t,e){return(t/=e/2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}};t.Cubic=class{static easeIn(t,e){return(t/=e)*t*t}static easeOut(t,e){return(t=t/e-1)*t*t+1}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}};t.Elastic=class{static easeIn(t,e){if(0===t)return 0;if(1==(t/=e))return 1;const s=.3*e,i=s/4;return-1*Math.pow(2,10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/s)}static easeOut(t,e){if(0===t)return 0;if(1==(t/=e))return 1;const s=.3*e,i=s/4;return 1*Math.pow(2,-10*t)*Math.sin((t*e-i)*(2*Math.PI)/s)+1}static easeInOut(t,e){if(0===t)return 0;if(2==(t/=e/2))return 1;const s=e*(.3*1.5),i=s/4;return t<1?-.5*Math.pow(2,10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/s):Math.pow(2,-10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/s)*.5+1}static punch(t,e){return 0===t?0:1==(t/=e)?0:Math.pow(2,-10*t)*Math.sin(t*(2*Math.PI)/.3)}};t.Exponential=class{static easeIn(t,e){return 0==t?0:Math.pow(2,10*(t/e-1))}static easeOut(t,e){return t==e?1:1-Math.pow(2,-10*t/e)}static easeInOut(t,e){return 0==t?0:t==e?1:(t/=e/2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))}};t.Quartic=class{static easeIn(t,e){return(t/=e)*t*t*t}static easeOut(t,e){return-1*((t=t/e-1)*t*t*t-1)}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}};t.Quintic=class{static easeIn(t,e){return(t/=e)*t*t*t*t}static easeOut(t,e){return(t=t/e-1)*t*t*t*t+1}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}};t.Sinusoidal=class{static easeIn(t,e){return-1*Math.cos(t/e*(Math.PI/2))+1}static easeOut(t,e){return Math.sin(t/e*(Math.PI/2))}static easeInOut(t,e){return-.5*(Math.cos(Math.PI*t/e)-1)}}}(e=t.Easing||(t.Easing={}))}(es||(es={})),function(t){t.Lerps=class{static lerp(e,s,i){return"number"==typeof e&&"number"==typeof s?e+(s-e)*i:e instanceof t.Rectangle&&s instanceof t.Rectangle?new t.Rectangle(e.x+(s.x-e.x)*i,e.y+(s.x-e.y)*i,e.width+(s.width-e.width)*i,e.height+(s.height-e.height)*i):e instanceof t.Vector2&&s instanceof t.Vector2?new t.Vector2(e.x+(s.x-e.x)*i,e.y+(s.y-e.y)*i):void 0}static angleLerp(e,s,i){let n=new t.Vector2(t.MathHelper.deltaAngle(e.x,s.x),t.MathHelper.deltaAngle(e.y,s.y));return new t.Vector2(e.x+n.x*i,e.y+n.y*i)}static ease(e,s,i,n,r){return"number"==typeof s&&"number"==typeof i?this.lerp(s,i,t.EaseHelper.ease(e,n,r)):s instanceof t.Vector2&&i instanceof t.Vector2?this.lerp(s,i,t.EaseHelper.ease(e,n,r)):s instanceof t.Rectangle&&i instanceof t.Rectangle?this.lerp(s,i,t.EaseHelper.ease(e,n,r)):void 0}static easeAngle(e,s,i,n,r){return this.angleLerp(s,i,t.EaseHelper.ease(e,n,r))}static fastSpring(e,s,i,n,r){return i.add(i.scale(-2*t.Time.deltaTime*n*r).add(s.sub(e).scale(t.Time.deltaTime*r*r))),e.add(i.scale(t.Time.deltaTime)),e}}}(es||(es={})),function(t){t.AnimCurve=class{get points(){return this._points}constructor(t){if(t.length<2)throw new Error("curve length must be >= 2");if(t.sort((t,e)=>t.t-e.t),0!==t[0].t)throw new Error("curve must start with 0");if(1!==t[t.length-1].t)throw new Error("curve must end with 1");this._points=t}lerp(e){for(let s=1;s<this._points.length;s++)if(e<=this._points[s].t){const i=t.MathHelper.map01(e,this._points[s-1].t,this._points[s].t);return t.MathHelper.lerp(this._points[s-1].value,this._points[s].value,i)}throw new Error("should never be here")}}}(es||(es={})),function(t){class e{constructor(t,e){this.func=t,this.context=e}}t.FuncPack=e;t.Emitter=class{constructor(){this._messageTable=new Map}addObserver(t,s,i){let n=this._messageTable.get(t);n||(n=[],this._messageTable.set(t,n)),this.hasObserver(t,s)||n.push(new e(s,i))}removeObserver(t,e){let s=this._messageTable.get(t);if(s){let t=s.findIndex(t=>t.func==e);-1!=t&&s.splice(t,1)}}emit(t,...e){let s=this._messageTable.get(t);if(s)for(let t of s)t.func.call(t.context,...e)}hasObserver(t,e){let s=this._messageTable.get(t);return!!s&&s.some(t=>t.func===e)}}}(es||(es={})),function(t){let e;!function(t){t[t.top=0]="top",t[t.bottom=1]="bottom",t[t.left=2]="left",t[t.right=3]="right"}(e=t.Edge||(t.Edge={}))}(es||(es={})),function(t){class e{static default(){return new e}constructor(){}equals(t,e){return"function"==typeof t.equals?t.equals(e):t===e}getHashCode(t){if("number"==typeof t)return this._getHashCodeForNumber(t);if("string"==typeof t)return this._getHashCodeForString(t);let e=385229220;return this.forOwn(t,t=>{"number"==typeof t?e+=this._getHashCodeForNumber(t):"string"==typeof t?e+=this._getHashCodeForString(t):"object"==typeof t&&this.forOwn(t,()=>{e+=this.getHashCode(t)})}),e}_getHashCodeForNumber(t){return t}_getHashCodeForString(t){let e=385229220;for(let s=0;s<t.length;s++)e=-1521134295*e^t.charCodeAt(s);return e}forOwn(t,e){t=Object(t),Object.keys(t).forEach(s=>e(t[s],s,t))}}t.EqualityComparer=e}(es||(es={})),function(t){t.Hash=class{static computeHash(...t){let e=2166136261;for(let s=0;s<t.length;s++)e=16777619*(e^t[s]);return e+=e<<13,e^=e>>7,e+=e<<3,e^=e>>17,e+=e<<5}}}(es||(es={})),function(t){class e{constructor(){this._listeners=[]}addListener(t,e){-1===this._listeners.findIndex(s=>s.callback===e&&s.caller===t)&&this._listeners.push({caller:t,callback:e})}removeListener(t,e){const s=this._listeners.findIndex(s=>s.callback===e&&s.caller===t);s>=0&&this._listeners.splice(s,1)}clearListener(){this._listeners=[]}clearListenerWithCaller(t){for(let e=this._listeners.length-1;e>=0;e--){this._listeners[e].caller===t&&this._listeners.splice(e,1)}}notify(...t){for(let e=this._listeners.length-1;e>=0;e--){const s=this._listeners[e];s.caller?s.callback.call(s.caller,...t):s.callback(...t)}}}t.Observable=e;t.ObservableT=class extends e{addListener(t,e){super.addListener(t,e)}removeListener(t,e){super.removeListener(t,e)}notify(t){super.notify(t)}};t.ObservableTT=class extends e{addListener(t,e){super.addListener(t,e)}removeListener(t,e){super.removeListener(t,e)}notify(t,e){super.notify(t,e)}};t.Command=class{constructor(t,s){this.bindAction(t,s),this._onExec=new e}bindAction(t,e){this._caller=t,this._action=e}dispatch(...t){this._action?(this._caller?this._action.call(this._caller,...t):this._action(...t),this._onExec.notify()):console.warn("command not bind with an action")}addListener(t,e){this._onExec.addListener(t,e)}removeListener(t,e){this._onExec.removeListener(t,e)}clearListener(){this._onExec.clearListener()}clearListenerWithCaller(t){this._onExec.clearListenerWithCaller(t)}};t.ValueChangeCommand=class{constructor(t){this._onValueChange=new e,this._value=t}get onValueChange(){return this._onValueChange}get value(){return this._value}set value(t){this._value=t}dispatch(t){if(t!==this._value){const e=this._value;this._value=t,this._onValueChange.notify(this._value,e)}}addListener(t,e){this._onValueChange.addListener(t,e)}removeListener(t,e){this._onValueChange.removeListener(t,e)}clearListener(){this._onValueChange.clearListener()}clearListenerWithCaller(t){this._onValueChange.clearListenerWithCaller(t)}}}(es||(es={})),function(t){t.Out=class{constructor(t=null){this.value=t}}}(es||(es={})),function(t){t.Ref=class{constructor(t){this.value=t}}}(es||(es={})),function(t){t.Screen=class{static get size(){return new t.Vector2(this.width,this.height)}static get center(){return new t.Vector2(this.width/2,this.height/2)}}}(es||(es={})),function(t){t.SubpixelNumber=class{update(t){this.remainder+=t;let e=Math.trunc(this.remainder);return this.remainder-=e,e}reset(){this.remainder=0}}}(es||(es={})),function(t){class e{constructor(){this.triangleIndices=[],this._triPrev=new Array(12),this._triNext=new Array(12)}static testPointTriangle(e,s,i,n){return!(t.Vector2Ext.cross(e.sub(s),i.sub(s))<0)&&(!(t.Vector2Ext.cross(e.sub(i),n.sub(i))<0)&&!(t.Vector2Ext.cross(e.sub(n),s.sub(n))<0))}triangulate(s,i=!0){let n=s.length;this.initialize(n);let r=0,o=0;for(;n>3&&r<500;){r++;let i=!0,a=s[this._triPrev[o]],h=s[o],l=s[this._triNext[o]];if(t.Vector2Ext.isTriangleCCW(a,h,l)){let t=this._triNext[this._triNext[o]];do{if(e.testPointTriangle(s[t],a,h,l)){i=!1;break}t=this._triNext[t]}while(t!=this._triPrev[o])}else i=!1;i?(this.triangleIndices.push(this._triPrev[o]),this.triangleIndices.push(o),this.triangleIndices.push(this._triNext[o]),this._triNext[this._triPrev[o]]=this._triNext[o],this._triPrev[this._triNext[o]]=this._triPrev[o],n--,o=this._triPrev[o]):o=this._triNext[o]}this.triangleIndices.push(this._triPrev[o]),this.triangleIndices.push(o),this.triangleIndices.push(this._triNext[o]),i||this.triangleIndices.reverse()}initialize(t){this.triangleIndices.length=0,this._triNext.length<t&&(this._triNext.reverse(),this._triNext.length=Math.max(2*this._triNext.length,t)),this._triPrev.length<t&&(this._triPrev.reverse(),this._triPrev.length=Math.max(2*this._triPrev.length,t));for(let e=0;e<t;e++)this._triPrev[e]=e-1,this._triNext[e]=e+1;this._triPrev[0]=t-1,this._triNext[t-1]=0}}t.Triangulator=e}(es||(es={})),function(t){const e=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];t.UUID=class{static randomUUID(){const t=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&s]+e[s>>8&255]+"-"+e[s>>16&15|64]+e[s>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}}(es||(es={})),function(t){t.getClassName=function(t){return t.className||t.name}}(es||(es={})),function(t){t.Bag=class{constructor(t=64){this.size_=0,this.length=0,this.array=[],this.length=t}removeAt(t){const e=this.array[t];return this.array[t]=this.array[--this.size_],this.array[this.size_]=null,e}remove(t){let e,s;const i=this.size_;for(e=0;e<i;e++)if(t==(s=this.array[e]))return this.array[e]=this.array[--this.size_],this.array[this.size_]=null,!0;return!1}removeLast(){if(this.size_>0){const t=this.array[--this.size_];return this.array[this.size_]=null,t}return null}contains(t){let e,s;for(e=0,s=this.size_;s>e;e++)if(t===this.array[e])return!0;return!1}removeAll(t){let e,s,i,n,r,o=!1;for(e=0,i=t.size();e<i;e++)for(n=t[e],s=0;s<this.size_;s++)if(n===(r=this.array[s])){this.removeAt(s),s--,o=!0;break}return o}get(t){if(t>=this.length)throw new Error("ArrayIndexOutOfBoundsException");return this.array[t]}safeGet(t){return t>=this.length&&this.grow(7*t/4+1),this.array[t]}size(){return this.size_}getCapacity(){return this.length}isIndexWithinBounds(t){return t<this.getCapacity()}isEmpty(){return 0==this.size_}add(t){this.size_===this.length&&this.grow(),this.array[this.size_++]=t}set(t,e){t>=this.length&&this.grow(2*t),this.size_=t+1,this.array[t]=e}grow(t=1+~~(3*this.length/2)){this.length=~~t}ensureCapacity(t){t>=this.length&&this.grow(2*t)}clear(){let t,e;for(t=0,e=this.size_;t<e;t++)this.array[t]=null;this.size_=0}addAll(t){let e;for(e=0;t.size()>e;e++)this.add(t.get(e))}}}(es||(es={})),function(t){class e{constructor(t,e){this.element=t,this.next=e}}function s(t,e){return t===e}t.Node=e,t.defaultEquals=s;t.LinkedList=class{constructor(t=s){this.count=0,this.next=void 0,this.equalsFn=t,this.head=null}push(t){const s=new e(t);let i;if(null==this.head)this.head=s;else{for(i=this.head;null!=i.next;)i=i.next;i.next=s}this.count++}removeAt(t){if(t>=0&&t<this.count){let e=this.head;if(0===t)this.head=e.next;else{const s=this.getElementAt(t-1);e=s.next,s.next=e.next}return this.count--,e.element}}getElementAt(t){if(t>=0&&t<=this.count){let e=this.head;for(let s=0;s<t&&null!=e;s++)e=e.next;return e}}insert(t,s){if(s>=0&&s<=this.count){const i=new e(t);if(0===s)i.next=this.head,this.head=i;else{const t=this.getElementAt(s-1);i.next=t.next,t.next=i}return this.count++,!0}return!1}indexOf(t){let e=this.head;for(let s=0;s<this.count&&null!=e;s++){if(this.equalsFn(t,e.element))return s;e=e.next}return-1}remove(t){this.removeAt(this.indexOf(t))}clear(){this.head=void 0,this.count=0}size(){return this.count}isEmpty(){return 0===this.size()}getHead(){return this.head}toString(){if(null==this.head)return"";let t=`${this.head.element}`,e=this.head.next;for(let s=1;s<this.size()&&null!=e;s++)t=`${t}, ${e.element}`,e=e.next;return t}}}(es||(es={})),function(t){class e{static warmCache(t,e){if(this.checkCreate(t),(e-=this._objectQueue.get(t).length)>0)for(let s=0;s<e;s++)this._objectQueue.get(t).push([])}static trimCache(t,e){for(this.checkCreate(t);e>this._objectQueue.get(t).length;)this._objectQueue.get(t).splice(0,1)}static clearCache(t){this.checkCreate(t),this._objectQueue.get(t).length=0}static obtain(t){return this.checkCreate(t),this._objectQueue.get(t).length>0?this._objectQueue.get(t).shift():[]}static free(t,e){this.checkCreate(t),this._objectQueue.get(t).push(e),e.length=0}static checkCreate(t){this._objectQueue.has(t)||this._objectQueue.set(t,[])}}e._objectQueue=new Map,t.ListPool=e}(es||(es={})),function(t){t.Pair=class{constructor(t,e){this.first=t,this.second=e}clear(){this.first=this.second=null}equals(t){return this.first===t.first&&this.second===t.second}}}(es||(es={})),function(t){t.PairSet=class{constructor(){this._all=new Array}get all(){return this._all}has(t){return this._all.findIndex(e=>e.equals(t))>-1}add(t){this.has(t)||this._all.push(t)}remove(t){const e=this._all.findIndex(e=>e.equals(t));if(e>-1){const t=this._all[e];this._all[e]=this._all[this._all.length-1],this._all[this._all.length-1]=t,this._all=this._all.slice(0,this._all.length-1)}}clear(){this._all=[]}union(t){const e=t.all;if(e.length>0)for(let t=0;t<e.length;t++){const s=e[t];this.add(s)}}except(t){const e=t.all;if(e.length>0)for(let t=0;t<e.length;t++){const s=e[t];this.remove(s)}}}}(es||(es={})),function(t){class e{static warmCache(t,e){this.checkCreate(t);const s=this._objectQueue.get(t);if((e-=s.length)>0)for(let i=0;i<e;i++)s.push(new t)}static trimCache(t,e){this.checkCreate(t);const s=this._objectQueue.get(t);for(;e<s.length;)s.pop()}static clearCache(t){this.checkCreate(t),this._objectQueue.get(t).length=0}static obtain(t){this.checkCreate(t);const e=this._objectQueue.get(t);return e.length>0?e.pop():new t}static free(e,s){this.checkCreate(e),this._objectQueue.get(e).push(s),t.isIPoolable(s)&&s.reset()}static checkCreate(t){this._objectQueue.has(t)||this._objectQueue.set(t,[])}}e._objectQueue=new Map,t.Pool=e,t.isIPoolable=(t=>"function"==typeof t.reset)}(es||(es={})),function(t){t.Coroutine=class{static waitForSeconds(t){return e.waiter.wait(t)}};class e{constructor(){this.waitTime=0}wait(t){return e.waiter.waitTime=t,e.waiter}}e.waiter=new e,t.WaitForSeconds=e}(es||(es={})),function(t){class e{constructor(){this.waitTimer=0,this.useUnscaledDeltaTime=!1}stop(){this.isDone=!0}setUseUnscaledDeltaTime(t){return this.useUnscaledDeltaTime=t,this}prepareForUse(){this.isDone=!1}reset(){this.isDone=!0,this.waitTimer=0,this.waitForCoroutine=null,this.enumerator=null,this.useUnscaledDeltaTime=!1}}t.CoroutineImpl=e;t.CoroutineManager=class extends t.GlobalManager{constructor(){super(...arguments),this._unblockedCoroutines=[],this._shouldRunNextFrame=[]}clearAllCoroutines(){for(let s=0;s<this._unblockedCoroutines.length;s++)t.Pool.free(e,this._unblockedCoroutines[s]);for(let s=0;s<this._shouldRunNextFrame.length;s++)t.Pool.free(e,this._shouldRunNextFrame[s]);this._unblockedCoroutines.length=0,this._shouldRunNextFrame.length=0}startCoroutine(t){const e=this.getOrCreateCoroutine();return e.prepareForUse(),e.enumerator="function"==typeof t?t():t,this.tickCoroutine(e)?(this.addCoroutine(e),e):null}getOrCreateCoroutine(){const s=t.Pool.obtain(e);return s.prepareForUse(),s}addCoroutine(t){this._isInUpdate?this._shouldRunNextFrame.push(t):this._unblockedCoroutines.push(t)}update(){this._isInUpdate=!0;const s=this._unblockedCoroutines,i=this._shouldRunNextFrame;for(let n=s.length-1;n>=0;n--){const r=s[n];if(r.isDone){t.Pool.free(e,r),s.splice(n,1);continue}const o=r.waitForCoroutine;if(null!=o){if(!o.isDone){i.push(r);continue}r.waitForCoroutine=null}const a=r.waitTimer;a>0?(r.waitTimer=a-(r.useUnscaledDeltaTime?t.Time.unscaledDeltaTime:t.Time.deltaTime),i.push(r)):this.tickCoroutine(r)&&i.push(r)}s.push(...i),i.length=0,this._isInUpdate=!1}tickCoroutine(s){const{enumerator:i}=s,{value:n,done:r}=i.next();return r||s.isDone?(t.Pool.free(e,s),!1):!(n&&(n instanceof t.WaitForSeconds?(s.waitTimer=n.waitTime,0):"number"==typeof n?(s.waitTimer=n,0):"string"==typeof n?"break"===n&&(t.Pool.free(e,s),1):"function"==typeof n?(s.waitForCoroutine=this.startCoroutine(n),0):n instanceof e&&(s.waitForCoroutine=n,0)))}}}(es||(es={})),function(t){t.MaxRectsBinPack=class{constructor(t,e,s=!0){this.binWidth=0,this.binHeight=0,this.usedRectangles=[],this.freeRectangles=[],this.init(t,e,s)}init(e,s,i=!0){this.binWidth=e,this.binHeight=s,this.allowRotations=i;let n=new t.Rectangle;n.x=0,n.y=0,n.width=e,n.height=s,this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(n)}insert(e,s){let i=new t.Rectangle,n=new t.Ref(0),r=new t.Ref(0);if(0==(i=this.findPositionForNewNodeBestAreaFit(e,s,n,r)).height)return i;let o=this.freeRectangles.length;for(let e=0;e<o;++e)this.splitFreeNode(this.freeRectangles[e],i)&&(new t.List(this.freeRectangles).removeAt(e),--e,--o);return this.pruneFreeList(),this.usedRectangles.push(i),i}findPositionForNewNodeBestAreaFit(e,s,i,n){let r=new t.Rectangle;i.value=Number.MAX_VALUE;for(let t=0;t<this.freeRectangles.length;++t){let o=this.freeRectangles[t].width*this.freeRectangles[t].height-e*s;if(this.freeRectangles[t].width>=e&&this.freeRectangles[t].height>=s){let a=Math.abs(this.freeRectangles[t].width-e),h=Math.abs(this.freeRectangles[t].height-s),l=Math.min(a,h);(o<i.value||o==i.value&&l<n.value)&&(r.x=this.freeRectangles[t].x,r.y=this.freeRectangles[t].y,r.width=e,r.height=s,n.value=l,i.value=o)}if(this.allowRotations&&this.freeRectangles[t].width>=s&&this.freeRectangles[t].height>=e){let a=Math.abs(this.freeRectangles[t].width-s),h=Math.abs(this.freeRectangles[t].height-e),l=Math.min(a,h);(o<i.value||o==i.value&&l<n.value)&&(r.x=this.freeRectangles[t].x,r.y=this.freeRectangles[t].y,r.width=s,r.height=e,n.value=l,i.value=o)}return r}}splitFreeNode(t,e){if(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)return!1;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){let s=t;s.height=e.y-s.y,this.freeRectangles.push(s)}if(e.y+e.height<t.y+t.height){let s=t;s.y=e.y+e.height,s.height=t.y+t.height-(e.y+e.height),this.freeRectangles.push(s)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){let s=t;s.width=e.x-s.x,this.freeRectangles.push(s)}if(e.x+e.width<t.x+t.width){let s=t;s.x=e.x+e.width,s.width=t.x+t.width-(e.x+e.width),this.freeRectangles.push(s)}}return!0}pruneFreeList(){for(let e=0;e<this.freeRectangles.length;++e)for(let s=e+1;s<this.freeRectangles.length;++s){if(this.isContainedIn(this.freeRectangles[e],this.freeRectangles[s])){new t.List(this.freeRectangles).removeAt(e),--e;break}this.isContainedIn(this.freeRectangles[s],this.freeRectangles[e])&&(new t.List(this.freeRectangles).removeAt(s),--s)}}isContainedIn(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height}}}(es||(es={})),function(t){t.ArrayUtils=class{static bubbleSort(t){let e=!1;for(let s=0;s<t.length;s++){e=!1;for(let i=t.length-1;i>s;i--)if(t[i]<t[i-1]){let s=t[i];t[i]=t[i-1],t[i-1]=s,e=!0}if(!e)break}}static insertionSort(t){let e=t.length;for(let i=1;i<e;i++){let e=t[i];for(var s=i;s>0&&t[s-1]>e;s--)t[s]=t[s-1];t[s]=e}}static binarySearch(t,e){let s=0,i=t.length,n=s+i>>1;for(;s<i;)e<=t[n]?i=n:e>=t[n]&&(s=n+1),n=s+i>>1;return t[s]==e?s:-1}static findElementIndex(t,e){let s=t.length;for(let i=0;i<s;++i)if(t[i]==e)return i;return null}static getMaxElementIndex(t){let e=0,s=t.length;for(let i=1;i<s;i++)t[i]>t[e]&&(e=i);return e}static getMinElementIndex(t){let e=0,s=t.length;for(let i=1;i<s;i++)t[i]<t[e]&&(e=i);return e}static getUniqueAry(t){let e=[],s=[],i=t.length;for(let s=0;s<i;++s){let i=t[s];-1==e.indexOf(i)&&e.push(i)}for(let t=(i=e.length)-1;t>=0;--t)s.unshift(e[t]);return s}static getDifferAry(t,e){t=this.getUniqueAry(t),e=this.getUniqueAry(e);let s=t.concat(e),i={},n=[],r=s.length;for(let t=0;t<r;++t)i[s[t]]?i[s[t]]instanceof Object&&i[s[t]].count++:(i[s[t]]={},i[s[t]].count=0,i[s[t]].key=s[t],i[s[t]].count++);for(let t in i)2!=i[t].count&&n.unshift(i[t].key);return n}static swap(t,e,s){let i=t[e];t[e]=t[s],t[s]=i}static clearList(t){if(t)for(let e=t.length-1;e>=0;e-=1)t.splice(e,1)}static cloneList(t){return t?t.slice(0,t.length):null}static equals(t,e){if(t==e)return!0;let s=t.length;if(s!=e.length)return!1;for(;s--;)if(t[s]!=e[s])return!1;return!0}static insert(t,e,s){if(!t)return null;let i=t.length;if(e>i&&(e=i),e<0&&(e=0),e==i)t.push(s);else if(0==e)t.unshift(s);else{for(let s=i-1;s>=e;s-=1)t[s+1]=t[s];t[e]=s}return s}static shuffle(e){let s=e.length;for(;s>1;){s--;let i=t.RandomUtils.randint(0,s+1),n=e[i];e[i]=e[s],e[s]=n}}static addIfNotPresent(e,s){return!new t.List(e).contains(s)&&(e.push(s),!0)}static lastItem(t){return t[t.length-1]}static randomItem(e){return e[t.RandomUtils.randint(0,e.length-1)]}static randomItems(e,s,i){let n=new Set;for(;n.size!=i;){let t=this.randomItem(s);n.has(t)||n.add(t)}let r=t.ListPool.obtain(e);return n.forEach(t=>r.push(t)),r}}}(es||(es={})),function(t){class e{static get nativeBase64(){return"function"==typeof window.atob}static decode(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(t);for(var e,s,i,n,r,o,a=[],h=0;h<t.length;)e=this._keyStr.indexOf(t.charAt(h++))<<2|(n=this._keyStr.indexOf(t.charAt(h++)))>>4,s=(15&n)<<4|(r=this._keyStr.indexOf(t.charAt(h++)))>>2,i=(3&r)<<6|(o=this._keyStr.indexOf(t.charAt(h++))),a.push(String.fromCharCode(e)),64!==r&&a.push(String.fromCharCode(s)),64!==o&&a.push(String.fromCharCode(i));return a=a.join("")}static encode(t){if(t=t.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var e,s,i,n,r,o,a,h=[],l=0;l<t.length;)n=(e=t.charCodeAt(l++))>>2,r=(3&e)<<4|(s=t.charCodeAt(l++))>>4,o=(15&s)<<2|(i=t.charCodeAt(l++))>>6,a=63&i,isNaN(s)?o=a=64:isNaN(i)&&(a=64),h.push(this._keyStr.charAt(n)),h.push(this._keyStr.charAt(r)),h.push(this._keyStr.charAt(o)),h.push(this._keyStr.charAt(a));return h=h.join("")}window.btoa(t)}static decodeBase64AsArray(t,s){s=s||1;var i,n,r,o=e.decode(t),a=new Uint32Array(o.length/s);for(i=0,r=o.length/s;i<r;i++)for(a[i]=0,n=s-1;n>=0;--n)a[i]+=o.charCodeAt(i*s+n)<<(n<<3);return a}static decompress(t,e,s){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}static decodeCSV(t){for(var e=t.replace("\n","").trim().split(","),s=[],i=0;i<e.length;i++)s.push(+e[i]);return s}}e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.Base64Utils=e}(es||(es={})),function(t){t.EdgeExt=class{static oppositeEdge(e){switch(e){case t.Edge.bottom:return t.Edge.top;case t.Edge.top:return t.Edge.bottom;case t.Edge.left:return t.Edge.right;case t.Edge.right:return t.Edge.left}}static isHorizontal(e){return e==t.Edge.right||e==t.Edge.left}static isVertical(e){return e==t.Edge.top||e==t.Edge.bottom}}}(es||(es={})),function(t){t.NumberExtension=class{static toNumber(t){return void 0==t?0:Number(t)}}}(es||(es={})),function(t){t.RandomUtils=class{static randrange(t,e,s=1){if(0==s)throw new Error("step 不能为 0");let i=e-t;if(0==i)throw new Error("没有可用的范围("+t+","+e+")");i<0&&(i=t-e);let n=Math.floor((i+s-1)/s);return Math.floor(this.random()*n)*s+Math.min(t,e)}static randint(t,e){return(t=Math.floor(t))>(e=Math.floor(e))?t++:e++,this.randrange(t,e)}static randnum(t,e){return this.random()*(e-t)+t}static shuffle(t){return t.sort(this._randomCompare),t}static choice(t){if(!t.hasOwnProperty("length"))throw new Error("无法对此对象执行此操作");let e=Math.floor(this.random()*t.length);return t instanceof String?String(t).charAt(e):t[e]}static sample(t,e){let s=t.length;if(e<=0||s<e)throw new Error("采样数量不够");let i=[],n=[];for(let r=0;r<e;r++){let e=Math.floor(this.random()*s);for(;n.indexOf(e)>=0;)e=Math.floor(this.random()*s);i.push(t[e]),n.push(e)}return i}static random(){return Math.random()}static boolean(t=.5){return this.random()<t}static _randomCompare(t,e){return this.random()>.5?1:-1}}}(es||(es={})),function(t){t.RectangleExt=class{static getSide(e,s){switch(s){case t.Edge.top:return e.top;case t.Edge.bottom:return e.bottom;case t.Edge.left:return e.left;case t.Edge.right:return e.right}}static union(e,s){let i=new t.Rectangle(s.x,s.y,0,0),n=new t.Rectangle;return n.x=Math.min(e.x,i.x),n.y=Math.min(e.y,i.y),n.width=Math.max(e.right,i.right)-n.x,n.height=Math.max(e.bottom,i.bottom)-n.y,n}static getHalfRect(e,s){switch(s){case t.Edge.top:return new t.Rectangle(e.x,e.y,e.width,e.height/2);case t.Edge.bottom:return new t.Rectangle(e.x,e.y+e.height/2,e.width,e.height/2);case t.Edge.left:return new t.Rectangle(e.x,e.y,e.width/2,e.height);case t.Edge.right:return new t.Rectangle(e.x+e.width/2,e.y,e.width/2,e.height)}}static getRectEdgePortion(e,s,i=1){switch(s){case t.Edge.top:return new t.Rectangle(e.x,e.y,e.width,i);case t.Edge.bottom:return new t.Rectangle(e.x,e.y+e.height-i,e.width,i);case t.Edge.left:return new t.Rectangle(e.x,e.y,i,e.height);case t.Edge.right:return new t.Rectangle(e.x+e.width-i,e.y,i,e.height)}}static expandSide(e,s,i){switch(i=Math.abs(i),s){case t.Edge.top:e.y-=i,e.height+=i;break;case t.Edge.bottom:e.height+=i;break;case t.Edge.left:e.x-=i,e.width+=i;break;case t.Edge.right:e.width+=i}}static contract(t,e,s){t.x+=e,t.y+=s,t.width-=2*e,t.height-=2*s}static boundsFromPolygonVector(e){let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let t=0;t<e.length;t++){let o=e[t];o.x<s&&(s=o.x),o.x>n&&(n=o.x),o.y<i&&(i=o.y),o.y>r&&(r=o.y)}return this.fromMinMaxVector(new t.Vector2(s,i),new t.Vector2(n,r))}static fromMinMaxVector(e,s){return new t.Rectangle(e.x,e.y,s.x-e.x,s.y-e.y)}static getSweptBroadphaseBounds(e,s,i){let n=t.Rectangle.empty;return n.x=s>0?e.x:e.x+s,n.y=i>0?e.y:e.y+i,n.width=s>0?s+e.width:e.width-s,n.height=i>0?i+e.height:e.height-i,n}collisionCheck(t,e,s,i){s.value=i.value=0;let n=e.x-(t.x+t.width),r=e.x+e.width-t.x,o=e.y-(t.y+t.height),a=e.y+e.height-t.y;return!(n>0||r<0||o>0||a<0||(s.value=Math.abs(n)<r?n:r,i.value=Math.abs(o)<a?o:a,Math.abs(s.value)<Math.abs(i.value)?i.value=0:s.value=0,0))}static getIntersectionDepth(e,s){let i=e.width/2,n=e.height/2,r=s.width/2,o=s.height/2,a=new t.Vector2(e.left+i,e.top+n),h=new t.Vector2(s.left+r,s.top+o),l=a.x-h.x,c=a.y-h.y,u=i+r,d=n+o;if(Math.abs(l)>=u||Math.abs(c)>=d)return t.Vector2.zero;let m=l>0?u-l:-u-l,p=c>0?d-c:-d-c;return new t.Vector2(m,p)}static getClosestPointOnBoundsToOrigin(e){let s=this.getMax(e),i=Math.abs(e.location.x),n=new t.Vector2(e.location.x,0);return Math.abs(s.x)<i&&(i=Math.abs(s.x),n.x=s.x,n.y=0),Math.abs(s.y)<i&&(i=Math.abs(s.y),n.x=0,n.y=s.y),Math.abs(e.location.y)<i&&(i=Math.abs(e.location.y),n.x=0,n.y=e.location.y),n}static getClosestPointOnRectangleToPoint(e,s){let i=t.Vector2.zero;return i.x=t.MathHelper.clamp(s.x,e.left,e.right),i.y=t.MathHelper.clamp(s.y,e.top,e.bottom),i}static getClosestPointOnRectangleBorderToPoint(e,s){let i=t.Vector2.zero;if(i.x=t.MathHelper.clamp(t.MathHelper.toInt(s.x),e.left,e.right),i.y=t.MathHelper.clamp(t.MathHelper.toInt(s.y),e.top,e.bottom),e.contains(i.x,i.y)){let t=e.x-e.left,s=e.right-i.x,n=i.y-e.top,r=e.bottom-i.y,o=Math.min(t,s,n,r);o==n?i.y=e.top:o==r?i.y=e.bottom:o==t?(i.x,e.left):i.x=e.right}return i}static getMax(e){return new t.Vector2(e.right,e.bottom)}static getCenter(e){return new t.Vector2(e.x+e.width/2,e.y+e.height/2)}static boundsFromPolygonPoints(e){let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let t=0;t<e.length;t++){let o=e[t];o.x<s&&(s=o.x),o.x>n&&(n=o.x),o.y<i&&(i=o.y),o.y>r&&(r=o.y)}return this.fromMinMaxVector(new t.Vector2(t.MathHelper.toInt(s),t.MathHelper.toInt(i)),new t.Vector2(t.MathHelper.toInt(n),t.MathHelper.toInt(r)))}static calculateBounds(e,s,i,n,r,o,a,h){if(0==o)e.x=t.MathHelper.toInt(s.x+i.x-n.x*r.x),e.y=t.MathHelper.toInt(s.y+i.y-n.y*r.y),e.width=t.MathHelper.toInt(a*r.x),e.height=t.MathHelper.toInt(h*r.y);else{let l,c=s.x+i.x,u=s.y+i.y,d=new t.Matrix2D;t.Matrix2D.createTranslation(-c-n.x,-u-n.y,d),t.Matrix2D.createScale(r.x,r.y,l),d=d.multiply(l),t.Matrix2D.createRotation(o,l),d=d.multiply(l),t.Matrix2D.createTranslation(c,u,l),d=d.multiply(l);let m=new t.Vector2(c,u),p=new t.Vector2(c+a,u),g=new t.Vector2(c,u+h),y=new t.Vector2(c+a,u+h);t.Vector2Ext.transformR(m,d,m),t.Vector2Ext.transformR(p,d,p),t.Vector2Ext.transformR(g,d,g),t.Vector2Ext.transformR(y,d,y);let f=t.MathHelper.toInt(Math.min(m.x,y.x,p.x,g.x)),_=t.MathHelper.toInt(Math.max(m.x,y.x,p.x,g.x)),T=t.MathHelper.toInt(Math.min(m.y,y.y,p.y,g.y)),x=t.MathHelper.toInt(Math.max(m.y,y.y,p.y,g.y));e.location=new t.Vector2(f,T),e.width=t.MathHelper.toInt(_-f),e.height=t.MathHelper.toInt(x-T)}}static scale(e,s){e.x=t.MathHelper.toInt(e.x*s.x),e.y=t.MathHelper.toInt(e.y*s.y),e.width=t.MathHelper.toInt(e.width*s.x),e.height=t.MathHelper.toInt(e.height*s.y)}static translate(t,e){t.location.addEqual(e)}}}(es||(es={})),function(t){t.TextureUtils=class{static premultiplyAlpha(t){let e=t[0];for(let s=0;s<t.length;s+=4)if(255!=e[s+3]){let t=e[s+3]/255;e[s+0]=e[s+0]*t,e[s+1]=e[s+1]*t,e[s+2]=e[s+2]*t}}}}(es||(es={})),function(t){t.TypeUtils=class{static getType(t){return t.constructor}}}(es||(es={})),function(t){t.Vector2Ext=class{static isTriangleCCW(t,e,s){return this.cross(e.sub(t),s.sub(e))<0}static halfVector(){return new t.Vector2(.5,.5)}static cross(t,e){return t.y*e.x-t.x*e.y}static perpendicular(e,s){return new t.Vector2(-1*(s.y-e.y),s.x-e.x)}static perpendicularFlip(e){return new t.Vector2(-e.y,e.x)}static angle(e,s){return this.normalize(e),this.normalize(s),Math.acos(t.MathHelper.clamp(e.dot(s),-1,1))*t.MathHelper.Rad2Deg}static angleBetween(t,e,s){const i=e.sub(t),n=s.sub(t);return this.angle(i,n)}static getRayIntersection(e,s,i,n,r=t.Vector2.zero){let o=s.y-e.y,a=s.x-e.x,h=n.y-i.y,l=n.x-i.x;if(o*l==h*a)return r.x=Number.NaN,r.y=Number.NaN,!1;let c=((i.y-e.y)*a*l+o*l*e.x-h*a*i.x)/(o*l-h*a),u=e.y+o/a*(c-e.x);return r.x=c,r.y=u,!0}static normalize(e){let s=Math.sqrt(e.x*e.x+e.y*e.y);s>t.MathHelper.Epsilon?e.divideScaler(s):e.x=e.y=0}static transformA(t,e,s,i,n,r){for(let o=0;o<r;o++){let r=t[e+o],a=i[n+o];a.x=r.x*s.m11+r.y*s.m21+s.m31,a.y=r.x*s.m12+r.y*s.m22+s.m32,i[n+o]=a}}static transformR(e,s,i=t.Vector2.zero){let n=e.x*s.m11+e.y*s.m21+s.m31,r=e.x*s.m12+e.y*s.m22+s.m32;i.x=n,i.y=r}static transform(t,e,s){this.transformA(t,0,e,s,0,t.length)}static round(e){return new t.Vector2(Math.round(e.x),Math.round(e.y))}}}(es||(es={})),function(t){t.Enumerable=class{static range(e,s){let i=new t.List;for(;s--;)i.add(e++);return i}static repeat(e,s){let i=new t.List;for(;s--;)i.add(e);return i}}}(es||(es={})),function(t){t.isObj=(t=>!!t&&"object"==typeof t),t.negate=(t=>(...e)=>!t(...e)),t.composeComparers=((t,e)=>(s,i)=>t(s,i)||e(s,i)),t.keyComparer=((t,e)=>(s,i)=>{const n=t(s),r=t(i);return n>r?e?-1:1:n<r?e?1:-1:0})}(es||(es={})),function(t){class e{constructor(t=[]){this._elements=t}add(t){this._elements.push(t)}append(t){this.add(t)}prepend(t){this._elements.unshift(t)}addRange(t){this._elements.push(...t)}aggregate(t,e){return this._elements.reduce(t,e)}all(t){return this._elements.every(t)}any(t){return t?this._elements.some(t):this._elements.length>0}average(t){const e=this.sum(t),s=this.count(t);return 0===s?NaN:e/s}cast(){return new e(this._elements)}clear(){this._elements.length=0}concat(t){return new e(this._elements.concat(t.toArray()))}contains(t){return this.any(e=>e===t)}count(t){return t?this.where(t).count():this._elements.length}defaultIfEmpty(t){return this.count()?this:new e([t])}distinctBy(t){const s=this.groupBy(t);return Object.keys(s).reduce((t,e)=>(t.add(s[e][0]),t),new e)}elementAt(t){if(t<this.count()&&t>=0)return this._elements[t];throw new Error("ArgumentOutOfRangeException: index is less than 0 or greater than or equal to the number of elements in source.")}elementAtOrDefault(t){return t<this.count()&&t>=0?this._elements[t]:null}except(t){return this.where(e=>!t.contains(e))}first(t){if(this.count())return t?this.where(t).first():this._elements[0];throw new Error("InvalidOperationException: The source sequence is empty.")}firstOrDefault(t){return this.count(t)?this.first(t):void 0}forEach(t){return this._elements.forEach(t)}groupBy(t,e=(t=>t)){return this.aggregate((s,i)=>{const n=t(i),r=s[n],o=e(i);return r?r.push(o):s[n]=[o],s},{})}groupJoin(t,e,s,i){return this.select(n=>i(n,t.where(t=>e(n)===s(t))))}indexOf(t){return this._elements.indexOf(t)}insert(t,e){if(t<0||t>this._elements.length)throw new Error("Index is out of range.");this._elements.splice(t,0,e)}intersect(t){return this.where(e=>t.contains(e))}join(t,e,s,i){return this.selectMany(n=>t.where(t=>s(t)===e(n)).select(t=>i(n,t)))}last(t){if(this.count())return t?this.where(t).last():this._elements[this.count()-1];throw Error("InvalidOperationException: The source sequence is empty.")}lastOrDefault(t){return this.count(t)?this.last(t):void 0}max(t){return Math.max(...this._elements.map(t||(t=>t)))}min(t){return Math.min(...this._elements.map(t||(t=>t)))}ofType(t){let e;switch(t){case Number:e="number";break;case String:e="string";break;case Boolean:e=typeof!0;break;case Function:e="function";break;default:e=null}return null===e?this.where(e=>e instanceof t).cast():this.where(t=>typeof t===e).cast()}orderBy(e,i=t.keyComparer(e,!1)){return new s(this._elements,i)}orderByDescending(e,i=t.keyComparer(e,!0)){const n=this._elements.slice();return n.sort(i),new s(n,i)}thenBy(t){return this.orderBy(t)}thenByDescending(t){return this.orderByDescending(t)}remove(t){const e=this.indexOf(t);return-1!==e&&(this.removeAt(e),!0)}removeAll(s){const i=this.where(t.negate(s)).toArray();return new e(i)}removeAt(t){this._elements.splice(t,1)}reverse(){return new e(this._elements.reverse())}select(t){const s=this._elements.map(t);return new e(s)}selectMany(t){return this.aggregate((e,s,i)=>{const n=this.select(t).elementAt(i);return e.addRange(n.toArray())},new e)}sequenceEqual(t){return this.all(e=>t.contains(e))}single(t){if(1!==this.count(t))throw new Error("The collection does not contain exactly one element.");return this.first(t)}singleOrDefault(t){return this.count(t)?this.single(t):void 0}skip(t){return new e(this._elements.slice(Math.max(0,t)))}skipLast(t){return new e(this._elements.slice(0,-Math.max(0,t)))}skipWhile(t){return this.skip(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}sum(t){return t?this.select(t).sum():this.aggregate((t,e)=>t+=+e,0)}take(t){return new e(this._elements.slice(0,Math.max(0,t)))}takeLast(t){return new e(this._elements.slice(-Math.max(0,t)))}takeWhile(t){return this.take(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}toArray(){return this._elements}toDictionary(t,s){return this.aggregate((e,i,n)=>(e[this.select(t).elementAt(n).toString()]=s?this.select(s).elementAt(n):i,e.add({Key:this.select(t).elementAt(n),Value:s?this.select(s).elementAt(n):i}),e),new e)}toSet(){let t=new Set;for(let e of this._elements)t.add(e);return t}toLookup(t,e){return this.groupBy(t,e)}where(t){return new e(this._elements.filter(t))}zip(t,e){return t.count()<this.count()?t.select((t,s)=>e(this.elementAt(s),t)):this.select((s,i)=>e(s,t.elementAt(i)))}}t.List=e;class s extends e{constructor(t,e){super(t),this._comparer=e,this._elements.sort(this._comparer)}thenBy(e){return new s(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!1)))}thenByDescending(e){return new s(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!0)))}}t.OrderedList=s}(es||(es={})),function(t){t.EndPoint=class{constructor(){this.position=t.Vector2.zero,this.begin=!1,this.segment=null,this.angle=0}};t.EndPointComparer=class{compare(t,e){return t.angle>e.angle?1:t.angle<e.angle?-1:!t.begin&&e.begin?1:t.begin&&!e.begin?-1:0}}}(es||(es={})),function(t){t.Segment=class{constructor(){this.p1=null,this.p2=null}}}(es||(es={})),function(t){class e{constructor(e,s){this.lineCountForCircleApproximation=10,this._radius=0,this._origin=t.Vector2.zero,this._isSpotLight=!1,this._spotStartAngle=0,this._spotEndAngle=0,this._endPoints=[],this._segments=[],this._origin=e,this._radius=s,this._radialComparer=new t.EndPointComparer}addColliderOccluder(e){if(e instanceof t.BoxCollider&&0==e.rotation)this.addSquareOccluder(e.bounds);else if(e instanceof t.PolygonCollider){let s=e.shape;for(let e=0;e<s.points.length;e++){let i=e-1;0==e&&(i+=s.points.length),this.addLineOccluder(t.Vector2.add(s.points[i],s.position),t.Vector2.add(s.points[e],s.position))}}else e instanceof t.CircleCollider&&this.addCircleOccluder(e.absolutePosition,e.radius)}addCircleOccluder(e,s){let i=e.sub(this._origin),n=Math.atan2(i.y,i.x),r=Math.PI/this.lineCountForCircleApproximation,o=n+t.MathHelper.PiOver2,a=t.MathHelper.angleToVector(o,s).addEqual(e);for(let i=1;i<this.lineCountForCircleApproximation;i++){let n=t.MathHelper.angleToVector(o+i*r,s).addEqual(e);this.addLineOccluder(a,n),a=n}}addLineOccluder(t,e){this.addSegment(t,e)}addSquareOccluder(e){let s=new t.Vector2(e.right,e.top),i=new t.Vector2(e.left,e.bottom),n=new t.Vector2(e.right,e.bottom);this.addSegment(e.location,s),this.addSegment(s,n),this.addSegment(n,i),this.addSegment(i,e.location)}addSegment(e,s){let i=new t.Segment,n=new t.EndPoint,r=new t.EndPoint;n.position=e,n.segment=i,r.position=s,r.segment=i,i.p1=n,i.p2=r,this._segments.push(i),this._endPoints.push(n),this._endPoints.push(r)}clearOccluders(){this._segments.length=0,this._endPoints.length=0}begin(t,e){this._origin=t,this._radius=e,this._isSpotLight=!1}end(){let s=t.ListPool.obtain(t.Vector2);this.updateSegments(),this._endPoints.sort(this._radialComparer.compare);let i=0;for(let t=0;t<2;t++)for(let n of this._endPoints){let r=0==e._openSegments.size()?null:e._openSegments.getHead().element;if(n.begin){let t=e._openSegments.getHead();for(;null!=t&&this.isSegmentInFrontOf(n.segment,t.element,this._origin);)t=t.next;null==t?e._openSegments.push(n.segment):e._openSegments.insert(n.segment,e._openSegments.indexOf(t.element))}else e._openSegments.remove(n.segment);let o=null;0!=e._openSegments.size()&&(o=e._openSegments.getHead().element),r!=o&&(1==t&&(!this._isSpotLight||e.between(i,this._spotStartAngle,this._spotEndAngle)&&e.between(n.angle,this._spotStartAngle,this._spotEndAngle))&&this.addTriangle(s,i,n.angle,r),i=n.angle)}return e._openSegments.clear(),this.clearOccluders(),s}addTriangle(s,i,n,r){let o=this._origin.clone(),a=new t.Vector2(this._origin.x+Math.cos(i),this._origin.y+Math.sin(i)),h=t.Vector2.zero,l=t.Vector2.zero;null!=r?(h.x=r.p1.position.x,h.y=r.p1.position.y,l.x=r.p2.position.x,l.y=r.p2.position.y):(h.x=this._origin.x+Math.cos(i)*this._radius*2,h.y=this._origin.y+Math.sin(i)*this._radius*2,l.x=this._origin.x+Math.cos(n)*this._radius*2,l.y=this._origin.y+Math.sin(n)*this._radius*2);let c=e.lineLineIntersection(h,l,o,a);a.x=this._origin.x+Math.cos(n),a.y=this._origin.y+Math.sin(n);let u=e.lineLineIntersection(h,l,o,a);s.push(c),s.push(u)}static lineLineIntersection(e,s,i,n){let r=((n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x))/((n.y-i.y)*(s.x-e.x)-(n.x-i.x)*(s.y-e.y));return new t.Vector2(e.x+r*(s.x-e.x),e.y+r*(s.y-e.y))}static between(t,e,s){return t=(360+t%360)%360,(e=(36e5+e)%360)<(s=(36e5+s)%360)?e<=t&&t<=s:e<=t||t<=s}loadRectangleBoundaries(){this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y-this._radius)),this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y+this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y+this._radius)),this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x-this._radius,this._origin.y+this._radius)),this.addSegment(new t.Vector2(this._origin.x+this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y+this._radius))}isSegmentInFrontOf(t,s,i){let n=e.isLeftOf(t.p2.position,t.p1.position,e.interpolate(s.p1.position,s.p2.position,.01)),r=e.isLeftOf(t.p2.position,t.p1.position,e.interpolate(s.p2.position,s.p1.position,.01)),o=e.isLeftOf(t.p2.position,t.p1.position,i),a=e.isLeftOf(s.p2.position,s.p1.position,e.interpolate(t.p1.position,t.p2.position,.01)),h=e.isLeftOf(s.p2.position,s.p1.position,e.interpolate(t.p2.position,t.p1.position,.01)),l=e.isLeftOf(s.p2.position,s.p1.position,i);return a==h&&h!=l||n==r&&r==o}static interpolate(e,s,i){return new t.Vector2(e.x*(1-i)+s.x*i,e.y*(1-i)+s.y*i)}static isLeftOf(t,e,s){return(e.x-t.x)*(s.y-t.y)-(e.y-t.y)*(s.x-t.x)<0}updateSegments(){for(let t of this._segments){t.p1.angle=Math.atan2(t.p1.position.y-this._origin.y,t.p1.position.x-this._origin.x),t.p2.angle=Math.atan2(t.p2.position.y-this._origin.y,t.p2.position.x-this._origin.x);let e=t.p2.angle-t.p1.angle;e<=-Math.PI&&(e+=2*Math.PI),e>Math.PI&&(e-=2*Math.PI),t.p1.begin=e>0,t.p2.begin=!t.p1.begin}this._isSpotLight&&(this._spotStartAngle=this._segments[0].p2.angle,this._spotEndAngle=this._segments[1].p2.angle)}}e._cornerCache=[],e._openSegments=new t.LinkedList,t.VisibilityComputer=e}(es||(es={})),function(t){t.Timer=class{constructor(){this._timeInSeconds=0,this._repeats=!1,this._isDone=!1,this._elapsedTime=0}getContext(){return this.context}reset(){this._elapsedTime=0}stop(){this._isDone=!0}tick(){return!this._isDone&&this._elapsedTime>this._timeInSeconds&&(this._elapsedTime-=this._timeInSeconds,this._onTime(this),this._isDone||this._repeats||(this._isDone=!0)),this._elapsedTime+=t.Time.deltaTime,this._isDone}initialize(t,e,s,i){this._timeInSeconds=t,this._repeats=e,this.context=s,this._onTime=i.bind(s)}unload(){this.context=null,this._onTime=null}}}(es||(es={})),function(t){t.TimerManager=class extends t.GlobalManager{constructor(){super(...arguments),this._timers=[]}update(){for(let t=this._timers.length-1;t>=0;t--)this._timers[t].tick()&&(this._timers[t].unload(),this._timers.splice(t,1))}schedule(e,s,i,n){let r=new t.Timer;return r.initialize(e,s,i,n),this._timers.push(r),r}}}(es||(es={}));