var es;!function(t){class e{constructor(i=!0,s=!0){this._globalManagers=[],this._coroutineManager=new t.CoroutineManager,this._timerManager=new t.TimerManager,this._frameCounterElapsedTime=0,this._frameCounter=0,this._totalMemory=0,e._instance=this,e.emitter=new t.Emitter,e.emitter.addObserver(t.CoreEvents.frameUpdated,this.update,this),e.registerGlobalManager(this._coroutineManager),e.registerGlobalManager(new t.TweenManager),e.registerGlobalManager(this._timerManager),e.entitySystemsEnabled=s,this.debug=i,this.initialize()}static get Instance(){return this._instance}static get scene(){return this._instance?this._instance._scene:null}static set scene(e){t.Insist.isNotNull(e,"场景不能为空"),null==this._instance._scene?(this._instance._scene=e,this._instance.onSceneChanged(),this._instance._scene.begin()):this._instance._nextScene=e}static create(e=!0){return null==this._instance&&(this._instance=new t.Core(e)),this._instance}static registerGlobalManager(t){this._instance._globalManagers.push(t),t.enabled=!0}static unregisterGlobalManager(e){new t.List(this._instance._globalManagers).remove(e),e.enabled=!1}static getGlobalManager(t){for(let i=0,s=e._instance._globalManagers.length;i<s;++i){let s=e._instance._globalManagers[i];if(s instanceof t)return s}return null}static startSceneTransition(e){return t.Insist.isNull(this._instance._sceneTransition,"在前一个场景转换完成之前，无法启动新的场景转换"),this._instance._sceneTransition=e,e}static startCoroutine(t){return this._instance._coroutineManager.startCoroutine(t)}static schedule(t,e=!1,i=null,s){return this._instance._timerManager.schedule(t,e,i,s)}startDebugDraw(){if(this.debug&&(this._frameCounter++,this._frameCounterElapsedTime+=t.Time.deltaTime,this._frameCounterElapsedTime>=1)){let t=window.performance.memory;null!=t&&(this._totalMemory=Number((t.totalJSHeapSize/1048576).toFixed(2))),this._titleMemory&&this._titleMemory(this._totalMemory,this._frameCounter),this._frameCounter=0,this._frameCounterElapsedTime-=1}}onSceneChanged(){e.emitter.emit(t.CoreEvents.sceneChanged),t.Time.sceneChanged()}initialize(){}update(i=-1){if(!e.paused){if(t.Time.update(i,-1!==i),null!=this._scene){for(const t of this._globalManagers)t.enabled&&t.update();null!=this._sceneTransition&&this._sceneTransition._loadsNewScene||this._scene.update()}null!=this._nextScene&&(this._scene.end(),this._scene=this._nextScene,this._nextScene=null,this.onSceneChanged(),this._scene.begin()),this.startDebugDraw(),this.draw()}}draw(){null!=this._sceneTransition&&this._sceneTransition.preRender(),null==this._sceneTransition||this._sceneTransition.hasPreviousSceneRender||(null!=this._scene&&e.startCoroutine(this._sceneTransition.onBeginTransition()),this._sceneTransition.render())}}e.paused=!1,e.debugRenderEndabled=!1,t.Core=e}(es||(es={})),function(t){let e;!function(t){t[t.error=0]="error",t[t.warn=1]="warn",t[t.log=2]="log",t[t.info=3]="info",t[t.trace=4]="trace"}(e=t.LogType||(t.LogType={}));t.Debug=class{static warnIf(t,i,...s){t&&this.log(e.warn,i,s)}static warn(t,...i){this.log(e.warn,t,i)}static error(t,...i){this.log(e.error,t,i)}static log(i,s,...n){switch(i){case e.error:console.error(`${i}: ${t.StringUtils.format(s,n)}`);break;case e.warn:console.warn(`${i}: ${t.StringUtils.format(s,n)}`);break;case e.log:console.log(`${i}: ${t.StringUtils.format(s,n)}`);break;case e.info:console.info(`${i}: ${t.StringUtils.format(s,n)}`);break;case e.trace:console.trace(`${i}: ${t.StringUtils.format(s,n)}`);break;default:throw new Error("argument out of range")}}}}(es||(es={})),function(t){class e{}e.debugText=16777215,e.colliderBounds=5033164.5,e.colliderEdge=9109504,e.colliderPosition=16776960,e.colliderCenter=16711680,e.renderableBounds=16776960,e.renderableCenter=10040012,e.verletParticle=14431326,e.verletConstraintEdge=4406838,t.DebugDefault=e}(es||(es={})),function(t){t.Insist=class{static fail(e=null,...i){console.assert&&(null==e?console.assert(!1):console.assert(!1,t.StringUtils.format(e,i)))}static isTrue(t,e=null,...i){t||(null==e?this.fail():this.fail(e,i))}static isFalse(t,e=null,...i){null==e?this.isTrue(!t):this.isTrue(!t,e,i)}static isNull(t,e=null,...i){null==e?this.isTrue(null==t):this.isTrue(null==t,e,i)}static isNotNull(t,e=null,...i){null==e?this.isTrue(null!=t):this.isTrue(null!=t,e,i)}static areEqual(t,e,i,...s){t!=e&&this.fail(i,s)}static areNotEqual(t,e,i,...s){t==e&&this.fail(i,s)}}}(es||(es={})),function(t){t.DebugConsole=class{}}(es||(es={})),function(t){class e{constructor(){this._enabled=!0,this._updateOrder=0,this.id=e._idGenerator++}get transform(){return this.entity.transform}get enabled(){return this.entity?this.entity.enabled&&this._enabled:this._enabled}set enabled(t){this.setEnabled(t)}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}initialize(){}onAddedToEntity(){}onRemovedFromEntity(){}onEntityTransformChanged(t){}onEnabled(){}onDisabled(){}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled()),this}setUpdateOrder(t){return this._updateOrder!=t&&(this._updateOrder=t),this}addComponent(t){return this.entity.addComponent(t)}getComponent(t){return this.entity.getComponent(t)}getComponents(t,e){return this.entity.getComponents(t,e)}hasComponent(t){return this.entity.hasComponent(t)}removeComponent(t){t?this.entity.removeComponent(t):this.entity.removeComponent(this)}}e._idGenerator=0,t.Component=e}(es||(es={})),function(t){class e{constructor(t,i){this.index_=0,this.index_=void 0!==i?e.INDEX++:i,this.type_=t}getName(){return t.getClassName(this.type_)}getIndex(){return this.index_}toString(){return"ComponentType["+t.getClassName(e)+"] ("+this.index_+")"}}e.INDEX=0,t.ComponentType=e}(es||(es={})),function(t){let e;!function(t){t[t.sceneChanged=0]="sceneChanged",t[t.frameUpdated=1]="frameUpdated",t[t.renderChanged=2]="renderChanged"}(e=t.CoreEvents||(t.CoreEvents={}))}(es||(es={})),function(t){class e{compare(t,e){let i=t.updateOrder-e.updateOrder;return 0==i&&(i=t.id-e.id),i}}t.EntityComparer=e;class i{constructor(e,i){this.updateInterval=1,this._tag=0,this._enabled=!0,this._updateOrder=0,this.components=new t.ComponentList(this),this.transform=new t.Transform(this),this.componentBits=new t.Bits,this.name=e,this.id=i}get isDestroyed(){return this._isDestroyed}get tag(){return this._tag}set tag(t){this.setTag(t)}get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}get parent(){return this.transform.parent}set parent(t){this.transform.setParent(t)}get childCount(){return this.transform.childCount}get position(){return this.transform.position}set position(t){this.transform.setPosition(t.x,t.y)}get localPosition(){return this.transform.localPosition}set localPosition(t){this.transform.setLocalPosition(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.setRotation(t)}get rotationDegrees(){return this.transform.rotationDegrees}set rotationDegrees(t){this.transform.setRotationDegrees(t)}get localRotation(){return this.transform.localRotation}set localRotation(t){this.transform.setLocalRotation(t)}get localRotationDegrees(){return this.transform.localRotationDegrees}set localRotationDegrees(t){this.transform.setLocalRotationDegrees(t)}get scale(){return this.transform.scale}set scale(t){this.transform.setScale(t)}get localScale(){return this.transform.localScale}set localScale(t){this.transform.setLocalScale(t)}get worldInverseTransform(){return this.transform.worldInverseTransform}get localToWorldTransform(){return this.transform.localToWorldTransform}get worldToLocalTransform(){return this.transform.worldToLocalTransform}onTransformChanged(t){this.components.onEntityTransformChanged(t)}setParent(e){return e instanceof t.Transform?this.transform.setParent(e):e instanceof i&&this.transform.setParent(e.transform),this}setPosition(t,e){return this.transform.setPosition(t,e),this}setLocalPosition(t){return this.transform.setLocalPosition(t),this}setRotation(t){return this.transform.setRotation(t),this}setRotationDegrees(t){return this.transform.setRotationDegrees(t),this}setLocalRotation(t){return this.transform.setLocalRotation(t),this}setLocalRotationDegrees(t){return this.transform.setLocalRotationDegrees(t),this}setScale(e){return e instanceof t.Vector2?this.transform.setScale(e):this.transform.setScale(new t.Vector2(e,e)),this}setLocalScale(e){return e instanceof t.Vector2?this.transform.setLocalScale(e):this.transform.setLocalScale(new t.Vector2(e,e)),this}setTag(t){return this._tag!=t&&(this.scene&&this.scene.entities.removeFromTagList(this),this._tag=t,this.scene&&this.scene.entities.addToTagList(this)),this}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.components.onEntityEnabled():this.components.onEntityDisabled()),this}setUpdateOrder(t){if(this._updateOrder!=t)return this._updateOrder=t,this.scene&&(this.scene.entities.markEntityListUnsorted(),this.scene.entities.markTagUnsorted(this.tag)),this}destroy(){this._isDestroyed=!0,this.scene.identifierPool.checkIn(this.id),this.scene.entities.remove(this),this.transform.parent=null;for(let t=this.transform.childCount-1;t>=0;t--){this.transform.getChild(t).entity.destroy()}}detachFromScene(){this.scene.entities.remove(this),this.components.deregisterAllComponents();for(let t=0;t<this.transform.childCount;t++)this.transform.getChild(t).entity.detachFromScene()}attachToScene(t){this.scene=t,t.entities.add(this),this.components.registerAllComponents();for(let e=0;e<this.transform.childCount;e++)this.transform.getChild(e).entity.attachToScene(t)}onAddedToScene(){}onRemovedFromScene(){this._isDestroyed&&this.components.removeAllComponents()}update(){this.components.update()}createComponent(t){let e=new t;return this.addComponent(e),e}addComponent(t){return t.entity=this,this.components.add(t),t.initialize(),t}getComponent(t){return this.components.getComponent(t,!1)}getComponentInScene(t){return this.components.getComponent(t,!0)}tryGetComponent(t,e){return e.value=this.components.getComponent(t,!1),null!=e.value}hasComponent(t){return null!=this.components.getComponent(t,!1)}getOrCreateComponent(t){let e=this.components.getComponent(t,!0);return e||(e=this.addComponent(new t)),e}getComponents(t,e){return this.components.getComponents(t,e)}removeComponent(t){this.components.remove(t)}removeComponentForType(t){let e=this.getComponent(t);return!!e&&(this.removeComponent(e),!0)}removeAllComponents(){for(let t=0;t<this.components.count;t++)this.removeComponent(this.components.buffer[t])}tweenPositionTo(e,i=.3){const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.position),s.initialize(s,e,i),s}tweenLocalPositionTo(e,i=.3){const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.localPosition),s.initialize(s,e,i),s}tweenScaleTo(e,i=.3){if("number"==typeof e)return this.tweenScaleTo(new t.Vector2(e,e),i);const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.scale),s.initialize(s,e,i),s}tweenLocalScaleTo(e,i=.3){if("number"==typeof e)return this.tweenLocalScaleTo(new t.Vector2(e,e),i);const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.localScale),s.initialize(s,e,i),s}tweenRotationDegreesTo(e,i=.3){const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.rotationDegrees),s.initialize(s,new t.Vector2(e,e),i),s}tweenLocalRotationDegreesTo(e,i=.3){const s=t.Pool.obtain(t.TransformVector2Tween);return s.setTargetAndType(this.transform,t.TransformTargetType.localRotationDegrees),s.initialize(s,new t.Vector2(e,e),i),s}compareTo(t){let e=this._updateOrder-t._updateOrder;return 0==e&&(e=this.id-t.id),e}equals(t){return 0==this.compareTo(t)}toString(){return`[Entity: name: ${this.name}, tag: ${this.tag}, enabled: ${this.enabled}, depth: ${this.updateOrder}]`}}i.entityComparer=new e,t.Entity=i}(es||(es={})),function(t){class e{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}static get zero(){return new e(0,0)}static get one(){return new e(1,1)}static get unitX(){return new e(1,0)}static get unitY(){return new e(0,1)}static get up(){return new e(0,-1)}static get down(){return new e(0,1)}static get left(){return new e(-1,0)}static get right(){return new e(1,0)}static add(t,i){let s=e.zero;return s.x=t.x+i.x,s.y=t.y+i.y,s}static divide(t,i){let s=e.zero;return s.x=t.x/i.x,s.y=t.y/i.y,s}static divideScaler(t,i){let s=e.zero;return s.x=t.x/i,s.y=t.y/i,s}static sqrDistance(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)}static clamp(i,s,n){return new e(t.MathHelper.clamp(i.x,s.x,n.x),t.MathHelper.clamp(i.y,s.y,n.y))}static lerp(i,s,n){return new e(t.MathHelper.lerp(i.x,s.x,n),t.MathHelper.lerp(i.y,s.y,n))}static lerpPrecise(i,s,n){return new e(t.MathHelper.lerpPrecise(i.x,s.x,n),t.MathHelper.lerpPrecise(i.y,s.y,n))}static transform(t,i){return new e(t.x*i.m11+t.y*i.m21+i.m31,t.x*i.m12+t.y*i.m22+i.m32)}static transformNormal(t,i){return new e(t.x*i.m11+t.y*i.m21,t.x*i.m12+t.y*i.m22)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static angle(e,i){return e=e.normalize(),i=i.normalize(),Math.acos(t.MathHelper.clamp(e.dot(i),-1,1))*t.MathHelper.Rad2Deg}static negate(t){return t.x=-t.x,t.y=-t.y,t}static reflect(e,i){let s=t.Vector2.zero,n=2*(e.x*i.x+e.y*i.y);return s.x=e.x-i.x*n,s.y=e.y-i.y*n,s}static smoothStep(i,s,n){return new e(t.MathHelper.smoothStep(i.x,s.x,n),t.MathHelper.smoothStep(i.y,s.y,n))}setTo(t,e){this.x=t,this.y=e}negate(){return this.scale(-1)}add(t){return new e(this.x+t.x,this.y+t.y)}addEqual(t){return this.x+=t.x,this.y+=t.y,this}divide(t){return new e(this.x/t.x,this.y/t.y)}divideScaler(t){return new e(this.x/t,this.y/t)}multiply(t){return new e(t.x*this.x,t.y*this.y)}multiplyScaler(t){return this.x*=t,this.y*=t,this}sub(t){return new e(this.x-t.x,this.y-t.y)}subEqual(t){return this.x-=t.x,this.y-=t.y,this}dot(t){return this.x*t.x+this.y*t.y}scale(t){return new e(this.x*t,this.y*t)}scaleEqual(t){return this.x*=t,this.y*=t,this}transform(t){return new e(this.x*t.m11+this.y*t.m21+t.m31,this.x*t.m12+this.y*t.m22+t.m32)}normalize(){const t=this.distance();return t>0?new e(this.x/t,this.y/t):new e(0,1)}normalizeEqual(){const t=this.distance();return t>0?(this.setTo(this.x/t,this.y/t),this):(this.setTo(0,1),this)}magnitude(){return this.distance()}distance(t){return t||(t=e.zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}lengthSquared(){return this.x*this.x+this.y*this.y}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}round(){return new e(Math.round(this.x),Math.round(this.y))}angleBetween(e,i){let s=e.sub(this),n=i.sub(this);return t.Vector2Ext.angle(s,n)}getDistance(t){return Math.sqrt(this.getDistanceSquared(t))}getDistanceSquared(t){const e=t.x-this.x,i=t.y-this.y;return e*e+i*i}isBetween(t,e){const i=e.sub(t).cross(this.sub(t));return Math.abs(i)<Number.EPSILON&&this.dot(e.sub(t))>=0&&this.dot(t.sub(e))>=0}cross(t){return this.x*t.y-this.y*t.x}getAngle(){return Math.atan2(this.y,this.x)}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}isValid(){return t.MathHelper.isValid(this.x)&&t.MathHelper.isValid(this.y)}static min(t,i){return new e(t.x<i.x?t.x:i.x,t.y<i.y?t.y:i.y)}static max(t,i){return new e(t.x>i.x?t.x:i.x,t.y>i.y?t.y:i.y)}static hermite(i,s,n,r,o){return new e(t.MathHelper.hermite(i.x,s.x,n.x,r.x,o),t.MathHelper.hermite(i.y,s.y,n.y,r.y,o))}static unsignedAngle(e,i,s=!0){e.normalizeEqual(),i.normalizeEqual();const n=Math.acos(t.MathHelper.clamp(e.dot(i),-1,1))*t.MathHelper.Rad2Deg;return s?Math.round(n):n}static fromAngle(t,i=1){return new e(i*Math.cos(t),i*Math.sin(t))}clone(){return new e(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this}}t.Vector2=e}(es||(es={})),function(t){t.Scene=class extends fairygui.GComponent{constructor(){super(),this._sceneComponents=[],this.entities=new t.EntityList(this),this.entityProcessors=new t.EntityProcessorList,this.identifierPool=new t.IdentifierPool}onConstruct(){var t;null===(t=this.initialize)||void 0===t||t.call(this)}initialize(){}onStart(){}onUnload(){}begin(){t.Physics.reset(),null!=this.entityProcessors&&this.entityProcessors.begin(),this._didSceneBegin=!0,this.onStart()}end(){this._didSceneBegin=!1,this.entities.removeAllEntities();for(let t=0;t<this._sceneComponents.length;t++)this._sceneComponents[t].onRemovedFromScene();this._sceneComponents.length=0,t.Physics.clear(),this.entityProcessors&&this.entityProcessors.end(),this.onUnload()}update(){this.entities.updateLists();for(let t=this._sceneComponents.length-1;t>=0;t--)this._sceneComponents[t].enabled&&this._sceneComponents[t].update();null!=this.entityProcessors&&this.entityProcessors.update(),this.entities.update(),null!=this.entityProcessors&&this.entityProcessors.lateUpdate()}addSceneComponent(t){return t.scene=this,t.onEnabled(),this._sceneComponents.push(t),this._sceneComponents.sort(t.compare),t}getSceneComponent(t){for(let e=0;e<this._sceneComponents.length;e++){let i=this._sceneComponents[e];if(i instanceof t)return i}return null}getOrCreateSceneComponent(t){let e=this.getSceneComponent(t);return null==e&&(e=this.addSceneComponent(new t)),e}removeSceneComponent(e){const i=new t.List(this._sceneComponents);t.Insist.isTrue(i.contains(e),`SceneComponent${e}不在SceneComponents列表中!`),i.remove(e),e.onRemovedFromScene()}createEntity(e){let i=new t.Entity(e,this.identifierPool.checkOut());return this.addEntity(i)}addEntity(e){t.Insist.isFalse(new t.List(this.entities.buffer).contains(e),`您试图将同一实体添加到场景两次: ${e}`),this.entities.add(e),e.scene=this;for(let t=0;t<e.transform.childCount;t++)this.addEntity(e.transform.getChild(t).entity);return e}destroyAllEntities(){for(let t=0;t<this.entities.count;t++)this.entities.buffer[t].destroy()}findEntity(t){return this.entities.findEntity(t)}findEntityById(t){return this.entities.findEntityById(t)}findEntitiesWithTag(t){return this.entities.entitiesWithTag(t)}findEntityWithTag(t){return this.entities.entityWithTag(t)}findComponentOfType(t){return this.entities.findComponentOfType(t)}findComponentsOfType(t){return this.entities.findComponentsOfType(t)}findEntitiesOfComponent(...t){return this.entities.findEntitiesOfComponent(...t)}addEntityProcessor(t){return t.scene=this,this.entityProcessors.add(t),t.setUpdateOrder(this.entityProcessors.count-1),this.entityProcessors.clearDirty(),t}removeEntityProcessor(t){this.entityProcessors.remove(t)}getEntityProcessor(t){return this.entityProcessors.getProcessor(t)}}}(es||(es={})),function(t){t.SceneTransition=class{get hasPreviousSceneRender(){return!!this._hasPreviousSceneRender||(this._hasPreviousSceneRender=!0,!1)}constructor(t){this._loadsNewScene=!1,this._hasPreviousSceneRender=!1,this._isNewSceneLoaded=!1,this.sceneLoadAction=t,this._loadsNewScene=null!=t}*LoadNextScene(){for(null!=this.onScreenObscured&&this.onScreenObscured(),this._loadsNewScene||(this._isNewSceneLoaded=!0,yield"break"),t.Core.scene=this.sceneLoadAction(),this._isNewSceneLoaded=!0;!this._isNewSceneLoaded;)yield null}*onBeginTransition(){yield null,yield t.Core.startCoroutine(this.LoadNextScene()),this.transitionComplete()}preRender(){}render(){}transitionComplete(){t.Core.Instance._sceneTransition=null,null!=this.onTransitionCompleted&&this.onTransitionCompleted()}}}(es||(es={})),function(t){let e,i;!function(t){t[t.position=0]="position",t[t.scale=1]="scale",t[t.rotation=2]="rotation"}(e=t.ComponentTransform||(t.ComponentTransform={})),function(t){t[t.clean=0]="clean",t[t.positionDirty=1]="positionDirty",t[t.scaleDirty=2]="scaleDirty",t[t.rotationDirty=4]="rotationDirty"}(i=t.DirtyType||(t.DirtyType={}));t.Transform=class{constructor(e){this._localTransform=t.Matrix2D.identity,this._worldTransform=t.Matrix2D.identity,this._rotationMatrix=t.Matrix2D.identity,this._translationMatrix=t.Matrix2D.identity,this._scaleMatrix=t.Matrix2D.identity,this._children=[],this._worldToLocalTransform=t.Matrix2D.identity,this._worldInverseTransform=t.Matrix2D.identity,this._position=t.Vector2.zero,this._scale=t.Vector2.one,this._rotation=0,this._localPosition=t.Vector2.zero,this._localScale=t.Vector2.one,this._localRotation=0,this.entity=e,this.scale=this._localScale=t.Vector2.one}get childCount(){return this._children.length}get rotationDegrees(){return t.MathHelper.toDegrees(this._rotation)}set rotationDegrees(e){this.setRotation(t.MathHelper.toRadians(e))}get localRotationDegrees(){return t.MathHelper.toDegrees(this._localRotation)}set localRotationDegrees(e){this.localRotation=t.MathHelper.toRadians(e)}get localToWorldTransform(){return this.updateTransform(),this._worldTransform}get parent(){return this._parent}set parent(t){this.setParent(t)}get worldToLocalTransform(){return this._worldToLocalDirty&&(null==this.parent?this._worldToLocalTransform=t.Matrix2D.identity:(this.parent.updateTransform(),this._worldToLocalTransform=t.Matrix2D.invert(this.parent._worldTransform)),this._worldToLocalDirty=!1),this._worldToLocalTransform}get worldInverseTransform(){return this.updateTransform(),this._worldInverseDirty&&(this._worldInverseTransform=t.Matrix2D.invert(this._worldTransform),this._worldInverseDirty=!1),this._worldInverseTransform}get position(){return this.updateTransform(),this._positionDirty&&(null==this.parent?this._position=this._localPosition:(this.parent.updateTransform(),t.Vector2Ext.transformR(this._localPosition,this.parent._worldTransform,this._position)),this._positionDirty=!1),this._position}set position(t){this.setPosition(t.x,t.y)}get scale(){return this.updateTransform(),this._scale}set scale(t){this.setScale(t)}get rotation(){return this.updateTransform(),this._rotation}set rotation(t){this.setRotation(t)}get localPosition(){return this.updateTransform(),this._localPosition}set localPosition(t){this.setLocalPosition(t)}get localScale(){return this.updateTransform(),this._localScale}set localScale(t){this.setLocalScale(t)}get localRotation(){return this.updateTransform(),this._localRotation}set localRotation(t){this.setLocalRotation(t)}getChild(t){return this._children[t]}setParent(t){if(this._parent==t)return this;if(null!=this._parent){const t=this._parent._children.findIndex(t=>t==this);-1!=t&&this._parent._children.splice(t,1)}return null!=t&&t._children.push(this),this._parent=t,this.setDirty(i.positionDirty),this}setPosition(e,i){let s=new t.Vector2(e,i);return s.equals(this._position)?this:(this._position=s,null!=this.parent?this.localPosition=t.Vector2.transform(this._position,this.worldToLocalTransform):this.localPosition=s,this._positionDirty=!1,this)}setLocalPosition(t){return t.equals(this._localPosition)?this:(this._localPosition=t,this._localDirty=this._positionDirty=this._localPositionDirty=this._localRotationDirty=this._localScaleDirty=!0,this.setDirty(i.positionDirty),this)}setRotation(t){return this._rotation=t,null!=this.parent?this.localRotation=this.parent.rotation+t:this.localRotation=t,this.setDirty(i.rotationDirty),this}setRotationDegrees(e){return this.setRotation(t.MathHelper.toRadians(e))}lookAt(e){const i=this.position.x>e.x?-1:1,s=this.position.sub(e).normalize();this.rotation=i*Math.acos(s.dot(t.Vector2.unitY))}setLocalRotation(t){return this._localRotation=t,this._localDirty=this._positionDirty=this._localPositionDirty=this._localRotationDirty=this._localScaleDirty=!0,this.setDirty(i.rotationDirty),this}setLocalRotationDegrees(e){return this.setLocalRotation(t.MathHelper.toRadians(e))}setScale(e){return this._scale=e,null!=this.parent?this.localScale=t.Vector2.divide(e,this.parent._scale):this.localScale=e,this.setDirty(i.scaleDirty),this}setLocalScale(t){return this._localScale=t,this._localDirty=this._positionDirty=this._localScaleDirty=!0,this.setDirty(i.scaleDirty),this}roundPosition(){this.position=t.Vector2Ext.round(this._position)}updateTransform(){this.hierarchyDirty!=i.clean&&(null!=this.parent&&this.parent.updateTransform(),this._localDirty&&(this._localPositionDirty&&(t.Matrix2D.createTranslation(this._localPosition.x,this._localPosition.y,this._translationMatrix),this._localPositionDirty=!1),this._localRotationDirty&&(t.Matrix2D.createRotation(this._localRotation,this._rotationMatrix),this._localRotationDirty=!1),this._localScaleDirty&&(t.Matrix2D.createScale(this._localScale.x,this._localScale.y,this._scaleMatrix),this._localScaleDirty=!1),t.Matrix2D.multiply(this._scaleMatrix,this._rotationMatrix,this._localTransform),t.Matrix2D.multiply(this._localTransform,this._translationMatrix,this._localTransform),null==this.parent&&(this._worldTransform=this._localTransform,this._rotation=this._localRotation,this._scale=this._localScale,this._worldInverseDirty=!0),this._localDirty=!1),null!=this.parent&&(t.Matrix2D.multiply(this._localTransform,this.parent._worldTransform,this._worldTransform),this._rotation=this._localRotation+this.parent._rotation,this._scale=this.parent._scale.multiply(this._localScale),this._worldInverseDirty=!0),this._worldToLocalDirty=!0,this._positionDirty=!0,this.hierarchyDirty=i.clean)}setDirty(t){if(0==(this.hierarchyDirty&t)){switch(this.hierarchyDirty|=t,t){case i.positionDirty:this.entity.onTransformChanged(e.position);break;case i.rotationDirty:this.entity.onTransformChanged(e.rotation);break;case i.scaleDirty:this.entity.onTransformChanged(e.scale)}for(let e=0;e<this._children.length;e++)this._children[e].setDirty(t)}}copyFrom(t){this._position=t.position.clone(),this._localPosition=t._localPosition.clone(),this._rotation=t._rotation,this._localRotation=t._localRotation,this._scale=t._scale,this._localScale=t._localScale,this.setDirty(i.positionDirty),this.setDirty(i.rotationDirty),this.setDirty(i.scaleDirty)}toString(){return`[Transform: parent: ${this.parent}, position: ${this.position}, rotation: ${this.rotation},\n                scale: ${this.scale}, localPosition: ${this._localPosition}, localRotation: ${this._localRotation},\n                localScale: ${this._localScale}]`}}}(es||(es={})),function(t){t.IUpdatableComparer=class{compare(t,e){return t.updateOrder-e.updateOrder}},t.isIUpdatable=(t=>void 0!==t.update)}(es||(es={})),function(t){t.SceneComponent=class{constructor(){this.updateOrder=0,this._enabled=!0}get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}onEnabled(){}onDisabled(){}onRemovedFromScene(){}update(){}setEnabled(t){return this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled()),this}setUpdateOrder(t){return this.updateOrder!=t&&(this.updateOrder=t),this}compare(t){return this.updateOrder-t.updateOrder}}}(es||(es={})),function(t){class e extends t.Component{get mass(){return this._mass}set mass(t){this.setMass(t)}get elasticity(){return this._elasticity}set elasticiy(t){this.setElasticity(t)}get friction(){return this._friction}set friction(t){this.setFriction(t)}get glue(){return this._glue}set glue(t){this.setGlue(t)}get isImmovable(){return this._mass<1e-4}constructor(){super(),this.shouldUseGravity=!0,this.velocity=t.Vector2.zero,this._mass=10,this._elasticity=.5,this._friction=.5,this._glue=.01,this._inverseMass=0,this._inverseMass=1/this._mass}setMass(e){return this._mass=t.MathHelper.clamp(e,0,Number.MAX_VALUE),this._mass>1e-4?this._inverseMass=1/this._mass:this._inverseMass=0,this}setElasticity(e){return this._elasticity=t.MathHelper.clamp01(e),this}setFriction(e){return this._friction=t.MathHelper.clamp01(e),this}setGlue(e){return this._glue=t.MathHelper.clamp(e,0,10),this}setVelocity(t){return this.velocity=t,this}addImpulse(e){this.isImmovable||this.velocity.addEqual(e.scale(this._inverseMass*(t.Time.deltaTime*t.Time.deltaTime)*1e5))}onAddedToEntity(){this._collider=null;for(let e=0;e<this.entity.components.buffer.length;e++){let i=this.entity.components.buffer[e];if(i instanceof t.Collider){this._collider=i;break}}t.Debug.warnIf(null==this._collider,"ArcadeRigidbody 没有 Collider。ArcadeRigidbody需要一个Collider!")}update(){if(this.isImmovable||null==this._collider)return void(this.velocity=t.Vector2.zero);this.shouldUseGravity&&this.velocity.addEqual(t.Physics.gravity.scale(t.Time.deltaTime)),this.entity.position=this.entity.position.add(this.velocity.scale(t.Time.deltaTime));let i=t.Physics.boxcastBroadphaseExcludingSelf(this._collider,this._collider.bounds,this._collider.collidesWithLayers.value);if(i.length>0)for(let s=0;s<i.length;s++){const n=i[s];if(!n)continue;if(n.entity.equals(this.entity))continue;const r=new t.Out;if(this._collider.collidesWithNonMotion(n,r)){let t=n.entity.getComponent(e);if(null!=t)this.processOverlap(t,r.value.minimumTranslationVector),this.processCollision(t,r.value.minimumTranslationVector);else{this.entity.position=this.entity.position.sub(r.value.minimumTranslationVector);const t=this.calculateResponseVelocity(this.velocity,r.value.minimumTranslationVector);this.velocity.addEqual(t)}}}}processOverlap(t,e){this.isImmovable?t.entity.position=t.entity.position.add(e):t.isImmovable?this.entity.position=this.entity.position.sub(e):(this.entity.position=this.entity.position.sub(e.scale(.5)),t.entity.position=t.entity.position.add(e.scale(.5)))}processCollision(t,e){let i=this.velocity.sub(t.velocity);i=this.calculateResponseVelocity(i,e);const s=this._inverseMass+t._inverseMass,n=this._inverseMass/s,r=t._inverseMass/s;this.velocity=this.velocity.add(i.scale(n)),t.velocity=t.velocity.sub(i.scale(r))}calculateResponseVelocity(e,i){let s=i.scale(-1).normalize(),n=e.dot(s),r=s.scale(n),o=e.sub(r);n>0&&(r=t.Vector2.zero);let a=this._friction;return o.lengthSquared()<this._glue&&(a=1.01),r.scale(1+this._elasticity).sub(o.scale(a)).scale(-1)}}t.ArcadeRigidbody=e}(es||(es={})),function(t){class e{constructor(){this.topLeft=t.Vector2.zero,this.bottomRight=t.Vector2.zero,this.bottomLeft=t.Vector2.zero}}class i{constructor(){this.right=!1,this.left=!1,this.above=!1,this.below=!1,this.becameGroundedThisFrame=!1,this.wasGroundedLastFrame=!1,this.movingDownSlope=!1,this.slopeAngle=0}hasCollision(){return this.below||this.right||this.left||this.above}reset(){this.right=this.left=!1,this.above=this.below=!1,this.becameGroundedThisFrame=this.movingDownSlope=!1,this.slopeAngle=0}toString(){return`[CharacterCollisionState2D] r: ${this.right}, l: ${this.left}, a: ${this.above}, b: ${this.below}, movingDownSlope: ${this.movingDownSlope}, angle: ${this.slopeAngle}, wasGroundedLastFrame: ${this.wasGroundedLastFrame}, becameGroundedThisFrame: ${this.becameGroundedThisFrame}`}}t.CharacterController=class{get skinWidth(){return this._skinWidth}set skinWidth(t){this._skinWidth=t,this.recalculateDistanceBetweenRays()}get isGrounded(){return this.collisionState.below}get raycastHitsThisFrame(){return this._raycastHitsThisFrame}constructor(s,n,r=-1,o=-1,a=-1){this.ignoredColliders=new Set,this.slopeLimit=30,this.jumpingThreshold=-7,this.totalHorizontalRays=5,this.totalVerticalRays=3,this.collisionState=new i,this.velocity=new t.Vector2(0,0),this._skinWidth=.02,this.kSkinWidthFloatFudgeFactor=.001,this._raycastOrigins=new e,this._raycastHit=new t.RaycastHit,this._isGoingUpSlope=!1,this._isWarpingToGround=!0,this.platformMask=-1,this.triggerMask=-1,this.oneWayPlatformMask=-1,this.rayOriginSkinMutiplier=4,this.onTriggerEnterEvent=new t.ObservableT,this.onTriggerExitEvent=new t.ObservableT,this.onControllerCollidedEvent=new t.ObservableT,this.platformMask=r,this.oneWayPlatformMask=o,this.triggerMask=a,this.platformMask|=this.oneWayPlatformMask,this._player=s;let l=null;for(let e=0;e<this._player.components.buffer.length;e++){let i=this._player.components.buffer[e];if(i instanceof t.Collider){l=i;break}}if(l.isTrigger=!1,!(l instanceof t.BoxCollider))throw new Error("player collider must be box");this._collider=l,this.skinWidth=n||.05*l.width,this._slopeLimitTangent=Math.tan(75*t.MathHelper.Deg2Rad),this._triggerHelper=new t.ColliderTriggerHelper(this._player);for(let e=0;e<32;e++)0==(this.triggerMask&1<<e)&&t.Flags.unsetFlag(this._collider.collidesWithLayers,e)}onTriggerEnter(t,e){this.onTriggerEnterEvent.notify(t)}onTriggerExit(t,e){this.onTriggerExitEvent.notify(t)}move(t,e){this.collisionState.wasGroundedLastFrame=this.collisionState.below,this.collisionState.reset(),this._raycastHitsThisFrame=[],this._isGoingUpSlope=!1,this.primeRaycastOrigins(),t.y>0&&this.collisionState.wasGroundedLastFrame&&(t=this.handleVerticalSlope(t)),0!==t.x&&(t=this.moveHorizontally(t)),0!==t.y&&(t=this.moveVertically(t)),this._player.setPosition(this._player.position.x+t.x,this._player.position.y+t.y),e>0&&(this.velocity.x=t.x/e,this.velocity.y=t.y/e),!this.collisionState.wasGroundedLastFrame&&this.collisionState.below&&(this.collisionState.becameGroundedThisFrame=!0),this._isGoingUpSlope&&(this.velocity.y=0),this._isWarpingToGround||this._triggerHelper.update();for(let t=0;t<this._raycastHitsThisFrame.length;t++)this.onControllerCollidedEvent.notify(this._raycastHitsThisFrame[t]);this.ignoreOneWayPlatformsTime>0&&(this.ignoreOneWayPlatformsTime-=e)}warpToGrounded(e=1e3){this.ignoreOneWayPlatformsTime=0,this._isWarpingToGround=!0;let i=0;do{if(i+=1,this.move(new t.Vector2(0,1),.02),i>e)break}while(!this.isGrounded);this._isWarpingToGround=!1}recalculateDistanceBetweenRays(){const t=this._collider.height*Math.abs(this._player.scale.y)-2*this._skinWidth;this._verticalDistanceBetweenRays=t/(this.totalHorizontalRays-1);const e=this._collider.width*Math.abs(this._player.scale.x)-2*this._skinWidth;this._horizontalDistanceBetweenRays=e/(this.totalVerticalRays-1)}primeRaycastOrigins(){const e=this._collider.bounds;this._raycastOrigins.topLeft=new t.Vector2(e.x+this._skinWidth,e.y+this._skinWidth),this._raycastOrigins.bottomRight=new t.Vector2(e.right-this._skinWidth,e.bottom-this._skinWidth),this._raycastOrigins.bottomLeft=new t.Vector2(e.x+this._skinWidth,e.bottom-this._skinWidth)}moveHorizontally(e){const i=e.x>0;let s=Math.abs(e.x)+this._skinWidth*this.rayOriginSkinMutiplier;const n=i?t.Vector2.right:t.Vector2.left,r=this._raycastOrigins.bottomLeft.y,o=i?this._raycastOrigins.bottomRight.x-this._skinWidth*(this.rayOriginSkinMutiplier-1):this._raycastOrigins.bottomLeft.x+this._skinWidth*(this.rayOriginSkinMutiplier-1);for(let a=0;a<this.totalHorizontalRays;a++){const l=new t.Vector2(o,r-a*this._verticalDistanceBetweenRays);if(0===a&&this.supportSlopedOneWayPlatforms&&this.collisionState.wasGroundedLastFrame?this._raycastHit=t.Physics.linecast(l,l.add(n.scaleEqual(s)),this.platformMask,this.ignoredColliders):this._raycastHit=t.Physics.linecast(l,l.add(n.scaleEqual(s)),this.platformMask&~this.oneWayPlatformMask,this.ignoredColliders),this._raycastHit.collider){if(0===a&&this.handleHorizontalSlope(e,t.Vector2.unsignedAngle(this._raycastHit.normal,t.Vector2.up))){this._raycastHitsThisFrame.push(this._raycastHit);break}if(e.x=this._raycastHit.point.x-l.x,s=Math.abs(e.x),i?(e.x-=this._skinWidth*this.rayOriginSkinMutiplier,this.collisionState.right=!0):(e.x+=this._skinWidth*this.rayOriginSkinMutiplier,this.collisionState.left=!0),this._raycastHitsThisFrame.push(this._raycastHit),s<this._skinWidth*this.rayOriginSkinMutiplier+this.kSkinWidthFloatFudgeFactor)break}}return e}moveVertically(e){const i=e.y<0;let s=Math.abs(e.y)+this._skinWidth*this.rayOriginSkinMutiplier;const n=i?t.Vector2.up:t.Vector2.down;let r=this._raycastOrigins.topLeft.x;const o=i?this._raycastOrigins.topLeft.y+this._skinWidth*(this.rayOriginSkinMutiplier-1):this._raycastOrigins.bottomLeft.y-this._skinWidth*(this.rayOriginSkinMutiplier-1);r+=e.x;let a=this.platformMask;(i||this.ignoreOneWayPlatformsTime>0)&&(a&=~this.oneWayPlatformMask);for(let l=0;l<this.totalVerticalRays;l++){const h=new t.Vector2(r+l*this._horizontalDistanceBetweenRays,o);if(this._raycastHit=t.Physics.linecast(h,h.add(n.scaleEqual(s)),a,this.ignoredColliders),this._raycastHit.collider&&(e.y=this._raycastHit.point.y-h.y,s=Math.abs(e.y),i?(e.y+=this._skinWidth*this.rayOriginSkinMutiplier,this.collisionState.above=!0):(e.y-=this._skinWidth*this.rayOriginSkinMutiplier,this.collisionState.below=!0),this._raycastHitsThisFrame.push(this._raycastHit),!i&&e.y<-1e-5&&(this._isGoingUpSlope=!0),s<this._skinWidth*this.rayOriginSkinMutiplier+this.kSkinWidthFloatFudgeFactor))break}return e}handleVerticalSlope(e){const i=.5*(this._raycastOrigins.bottomLeft.x+this._raycastOrigins.bottomRight.x),s=t.Vector2.down,n=this._slopeLimitTangent*(this._raycastOrigins.bottomRight.x-i),r=new t.Vector2(i,this._raycastOrigins.bottomLeft.y);if(this._raycastHit=t.Physics.linecast(r,r.add(s.scaleEqual(n)),this.platformMask,this.ignoredColliders),this._raycastHit.collider){const i=t.Vector2.unsignedAngle(this._raycastHit.normal,t.Vector2.up);if(0===i)return e;if(Math.sign(this._raycastHit.normal.x)===Math.sign(e.x)){const t=this.slopeSpeedMultiplier?this.slopeSpeedMultiplier.lerp(-i):1;e.y+=this._raycastHit.point.y-r.y-this.skinWidth,e.x*=t,this.collisionState.movingDownSlope=!0,this.collisionState.slopeAngle=i}}return e}handleHorizontalSlope(e,i){if(90===Math.round(i))return!1;if(i<this.slopeLimit){if(e.y>this.jumpingThreshold){const s=this.slopeSpeedMultiplier?this.slopeSpeedMultiplier.lerp(i):1;e.x*=s,e.y=Math.abs(Math.tan(i*t.MathHelper.Deg2Rad)*e.x);const n=e.x>0,r=n?this._raycastOrigins.bottomRight:this._raycastOrigins.bottomLeft;let o=null;(o=this.supportSlopedOneWayPlatforms&&this.collisionState.wasGroundedLastFrame?t.Physics.linecast(r,r.add(e),this.platformMask,this.ignoredColliders):t.Physics.linecast(r,r.add(e),this.platformMask&~this.oneWayPlatformMask,this.ignoredColliders)).collider&&(e.x=o.point.x-r.x,e.y=o.point.y-r.y,n?e.x-=this._skinWidth:e.x+=this._skinWidth),this._isGoingUpSlope=!0,this.collisionState.below=!0}}else e.x=0;return!0}}}(es||(es={})),function(t){t.TriggerListenerHelper=class{static getITriggerListener(e,i){if(e.components._components.length>0)for(let s=0;s<e.components._components.length;s++){const n=e.components._components[s];t.isITriggerListener(n)&&i.push(n)}for(let s in e.components._componentsToAdd){let n=e.components._componentsToAdd[s];t.isITriggerListener(n)&&i.push(n)}return i}},t.isITriggerListener=(t=>void 0!==t.onTriggerEnter)}(es||(es={})),function(t){t.Mover=class extends t.Component{onAddedToEntity(){this._triggerHelper=new t.ColliderTriggerHelper(this.entity)}calculateMovement(e,i){i.value=new t.CollisionResult;let s=null;if(this.entity.components.buffer.length>0)for(let e=0;e<this.entity.components.buffer.length;e++){let i=this.entity.components.buffer[e];if(i instanceof t.Collider){s=i;break}}if(null==s||null==this._triggerHelper)return!1;let n=[];if(this.entity.components.buffer.length>0)for(let e=0;e<this.entity.components.buffer.length;e++){let i=this.entity.components.buffer[e];i instanceof t.Collider&&n.push(i)}if(n.length>0)for(let s=0;s<n.length;s++){let r=n[s];if(r.isTrigger)continue;let o=r.bounds;o.x+=e.x,o.y+=e.y;let a=t.Physics.boxcastBroadphaseExcludingSelf(r,o,r.collidesWithLayers.value);if(a.length>0)for(let s=0;s<a.length;s++){const n=a[s];if(n.isTrigger)return;let o=new t.Out;r.collidesWith(n,e,o)&&(e.subEqual(o.value.minimumTranslationVector),null!=o.value.collider&&(i.value.collider=o.value.collider,i.value.minimumTranslationVector=o.value.minimumTranslationVector,i.value.normal=o.value.normal,i.value.point=o.value.point))}}return t.ListPool.free(t.Collider,n),null!=i.value.collider}applyMovement(e){this.entity.position=t.Vector2.add(this.entity.position,e),this._triggerHelper&&this._triggerHelper.update()}move(t,e){return this.calculateMovement(t,e),this.applyMovement(t),null!=e.value.collider}}}(es||(es={})),function(t){t.ProjectileMover=class extends t.Component{constructor(){super(...arguments),this._tempTriggerList=[]}onAddedToEntity(){let e=null;for(let i=0;i<this.entity.components.buffer.length;i++){let s=this.entity.components.buffer[i];if(s instanceof t.Collider){e=s;break}}this._collider=e,t.Debug.warnIf(null==this._collider,"ProjectileMover没有Collider。ProjectilMover需要一个Collider!")}move(e){if(null==this._collider)return!1;let i=!1;this.entity.position=t.Vector2.add(this.entity.position,e);let s=t.Physics.boxcastBroadphase(this._collider.bounds,this._collider.collidesWithLayers.value);if(s.length>0)for(let t=0;t<s.length;t++){const e=s[t];this._collider.overlaps(e)&&e.enabled&&(i=!0,this.notifyTriggerListeners(this._collider,e))}return i}notifyTriggerListeners(e,i){t.TriggerListenerHelper.getITriggerListener(i.entity,this._tempTriggerList);for(let t=0;t<this._tempTriggerList.length;t++)this._tempTriggerList[t].onTriggerEnter(e,i);this._tempTriggerList.length=0,t.TriggerListenerHelper.getITriggerListener(this.entity,this._tempTriggerList);for(let t=0;t<this._tempTriggerList.length;t++)this._tempTriggerList[t].onTriggerEnter(i,e);this._tempTriggerList.length=0}}}(es||(es={})),function(t){class e extends t.Component{constructor(){super(...arguments),this.castSortOrder=0,this.isTrigger=!1,this.physicsLayer=new t.Ref(1),this.collidesWithLayers=new t.Ref(t.Physics.allLayers),this.shouldColliderScaleAndRotateWithTransform=!0,this.registeredPhysicsBounds=new t.Rectangle,this._isPositionDirty=!0,this._isRotationDirty=!0,this._localOffset=t.Vector2.zero}get absolutePosition(){return t.Vector2.add(this.entity.transform.position,this._localOffset)}get rotation(){return this.shouldColliderScaleAndRotateWithTransform&&null!=this.entity?this.entity.transform.rotation:0}get bounds(){return(this._isPositionDirty||this._isRotationDirty)&&(this.shape.recalculateBounds(this),this._isPositionDirty=this._isRotationDirty=!1),this.shape.bounds}get localOffset(){return this._localOffset}set localOffset(t){this.setLocalOffset(t)}setLocalOffset(t){return this._localOffset.equals(t)||(this.unregisterColliderWithPhysicsSystem(),this._localOffset.setTo(t.x,t.y),this._localOffsetLength=this._localOffset.magnitude(),this._isPositionDirty=!0,this.registerColliderWithPhysicsSystem()),this}setShouldColliderScaleAndRotateWithTransform(t){return this.shouldColliderScaleAndRotateWithTransform=t,this._isPositionDirty=this._isRotationDirty=!0,this}onAddedToEntity(){this._isParentEntityAddedToScene=!0,this.registerColliderWithPhysicsSystem()}onRemovedFromEntity(){this.unregisterColliderWithPhysicsSystem(),this._isParentEntityAddedToScene=!1}onEntityTransformChanged(e){switch(e){case t.ComponentTransform.position:case t.ComponentTransform.scale:this._isPositionDirty=!0;break;case t.ComponentTransform.rotation:this._isRotationDirty=!0}this._isColliderRegistered&&t.Physics.updateCollider(this)}onEnabled(){this.registerColliderWithPhysicsSystem(),this._isPositionDirty=this._isRotationDirty=!0}onDisabled(){this.unregisterColliderWithPhysicsSystem()}registerColliderWithPhysicsSystem(){this._isParentEntityAddedToScene&&!this._isColliderRegistered&&(t.Physics.addCollider(this),this._isColliderRegistered=!0)}unregisterColliderWithPhysicsSystem(){this._isParentEntityAddedToScene&&this._isColliderRegistered&&t.Physics.removeCollider(this),this._isColliderRegistered=!1}overlaps(t){return this.shape.overlaps(t.shape)}collidesWith(t,e,i){const s=this.entity.position;this.entity.position=this.entity.position.add(e);const n=this.shape.collidesWithShape(t.shape,i);return n&&(i.value.collider=t),this.entity.position=s,n}collidesWithNonMotion(t,e){return this.shape.collidesWithShape(t.shape,e)?(e.value.collider=t,!0):(e.value.collider=null,!1)}collidesWithAny(e,i){i.value=new t.CollisionResult;let s=this.bounds.clone();s.x+=e.x,s.y+=e.y;let n=t.Physics.boxcastBroadphaseExcludingSelf(this,s,this.collidesWithLayers.value),r=this.shape.position;this.shape.position=t.Vector2.add(this.shape.position,e);let o=!1;for(let t=0;t<n.length;t++){const s=n[t];s.isTrigger||this.collidesWithNonMotion(s,i)&&(e=e.sub(i.value.minimumTranslationVector),this.shape.position=this.shape.position.sub(i.value.minimumTranslationVector),o=!0)}return this.shape.position=r,o}collidesWithAnyNonMotion(e){e.value=new t.CollisionResult;let i=t.Physics.boxcastBroadphaseExcludingSelfNonRect(this,this.collidesWithLayers.value);for(let t of i)if(!t.isTrigger&&this.collidesWithNonMotion(t,e))return!0;return!1}}e.lateSortOrder=999,t.Collider=e}(es||(es={})),function(t){t.BoxCollider=class extends t.Collider{constructor(e=0,i=0,s=1,n=1){super(),this._localOffset=new t.Vector2(e+s/2,i+n/2),this.shape=new t.Box(s,n)}get width(){return this.shape.width}set width(t){this.setWidth(t)}get height(){return this.shape.height}set height(t){this.setHeight(t)}setSize(e,i){let s=this.shape;return e==s.width&&i==s.height||(s.updateBox(e,i),this._isPositionDirty=!0,this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}setWidth(e){let i=this.shape;return e!=i.width&&(i.updateBox(e,i.height),this._isPositionDirty=!0,null!=this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}setHeight(e){let i=this.shape;e!=i.height&&(i.updateBox(i.width,e),this._isPositionDirty=!0,this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this))}toString(){return`[BoxCollider: bounds: ${this.bounds}]`}}}(es||(es={})),function(t){t.CircleCollider=class extends t.Collider{constructor(e=1){super(),this.shape=new t.Circle(e)}get radius(){return this.shape.radius}set radius(t){this.setRadius(t)}setRadius(e){let i=this.shape;return e!=i.radius&&(i.radius=e,i._originalRadius=e,this._isPositionDirty=!0,null!=this.entity&&this._isParentEntityAddedToScene&&t.Physics.updateCollider(this)),this}toString(){return`[CircleCollider: bounds: ${this.bounds}, radius: ${this.shape.radius}]`}}}(es||(es={})),function(t){t.PolygonCollider=class extends t.Collider{constructor(e){super(),e[0]==e[e.length-1]&&(e=e.slice(0,e.length-1));let i=t.Polygon.findPolygonCenter(e);this.setLocalOffset(i),t.Polygon.recenterPolygonVerts(e),this.shape=new t.Polygon(e)}}}(es||(es={})),function(t){t.SectorCollider=class extends t.Collider{constructor(e,i,s,n){super(),this.shape=new t.Sector(e,i,s,n)}}}(es||(es={})),function(t){function e(e){switch(typeof e){case"boolean":case"number":case"string":return""+e;case"function":return t.getClassName(e);default:return e.uuid=e.uuid?e.uuid:t.UUID.randomUUID(),e.uuid}}t.HashMap=class{constructor(){this.clear()}clear(){this.map_={},this.keys_={}}values(){const t=[],e=this.map_;for(const i in e)t.push(e[i]);return t}contains(t){const e=this.map_;for(const i in e)if(t===e[i])return!0;return!1}containsKey(t){return e(t)in this.map_}containsValue(t){const e=this.map_;for(const i in e)if(t===e[i])return!0;return!1}get(t){return this.map_[e(t)]}isEmpty(){return 0===Object.keys(this.map_).length}keys(){const t=this.map_,e=[];for(const i in t)e.push(t[i]);return e}put(t,i){const s=e(t);this.map_[s]=i,this.keys_[s]=t}remove(t){const i=this.map_,s=e(t),n=i[s];return delete i[s],delete this.keys_[s],n}size(){return Object.keys(this.map_).length}}}(es||(es={})),function(t){t.EntitySystem=class{get useTime(){return this._useTime}get updateOrder(){return this._updateOrder}set updateOrder(t){this.setUpdateOrder(t)}constructor(e){this._entities=[],this._updateOrder=0,this._startTime=0,this._endTime=0,this._useTime=0,this._matcher=e||t.Matcher.empty(),this.initialize()}get scene(){return this._scene}set scene(t){this._scene=t,this._entities=[]}get matcher(){return this._matcher}setUpdateOrder(t){this._updateOrder=t,this.scene.entityProcessors.setDirty()}initialize(){}onChanged(t){let e=!!this._entities.find(e=>e.id==t.id),i=this._matcher.isInterestedEntity(t);i&&!e?this.add(t):!i&&e&&this.remove(t)}add(t){this._entities.find(e=>e.id==t.id)||this._entities.push(t),this.onAdded(t)}onAdded(t){}remove(e){new t.List(this._entities).remove(e),this.onRemoved(e)}onRemoved(t){}update(){this.checkProcessing()&&(this.begin(),this.process(this._entities))}lateUpdate(){this.checkProcessing()&&(this.lateProcess(this._entities),this.end())}begin(){t.Core.Instance.debug&&(this._startTime=Date.now())}process(t){}lateProcess(t){}end(){t.Core.Instance.debug&&(this._endTime=Date.now(),this._useTime=this._endTime-this._startTime)}checkProcessing(){return!0}}}(es||(es={})),function(t){t.DelayedIteratingSystem=class extends t.EntitySystem{constructor(t){super(t),this.delay=0,this.running=!1,this.acc=0}process(t){const e=t.length;if(0!==e){this.delay=Number.MAX_VALUE;for(let i=0;i<e;i++){const e=t[i];this.processDelta(e,this.acc);const s=this.getRemainingDelay(e);s<=0?this.processExpired(e):this.offerDelay(s)}this.acc=0}else this.stop()}checkProcessing(){return!!this.running&&(this.acc+=t.Time.deltaTime,this.acc>=this.delay)}offerDelay(t){this.running?this.delay=Math.min(this.delay,t):(this.running=!0,this.delay=t)}getInitialTimeDelay(){return this.delay}getRemainingTimeUntilProcessing(){return this.running?this.delay-this.acc:0}isRunning(){return this.running}stop(){this.running=!1,this.acc=0}}}(es||(es={})),function(t){t.EntityProcessingSystem=class extends t.EntitySystem{constructor(t){super(t),this.enabled=!0}lateProcessEntity(t){}process(t){if(0!==t.length)for(let e=0,i=t.length;e<i;e++){const i=t[e];this.processEntity(i)}}lateProcess(t){if(0!==t.length)for(let e=0,i=t.length;e<i;e++){const i=t[e];this.lateProcessEntity(i)}}checkProcessing(){return this.enabled}}}(es||(es={})),function(t){t.IntervalSystem=class extends t.EntitySystem{constructor(t,e){super(t),this.acc=0,this.intervalRemainder=0,this.interval=e}checkProcessing(){return this.acc+=t.Time.deltaTime,this.acc>=this.interval&&(this.intervalRemainder=this.acc-this.interval,this.acc=0,!0)}getIntervalDelta(){return this.interval+this.intervalRemainder}}}(es||(es={})),function(t){t.IntervalIteratingSystem=class extends t.IntervalSystem{constructor(t,e){super(t,e)}process(t){t.forEach(t=>this.processEntity(t))}}}(es||(es={})),function(t){t.PassiveSystem=class extends t.EntitySystem{onChanged(t){}process(t){this.begin(),this.end()}}}(es||(es={})),function(t){t.ProcessingSystem=class extends t.EntitySystem{onChanged(t){}process(t){this.begin(),this.processSystem(),this.end()}}}(es||(es={})),function(t){t.Bits=class{constructor(){this._bit={}}set(t,e){this._bit[t]=e}get(t){let e=this._bit[t];return null==e?0:e}}}(es||(es={})),function(t){class e{constructor(t){this._components=[],this._updatableComponents=[],this._componentsToAdd={},this._componentsToRemove={},this._componentsToAddList=[],this._componentsToRemoveList=[],this._tempBufferList=[],this.componentsByType=new Map,this.componentsToAddByType=new Map,this._entity=t}get count(){return this._components.length}get buffer(){return this._components}markEntityListUnsorted(){this._isComponentListUnsorted=!0}add(t){this._componentsToAdd[t.id]=t,this._componentsToAddList.push(t),this.addComponentsToAddByType(t)}remove(t){if(this._componentsToAdd[t.id]){const e=this._componentsToAddList.findIndex(e=>e.id===t.id);return-1!==e&&this._componentsToAddList.splice(e,1),delete this._componentsToAdd[t.id],void this.removeComponentsToAddByType(t)}this._componentsToRemove[t.id]=t,this._componentsToRemoveList.push(t)}removeAllComponents(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;++t)this.handleRemove(this._components[t]);this.componentsByType.clear(),this.componentsToAddByType.clear(),this._components.length=0,this._updatableComponents.length=0,this._componentsToAdd={},this._componentsToRemove={},this._componentsToAddList.length=0,this._componentsToRemoveList.length=0}deregisterAllComponents(){if(this._components.length>0)for(const e of this._components)t.isIUpdatable(e)&&new t.List(this._updatableComponents).remove(e),this.decreaseBits(e),this._entity.scene.entityProcessors.onComponentRemoved(this._entity)}registerAllComponents(){if(this._components.length>0)for(const e of this._components)t.isIUpdatable(e)&&this._updatableComponents.push(e),this.addBits(e),this._entity.scene.entityProcessors.onComponentAdded(this._entity)}decreaseBits(e){const i=this._entity.componentBits,s=t.ComponentTypeManager.getIndexFor(t.TypeUtils.getType(e));i.set(s,i.get(s)-1)}addBits(e){const i=this._entity.componentBits,s=t.ComponentTypeManager.getIndexFor(t.TypeUtils.getType(e));i.set(s,i.get(s)+1)}updateLists(){if(this._componentsToRemoveList.length>0){for(const t of this._componentsToRemoveList){this.handleRemove(t);const e=this._components.findIndex(e=>e.id===t.id);-1!==e&&this._components.splice(e,1),this.removeComponentsByType(t)}this._componentsToRemove={},this._componentsToRemoveList.length=0}if(this._componentsToAddList.length>0){for(const e of this._componentsToAddList)t.isIUpdatable(e)&&this._updatableComponents.push(e),this.addBits(e),this._entity.scene.entityProcessors.onComponentAdded(this._entity),this.addComponentsByType(e),this._components.push(e),this._tempBufferList.push(e);this._componentsToAdd={},this._componentsToAddList.length=0,this.componentsToAddByType.clear(),this._isComponentListUnsorted=!0}if(this._tempBufferList.length>0){for(const t of this._tempBufferList)t.onAddedToEntity(),t.enabled&&t.onEnabled();this._tempBufferList.length=0}}handleRemove(e){if(t.isIUpdatable(e)&&this._updatableComponents.length>0){const t=this._updatableComponents.findIndex(t=>t.id===e.id);-1!==t&&this._updatableComponents.splice(t,1)}this.decreaseBits(e),this._entity.scene.entityProcessors.onComponentRemoved(this._entity),e.onRemovedFromEntity(),e.entity=null}removeComponentsByType(e){const i=this.componentsByType.get(t.TypeUtils.getType(e)),s=i.findIndex(t=>t.id===e.id);-1!==s&&i.splice(s,1)}addComponentsByType(e){let i=this.componentsByType.get(t.TypeUtils.getType(e));i||(i=[]),i.push(e),this.componentsByType.set(t.TypeUtils.getType(e),i)}removeComponentsToAddByType(e){let i=this.componentsToAddByType.get(t.TypeUtils.getType(e)),s=i.findIndex(t=>t.id==e.id);-1!=s&&i.splice(s,1)}addComponentsToAddByType(e){let i=this.componentsToAddByType.get(t.TypeUtils.getType(e));i||(i=[]),i.push(e),this.componentsToAddByType.set(t.TypeUtils.getType(e),i)}getComponent(t,e){let i=this.componentsByType.get(t);if(i&&i.length>0)return i[0];if(!e){let e=this.componentsToAddByType.get(t);if(e&&e.length>0)return e[0]}return null}getComponents(t,e){e||(e=[]);let i=this.componentsByType.get(t);i&&(e=e.concat(i));let s=this.componentsToAddByType.get(t);return s&&(e=e.concat(s)),e}update(){if(this.updateLists(),this._updatableComponents.length>0)for(let t=0,e=this._updatableComponents.length;t<e;++t){let e=this._updatableComponents[t];e.enabled&&e.update()}}onEntityTransformChanged(t){if(this._components.length>0)for(let e=0,i=this._components.length;e<i;++e){let i=this._components[e];i.enabled&&i.onEntityTransformChanged(t)}if(this._componentsToAddList.length>0)for(let e=0,i=this._componentsToAddList.length;e<i;++e){let i=this._componentsToAddList[e];i.enabled&&i.onEntityTransformChanged(t)}}onEntityEnabled(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;t++)this._components[t].onEnabled()}onEntityDisabled(){if(this._components.length>0)for(let t=0,e=this._components.length;t<e;t++)this._components[t].onDisabled()}}e.compareUpdatableOrder=new t.IUpdatableComparer,t.ComponentList=e}(es||(es={})),function(t){t.ComponentTypeFactory=class{constructor(){this.componentTypes={},this.types=new t.Bag,this.componentTypeCount=0}getIndexFor(t){return this.getTypeFor(t).getIndex()}getTypeFor(e){if("number"==typeof e)return this.types.get(e);const i=t.getClassName(e);if(!this.componentTypes[i]){const s=this.componentTypeCount++,n=new t.ComponentType(e,s);this.componentTypes[i]=n,this.types.set(s,n)}return this.componentTypes[i]}}}(es||(es={})),function(t){class e{static add(t){this._componentTypesMask.has(t)||this._componentTypesMask.set(t,this._componentTypesMask.size)}static getIndexFor(t){let e=-1;return this._componentTypesMask.has(t)?e=this._componentTypesMask.get(t):(this.add(t),e=this._componentTypesMask.get(t)),e}}e._componentTypesMask=new Map,t.ComponentTypeManager=e}(es||(es={})),function(t){t.EntityList=class{constructor(t){this._entities=[],this._entitiesToAdded={},this._entitiesToRemove={},this._entitiesToAddedList=[],this._entitiesToRemoveList=[],this._entityDict=new Map,this._unsortedTags=new Set,this.scene=t}get count(){return this._entities.length}get buffer(){return this._entities}markEntityListUnsorted(){this._isEntityListUnsorted=!0}markTagUnsorted(t){this._unsortedTags.add(t)}add(t){this._entitiesToAdded[t.id]=t,this._entitiesToAddedList.push(t)}remove(t){if(this._entitiesToAdded[t.id]){const e=this._entitiesToAddedList.findIndex(e=>e.id===t.id);return-1!==e&&this._entitiesToAddedList.splice(e,1),void delete this._entitiesToAdded[t.id]}this._entitiesToRemoveList.push(t),this._entitiesToRemove[t.id]||(this._entitiesToRemove[t.id]=t)}removeAllEntities(){this._unsortedTags.clear(),this._entitiesToAdded={},this._entitiesToAddedList.length=0,this._isEntityListUnsorted=!1,this.updateLists();for(const t of this._entities)t._isDestroyed=!0,t.onRemovedFromScene(),t.scene=null;this._entities.length=0,this._entityDict.clear()}contains(t){return!!this._entitiesToAdded[t.id]}getTagList(t){let e=this._entityDict.get(t);return e||(e=new Set,this._entityDict.set(t,e)),e}addToTagList(t){this.getTagList(t.tag).add(t),this._unsortedTags.add(t.tag)}removeFromTagList(t){const e=this._entityDict.get(t.tag);e&&e.delete(t)}update(){for(let e=0;e<this._entities.length;e++){const i=this._entities[e];!i.enabled||1!==i.updateInterval&&t.Time.frameCount%i.updateInterval!=0||i.update()}}updateLists(){if(this._entitiesToRemoveList.length>0){for(const t of this._entitiesToRemoveList){this.removeFromTagList(t);const e=this._entities.findIndex(e=>e.id===t.id);-1!==e&&this._entities.splice(e,1),t.onRemovedFromScene(),t.scene=null,this.scene.entityProcessors.onEntityRemoved(t)}this._entitiesToRemove={},this._entitiesToRemoveList.length=0}if(this._entitiesToAddedList.length>0){for(const t of this._entitiesToAddedList)this._entities.push(t),t.scene=this.scene,this.addToTagList(t);for(const t of this._entitiesToAddedList)this.scene.entityProcessors.onEntityAdded(t);for(const t of this._entitiesToAddedList)t.onAddedToScene();this._entitiesToAdded={},this._entitiesToAddedList.length=0}}findEntity(t){if(this._entities.length>0)for(let e=0,i=this._entities.length;e<i;++e){let i=this._entities[e];if(i.name==t)return i}if(this._entitiesToAddedList.length>0)for(let e=0,i=this._entitiesToAddedList.length;e<i;++e){let i=this._entitiesToAddedList[e];if(i.name==t)return i}return null}findEntityRight(t){if(this._entities.length>0)for(let e=this._entities.length-1,i=0;e>=i;--e){let i=this._entities[e];if(i.name==t)return i}if(this._entitiesToAddedList.length>0)for(let e=this._entitiesToAddedList.length-1,i=0;e>=i;--e){let i=this._entitiesToAddedList[e];if(i.name==t)return i}return null}findEntityById(t){if(this._entities.length>0)for(let e=0,i=this._entities.length;e<i;++e){let i=this._entities[e];if(i.id==t)return i}return this._entitiesToAdded[t]}entitiesWithTag(e){const i=this.getTagList(e),s=t.ListPool.obtain(t.Entity);if(i.size>0)for(const t of i)s.push(t);return s}entityWithTag(t){let e=this.getTagList(t);if(e.size>0)for(let t of e)return t;return null}findComponentOfType(t){for(const e of this._entities)if(e.enabled){const i=e.getComponent(t);if(i)return i}for(const e of this._entitiesToAddedList)if(e.enabled){const i=e.getComponent(t);if(i)return i}return null}findComponentsOfType(e){const i=t.ListPool.obtain(e);for(const t of this._entities)t.enabled&&t.getComponents(e,i);for(const t of this._entitiesToAddedList)t.enabled&&t.getComponents(e,i);return i}findEntitiesOfComponent(...t){const e=[];for(const i of this._entities)if(i.enabled){if(0===t.length){e.push(i);continue}let s=!0;for(const e of t)if(!i.hasComponent(e)){s=!1;break}s&&e.push(i)}for(const i of this._entitiesToAddedList)if(i.enabled){if(0===t.length){e.push(i);continue}let s=!0;for(const e of t)if(!i.hasComponent(e)){s=!1;break}s&&e.push(i)}return e}}}(es||(es={})),function(t){t.EntityProcessorList=class{constructor(){this._processors=[],this._orderDirty=!1}get processors(){return this._processors}get count(){return this._processors.length}add(t){this._processors.push(t)}remove(e){new t.List(this._processors).remove(e)}onComponentAdded(t){this.notifyEntityChanged(t)}onComponentRemoved(t){this.notifyEntityChanged(t)}onEntityAdded(t){this.notifyEntityChanged(t)}onEntityRemoved(t){this.removeFromProcessors(t)}begin(){}update(){if(0!==this._processors.length){if(this._orderDirty){this._processors.sort((t,e)=>t.updateOrder-e.updateOrder);for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].setUpdateOrder(t);this.clearDirty()}for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].update()}}end(){}setDirty(){this._orderDirty=!0}clearDirty(){this._orderDirty=!1}getProcessor(t){if(0===this._processors.length)return null;for(let e=0,i=this._processors.length;e<i;++e){const i=this._processors[e];if(i instanceof t)return i}return null}notifyEntityChanged(t){if(0!==this._processors.length)for(let e=0,i=this._processors.length;e<i;++e)this._processors[e].onChanged(t)}removeFromProcessors(t){if(0!==this._processors.length)for(let e=0,i=this._processors.length;e<i;++e)this._processors[e].remove(t)}lateUpdate(){if(0!==this._processors.length)for(let t=0,e=this._processors.length;t<e;++t)this._processors[t].lateUpdate()}}}(es||(es={})),function(t){class e{static isPrime(t){if(0!=(1&t)){let e=Math.sqrt(t);for(let i=3;i<=e;i+=2)if(t%i==0)return!1;return!0}return 2===t}static getPrime(t){if(t<0)throw new Error("参数错误 min 不能小于0");for(let e=0;e<this.primes.length;e++){let i=this.primes[e];if(i>=t)return i}for(let e=1|t;e<Number.MAX_VALUE;e+=2)if(this.isPrime(e)&&(e-1)%this.hashPrime!=0)return e;return t}static expandPrime(t){let e=2*t;return e>this.maxPrimeArrayLength&&this.maxPrimeArrayLength>t?this.maxPrimeArrayLength:this.getPrime(e)}static getHashCode(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++){e=(e<<5)-e+t.charCodeAt(i),e&=e}return e}}e.hashCollisionThreshold=100,e.hashPrime=101,e.primes=[3,7,11,17,23,29,37,47,59,71,89,107,131,163,197,239,293,353,431,521,631,761,919,1103,1327,1597,1931,2333,2801,3371,4049,4861,5839,7013,8419,10103,12143,14591,17519,21023,25229,30293,36353,43627,52361,62851,75431,90523,108631,130363,156437,187751,225307,270371,324449,389357,467237,560689,672827,807403,968897,1162687,1395263,1674319,2009191,2411033,2893249,3471899,4166287,4999559,5999471,7199369],e.maxPrimeArrayLength=2146435069,t.HashHelpers=e}(es||(es={})),function(t){t.IdentifierPool=class{constructor(){this.nextAvailableId_=0,this.ids=new t.Bag}checkOut(){return this.ids.size()>0?this.ids.removeLast():this.nextAvailableId_++}checkIn(t){this.ids.add(t)}}}(es||(es={})),function(t){class e{constructor(){this.allSet=[],this.exclusionSet=[],this.oneSet=[]}static empty(){return new e}getAllSet(){return this.allSet}getExclusionSet(){return this.exclusionSet}getOneSet(){return this.oneSet}isInterestedEntity(t){return this.isInterested(t.componentBits)}isInterested(e){if(0!==this.allSet.length)for(let i=0;i<this.allSet.length;i++){const s=this.allSet[i];if(!e.get(t.ComponentTypeManager.getIndexFor(s)))return!1}if(0!==this.exclusionSet.length)for(let i=0;i<this.exclusionSet.length;i++){const s=this.exclusionSet[i];if(e.get(t.ComponentTypeManager.getIndexFor(s)))return!1}if(0!==this.oneSet.length){for(let i=0;i<this.oneSet.length;i++){const s=this.oneSet[i];if(e.get(t.ComponentTypeManager.getIndexFor(s)))return!0}return!1}return!0}all(...t){return this.allSet.push(...t),this}exclude(...t){return this.exclusionSet.push(...t),this}one(...t){return this.oneSet.push(...t),this}}t.Matcher=e}(es||(es={})),function(t){class e{static matchChineseWord(t){return t.match(/[\u4E00-\u9FA5]+/gim)}static lTrim(t){let e=0;for(;this.isWhiteSpace(t.charAt(e));)e++;return t.slice(e,t.length)}static rTrim(t){let e=t.length-1;for(;this.isWhiteSpace(t.charAt(e));)e--;return t.slice(0,e+1)}static trim(t){return null==t?null:this.rTrim(this.lTrim(t))}static isWhiteSpace(t){return" "==t||"\t"==t||"\r"==t||"\n"==t}static isNullOrEmpty(t){return""==t||null==t||void 0==t}static replaceMatch(t,e,i,s=!1){let n=t.length,r="",o=!1,a=1==s?e.toLowerCase():e;for(let e=0;e<n;e++)o=!1,t.charAt(e)==a.charAt(0)&&t.substr(e,a.length)==a&&(o=!0),o?(r+=i,e=e+a.length-1):r+=t.charAt(e);return r}static htmlSpecialChars(t,e=!1){let i=this.specialSigns.length;for(let s=0;s<i;s+=2){let i,n;if(i=this.specialSigns[s],n=this.specialSigns[s+1],e){let t=i;i=n,n=t}t=this.replaceMatch(t,i,n)}return t}static zfill(t,e=2){if(!t)return t;e=Math.floor(e);let i=t.length;if(i>=e)return t;let s=!1;"-"==t.substr(0,1)&&(s=!0,t=t.substr(1));let n=e-i;for(let e=0;e<n;e++)t="0"+t;return s&&(t="-"+t),t}static reverse(t){return t.length>1?this.reverse(t.substring(1))+t.substring(0,1):t}static cutOff(t,e,i,s=!0){e=Math.floor(e),i=Math.floor(i);let n=t.length;e>n&&(e=n);let r,o=e,a=e+i;return s?r=t.substring(0,o)+t.substr(a,n):(a=(o=n-1-e-i)+i,r=t.substring(0,o+1)+t.substr(a+1,n)),r}static strReplace(t,e){let i=0,s=e.length;for(;i<s;i++)null!=e[i]&&""!=e[i]||(e[i]="无"),t=t.replace("{"+i+"}",e[i]);return t}static format(t,...e){for(let i=0;i<e.length-1;i++){let s=new RegExp("\\{"+i+"\\}","gm");t=t.replace(s,e[i+1])}return t}}e.specialSigns=["&","&amp;","<","&lt;",">","&gt;",'"',"&quot;","'","&apos;","®","&reg;","©","&copy;","™","&trade;"],t.StringUtils=e}(es||(es={})),function(t){class e{static update(t,e){let i=0;e?i=t:(-1===t&&(t=Date.now()),-1===this._lastTime&&(this._lastTime=t),i=(t-this._lastTime)/1e3),i>this.maxDeltaTime&&(i=this.maxDeltaTime),this.totalTime+=i,this.deltaTime=i*this.timeScale,this.unscaledDeltaTime=i,this.timeSinceSceneLoad+=i,this.frameCount++,this._lastTime=t}static sceneChanged(){this.timeSinceSceneLoad=0}static checkEvery(t){return Math.floor(this.timeSinceSceneLoad/t)>Math.floor(this.deltaTime/t)}}e.totalTime=0,e.unscaledDeltaTime=0,e.deltaTime=0,e.timeScale=1,e.maxDeltaTime=Number.MAX_VALUE,e.frameCount=0,e.timeSinceSceneLoad=0,e._lastTime=-1,t.Time=e}(es||(es={})),function(t){t.TimeUtils=class{static monthId(t=null){let e=(t=t||new Date).getFullYear(),i=t.getMonth()+1;return parseInt(e+(i<10?"0":"")+i)}static dateId(t=null){let e=(t=t||new Date).getMonth()+1,i=e<10?"0":"",s=t.getDate(),n=s<10?"0":"";return parseInt(t.getFullYear()+i+e+n+s)}static weekId(t=null,e=!0){t=t||new Date;const i=new Date(t.getTime());i.setDate(1),i.setMonth(0);const s=i.getFullYear();let n=i.getDay();0==n&&(n=7);let r=!1;n<=4?(r=n>1,i.setDate(i.getDate()-(n-1))):i.setDate(i.getDate()+7-n+1);let o=this.diffDay(t,i,!1);if(o<0)return i.setDate(1),i.setMonth(0),i.setDate(i.getDate()-1),this.weekId(i,!1);const a=Math.floor(o/7),l=Math.floor(a)+1;if(53==l){i.setTime(t.getTime()),i.setDate(i.getDate()-1);let s=i.getDay();if(0==s&&(s=7),e&&(!r||s<4))return i.setFullYear(i.getFullYear()+1),i.setDate(1),i.setMonth(0),this.weekId(i,!1)}return parseInt(s+"00"+(l>9?"":"0")+l)}static diffDay(t,e,i=!1){let s=(t.getTime()-e.getTime())/864e5;return i?Math.ceil(s):Math.floor(s)}static getFirstDayOfWeek(t=new Date){let e=t.getDay()||7;return new Date(t.getFullYear(),t.getMonth(),t.getDate()+1-e,0,0,0,0)}static getFirstOfDay(t){return(t=t||new Date).setHours(0,0,0,0),t}static getNextFirstOfDay(t){return new Date(this.getFirstOfDay(t).getTime()+864e5)}static formatDate(t){let e=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;let s=t.getDate();return e+"-"+i+"-"+(s=s<10?"0"+s:s)}static formatDateTime(t){let e=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;let s=t.getDate();s=s<10?"0"+s:s;let n=t.getHours(),r=t.getMinutes();r=r<10?"0"+r:r;let o=t.getSeconds();return e+"-"+i+"-"+s+" "+n+":"+r+":"+(o=o<10?"0"+o:o)}static parseDate(t){let e=Date.parse(t);return isNaN(e)?new Date:new Date(Date.parse(t.replace(/-/g,"/")))}static secondToTime(t=0,e=":",i=!0){let s,n=Math.floor(t/3600),r=Math.floor(t%3600/60),o=Math.floor(t%3600%60),a=n.toString(),l=r.toString(),h=o.toString();return n<10&&(a="0"+a),r<10&&(l="0"+l),o<10&&(h="0"+h),s=i?a+e+l+e+h:l+e+h}static timeToMillisecond(t,e=":"){let i=t.split(e),s=0,n=i.length;for(let t=0;t<n;t++)s+=i[t]*Math.pow(60,n-1-t);return(s*=1e3).toString()}}}(es||(es={})),function(t){t.Bezier=class{static getPoint(e,i,s,n){let r=1-(n=t.MathHelper.clamp01(n));return e.scale(r*r).addEqual(i.scale(2*r*n)).addEqual(s.scale(n*n))}static getPointThree(e,i,s,n,r){const o=1-(r=t.MathHelper.clamp01(r));return e.scale(o*o*o).addEqual(i.scale(3*o*o*r)).addEqual(s.scale(3*o*r*r)).addEqual(n.scale(r*r*r))}static getFirstDerivative(t,e,i,s){return e.sub(t).scale(2*(1-s)).addEqual(i.sub(e).scale(2*s))}static getFirstDerivativeThree(e,i,s,n,r){let o=1-(r=t.MathHelper.clamp01(r));return i.sub(e).scale(3*o*o).addEqual(s.sub(i).scale(6*o*r)).addEqual(n.sub(s).scale(3*r*r))}static getOptimizedDrawingPoints(e,i,s,n,r=1){let o=t.ListPool.obtain(t.Vector2);return o.push(e),this.recursiveGetOptimizedDrawingPoints(e,i,s,n,o,r),o.push(n),o}static recursiveGetOptimizedDrawingPoints(e,i,s,n,r,o){let a=t.Vector2.divideScaler(e.add(i),2),l=t.Vector2.divideScaler(i.add(s),2),h=t.Vector2.divideScaler(s.add(n),2),c=t.Vector2.divideScaler(a.add(l),2),u=t.Vector2.divideScaler(l.add(h),2),d=t.Vector2.divideScaler(c.add(u),2),m=n.sub(e),p=Math.abs((i.x,n.x*m.y-(i.y-n.y)*m.x)),g=Math.abs((s.x-n.x)*m.y-(s.y-n.y)*m.x);(p+g)*(p+g)<o*(m.x*m.x+m.y*m.y)?r.push(d):(this.recursiveGetOptimizedDrawingPoints(e,a,c,d,r,o),this.recursiveGetOptimizedDrawingPoints(d,u,h,n,r,o))}}}(es||(es={})),function(t){t.BezierSpline=class{constructor(){this._points=[],this._curveCount=0}pointIndexAtTime(e){const i={time:0,range:0};return e>=1?(e=1,i.range=this._points.length-4):(e=t.MathHelper.clamp01(e)*this._curveCount,i.range=t.MathHelper.toInt(e),e-=i.range,i.range*=3),i.time=e,i}setControlPoint(t,e){if(t%3==0){const i=e.sub(this._points[t]);t>0&&this._points[t-1].addEqual(i),t+1<this._points.length&&this._points[t+1].addEqual(i)}this._points[t]=e}getPointAtTime(e){const i=this.pointIndexAtTime(e).range;return t.Bezier.getPointThree(this._points[i],this._points[i+1],this._points[i+2],this._points[i+3],e)}getVelocityAtTime(e){const i=this.pointIndexAtTime(e).range;return t.Bezier.getFirstDerivativeThree(this._points[i],this._points[i+1],this._points[i+2],this._points[i+3],e)}getDirectionAtTime(t){return this.getVelocityAtTime(t).normalize()}addCurve(t,e,i,s){0==this._points.length&&this._points.push(t),this._points.push(e),this._points.push(i),this._points.push(s),this._curveCount=(this._points.length-1)/3}reset(){this._points.length=0}getDrawingPoints(t){let e=[];for(let i=0;i<t;i++){let s=i/t;e[i]=this.getPointAtTime(s)}return e}}}(es||(es={})),function(t){t.Flags=class{static isFlagSet(t,e){return 0!=(t&e)}static isUnshiftedFlagSet(t,e){return 0!=(t&(e=1<<e))}static setFlagExclusive(t,e){t.value=1<<e}static setFlag(t,e){t.value|=1<<e}static unsetFlag(t,e){e=1<<e,t.value&=~e}static invertFlags(t){t.value=~t.value}static binaryStringRepresentation(t,e=10){let i=t.toString(2);for(;i.length<(e||2);)i="0"+i;return i}}}(es||(es={})),function(t){class e{static toDegrees(t){return 57.29577951308232*t}static toRadians(t){return.017453292519943295*t}static barycentric(t,e,i,s,n){return t+s/(1-s)*(e+(i-e)*n-t)}static catmullRom(t,e,i,s,n){const r=n*n;return(3*e-t-3*i+s)/2*(r*n)+(2*t-5*e+4*i-s/2)*r+(-t+i)/2*n+(e-t+i-s)/2}static map(t,e,i,s,n){return s+(t-e)*(n-s)/(i-e)}static map01(t,e,i){return 1*(t-e)/(i-e)}static map10(t,e,i){return 1-this.map01(t,e,i)}static smoothStep(t,e,i){return i=this.clamp01(i),i=this.hermite(t,0,e,0,i)}static wrapAngle(t){const e=(t+2*Math.PI)%(2*Math.PI);return e>Math.PI?e-2*Math.PI:e}static isPowerOfTwo(t){return!(t<=0)&&0==(t&t-1)}static lerp(t,i,s){return t+(i-t)*e.clamp01(s)}static betterLerp(t,i,s,n){return Math.abs(t-i)<n?i:e.lerp(t,i,s)}static lerpAngle(t,e,i){let s=this.repeat(e-t,360);return s>180&&(s-=360),t+s*this.clamp01(i)}static lerpAngleRadians(t,e,i){let s=this.repeat(e-t,2*Math.PI);return s>Math.PI&&(s-=2*Math.PI),t+s*this.clamp01(i)}static pingPong(t,e){return t=this.repeat(t,2*e),e-Math.abs(t-e)}static signThreshold(t,e){return Math.abs(t)>=e?Math.sign(t):0}static inverseLerp(t,e,i){const s=e-t;return 0===s?0:(i-t)/s}static lerpPrecise(t,e,i){return(1-i)*t+e*i}static clamp(t,e,i){return t<e?e:t>i?i:t}static snap(t,e){return Math.round(t/e)*e}static isEven(t){return t%2==0}static isOdd(t){return t%2!=0}static roundWithRoundedAmount(t,e){let i=Math.round(t);return e.value=t-i*Math.round(t/i),i}static clamp01(t){return t<0?0:t>1?1:t}static angleBetweenVectors(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}static angleToVector(e,i){const s=Math.cos(e)*i,n=Math.sin(e)*i;return new t.Vector2(s,n)}static incrementWithWrap(t,e){return++t==e?0:t}static decrementWithWrap(t,e){return--t<0?e-1:t}static hypotenuse(t,e){let i=t*t+e*e;return Math.sqrt(i)}static closestPowerOfTwoGreaterThan(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}static roundToNearest(t,e){const i=t/e;return Math.round(i)*e}static withinEpsilon(t,e=this.Epsilon){return Math.abs(t)<e}static approach(t,e,i){return t<e?Math.min(t+i,e):Math.max(t-i,e)}static approachAngle(t,e,i){let s=this.deltaAngle(t,e);if(-i<s&&s<i)return e;let n=this.approach(t,t+s,i);return n=this.repeat(n,360)}static project(t,e){let i=t.dot(e)/e.lengthSquared();return e.scale(i)}static approachAngleRadians(t,e,i){let s=this.deltaAngleRadians(t,e);if(-i<s&&s<i)return e;let n=this.approach(t,t+s,i);return this.repeat(n,2*Math.PI)}static approximately(t,e,i=this.Epsilon){return Math.abs(t-e)<=i}static deltaAngle(t,e){let i=this.repeat(e-t,360);return i>180&&(i-=360),i}static between(t,e,i){return t>=e&&t<=i}static deltaAngleRadians(t,e){let i=this.repeat(e-t,2*Math.PI);return i>Math.PI&&(i-=2*Math.PI),i}static repeat(t,e){return t-Math.floor(t/e)*e}static floorToInt(t){const e=Math.floor(t);return this.toInt(e)}static rotateAround(e,i){const s=t.Time.totalTime*i,n=Math.cos(s),r=Math.sin(s),o=e.x+n,a=e.y+r;return new t.Vector2(o,a)}static rotateAround2(e,i,s){const{x:n,y:r}=i,{x:o,y:a}=e,l=this.toRadians(s),h=Math.cos(l),c=Math.sin(l),u=h*(o-n)-c*(a-r)+n,d=c*(o-n)+h*(a-r)+r;return new t.Vector2(u,d)}static pointOnCircle(e,i,s){const n=this.toRadians(s),r=Math.cos(n)*i,o=Math.sin(n)*i,a=r+e.x,l=o+e.y;return new t.Vector2(a,l)}static pointOnCircleRadians(e,i,s){const n=Math.cos(s)*i,r=Math.sin(s)*i,o=n+e.x,a=r+e.y;return new t.Vector2(o,a)}static lissajou(e=2,i=3,s=1,n=1,r=0){const o=Math.sin(t.Time.totalTime*e+r)*s,a=Math.cos(t.Time.totalTime*i)*n;return new t.Vector2(o,a)}static lissajouDamped(e=2,i=3,s=1,n=1,r=.5,o=0,a=5){const l=this.pingPong(t.Time.totalTime,a),h=Math.pow(Math.E,-o*l),c=h*Math.sin(t.Time.totalTime*e+r)*s,u=h*Math.cos(t.Time.totalTime*i)*n;return new t.Vector2(c,u)}static hermite(t,e,i,s,n){let r=n,o=r*r*r,a=r*r;if(0===n)return t;if(1===n)return i;return(2*t-2*i+s+e)*o+(3*i-3*t-2*e-s)*a+e*r+t}static isValid(t){return!Number.isNaN(t)&&t!==1/0}static smoothDamp(t,i,s,n,r,o){const a=2/(n=Math.max(1e-4,n)),l=a*o,h=1/(1+.48*l+.235*l*l),c=r*n;let u=t-i;const d=(s+a*(u=e.clamp(u,-c,c)))*o;s=(s-a*d)*h;let m=(i=t-u)+(u+d)*h;return t>i==m>i&&(s=((m=i)-i)/o),{value:m,currentVelocity:s}}static smoothDampVector(e,i,s,n,r,o){const a=t.Vector2.zero,l=this.smoothDamp(e.x,i.x,s.x,n,r,o);a.x=l.value,s.x=l.currentVelocity;const h=this.smoothDamp(e.y,i.y,s.y,n,r,o);return a.y=h.value,s.y=h.currentVelocity,a}static mapMinMax(t,i,s,n,r){return n+(e.clamp(t,i,s)-i)*(r-n)/(s-i)}static fromAngle(e){return new t.Vector2(Math.cos(e),Math.sin(e)).normalizeEqual()}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}}e.Epsilon=1e-5,e.Rad2Deg=57.29578,e.Deg2Rad=.0174532924,e.PiOver2=Math.PI/2,t.MathHelper=e}(es||(es={})),function(t){class e{static get Identity(){return this.identity}constructor(t,e,i,s,n,r,o,a,l,h,c,u,d,m,p,g){this.m11=t,this.m12=e,this.m13=i,this.m14=s,this.m21=n,this.m22=r,this.m23=o,this.m24=a,this.m31=l,this.m32=h,this.m33=c,this.m34=u,this.m41=d,this.m42=m,this.m43=p,this.m44=g}static createOrthographicOffCenter(t,i,s,n,r,o,a=new e){a.m11=2/(i-t),a.m12=0,a.m13=0,a.m14=0,a.m21=0,a.m22=2/(n-s),a.m23=0,a.m24=0,a.m31=0,a.m32=0,a.m33=1/(r-o),a.m34=0,a.m41=(t+i)/(t-i),a.m42=(n+s)/(s-n),a.m43=r/(r-o),a.m44=1}static createTranslation(t,e){e.m11=1,e.m12=0,e.m13=0,e.m14=0,e.m21=0,e.m22=1,e.m23=0,e.m24=0,e.m31=0,e.m32=0,e.m33=1,e.m34=0,e.m41=t.x,e.m42=t.y,e.m43=0,e.m44=1}static createRotationZ(t,i){i=e.Identity;var s=Math.cos(t),n=Math.sin(t);i.m11=s,i.m12=n,i.m21=-n,i.m22=s}static multiply(t,i,s=new e){let n=t.m11*i.m11+t.m12*i.m21+t.m13*i.m31+t.m14*i.m41,r=t.m11*i.m12+t.m12*i.m22+t.m13*i.m32+t.m14*i.m42,o=t.m11*i.m13+t.m12*i.m23+t.m13*i.m33+t.m14*i.m43,a=t.m11*i.m14+t.m12*i.m24+t.m13*i.m34+t.m14*i.m44,l=t.m21*i.m11+t.m22*i.m21+t.m23*i.m31+t.m24*i.m41,h=t.m21*i.m12+t.m22*i.m22+t.m23*i.m32+t.m24*i.m42,c=t.m21*i.m13+t.m22*i.m23+t.m23*i.m33+t.m24*i.m43,u=t.m21*i.m14+t.m22*i.m24+t.m23*i.m34+t.m24*i.m44,d=t.m31*i.m11+t.m32*i.m21+t.m33*i.m31+t.m34*i.m41,m=t.m31*i.m12+t.m32*i.m22+t.m33*i.m32+t.m34*i.m42,p=t.m31*i.m13+t.m32*i.m23+t.m33*i.m33+t.m34*i.m43,g=t.m31*i.m14+t.m32*i.m24+t.m33*i.m34+t.m34*i.m44,y=t.m41*i.m11+t.m42*i.m21+t.m43*i.m31+t.m44*i.m41,f=t.m41*i.m12+t.m42*i.m22+t.m43*i.m32+t.m44*i.m42,_=t.m41*i.m13+t.m42*i.m23+t.m43*i.m33+t.m44*i.m43,T=t.m41*i.m14+t.m42*i.m24+t.m43*i.m34+t.m44*i.m44;s.m11=n,s.m12=r,s.m13=o,s.m14=a,s.m21=l,s.m22=h,s.m23=c,s.m24=u,s.m31=d,s.m32=m,s.m33=p,s.m34=g,s.m41=y,s.m42=f,s.m43=_,s.m44=T}}e.identity=new e(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t.Matrix=e}(es||(es={})),function(t){class e{constructor(){this.m11=0,this.m12=0,this.m21=0,this.m22=0,this.m31=0,this.m32=0}static get identity(){return(new e).setIdentity()}setIdentity(){return this.setValues(1,0,0,1,0,0)}setValues(t,e,i,s,n,r){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.m31=n,this.m32=r,this}get translation(){return new t.Vector2(this.m31,this.m32)}set translation(t){this.m31=t.x,this.m32=t.y}get rotation(){return Math.atan2(this.m21,this.m11)}set rotation(t){let e=Math.cos(t),i=Math.sin(t);this.m11=e,this.m12=i,this.m21=-i,this.m22=e}get rotationDegrees(){return t.MathHelper.toDegrees(this.rotation)}set rotationDegrees(e){this.rotation=t.MathHelper.toRadians(e)}get scale(){return new t.Vector2(this.m11,this.m22)}set scale(t){this.m11=t.x,this.m22=t.y}static createRotation(t,e){e.setIdentity();const i=Math.cos(t),s=Math.sin(t);e.m11=i,e.m12=s,e.m21=-1*s,e.m22=i}static createRotationOut(t,e){let i=Math.cos(t),s=Math.sin(t);e.m11=i,e.m12=s,e.m21=-s,e.m22=i}static createScale(t,e,i){i.m11=t,i.m12=0,i.m21=0,i.m22=e,i.m31=0,i.m32=0}static createScaleOut(t,e,i){i.m11=t,i.m12=0,i.m21=0,i.m22=e,i.m31=0,i.m32=0}static createTranslation(t,e,i){return i.m11=1,i.m12=0,i.m21=0,i.m22=1,i.m31=t,i.m32=e,i}static createTranslationOut(t,e){e.m11=1,e.m12=0,e.m21=0,e.m22=1,e.m31=t.x,e.m32=t.y}static invert(t){let e=1/t.determinant(),i=this.identity;return i.m11=t.m22*e,i.m12=-t.m12*e,i.m21=-t.m21*e,i.m22=t.m11*e,i.m31=(t.m32*t.m21-t.m31*t.m22)*e,i.m32=-(t.m32*t.m11-t.m31*t.m12)*e,i}add(t){return this.m11+=t.m11,this.m12+=t.m12,this.m21+=t.m21,this.m22+=t.m22,this.m31+=t.m31,this.m32+=t.m32,this}substract(t){return this.m11-=t.m11,this.m12-=t.m12,this.m21-=t.m21,this.m22-=t.m22,this.m31-=t.m31,this.m32-=t.m32,this}divide(t){return this.m11/=t.m11,this.m12/=t.m12,this.m21/=t.m21,this.m22/=t.m22,this.m31/=t.m31,this.m32/=t.m32,this}multiply(t){let e=this.m11*t.m11+this.m12*t.m21,i=this.m11*t.m12+this.m12*t.m22,s=this.m21*t.m11+this.m22*t.m21,n=this.m21*t.m12+this.m22*t.m22,r=this.m31*t.m11+this.m32*t.m21+t.m31,o=this.m31*t.m12+this.m32*t.m22+t.m32;return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.m31=r,this.m32=o,this}static multiply(t,e,i){const s=t.m11*e.m11+t.m12*e.m21,n=t.m11*e.m12+t.m12*e.m22,r=t.m21*e.m11+t.m22*e.m21,o=t.m21*e.m12+t.m22*e.m22,a=t.m31*e.m11+t.m32*e.m21+e.m31,l=t.m31*e.m12+t.m32*e.m22+e.m32;i.m11=s,i.m12=n,i.m21=r,i.m22=o,i.m31=a,i.m32=l}determinant(){return this.m11*this.m22-this.m12*this.m21}static lerp(t,e,i){return t.m11=t.m11+(e.m11-t.m11)*i,t.m12=t.m12+(e.m12-t.m12)*i,t.m21=t.m21+(e.m21-t.m21)*i,t.m22=t.m22+(e.m22-t.m22)*i,t.m31=t.m31+(e.m31-t.m31)*i,t.m32=t.m32+(e.m32-t.m32)*i,t}static transpose(t){let e=this.identity;return e.m11=t.m11,e.m12=t.m21,e.m21=t.m12,e.m22=t.m22,e.m31=0,e.m32=0,e}mutiplyTranslation(i,s){let n=new e;return e.createTranslation(i,s,n),t.MatrixHelper.multiply(this,n)}equals(t){return this==t}static toMatrix(e){let i=new t.Matrix;return i.m11=e.m11,i.m12=e.m12,i.m13=0,i.m14=0,i.m21=e.m21,i.m22=e.m22,i.m23=0,i.m24=0,i.m31=0,i.m32=0,i.m33=1,i.m34=0,i.m41=e.m31,i.m42=e.m32,i.m43=0,i.m44=1,i}toString(){return`{m11:${this.m11} m12:${this.m12} m21:${this.m21} m22:${this.m22} m31:${this.m31} m32:${this.m32}}`}}t.Matrix2D=e}(es||(es={})),function(t){t.MatrixHelper=class{static add(e,i){const s=new t.Matrix2D;return s.m11=e.m11+i.m11,s.m12=e.m12+i.m12,s.m21=e.m21+i.m21,s.m22=e.m22+i.m22,s.m31=e.m31+i.m31,s.m32=e.m32+i.m32,s}static divide(e,i){const s=new t.Matrix2D;return s.m11=e.m11/i.m11,s.m12=e.m12/i.m12,s.m21=e.m21/i.m21,s.m22=e.m22/i.m22,s.m31=e.m31/i.m31,s.m32=e.m32/i.m32,s}static multiply(e,i){const s=new t.Matrix2D;return i instanceof t.Matrix2D?(s.m11=e.m11*i.m11+e.m12*i.m21,s.m12=e.m11*i.m12+e.m12*i.m22,s.m21=e.m21*i.m11+e.m22*i.m21,s.m22=e.m21*i.m12+e.m22*i.m22,s.m31=e.m31*i.m11+e.m32*i.m21+i.m31,s.m32=e.m31*i.m12+e.m32*i.m22+i.m32):(s.m11=e.m11*i,s.m12=e.m12*i,s.m21=e.m21*i,s.m22=e.m22*i,s.m31=e.m31*i,s.m32=e.m32*i),s}static subtract(e,i){const s=new t.Matrix2D;return s.m11=e.m11-i.m11,s.m12=e.m12-i.m12,s.m21=e.m21-i.m21,s.m22=e.m22-i.m22,s.m31=e.m31-i.m31,s.m32=e.m32-i.m32,s}}}(es||(es={})),function(t){class e{static get empty(){return new e}static get maxRect(){return new e(Number.MIN_VALUE/2,Number.MIN_VALUE/2,Number.MAX_VALUE,Number.MAX_VALUE)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get max(){return new t.Vector2(this.right,this.bottom)}isEmpty(){return 0==this.width&&0==this.height&&0==this.x&&0==this.y}get location(){return new t.Vector2(this.x,this.y)}set location(t){this.x=t.x,this.y=t.y}get size(){return new t.Vector2(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}get center(){return new t.Vector2(this.x+this.width/2,this.y+this.height/2)}constructor(e=0,i=0,s=0,n=0){this.x=0,this.y=0,this.width=0,this.height=0,this._tempMat=new t.Matrix2D,this._transformMat=new t.Matrix2D,this.x=e,this.y=i,this.width=s,this.height=n}static fromMinMax(t,i,s,n){return new e(t,i,s-t,n-i)}static rectEncompassingPoints(t){let e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++){let o=t[r];o.x<e&&(e=o.x),o.x>s&&(s=o.x),o.y<i&&(i=o.y),o.y>n&&(n=o.y)}return this.fromMinMax(e,i,s,n)}getSide(e){switch(e){case t.Edge.top:return this.top;case t.Edge.bottom:return this.bottom;case t.Edge.left:return this.left;case t.Edge.right:return this.right;default:throw new Error("Argument Out Of Range")}}contains(t,e){return this.x<=t&&t<this.x+this.width&&this.y<=e&&e<this.y+this.height}inflate(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}intersects(t){return t.left<this.right&&this.left<t.right&&t.top<this.bottom&&this.top<t.bottom}rayIntersects(t){const e={intersected:!1,distance:0};let i=1/0;if(Math.abs(t.direction.x)<1e-6){if(t.start.x<this.x||t.start.x>this.x+this.width)return e}else{const s=1/t.direction.x;let n=(this.x-t.start.x)*s,r=(this.x+this.width-t.start.x)*s;if(n>r&&([r,n]=[n,r]),e.distance=Math.max(n,e.distance),i=Math.min(r,i),e.distance>i)return e}if(Math.abs(t.direction.y)<1e-6){if(t.start.y<this.y||t.start.y>this.y+this.height)return e}else{const s=1/t.direction.y;let n=(this.y-t.start.y)*s,r=(this.y+this.height-t.start.y)*s;if(n>r&&([r,n]=[n,r]),e.distance=Math.max(n,e.distance),i=Math.min(r,i),e.distance>i)return e}return e.intersected=!0,e}containsRect(t){return this.x<=t.x&&t.x<this.x+this.width&&this.y<=t.y&&t.y<this.y+this.height}getHalfSize(){return new t.Vector2(.5*this.width,.5*this.height)}getClosestPointOnBoundsToOrigin(){let e=this.max,i=Math.abs(this.location.x),s=new t.Vector2(this.location.x,0);return Math.abs(e.x)<i&&(i=Math.abs(e.x),s.x=e.x,s.y=0),Math.abs(e.y)<i&&(i=Math.abs(e.y),s.x=0,s.y=e.y),Math.abs(this.location.y)<i&&(i=Math.abs(this.location.y),s.x=0,s.y=this.location.y),s}getClosestPointOnRectangleToPoint(e){let i=t.Vector2.zero;return i.x=t.MathHelper.clamp(e.x,this.left,this.right),i.y=t.MathHelper.clamp(e.y,this.top,this.bottom),i}getClosestPointOnRectangleBorderToPoint(e,i){i.value=t.Vector2.zero;const s=t.Vector2.zero;if(s.x=t.MathHelper.clamp(e.x,this.left,this.right),s.y=t.MathHelper.clamp(e.y,this.top,this.bottom),this.contains(s.x,s.y)){let t=s.x-this.left,e=this.right-s.x,n=s.y-this.top,r=this.bottom-s.y,o=Math.min(t,e,n,r);o==n?(s.y=this.top,i.value.y=-1):o==r?(s.y=this.bottom,i.value.y=1):o==t?(s.x=this.left,i.value.x=-1):(s.x=this.right,i.value.x=1)}else s.x==this.left&&(i.value.x=-1),s.x==this.right&&(i.value.x=1),s.y==this.top&&(i.value.y=-1),s.y==this.bottom&&(i.value.y=1);return s}static intersect(t,i){if(t.intersects(i)){let s=Math.min(t.x+t.width,i.x+i.width),n=Math.max(t.x,i.x),r=Math.max(t.y,i.y),o=Math.min(t.y+t.height,i.y+i.height);return new e(n,r,s-n,o-r)}return new e(0,0,0,0)}offset(t,e){return this.x+=t,this.y+=e,this}static union(t,i){let s=Math.min(t.x,i.x),n=Math.min(t.y,i.y);return new e(s,n,Math.max(t.right,i.right)-s,Math.max(t.bottom,i.bottom)-n)}static overlap(t,i){let s=Math.max(t.x,i.x,0),n=Math.max(t.y,i.y,0);return new e(s,n,Math.max(Math.min(t.right,i.right)-s,0),Math.max(Math.min(t.bottom,i.bottom)-n,0))}calculateBounds(e,i,s,n,r,o,a){if(0==r)this.x=Math.trunc(e.x+i.x-s.x*n.x),this.y=Math.trunc(e.y+i.y-s.y*n.y),this.width=Math.trunc(o*n.x),this.height=Math.trunc(a*n.y);else{let l=e.x+i.x,h=e.y+i.y;t.Matrix2D.createTranslation(-l-s.x,-h-s.y,this._transformMat),t.Matrix2D.createScale(n.x,n.y,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat),t.Matrix2D.createRotation(r,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat),t.Matrix2D.createTranslation(l,h,this._tempMat),this._transformMat=this._transformMat.multiply(this._tempMat);let c=new t.Vector2(l,h),u=new t.Vector2(l+o,h),d=new t.Vector2(l,h+a),m=new t.Vector2(l+o,h+a);t.Vector2Ext.transformR(c,this._transformMat,c),t.Vector2Ext.transformR(u,this._transformMat,u),t.Vector2Ext.transformR(d,this._transformMat,d),t.Vector2Ext.transformR(m,this._transformMat,m);let p=Math.trunc(Math.min(c.x,m.x,u.x,d.x)),g=Math.trunc(Math.max(c.x,m.x,u.x,d.x)),y=Math.trunc(Math.min(c.y,m.y,u.y,d.y)),f=Math.trunc(Math.max(c.y,m.y,u.y,d.y));this.location=new t.Vector2(p,y),this.width=Math.trunc(g-p),this.height=Math.trunc(f-y)}}getSweptBroadphaseBounds(t,i){let s=e.empty;return s.x=t>0?this.x:this.x+t,s.y=i>0?this.y:this.y+i,s.width=t>0?t+this.width:this.width-t,s.height=i>0?i+this.height:this.height-i,s}collisionCheck(t,e,i){e.value=i.value=0;let s=t.x-(this.x+this.width),n=t.x+t.width-this.x,r=t.y-(this.y+this.height),o=t.y+t.height-this.y;return!(s>0||n<0||r>0||o<0)&&(e.value=Math.abs(s)<n?s:n,i.value=Math.abs(r)<o?r:o,Math.abs(e.value)<Math.abs(i.value)?i.value=0:e.value=0,!0)}static getIntersectionDepth(e,i){let s=e.width/2,n=e.height/2,r=i.width/2,o=i.height/2,a=new t.Vector2(e.left+s,e.top+n),l=new t.Vector2(i.left+r,i.top+o),h=a.x-l.x,c=a.y-l.y,u=s+r,d=n+o;if(Math.abs(h)>=u||Math.abs(c)>=d)return t.Vector2.zero;let m=h>0?u-h:-u-h,p=c>0?d-c:-d-c;return new t.Vector2(m,p)}equals(t){return this===t}getHashCode(){return Math.trunc(this.x)^Math.trunc(this.y)^Math.trunc(this.width)^Math.trunc(this.height)}clone(){return new e(this.x,this.y,this.width,this.height)}}t.Rectangle=e}(es||(es={})),function(t){t.SubpixelFloat=class{constructor(){this.remainder=0}update(t){this.remainder+=t;let e=Math.trunc(this.remainder);return this.remainder-=e,e}reset(){this.remainder=0}}}(es||(es={})),function(t){t.SubpixelVector2=class{constructor(){this._x=new t.SubpixelFloat,this._y=new t.SubpixelFloat}update(t){t.x=this._x.update(t.x),t.y=this._y.update(t.y)}reset(){this._x.reset(),this._y.reset()}}}(es||(es={})),function(t){t.ColliderTriggerHelper=class{constructor(e){this._activeTriggerIntersections=new t.PairSet,this._previousTriggerIntersections=new t.PairSet,this._tempTriggerList=[],this._entity=e}update(){const e=[];let i=this.getColliders();if(i.length>0)for(let s=0;s<i.length;s++){let n=i[s],r=t.Physics.boxcastBroadphaseExcludingSelf(n,n.bounds,n.collidesWithLayers.value);for(let i=0;i<r.length;i++){let s=r[i];if((n.isTrigger||s.isTrigger)&&n.overlaps(s)){const i=new t.Pair(n,s);!this._activeTriggerIntersections.has(i)&&!this._previousTriggerIntersections.has(i)&&(s.castSortOrder>=t.Collider.lateSortOrder?e.push(i):this.notifyTriggerListeners(i,!0)),this._activeTriggerIntersections.add(i)}}}if(e.length>0)for(let t=0;t<e.length;t++){const i=e[t];this.notifyTriggerListeners(i,!0)}this.checkForExitedColliders()}getColliders(){const e=[];if(this._entity.components.buffer.length>0)for(let i=0;i<this._entity.components.buffer.length;i++){const s=this._entity.components.buffer[i];s instanceof t.Collider&&e.push(s)}return e}checkForExitedColliders(){this._previousTriggerIntersections.except(this._activeTriggerIntersections),this._previousTriggerIntersections.all.forEach(t=>{this.notifyTriggerListeners(t,!1)}),this._previousTriggerIntersections.clear(),this._previousTriggerIntersections.union(this._activeTriggerIntersections),this._activeTriggerIntersections.clear()}notifyTriggerListeners(e,i){if(t.TriggerListenerHelper.getITriggerListener(e.first.entity,this._tempTriggerList),this._tempTriggerList.length>0)for(let s=0;s<this._tempTriggerList.length;s++){const n=this._tempTriggerList[s];if(i?n.onTriggerEnter(e.second,e.first):n.onTriggerExit(e.second,e.first),this._tempTriggerList.length=0,e.second.entity){if(t.TriggerListenerHelper.getITriggerListener(e.second.entity,this._tempTriggerList),this._tempTriggerList.length>0)for(let t=0;t<this._tempTriggerList.length;t++){const s=this._tempTriggerList[t];i?s.onTriggerEnter(e.first,e.second):s.onTriggerExit(e.first,e.second)}this._tempTriggerList.length=0}}}}}(es||(es={})),function(t){let e;!function(t){t[t.center=0]="center",t[t.top=1]="top",t[t.bottom=2]="bottom",t[t.topLeft=9]="topLeft",t[t.topRight=5]="topRight",t[t.left=8]="left",t[t.right=4]="right",t[t.bottomLeft=10]="bottomLeft",t[t.bottomRight=6]="bottomRight"}(e=t.PointSectors||(t.PointSectors={}));t.Collisions=class{static lineToLine(t,e,i,s){const n=e.sub(t),r=s.sub(i),o=n.x*r.y-n.y*r.x;if(0==o)return!1;const a=i.sub(t),l=(a.x*r.y-a.y*r.x)/o;if(l<0||l>1)return!1;const h=(a.x*n.y-a.y*n.x)/o;return!(h<0||h>1)}static lineToLineIntersection(e,i,s,n,r=t.Vector2.zero){r.x=0,r.y=0;const o=i.sub(e),a=n.sub(s),l=o.x*a.y-o.y*a.x;if(0==l)return!1;const h=s.sub(e),c=(h.x*a.y-h.y*a.x)/l;if(c<0||c>1)return!1;const u=(h.x*o.y-h.y*o.x)/l;if(u<0||u>1)return!1;const d=e.add(o.scale(c));return r.x=d.x,r.y=d.y,!0}static closestPointOnLine(e,i,s){const n=i.sub(e);let r=s.sub(e).dot(n)/n.dot(n);return r=t.MathHelper.clamp(r,0,1),e.add(n.scale(r))}static circleToCircle(e,i,s,n){return t.Vector2.sqrDistance(e,s)<(i+n)*(i+n)}static circleToLine(e,i,s,n){return t.Vector2.sqrDistance(e,this.closestPointOnLine(s,n,e))<i*i}static circleToPoint(e,i,s){return t.Vector2.sqrDistance(e,s)<i*i}static rectToCircle(i,s,n){if(this.rectToPoint(i.x,i.y,i.width,i.height,s))return!0;let r,o;const a=this.getSector(i.x,i.y,i.width,i.height,s);return!!(0!=(a&e.top)&&(r=new t.Vector2(i.x,i.y),o=new t.Vector2(i.x+i.width,i.y),this.circleToLine(s,n,r,o))||0!=(a&e.bottom)&&(r=new t.Vector2(i.x,i.y+i.width),o=new t.Vector2(i.x+i.width,i.y+i.height),this.circleToLine(s,n,r,o))||0!=(a&e.left)&&(r=new t.Vector2(i.x,i.y),o=new t.Vector2(i.x,i.y+i.height),this.circleToLine(s,n,r,o))||0!=(a&e.right)&&(r=new t.Vector2(i.x+i.width,i.y),o=new t.Vector2(i.x+i.width,i.y+i.height),this.circleToLine(s,n,r,o)))}static rectToLine(i,s,n){const r=this.getSector(i.x,i.y,i.width,i.height,s),o=this.getSector(i.x,i.y,i.width,i.height,n);if(r==e.center||o==e.center)return!0;if(0!=(r&o))return!1;const a=r|o;return!!(0!=(a&e.top)&&this.lineToLine(new t.Vector2(i.x,i.y),new t.Vector2(i.x+i.width,i.y),s,n)||0!=(a&e.bottom)&&this.lineToLine(new t.Vector2(i.x,i.y+i.height),new t.Vector2(i.x+i.width,i.y+i.height),s,n)||0!=(a&e.left)&&this.lineToLine(new t.Vector2(i.x,i.y),new t.Vector2(i.x,i.y+i.height),s,n)||0!=(a&e.right)&&this.lineToLine(new t.Vector2(i.x+i.width,i.y),new t.Vector2(i.x+i.width,i.y+i.height),s,n))}static rectToPoint(t,e,i,s,n){return n.x>=t&&n.y>=e&&n.x<t+i&&n.y<e+s}static getSector(t,i,s,n,r){let o=e.center;return r.x<t?o|=e.left:r.x>=t+s&&(o|=e.right),r.y<i?o|=e.top:r.y>=i+n&&(o|=e.bottom),o}}}(es||(es={})),function(t){class e{constructor(e,i,s,n,r){this.fraction=0,this.distance=0,this.point=t.Vector2.zero,this.normal=t.Vector2.zero,this.collider=e,this.fraction=i,this.distance=s,this.point=n,this.centroid=t.Vector2.zero}setAllValues(t,e,i,s,n){this.collider=t,this.fraction=e,this.distance=i,this.point=s,this.normal=n}setValues(t,e,i,s){this.fraction=t,this.distance=e,this.point=i,this.normal=s}reset(){this.collider=null,this.fraction=this.distance=0}clone(){const t=new e;return t.setAllValues(this.collider,this.fraction,this.distance,this.point,this.normal),t}toString(){return`[RaycastHit] fraction: ${this.fraction}, distance: ${this.distance}, normal: ${this.normal}, centroid: ${this.centroid}, point: ${this.point}`}}t.RaycastHit=e}(es||(es={})),function(t){class e{static reset(){this._spatialHash=new t.SpatialHash(this.spatialHashCellSize),this._hitArray[0].reset(),this._colliderArray[0]=null}static clear(){this._spatialHash.clear()}static overlapCircle(t,i,s=e.allLayers){return this._colliderArray[0]=null,this._spatialHash.overlapCircle(t,i,this._colliderArray,s),this._colliderArray[0]}static overlapCircleAll(t,e,i,s=this.allLayers){return this._spatialHash.overlapCircle(t,e,i,s)}static boxcastBroadphase(t,e=this.allLayers){return this._spatialHash.aabbBroadphase(t,null,e)}static boxcastBroadphaseExcludingSelf(t,e,i=this.allLayers){return this._spatialHash.aabbBroadphase(e,t,i)}static boxcastBroadphaseExcludingSelfNonRect(t,e=this.allLayers){let i=t.bounds;return this._spatialHash.aabbBroadphase(i,t,e)}static boxcastBroadphaseExcludingSelfDelta(t,i,s,n=e.allLayers){let r=t.bounds.getSweptBroadphaseBounds(i,s);return this._spatialHash.aabbBroadphase(r,t,n)}static addCollider(t){e._spatialHash.register(t)}static removeCollider(t){e._spatialHash.remove(t)}static updateCollider(t){this._spatialHash.remove(t),this._spatialHash.register(t)}static linecast(t,i,s=this.allLayers,n=null){return this._hitArray[0].reset(),e.linecastAll(t,i,this._hitArray,s,n),this._hitArray[0]}static linecastAll(t,e,i,s=this.allLayers,n=null){return this._spatialHash.linecast(t,e,i,s,n)}static overlapRectangle(t,i=e.allLayers){return this._colliderArray[0]=null,this._spatialHash.overlapRectangle(t,this._colliderArray,i),this._colliderArray[0]}static overlapRectangleAll(t,i,s=e.allLayers){return 0==i.length?(console.warn("传入了一个空的结果数组。不会返回任何结果"),0):this._spatialHash.overlapRectangle(t,i,s)}}e.gravity=new t.Vector2(0,-300),e.spatialHashCellSize=100,e.allLayers=-1,e.raycastsHitTriggers=!1,e.raycastsStartInColliders=!1,e.debugRender=!1,e._hitArray=[new t.RaycastHit],e._colliderArray=[null],t.Physics=e}(es||(es={})),function(t){t.Ray2D=class{get start(){return this._start}get direction(){return this._direction}get end(){return this._end}constructor(t,e){this._start=t.clone(),this._end=e.clone(),this._direction=this._end.sub(this._start)}}}(es||(es={})),function(t){t.SpatialHash=class{constructor(s=100){this.gridBounds=new t.Rectangle,this._overlapTestBox=new t.Box(0,0),this._overlapTestCircle=new t.Circle(0),this._cellDict=new e,this._tempHashSet=new Set,this._cellSize=s,this._inverseCellSize=1/this._cellSize,this._raycastParser=new i}register(e){const i=e.bounds.clone();e.registeredPhysicsBounds=i;const s=this.cellCoords(i.x,i.y),n=this.cellCoords(i.right,i.bottom);this.gridBounds.contains(s.x,s.y)||(this.gridBounds=t.RectangleExt.union(this.gridBounds,s)),this.gridBounds.contains(n.x,n.y)||(this.gridBounds=t.RectangleExt.union(this.gridBounds,n));for(let t=s.x;t<=n.x;t++)for(let i=s.y;i<=n.y;i++)this.cellAtPosition(t,i,!0).push(e)}remove(e){const i=e.registeredPhysicsBounds.clone(),s=this.cellCoords(i.x,i.y),n=this.cellCoords(i.right,i.bottom);for(let i=s.x;i<=n.x;i++)for(let r=s.y;r<=n.y;r++){const s=this.cellAtPosition(i,r);t.Insist.isNotNull(s,`从不存在碰撞器的单元格中移除碰撞器: [${e}]`),null!=s&&new t.List(s).remove(e)}}removeWithBruteForce(t){this._cellDict.remove(t)}clear(){this._cellDict.clear()}aabbBroadphase(e,i,s){this._tempHashSet.clear();const n=this.cellCoords(e.x,e.y),r=this.cellCoords(e.right,e.bottom);for(let o=n.x;o<=r.x;o++)for(let a=n.y;a<=r.y;a++){const n=this.cellAtPosition(o,a);if(n&&n.length>0)for(let r=0;r<n.length;r++){const o=n[r];o!==i&&t.Flags.isFlagSet(s,o.physicsLayer.value)&&e.intersects(o.bounds)&&this._tempHashSet.add(o)}}return Array.from(this._tempHashSet)}linecast(e,i,s,n,r){const o=new t.Ray2D(e,i);this._raycastParser.start(o,s,n,r);let a=this.cellCoords(e.x,e.y);const l=this.cellCoords(i.x,i.y);let h=Math.sign(o.direction.x),c=Math.sign(o.direction.y);a.x===l.x&&(h=0),a.y===l.y&&(c=0);const u=h<0?0:h,d=c<0?0:c;let m=(a.x+u)*this._cellSize,p=(a.y+d)*this._cellSize,g=0!==o.direction.x?(m-o.start.x)/o.direction.x:Number.MAX_VALUE,y=0!==o.direction.y?(p-o.start.y)/o.direction.y:Number.MAX_VALUE;const f=0!==o.direction.x?this._cellSize/(o.direction.x*h):Number.MAX_VALUE,_=0!==o.direction.y?this._cellSize/(o.direction.y*c):Number.MAX_VALUE;let T=this.cellAtPosition(a.x,a.y);if(null!==T&&this._raycastParser.checkRayIntersection(a.x,a.y,T))return this._raycastParser.reset(),this._raycastParser.hitCounter;for(;a.x!==l.x||a.y!==l.y;)if(g<y?(a.x=t.MathHelper.toInt(t.MathHelper.approach(a.x,l.x,Math.abs(h))),g+=f):(a.y=t.MathHelper.toInt(t.MathHelper.approach(a.y,l.y,Math.abs(c))),y+=_),(T=this.cellAtPosition(a.x,a.y))&&this._raycastParser.checkRayIntersection(a.x,a.y,T))return this._raycastParser.reset(),this._raycastParser.hitCounter;return this._raycastParser.reset(),this._raycastParser.hitCounter}overlapRectangle(e,i,s){this._overlapTestBox.updateBox(e.width,e.height),this._overlapTestBox.position=e.location;let n=0;const r=this.aabbBroadphase(e,null,s);for(let s=0;s<r.length;s++){const o=r[s];if(o instanceof t.BoxCollider)i[n]=o,n++;else if(o instanceof t.CircleCollider)t.Collisions.rectToCircle(e,o.bounds.center,.5*o.bounds.width)&&(i[n]=o,n++);else{if(!(o instanceof t.PolygonCollider))throw new Error("overlapRectangle对这个类型没有实现!");o.shape.overlaps(this._overlapTestBox)&&(i[n]=o,n++)}if(n===i.length)return n}return n}overlapCircle(e,i,s,n){const r=new t.Rectangle(e.x-i,e.y-i,2*i,2*i);this._overlapTestCircle.radius=i,this._overlapTestCircle.position=e;let o=0;const a=this.aabbBroadphase(r,null,n);if(a.length>0)for(let e=0;e<a.length;e++){const i=a[e];if(i instanceof t.BoxCollider)i.shape.overlaps(this._overlapTestCircle)&&(s[o]=i,o++);else if(i instanceof t.CircleCollider)i.shape.overlaps(this._overlapTestCircle)&&(s[o]=i,o++);else{if(!(i instanceof t.PolygonCollider))throw new Error("对这个对撞机类型的overlapCircle没有实现!");i.shape.overlaps(this._overlapTestCircle)&&(s[o]=i,o++)}if(o===s.length)return o}return o}cellCoords(e,i){return new t.Vector2(Math.floor(e*this._inverseCellSize),Math.floor(i*this._inverseCellSize))}cellAtPosition(t,e,i=!1){let s=this._cellDict.tryGetValue(t,e);return s||i&&(s=[],this._cellDict.add(t,e,s)),s}};class e{constructor(){this._store=new Map}add(t,e,i){this._store.set(this.getKey(t,e),i)}remove(t){this._store.forEach(e=>{let i=e.indexOf(t);e.splice(i,1)})}tryGetValue(t,e){return this._store.get(this.getKey(t,e))}getKey(t,e){return`${t}_${e}`}clear(){this._store.clear()}}t.NumberDictionary=e;class i{constructor(){this._tempHit=new t.RaycastHit,this._checkedColliders=[],this._cellHits=[]}start(t,e,i,s){this._ray=t,this._hits=e,this._layerMask=i,this._ignoredColliders=s,this.hitCounter=0}checkRayIntersection(e,s,n){for(let e=0;e<n.length;e++){const i=n[e];if(-1!=this._checkedColliders.indexOf(i))continue;if(this._checkedColliders.push(i),i.isTrigger&&!t.Physics.raycastsHitTriggers)continue;if(!t.Flags.isFlagSet(this._layerMask,i.physicsLayer.value))continue;if(this._ignoredColliders&&this._ignoredColliders.has(i))continue;const s=i.bounds.rayIntersects(this._ray);if(s.intersected&&s.distance<=1){let e=new t.Out(this._tempHit);if(i.shape.collidesWithLine(this._ray.start,this._ray.end,e)){if(!t.Physics.raycastsStartInColliders&&i.shape.containsPoint(this._ray.start))continue;e.value.collider=i,this._cellHits.push(e.value)}}}if(0===this._cellHits.length)return!1;this._cellHits=this._cellHits.sort(i.compareRaycastHits);for(let t=0;t<this._cellHits.length;t++)if(this._hits[this.hitCounter]=this._cellHits[t],this.hitCounter++,this.hitCounter===this._hits.length)return!0;return!1}reset(){this._hits=null,this._checkedColliders.length=0,this._cellHits.length=0,this._ignoredColliders=null}}i.compareRaycastHits=((t,e)=>t.distance!==e.distance?t.distance-e.distance:t.collider.castSortOrder-e.collider.castSortOrder),t.RaycastResultParser=i}(es||(es={})),function(t){t.Shape=class{}}(es||(es={})),function(t){class e extends t.Shape{constructor(t,e){super(),this._areEdgeNormalsDirty=!0,this.isUnrotated=!0,this.setPoints(t),this.isBox=e}create(t,i){e.buildSymmetricalPolygon(t,i)}get edgeNormals(){return this._areEdgeNormalsDirty&&this.buildEdgeNormals(),this._edgeNormals}setPoints(t){this.points=t,this.recalculateCenterAndEdgeNormals(),this._originalPoints=[],this.points.forEach(t=>{this._originalPoints.push(t.clone())})}recalculateCenterAndEdgeNormals(){this._polygonCenter=e.findPolygonCenter(this.points),this._areEdgeNormalsDirty=!0}buildEdgeNormals(){let e,i=this.isBox?2:this.points.length;void 0!=this._edgeNormals&&this._edgeNormals.length==i||(this._edgeNormals=new Array(i));for(let s=0;s<i;s++){let i=this.points[s];e=s+1>=this.points.length?this.points[0]:this.points[s+1];let n=t.Vector2Ext.perpendicular(i,e);t.Vector2Ext.normalize(n),this._edgeNormals[s]=n}}static buildSymmetricalPolygon(e,i){const s=new Array(e);for(let n=0;n<e;n++){const r=2*Math.PI*(n/e);s[n]=new t.Vector2(Math.cos(r)*i,Math.sin(r)*i)}return s}static recenterPolygonVerts(t){const e=this.findPolygonCenter(t);for(let i=0;i<t.length;i++)t[i]=t[i].sub(e)}static findPolygonCenter(e){let i=0,s=0;for(let t=0;t<e.length;t++)i+=e[t].x,s+=e[t].y;return new t.Vector2(i/e.length,s/e.length)}static getFarthestPointInDirection(t,e){let i=0,s=t[i].dot(e);for(let n=1;n<t.length;n++){let r=t[n].dot(e);r>s&&(s=r,i=n)}return t[i]}static getClosestPointOnPolygonToPoint(e,i){const s={distanceSquared:Number.MAX_VALUE,edgeNormal:t.Vector2.zero,closestPoint:t.Vector2.zero};let n=0;for(let r=0;r<e.length;r++){let o=r+1;o===e.length&&(o=0);const a=t.ShapeCollisionsCircle.closestPointOnLine(e[r],e[o],i);if((n=t.Vector2.sqrDistance(i,a))<s.distanceSquared){s.distanceSquared=n,s.closestPoint=a;const t=e[o].sub(e[r]);s.edgeNormal.x=t.y,s.edgeNormal.y=-t.x}}return s.edgeNormal=s.edgeNormal.normalize(),s}static rotatePolygonVerts(e,i,s){let n=Math.cos(e),r=Math.sin(e);for(let e=0;e<i.length;e++){let o=i[e];s[e]=new t.Vector2(o.x*n+o.y*-r,o.x*r+o.y*n)}}recalculateBounds(e){if(this.center=e.localOffset,e.shouldColliderScaleAndRotateWithTransform){let i=!0;const s=new t.Matrix2D,n=new t.Matrix2D;t.Matrix2D.createTranslation(-this._polygonCenter.x,-this._polygonCenter.y,n);const r=e.entity.transform.scale;if(!r.equals(t.Vector2.one)){t.Matrix2D.createScale(r.x,r.y,s),t.Matrix2D.multiply(n,s,n),i=!1;const o=e.localOffset.multiply(r);this.center=o}const o=e.entity.transform.rotationDegrees;if(0!==o){const a=i?e._localOffsetLength:e.localOffset.multiply(r).magnitude(),l=Math.atan2(e.localOffset.y*r.y,e.localOffset.x*r.x)*t.MathHelper.Rad2Deg;this.center=t.MathHelper.pointOnCircle(t.Vector2.zero,a,o+l),t.Matrix2D.createRotation(t.MathHelper.Deg2Rad*o,s),t.Matrix2D.multiply(n,s,n)}t.Matrix2D.createTranslation(this._polygonCenter.x+e.transform.position.x+this.center.x,this._polygonCenter.y+e.transform.position.y+this.center.y,s),t.Matrix2D.multiply(n,s,n),this.points=this._originalPoints.map(t=>t.transform(n)),this.isUnrotated=0===o,e._isRotationDirty&&(this._areEdgeNormalsDirty=!0)}this.position=e.transform.position.add(this.center),this.bounds=t.Rectangle.rectEncompassingPoints(this.points).offset(this.position.x,this.position.y)}overlaps(i){let s=new t.Out;if(i instanceof e)return t.ShapeCollisionsPolygon.polygonToPolygon(this,i,s);if(i instanceof t.Circle)return!!t.ShapeCollisionsCircle.circleToPolygon(i,this,s)&&(s.value.invertResult(),!0);throw new Error(`overlaps of Pologon to ${i} are not supported`)}collidesWithShape(i,s){if(i instanceof e)return t.ShapeCollisionsPolygon.polygonToPolygon(this,i,s);if(i instanceof t.Circle)return!!t.ShapeCollisionsCircle.circleToPolygon(i,this,s)&&(s.value.invertResult(),!0);throw new Error(`overlaps of Polygon to ${i} are not supported`)}collidesWithLine(e,i,s){return t.ShapeCollisionsLine.lineToPoly(e,i,this,s)}containsPoint(t){t=t.sub(this.position);let e=!1;for(let i=0,s=this.points.length-1;i<this.points.length;s=i++)this.points[i].y>t.y!=this.points[s].y>t.y&&t.x<(this.points[s].x-this.points[i].x)*(t.y-this.points[i].y)/(this.points[s].y-this.points[i].y)+this.points[i].x&&(e=!e);return e}pointCollidesWithShape(e,i){return t.ShapeCollisionsPoint.pointToPoly(e,this,i)}}t.Polygon=e}(es||(es={})),function(t){class e extends t.Polygon{constructor(t,i){super(e.buildBox(t,i),!0),this.width=t,this.height=i}static buildBox(e,i){let s=e/2,n=i/2,r=new Array(4);return r[0]=new t.Vector2(-s,-n),r[1]=new t.Vector2(s,-n),r[2]=new t.Vector2(s,n),r[3]=new t.Vector2(-s,n),r}updateBox(e,i){this.width=e,this.height=i;let s=e/2,n=i/2;this.points[0]=new t.Vector2(-s,-n),this.points[1]=new t.Vector2(s,-n),this.points[2]=new t.Vector2(s,n),this.points[3]=new t.Vector2(-s,n);for(let t=0;t<this.points.length;t++)this._originalPoints[t]=this.points[t]}getEdges(){const e=[];for(let i=0;i<this.points.length;i++){const s=(i+1)%this.points.length;e.push(new t.Line(this.points[i],this.points[s]))}return e}overlaps(i){if(this.isUnrotated){if(i instanceof e&&i.isUnrotated)return this.bounds.intersects(i.bounds);if(i instanceof t.Circle)return t.Collisions.rectToCircle(this.bounds,i.position,i.radius)}return super.overlaps(i)}collidesWithShape(i,s){return i instanceof e&&i.isUnrotated?t.ShapeCollisionsBox.boxToBox(this,i,s):super.collidesWithShape(i,s)}containsPoint(t){return this.isUnrotated?this.bounds.contains(t.x,t.y):super.containsPoint(t)}pointCollidesWithShape(e,i){return this.isUnrotated?t.ShapeCollisionsPoint.pointToBox(e,this,i):super.pointCollidesWithShape(e,i)}getFurthestPoint(e){const i=this.width/2,s=this.height/2;let n=new t.Vector2(i,s),r=n.dot(e),o=new t.Vector2(-i,s),a=o.dot(e);return a>r&&(n.copyFrom(o),r=a),o.setTo(-i,-s),(a=o.dot(e))>r&&(n.copyFrom(o),r=a),o.setTo(i,-s),(a=o.dot(e))>r&&n.copyFrom(o),n}}t.Box=e}(es||(es={})),function(t){class e extends t.Shape{constructor(t){super(),this.radius=t,this._originalRadius=t}recalculateBounds(e){if(this.center=e.localOffset,e.shouldColliderScaleAndRotateWithTransform){const i=e.entity.transform.scale,s=1===i.x&&1===i.y,n=Math.max(i.x,i.y);if(this.radius=this._originalRadius*n,0!==e.entity.transform.rotation){const i=Math.atan2(e.localOffset.y,e.localOffset.x)*t.MathHelper.Rad2Deg,n=s?e._localOffsetLength:e.localOffset.multiply(e.entity.transform.scale).magnitude();this.center=t.MathHelper.pointOnCircle(t.Vector2.zero,n,e.entity.transform.rotation+i)}}this.position=e.transform.position.add(this.center),this.bounds=new t.Rectangle(this.position.x-this.radius,this.position.y-this.radius,2*this.radius,2*this.radius)}overlaps(i){const s=new t.Out;if(i instanceof t.Box&&i.isUnrotated)return t.Collisions.rectToCircle(i.bounds,this.position,this.radius);if(i instanceof e)return t.Collisions.circleToCircle(this.position,this.radius,i.position,i.radius);if(i instanceof t.Polygon)return t.ShapeCollisionsCircle.circleToPolygon(this,i,s);throw new Error(`overlaps of circle to ${i} are not supported`)}collidesWithShape(i,s){if(i instanceof t.Box&&i.isUnrotated)return t.ShapeCollisionsCircle.circleToBox(this,i,s);if(i instanceof e)return t.ShapeCollisionsCircle.circleToCircle(this,i,s);if(i instanceof t.Polygon)return t.ShapeCollisionsCircle.circleToPolygon(this,i,s);throw new Error(`Collisions of Circle to ${i} are not supported`)}collidesWithLine(e,i,s){return t.ShapeCollisionsLine.lineToCircle(e,i,this,s)}getPointAlongEdge(e){return new t.Vector2(this.position.x+this.radius*Math.cos(e),this.position.y+this.radius*Math.sin(e))}containsPoint(t){return t.sub(this.position).lengthSquared()<=this.radius*this.radius}pointCollidesWithShape(e,i){return t.ShapeCollisionsPoint.pointToCircle(e,this,i)}}t.Circle=e}(es||(es={})),function(t){t.CollisionResult=class{constructor(){this.normal=t.Vector2.zero,this.minimumTranslationVector=t.Vector2.zero,this.point=t.Vector2.zero}reset(){this.collider=null,this.normal.setTo(0,0),this.minimumTranslationVector.setTo(0,0),this.point&&this.point.setTo(0,0)}cloneTo(e){e.collider=this.collider,e.normal.setTo(this.normal.x,this.normal.y),e.minimumTranslationVector.setTo(this.minimumTranslationVector.x,this.minimumTranslationVector.y),this.point&&(e.point||(e.point=new t.Vector2(0,0)),e.point.setTo(this.point.x,this.point.y))}removeHorizontalTranslation(e){if(Math.sign(this.normal.x)!==Math.sign(e.x)||0===e.x&&0!==this.normal.x){const i=this.minimumTranslationVector.magnitude()/this.normal.y;1!=Math.abs(this.normal.x)&&Math.abs(i)<Math.abs(3*e.y)&&(this.minimumTranslationVector=new t.Vector2(0,-i))}}invertResult(){this.minimumTranslationVector=this.minimumTranslationVector.negate(),this.normal=this.normal.negate()}toString(){return`[CollisionResult] normal: ${this.normal}, minimumTranslationVector: ${this.minimumTranslationVector}`}}}(es||(es={})),function(t){t.Line=class{constructor(t,e){this.start=t.clone(),this.end=e.clone()}get direction(){return this.end.sub(this.start).normalize()}getNormal(){const e=this.direction.getAngle()-Math.PI/2;return new t.Vector2(Math.cos(e),Math.sin(e))}getDirection(t){return t.copyFrom(this.end).sub(this.start).normalize()}getLength(){return this.start.getDistance(this.end)}getLengthSquared(){return this.start.getDistanceSquared(this.end)}distanceToPoint(t,e){return Math.abs((this.end.y-this.start.y)*t.x-(this.end.x-this.start.x)*t.y+this.end.x*this.start.y-this.end.y*this.start.x)/(2*t.magnitude())}getFurthestPoint(t){return this.start.dot(t)>this.end.dot(t)?this.start:this.end}getClosestPoint(t,e){const i=e.copyFrom(this.end).sub(this.start),s=t.sub(this.start).dot(i)/i.lengthSquared();return s<0?e.copyFrom(this.start):s>1?e.copyFrom(this.end):e.copyFrom(i).multiplyScaler(s).add(this.start)}}}(es||(es={})),function(t){t.Projection=class{constructor(){this.min=Number.MAX_VALUE,this.max=-Number.MAX_VALUE}project(t,e){const i=e.points;let s=t.dot(i[0]),n=s;for(let e=1;e<i.length;e++){const r=i[e],o=t.dot(r);o<s?s=o:o>n&&(n=o)}this.min=s,this.max=n}overlap(t){return this.max>=t.min&&t.max>=this.min}getOverlap(t){return Math.min(this.max,t.max)-Math.max(this.min,t.min)}}}(es||(es={})),function(t){t.RealtimeCollisions=class{static intersectMovingCircleBox(e,i,s,n){const r=i.bounds;r.inflate(e.radius,e.radius);const o=new t.Ray2D(e.position.sub(s),e.position),a=r.rayIntersects(o);if(!a.intersected&&a.distance>1)return!1;const l=o.start.add(o.direction.scale(n));let h,c=0;l.x<i.bounds.left&&(h|=1),l.x>i.bounds.right&&(c|=1),l.y<i.bounds.top&&(h|=2),l.y>i.bounds.bottom&&(c|=2);const u=h+c;return 3==u&&console.log(`m == 3. corner ${t.Time.frameCount}`),!0}static corner(e,i){let s=t.Vector2.zero;return s.x=0==(1&i)?e.right:e.left,s.y=0==(1&i)?e.bottom:e.top,s}static testCircleBox(t,e,i){const s=e.bounds.getClosestPointOnRectangleToPoint(t.position).sub(t.position);return s.dot(s)<=t.radius*t.radius}}}(es||(es={})),function(t){t.Sector=class extends t.Shape{get sectorAngle(){let t=this.endAngle-this.startAngle;return t<0&&(t+=360),t}constructor(t,e,i,s){super(),this.center=t,this.radius=e,this.startAngle=i,this.endAngle=s,this.angle=s-i,this.radiusSquared=e*e,this.points=this.getPoints(),this.calculateProperties()}getCentroid(){const e=(Math.cos(this.startAngle)+Math.cos(this.endAngle))*this.radius/3,i=(Math.sin(this.startAngle)+Math.sin(this.endAngle))*this.radius/3;return new t.Vector2(e+this.center.x,i+this.center.y)}getAngle(){return this.startAngle}recalculateBounds(e){const i=this.center.add(e.localOffset),s=i.x-this.radius,n=i.y-this.radius,r=2*this.radius,o=2*this.radius,a=new t.Rectangle(s,n,r,o);this.bounds=a,this.center=i}overlaps(e){let i=new t.Out;if(e instanceof t.Polygon)return t.ShapeCollisionSector.sectorToPolygon(this,e,i);if(e instanceof t.Circle)return!!t.ShapeCollisionSector.sectorToCircle(this,e,i)&&(i.value.invertResult(),!0);throw new Error(`overlaps of Sector to ${e} are not supported`)}collidesWithShape(e,i){if(e instanceof t.Box)return t.ShapeCollisionSector.sectorToBox(this,e,i);if(e instanceof t.Polygon)return t.ShapeCollisionSector.sectorToPolygon(this,e,i);if(e instanceof t.Circle)return t.ShapeCollisionSector.sectorToCircle(this,e,i);throw new Error(`overlaps of Polygon to ${e} are not supported`)}collidesWithLine(e,i,s){const n=e.sub(this.center),r=i.sub(this.center),o=n.getAngle();let a=r.getAngle()-o;if(a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),a>=this.startAngle&&a<=this.endAngle){const r=n.getLength(),a=this.startAngle-o,l=r*Math.cos(a),h=r*Math.sin(a),c=new t.Vector2(l,h);if(c.isBetween(e,i)){const n=c.sub(e).getLength(),r=n/e.getDistance(i),o=c.sub(this.center).normalize(),a=c.add(this.center),l=new t.RaycastHit;return l.setValues(r,n,a,o),s.value=l,!0}}return!1}containsPoint(t){const e=t.sub(this.center);if(e.lengthSquared()>this.radiusSquared)return!1;const i=e.getAngle(),s=this.startAngle;this.angle;let n=i-s;return n<0&&(n+=2*Math.PI),!(n>this.angle)}pointCollidesWithShape(e,i){return this.containsPoint(e)?(i&&(i.value=new t.CollisionResult,i.value.normal=e.sub(this.center).normalize(),i.value.minimumTranslationVector=i.value.normal.scale(this.radius-e.sub(this.center).getLength()),i.value.point=e),!0):(i&&(i.value=null),!1)}getPoints(){let e=new Array(this.numberOfPoints);for(let i=0;i<this.numberOfPoints;i++){let s=this.startAngle+i*this.angleStep;e[i]=t.Vector2.fromAngle(s,this.radius).add(this.center)}return e}calculateProperties(){this.numberOfPoints=Math.max(10,Math.floor(.1*this.radius)),this.angleStep=(this.endAngle-this.startAngle)/(this.numberOfPoints-1)}getFurthestPoint(e){let i=-Number.MAX_VALUE,s=new t.Vector2;for(let t=0;t<this.numberOfPoints;t++){let n=this.points[t].dot(e);n>i&&(i=n,s.copyFrom(this.points[t]))}return s}}}(es||(es={})),function(t){t.ShapeCollisionSector=class{static sectorToPolygon(e,i,s){const n=i.points.length;let r=!1;const o=new t.Vector2,a=new t.Vector2,l=new t.Out;for(let o=0;o<n;o++){const n=i.points[o];if(e.containsPoint(n)){s&&(s.value=new t.CollisionResult,s.value.point=n.clone(),s.value.normal=n.sub(e.center).normalize()),r=!0;break}}if(!r&&i.containsPoint(e.center)&&(s&&(s.value=new t.CollisionResult,s.value.point=e.center.clone(),s.value.normal=new t.Vector2(0,0)),r=!0),!r)for(let h=0;h<n;h++){const c=i.points[h],u=i.points[(h+1)%n];if(o.copyFrom(c),a.copyFrom(u),e.collidesWithLine(o,a,l)){s&&(s.value=new t.CollisionResult,s.value.point.copyFrom(l.value.point),s.value.normal.copyFrom(l.value.normal)),r=!0;break}}return r}static sectorToCircle(e,i,s){const n=i.radius*i.radius,r=e.center.getDistanceSquared(i.center),o=Math.abs(i.center.sub(e.center).getAngle()-e.getAngle()),a=e.endAngle-e.startAngle;return r<=n&&o<=a/2?(s&&(s.value=new t.CollisionResult,s.value.normal=i.center.sub(e.center).normalize(),s.value.point=i.center.clone().add(s.value.normal.clone().multiplyScaler(i.radius))),!0):(s&&(s.value=null),!1)}static sectorToBox(e,i,s){s.value=new t.CollisionResult;let n=i.getEdges();for(let t=0;t<n.length;t++){let r=n[t].getNormal(),o=i.getFurthestPoint(r),a=e.getFurthestPoint(r.negate()),l=r.dot(a.sub(o));if(l>0)return!1;s.value&&Math.abs(l)<s.value.minimumTranslationVector.getLength()&&(s.value.minimumTranslationVector=r.clone().multiplyScaler(l),s.value.normal=r)}return!0}}}(es||(es={})),function(t){t.ShapeCollisionsBox=class{static boxToBox(e,i,s){s.value=new t.CollisionResult;const n=this.minkowskiDifference(e,i);return!!n.contains(0,0)&&(s.value.minimumTranslationVector=n.getClosestPointOnBoundsToOrigin(),!s.value.minimumTranslationVector.equals(t.Vector2.zero)&&(s.value.normal=s.value.minimumTranslationVector.scale(-1),s.value.normal=s.value.normal.normalize(),!0))}static boxToBoxCast(e,i,s,n){const r=this.minkowskiDifference(e,i);if(r.contains(0,0)){const e=r.getClosestPointOnBoundsToOrigin();return!e.equals(t.Vector2.zero)&&(n.normal=new t.Vector2(-e.x,-e.y),n.normal=n.normal.normalize(),n.distance=0,n.fraction=0,!0)}{const i=new t.Ray2D(t.Vector2.zero,s.scale(-1)),o=r.rayIntersects(i);if(o.intersected&&o.distance<=1)return n.fraction=o.distance,n.distance=s.magnitude()*o.distance,n.normal=s.scale(-1),n.normal=n.normal.normalize(),n.centroid=e.bounds.center.add(s.scale(o.distance)),!0}return!1}static minkowskiDifference(e,i){const s=e.position.sub(e.bounds.center),n=e.bounds.location.add(s.sub(i.bounds.max)),r=e.bounds.size.add(i.bounds.size);return new t.Rectangle(n.x,n.y,r.x,r.y)}}}(es||(es={})),function(t){t.ShapeCollisionsCircle=class{static circleToCircleCast(e,i,s,n){n.value=new t.RaycastHit;let r=e.position.add(s),o=this.closestPointOnLine(e.position,r,i.position),a=t.Vector2.sqrDistance(i.position,o);const l=(e.radius+i.radius)*(e.radius+i.radius);if(a<=l){const h=s.normalize();o===r&&(r=e.position.add(s.add(h.scale(i.radius))),o=this.closestPointOnLine(e.position,r,i.position),a=t.Vector2.sqrDistance(i.position,o));const c=Math.sqrt(l-a);return n.value.centroid=o.sub(h.scale(c)),n.value.normal=n.value.centroid.sub(i.position).normalize(),n.value.fraction=(n.value.centroid.x-e.position.x)/s.x,n.value.distance=t.Vector2.distance(e.position,n.value.centroid),n.value.point=i.position.add(n.value.normal.scale(i.radius)),!0}return!1}static circleToCircle(e,i,s){s.value=new t.CollisionResult;const n=t.Vector2.sqrDistance(e.position,i.position),r=e.radius+i.radius;if(n<r*r){s.value.normal=e.position.sub(i.position).normalize();const t=r-Math.sqrt(n);return s.value.minimumTranslationVector=s.value.normal.scale(-t),s.value.point=i.position.add(s.value.normal.scale(i.radius)),!0}return!1}static circleToBox(e,i,s){s.value=new t.CollisionResult;const n=new t.Out,r=i.bounds.getClosestPointOnRectangleBorderToPoint(e.position,n);if(s.value.normal=n.value,i.containsPoint(e.position)){s.value.point=r;const t=r.add(s.value.normal.scale(e.radius));return s.value.minimumTranslationVector=e.position.sub(t),!0}const o=t.Vector2.sqrDistance(r,e.position);if(0==o)s.value.minimumTranslationVector=s.value.normal.scale(e.radius);else if(o<=e.radius*e.radius){s.value.normal=e.position.sub(r);const t=s.value.normal.magnitude()-e.radius;return s.value.point=r,s.value.normal=s.value.normal.normalize(),s.value.minimumTranslationVector=s.value.normal.scale(t),!0}return!1}static circleToPolygon(e,i,s){s.value=new t.CollisionResult;const n=e.position.sub(i.position),r=t.Polygon.getClosestPointOnPolygonToPoint(i.points,n);s.value.normal=r.edgeNormal;const o=i.containsPoint(e.position);if(r.distanceSquared>e.radius*e.radius&&!o)return!1;let a;if(o)a=s.value.normal.scale(Math.sqrt(r.distanceSquared)-e.radius);else if(0===r.distanceSquared)a=s.value.normal.scale(e.radius);else{const t=Math.sqrt(r.distanceSquared);a=n.sub(r.closestPoint).scale((e.radius-t)/t*-1)}return s.value.minimumTranslationVector=a,s.value.point=r.closestPoint.add(i.position),!0}static closestPointOnLine(e,i,s){const n=i.sub(e);let r=s.sub(e).dot(n)/n.dot(n);return r=t.MathHelper.clamp(r,0,1),e.add(n.scaleEqual(r))}}}(es||(es={})),function(t){class e{static lineToPoly(i,s,n,r){r.value=new t.RaycastHit;let o=t.Vector2.zero,a=t.Vector2.zero,l=Number.MAX_VALUE,h=!1;for(let r=n.points.length-1,c=0;c<n.points.length;r=c,c++){const u=t.Vector2.add(n.position,n.points[r]),d=t.Vector2.add(n.position,n.points[c]),m=t.Vector2.zero;if(e.lineToLine(u,d,i,s,m)){h=!0;let e=(m.x-i.x)/(s.x-i.x);if((Number.isNaN(e)||Math.abs(e)==1/0)&&(e=(m.y-i.y)/(s.y-i.y)),e<l){const i=d.sub(u);o=new t.Vector2(i.y,-i.x),l=e,a=m}}}if(h){o=o.normalize();const e=t.Vector2.distance(i,a);return r.value.setValues(l,e,a,o),!0}return!1}static lineToLine(t,e,i,s,n){const r=e.sub(t),o=s.sub(i),a=r.x*o.y-r.y*o.x;if(0==a)return!1;const l=i.sub(t),h=(l.x*o.y-l.y*o.x)/a;if(h<0||h>1)return!1;const c=(l.x*r.y-l.y*r.x)/a;if(c<0||c>1)return!1;const u=t.add(r.scale(h));return n.x=u.x,n.y=u.y,!0}static lineToCircle(e,i,s,n){n.value=new t.RaycastHit;const r=t.Vector2.distance(e,i),o=t.Vector2.divideScaler(i.sub(e),r),a=e.sub(s.position),l=a.dot(o),h=a.dot(a)-s.radius*s.radius;if(h>0&&l>0)return!1;let c=l*l-h;return!(c<0)&&(n.value.fraction=-l-Math.sqrt(c),n.value.fraction<0&&(n.value.fraction=0),n.value.point=e.add(o.scale(n.value.fraction)),n.value.distance=t.Vector2.distance(e,n.value.point),n.value.normal=n.value.point.sub(s.position).normalize(),n.value.fraction=n.value.distance/r,!0)}}t.ShapeCollisionsLine=e}(es||(es={})),function(t){t.ShapeCollisionsPoint=class{static pointToCircle(e,i,s){s.value=new t.CollisionResult;let n=t.Vector2.sqrDistance(e,i.position),r=1+i.radius;if(n<r*r){s.value.normal=e.sub(i.position).normalize();let t=r-Math.sqrt(n);return s.value.minimumTranslationVector=s.value.normal.scale(-t),s.value.point=i.position.add(s.value.normal.scale(i.radius)),!0}return!1}static pointToBox(e,i,s){if(s.value=new t.CollisionResult,i.containsPoint(e)){const n=new t.Out;return s.value.point=i.bounds.getClosestPointOnRectangleBorderToPoint(e,n),s.value.normal=n.value,s.value.minimumTranslationVector=e.sub(s.value.point),!0}return!1}static pointToPoly(e,i,s){if(s.value=new t.CollisionResult,i.containsPoint(e)){const n=t.Polygon.getClosestPointOnPolygonToPoint(i.points,e.sub(i.position));return s.value.normal=n.edgeNormal,s.value.minimumTranslationVector=s.value.normal.scale(Math.sqrt(n.distanceSquared)),s.value.point=n.closestPoint.sub(i.position),!0}return!1}}}(es||(es={})),function(t){t.ShapeCollisionsPolygon=class{static polygonToPolygon(e,i,s){s.value=new t.CollisionResult;let n=!0;const r=e.edgeNormals,o=i.edgeNormals;let a,l=Number.POSITIVE_INFINITY,h=t.Vector2.zero,c=e.position.sub(i.position);for(let t=0;t<r.length+o.length;t++){a=t<r.length?r[t]:o[t-r.length];let s=0,{min:u,max:d}=this.getInterval(a,e);const{min:m,max:p}=this.getInterval(a,i),g=c.dot(a);if(u+=g,d+=g,(s=this.intervalDistance(u,d,m,p))>0&&(n=!1),!n)return!1;(s=Math.abs(s))<l&&(l=s,h.setTo(a.x,a.y),h.dot(c)<0&&(h=h.scale(-1)))}return s.value.normal=h,s.value.minimumTranslationVector=h.scale(-l),!0}static getInterval(t,e){const i={min:0,max:0};let s;s=e.points[0].dot(t),i.max=s,i.min=s;for(let n=1;n<e.points.length;n++)(s=e.points[n].dot(t))<i.min?i.min=s:s>i.max&&(i.max=s);return i}static intervalDistance(t,e,i,s){return t<i?i-e:t-s}}}(es||(es={})),function(t){t.AbstractTweenable=class{constructor(){this.discriminator="ITweenable"}recycleSelf(){}isRunning(){return this._isCurrentlyManagedByTweenManager&&!this._isPaused}start(){this._isCurrentlyManagedByTweenManager?this._isPaused=!1:(t.TweenManager.addTween(this),this._isCurrentlyManagedByTweenManager=!0,this._isPaused=!1)}pause(){this._isPaused=!0}resume(){this._isPaused=!1}stop(e=!1){t.TweenManager.removeTween(this),this._isCurrentlyManagedByTweenManager=!1,this._isPaused=!0}}}(es||(es={})),function(t){class e{constructor(t,e){this._target=t,this._propertyName=e}getTargetObject(){return this._target}setTweenedValue(t){this._target[this._propertyName]=t}getTweenedValue(){return this._target[this._propertyName]}}t.PropertyTweens=class{static NumberPropertyTo(i,s,n,r){let o=new e(i,s),a=t.TweenManager.cacheNumberTweens?t.Pool.obtain(t.NumberTween):new t.NumberTween;return a.initialize(o,n,r),a}static Vector2PropertyTo(i,s,n,r){let o=new e(i,s),a=t.TweenManager.cacheVector2Tweens?t.Pool.obtain(t.Vector2Tween):new t.Vector2Tween;return a.initialize(o,n,r),a}}}(es||(es={})),function(t){t.TransformSpringTween=class extends t.AbstractTweenable{get targetType(){return this._targetType}constructor(t,e,i){super(),this.dampingRatio=.23,this.angularFrequency=25,this._transform=t,this._targetType=e,this.setTargetValue(i)}setTargetValue(e){this._velocity=t.Vector2.zero,this._targetValue=e,this._isCurrentlyManagedByTweenManager||this.start()}updateDampingRatioWithHalfLife(t){this.dampingRatio=-t/this.angularFrequency*Math.log(.5)}tick(){return this._isPaused||this.setTweenedValue(t.Lerps.fastSpring(this.getCurrentValueOfTweenedTargetType(),this._targetValue,this._velocity,this.dampingRatio,this.angularFrequency)),!1}setTweenedValue(e){switch(this._targetType){case t.TransformTargetType.position:this._transform.position=e;break;case t.TransformTargetType.localPosition:this._transform.localPosition=e;break;case t.TransformTargetType.scale:this._transform.scale=e;break;case t.TransformTargetType.localScale:this._transform.localScale=e;break;case t.TransformTargetType.rotationDegrees:this._transform.rotationDegrees=e.x;case t.TransformTargetType.localRotationDegrees:this._transform.localRotationDegrees=e.x}}getCurrentValueOfTweenedTargetType(){switch(this._targetType){case t.TransformTargetType.position:return this._transform.position;case t.TransformTargetType.localPosition:return this._transform.localPosition;case t.TransformTargetType.scale:return this._transform.scale;case t.TransformTargetType.localScale:return this._transform.localScale;case t.TransformTargetType.rotationDegrees:return new t.Vector2(this._transform.rotationDegrees);case t.TransformTargetType.localRotationDegrees:return new t.Vector2(this._transform.localRotationDegrees,0);default:return t.Vector2.zero}}}}(es||(es={})),function(t){let e,i;!function(t){t[t.none=0]="none",t[t.restartFromBeginning=1]="restartFromBeginning",t[t.pingpong=2]="pingpong"}(e=t.LoopType||(t.LoopType={})),function(t){t[t.running=0]="running",t[t.paused=1]="paused",t[t.complete=2]="complete"}(i=t.TweenState||(t.TweenState={}));t.Tween=class{constructor(){this._shouldRecycleTween=!0,this._tweenState=i.complete,this._timeScale=1}setEaseType(t){return this._easeType=t,this}setDelay(t){return this._delay=t,this._elapsedTime=-this._delay,this}setDuration(t){return this._duration=t,this}setTimeScale(t){return this._timeScale=t,this}setIsTimeScaleIndependent(){return this._isTimeScaleIndependent=!0,this}setCompletionHandler(t){return this._completionHandler=t,this}setLoops(t,i=1,s=0){return this._loopType=t,this._delayBetweenLoops=s,i<0&&(i=-1),t==e.pingpong&&(i*=2),this._loops=i,this}setLoopCompletionHanlder(t){return this._loopCompleteHandler=t,this}setFrom(t){return this._isFromValueOverridden=!0,this._fromValue=t,this}prepareForReuse(t,e,i){return this.initialize(this._target,e,i),this}setRecycleTween(t){return this._shouldRecycleTween=t,this}setContext(t){return this.context=t,this}setNextTween(t){return this._nextTween=t,this}tick(){if(this._tweenState==i.paused)return!1;let t=this.calculateElapsedTimeExcess();this._elapsedTime>=0&&this._elapsedTime<=this._duration&&this.updateValue(),this._loopType!=e.none&&this._tweenState==i.complete&&0!=this._loops&&this.handleLooping(t);let s=this.calculateDeltaTime();return this.updateElapsedTime(s),this._tweenState==i.complete&&(this.handleCompletion(),!0)}calculateElapsedTimeExcess(){let t=0;return!this._isRunningInReverse&&this._elapsedTime>=this._duration?(t=this._elapsedTime-this._duration,this._elapsedTime=this._duration,this._tweenState=i.complete):this._isRunningInReverse&&this._elapsedTime<=0&&(t=0-this._elapsedTime,this._elapsedTime=0,this._tweenState=i.complete),t}calculateDeltaTime(){let e=this._isTimeScaleIndependent?t.Time.unscaledDeltaTime:t.Time.deltaTime;return e*=this._timeScale,this._isRunningInReverse&&(e=-e),e}updateElapsedTime(t){this._elapsedTime+=t,this._isRunningInReverse?(this._elapsedTime=Math.max(0,this._elapsedTime),this._elapsedTime=Math.min(this._elapsedTime,this._duration)):this._elapsedTime=Math.min(this._elapsedTime,this._duration)}handleCompletion(){this._completionHandler&&this._completionHandler(this),null!=this._nextTween&&(this._nextTween.start(),this._nextTween=null)}recycleSelf(){this._shouldRecycleTween&&(this._target=null,this._nextTween=null)}isRunning(){return this._tweenState==i.running}start(){this._isFromValueOverridden||(this._fromValue=this._target.getTweenedValue()),this._tweenState==i.complete&&(this._tweenState=i.running,t.TweenManager.addTween(this))}pause(){this._tweenState=i.paused}resume(){this._tweenState=i.running}stop(s=!1){this._tweenState=i.complete,s?(this._elapsedTime=this._isRunningInReverse?0:this._duration,this._loopType=e.none,this._loops=0):t.TweenManager.removeTween(this)}jumpToElapsedTime(e){this._elapsedTime=t.MathHelper.clamp(e,0,this._duration),this.updateValue()}reverseTween(){this._isRunningInReverse=!this._isRunningInReverse}*waitForCompletion(){for(;this._tweenState!=i.complete;)yield null}getTargetObject(){return this._target.getTargetObject()}resetState(){this.context=null,this._completionHandler=this._loopCompleteHandler=null,this._isFromValueOverridden=!1,this._isTimeScaleIndependent=!1,this._tweenState=i.complete,this._isRelative=!1,this._easeType=t.TweenManager.defaultEaseType,null!=this._nextTween&&(this._nextTween.recycleSelf(),this._nextTween=null),this._delay=0,this._duration=0,this._timeScale=1,this._elapsedTime=0,this._loopType=e.none,this._delayBetweenLoops=0,this._loops=0,this._isRunningInReverse=!1}initialize(t,e,i){this.resetState(),this._target=t,this._toValue=e,this._duration=i}handleLooping(t){this._loops--,this._loopType==e.pingpong&&this.reverseTween(),this._loopType!=e.restartFromBeginning&&this._loops%2!=0||this._loopCompleteHandler&&this._completionHandler(this),0!=this._loops&&(this._tweenState=i.running,this._loopType==e.restartFromBeginning?this._elapsedTime=t-this._delayBetweenLoops:this._isRunningInReverse?this._elapsedTime+=this._delayBetweenLoops-t:this._elapsedTime=t-this._delayBetweenLoops,0==this._delayBetweenLoops&&t>0&&this.updateValue())}}}(es||(es={})),function(t){class e extends t.Tween{static create(){return t.TweenManager.cacheNumberTweens?t.Pool.obtain(e):new e}constructor(t,e,i){super(),this.initialize(t,e,i)}setIsRelative(){return this._isRelative=!0,this._toValue+=this._fromValue,this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheNumberTweens&&t.Pool.free(e,this)}}t.NumberTween=e;class i extends t.Tween{static create(){return t.TweenManager.cacheVector2Tweens?t.Pool.obtain(i):new i}constructor(t,e,i){super(),this.initialize(t,e,i)}setIsRelative(){return this._isRelative=!0,this._toValue.add(this._fromValue),this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheVector2Tweens&&t.Pool.free(i,this)}}t.Vector2Tween=i;class s extends t.Tween{static create(){return t.TweenManager.cacheRectTweens?t.Pool.obtain(s):new s}constructor(t,e,i){super(),this.initialize(t,e,i)}setIsRelative(){return this._isRelative=!0,this._toValue=new t.Rectangle(this._toValue.x+this._fromValue.x,this._toValue.y+this._fromValue.y,this._toValue.width+this._fromValue.width,this._toValue.height+this._fromValue.height),this}updateValue(){this._target.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){super.recycleSelf(),this._shouldRecycleTween&&t.TweenManager.cacheRectTweens&&t.Pool.free(s,this)}}t.RectangleTween=s}(es||(es={})),function(t){let e;!function(t){t[t.position=0]="position",t[t.localPosition=1]="localPosition",t[t.scale=2]="scale",t[t.localScale=3]="localScale",t[t.rotationDegrees=4]="rotationDegrees",t[t.localRotationDegrees=5]="localRotationDegrees"}(e=t.TransformTargetType||(t.TransformTargetType={}));t.TransformVector2Tween=class extends t.Vector2Tween{setTweenedValue(t){switch(this._targetType){case e.position:this._transform.position=t;break;case e.localPosition:this._transform.localPosition=t;break;case e.scale:this._transform.scale=t;break;case e.localScale:this._transform.localScale=t;break;case e.rotationDegrees:this._transform.rotationDegrees=t.x;case e.localRotationDegrees:this._transform.localRotationDegrees=t.x}}getTweenedValue(){switch(this._targetType){case e.position:return this._transform.position;case e.localPosition:return this._transform.localPosition;case e.scale:return this._transform.scale;case e.localScale:return this._transform.localScale;case e.rotationDegrees:return new t.Vector2(this._transform.rotationDegrees,this._transform.rotationDegrees);case e.localRotationDegrees:return new t.Vector2(this._transform.localRotationDegrees,0)}}getTargetObject(){return this._transform}setTargetAndType(t,e){this._transform=t,this._targetType=e}updateValue(){this._targetType!=e.rotationDegrees&&this._targetType!=e.localRotationDegrees||this._isRelative?this.setTweenedValue(t.Lerps.ease(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration)):this.setTweenedValue(t.Lerps.easeAngle(this._easeType,this._fromValue,this._toValue,this._elapsedTime,this._duration))}recycleSelf(){this._shouldRecycleTween&&(this._target=null,this._nextTween=null,this._transform=null,t.Pool.free(t.Vector2Tween,this))}}}(es||(es={})),function(t){let e;!function(t){t[t.linear=0]="linear",t[t.sineIn=1]="sineIn",t[t.sineOut=2]="sineOut",t[t.sineInOut=3]="sineInOut",t[t.quadIn=4]="quadIn",t[t.quadOut=5]="quadOut",t[t.quadInOut=6]="quadInOut",t[t.quintIn=7]="quintIn",t[t.quintOut=8]="quintOut",t[t.quintInOut=9]="quintInOut",t[t.cubicIn=10]="cubicIn",t[t.cubicOut=11]="cubicOut",t[t.cubicInOut=12]="cubicInOut",t[t.quartIn=13]="quartIn",t[t.quartOut=14]="quartOut",t[t.quartInOut=15]="quartInOut",t[t.expoIn=16]="expoIn",t[t.expoOut=17]="expoOut",t[t.expoInOut=18]="expoInOut",t[t.circleIn=19]="circleIn",t[t.circleOut=20]="circleOut",t[t.circleInOut=21]="circleInOut",t[t.elasticIn=22]="elasticIn",t[t.elasticOut=23]="elasticOut",t[t.elasticInOut=24]="elasticInOut",t[t.punch=25]="punch",t[t.backIn=26]="backIn",t[t.backOut=27]="backOut",t[t.backInOut=28]="backInOut",t[t.bounceIn=29]="bounceIn",t[t.bounceOut=30]="bounceOut",t[t.bounceInOut=31]="bounceInOut"}(e=t.EaseType||(t.EaseType={}));t.EaseHelper=class{static oppositeEaseType(t){switch(t){case e.linear:return t;case e.backIn:return e.backOut;case e.backOut:return e.backIn;case e.backInOut:return t;case e.bounceIn:return e.bounceOut;case e.bounceOut:return e.bounceIn;case e.bounceInOut:return t;case e.circleIn:return e.circleOut;case e.circleOut:return e.circleIn;case e.circleInOut:return t;case e.cubicIn:return e.cubicOut;case e.cubicOut:return e.cubicIn;case e.circleInOut:case e.punch:return t;case e.expoIn:return e.expoOut;case e.expoOut:return e.expoIn;case e.expoInOut:return t;case e.quadIn:return e.quadOut;case e.quadOut:return e.quadIn;case e.quadInOut:return t;case e.quartIn:return e.quadOut;case e.quartOut:return e.quartIn;case e.quadInOut:return t;case e.sineIn:return e.sineOut;case e.sineOut:return e.sineIn;case e.sineInOut:default:return t}}static ease(i,s,n){switch(i){case e.linear:return t.Easing.Linear.easeNone(s,n);case e.backIn:return t.Easing.Back.easeIn(s,n);case e.backOut:return t.Easing.Back.easeOut(s,n);case e.backInOut:return t.Easing.Back.easeInOut(s,n);case e.bounceIn:return t.Easing.Bounce.easeIn(s,n);case e.bounceOut:return t.Easing.Bounce.easeOut(s,n);case e.bounceInOut:return t.Easing.Bounce.easeInOut(s,n);case e.circleIn:return t.Easing.Circular.easeIn(s,n);case e.circleOut:return t.Easing.Circular.easeOut(s,n);case e.circleInOut:return t.Easing.Circular.easeInOut(s,n);case e.cubicIn:return t.Easing.Cubic.easeIn(s,n);case e.cubicOut:return t.Easing.Cubic.easeOut(s,n);case e.cubicInOut:return t.Easing.Cubic.easeInOut(s,n);case e.elasticIn:return t.Easing.Elastic.easeIn(s,n);case e.elasticOut:return t.Easing.Elastic.easeOut(s,n);case e.elasticInOut:return t.Easing.Elastic.easeInOut(s,n);case e.punch:return t.Easing.Elastic.punch(s,n);case e.expoIn:return t.Easing.Exponential.easeIn(s,n);case e.expoOut:return t.Easing.Exponential.easeOut(s,n);case e.expoInOut:return t.Easing.Exponential.easeInOut(s,n);case e.quadIn:return t.Easing.Quadratic.easeIn(s,n);case e.quadOut:return t.Easing.Quadratic.easeOut(s,n);case e.quadInOut:return t.Easing.Quadratic.easeInOut(s,n);case e.quintIn:return t.Easing.Quintic.easeIn(s,n);case e.quintOut:return t.Easing.Quintic.easeOut(s,n);case e.quintInOut:return t.Easing.Quintic.easeInOut(s,n);case e.sineIn:return t.Easing.Sinusoidal.easeIn(s,n);case e.sineOut:return t.Easing.Sinusoidal.easeOut(s,n);case e.sineInOut:return t.Easing.Sinusoidal.easeInOut(s,n);default:return t.Easing.Linear.easeNone(s,n)}}}}(es||(es={})),function(t){t.GlobalManager=class{get enabled(){return this._enabled}set enabled(t){this.setEnabled(t)}setEnabled(t){this._enabled!=t&&(this._enabled=t,this._enabled?this.onEnabled():this.onDisabled())}onEnabled(){}onDisabled(){}update(){}}}(es||(es={})),function(t){class e extends t.GlobalManager{static get activeTweens(){return this._instance._activeTweens}constructor(){super(),this._activeTweens=[],this._tempTweens=[],e._instance=this}update(){this._isUpdating=!0;for(let t=this._activeTweens.length-1;t>=0;--t){let e=this._activeTweens[t];e.tick()&&this._tempTweens.push(e)}this._isUpdating=!1;for(let e=0;e<this._tempTweens.length;e++)this._tempTweens[e].recycleSelf(),new t.List(this._activeTweens).remove(this._tempTweens[e]);this._tempTweens.length=0}static addTween(t){e._instance._activeTweens.push(t)}static removeTween(i){e._instance._isUpdating?e._instance._tempTweens.push(i):(i.recycleSelf(),new t.List(e._instance._activeTweens).remove(i))}static stopAllTweens(t=!1){for(let i=e._instance._activeTweens.length-1;i>=0;--i)e._instance._activeTweens[i].stop(t)}static allTweensWithContext(t){let i=[];for(let s=0;s<e._instance._activeTweens.length;s++)e._instance._activeTweens[s].context==t&&i.push(e._instance._activeTweens[s]);return i}static stopAllTweensWithContext(t,i=!1){for(let s=e._instance._activeTweens.length-1;s>=0;--s)e._instance._activeTweens[s].context==t&&e._instance._activeTweens[s].stop(i)}static allTweenWithTarget(t){let i=[];for(let s=0;s<e._instance._activeTweens.length;s++)if(e._instance._activeTweens[s]){e._instance._activeTweens[s].getTargetObject()==t&&i.push(e._instance._activeTweens[s])}return i}static allTweensWithTargetEntity(e){let i=[];for(let s=0;s<this._instance._activeTweens.length;s++)if("ITweenControl"==this._instance._activeTweens[s].discriminator){let n=this._instance._activeTweens[s].getTargetObject();(n instanceof t.Entity&&n==e||n instanceof t.Component&&n.entity==e||n instanceof t.Transform&&n.entity==e)&&i.push(this._instance._activeTweens[s])}return i}static stopAllTweensWithTarget(t,i=!1){for(let s=e._instance._activeTweens.length-1;s>=0;--s)if(e._instance._activeTweens[s]){let n=e._instance._activeTweens[s];n.getTargetObject()==t&&n.stop(i)}}}e.defaultEaseType=t.EaseType.quartIn,e.removeAllTweensOnLevelLoad=!1,e.cacheNumberTweens=!0,e.cacheVector2Tweens=!0,e.cacheColorTweens=!0,e.cacheRectTweens=!1,t.TweenManager=e}(es||(es={})),function(t){let e;!function(t){t.Linear=class{static easeNone(t,e){return t/e}};t.Quadratic=class{static easeIn(t,e){return(t/=e)*t}static easeOut(t,e){return-1*(t/=e)*(t-2)}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t:-.5*(--t*(t-2)-1)}};t.Back=class{static easeIn(t,e,i=1.70158){return(t/=e)*t*((i+1)*t-i)}static easeOut(t,e,i=1.70158){return(t=t/e-1)*t*((i+1)*t+i)+1}static easeInOut(t,e,i=1.70158){return(t/=e/2)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2)}};t.Bounce=class{static easeOut(t,e){return(t/=e)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static easeIn(t,e){return 1-this.easeOut(e-t,e)}static easeInOut(t,e){return t<e/2?.5*this.easeIn(2*t,e):.5*this.easeOut(2*t-e,e)+.5}};t.Circular=class{static easeIn(t,e){return-(Math.sqrt(1-(t/=e)*t)-1)}static easeOut(t,e){return Math.sqrt(1-(t=t/e-1)*t)}static easeInOut(t,e){return(t/=e/2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}};t.Cubic=class{static easeIn(t,e){return(t/=e)*t*t}static easeOut(t,e){return(t=t/e-1)*t*t+1}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}};t.Elastic=class{static easeIn(t,e){if(0===t)return 0;if(1==(t/=e))return 1;const i=.3*e,s=i/4;return-1*Math.pow(2,10*(t-=1))*Math.sin((t*e-s)*(2*Math.PI)/i)}static easeOut(t,e){if(0===t)return 0;if(1==(t/=e))return 1;const i=.3*e,s=i/4;return 1*Math.pow(2,-10*t)*Math.sin((t*e-s)*(2*Math.PI)/i)+1}static easeInOut(t,e){if(0===t)return 0;if(2==(t/=e/2))return 1;const i=e*(.3*1.5),s=i/4;return t<1?-.5*Math.pow(2,10*(t-=1))*Math.sin((t*e-s)*(2*Math.PI)/i):Math.pow(2,-10*(t-=1))*Math.sin((t*e-s)*(2*Math.PI)/i)*.5+1}static punch(t,e){return 0===t?0:1==(t/=e)?0:Math.pow(2,-10*t)*Math.sin(t*(2*Math.PI)/.3)}};t.Exponential=class{static easeIn(t,e){return 0==t?0:Math.pow(2,10*(t/e-1))}static easeOut(t,e){return t==e?1:1-Math.pow(2,-10*t/e)}static easeInOut(t,e){return 0==t?0:t==e?1:(t/=e/2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))}};t.Quartic=class{static easeIn(t,e){return(t/=e)*t*t*t}static easeOut(t,e){return-1*((t=t/e-1)*t*t*t-1)}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}};t.Quintic=class{static easeIn(t,e){return(t/=e)*t*t*t*t}static easeOut(t,e){return(t=t/e-1)*t*t*t*t+1}static easeInOut(t,e){return(t/=e/2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}};t.Sinusoidal=class{static easeIn(t,e){return-1*Math.cos(t/e*(Math.PI/2))+1}static easeOut(t,e){return Math.sin(t/e*(Math.PI/2))}static easeInOut(t,e){return-.5*(Math.cos(Math.PI*t/e)-1)}}}(e=t.Easing||(t.Easing={}))}(es||(es={})),function(t){t.Lerps=class{static lerp(e,i,s){return"number"==typeof e&&"number"==typeof i?e+(i-e)*s:e instanceof t.Rectangle&&i instanceof t.Rectangle?new t.Rectangle(e.x+(i.x-e.x)*s,e.y+(i.x-e.y)*s,e.width+(i.width-e.width)*s,e.height+(i.height-e.height)*s):e instanceof t.Vector2&&i instanceof t.Vector2?new t.Vector2(e.x+(i.x-e.x)*s,e.y+(i.y-e.y)*s):void 0}static angleLerp(e,i,s){let n=new t.Vector2(t.MathHelper.deltaAngle(e.x,i.x),t.MathHelper.deltaAngle(e.y,i.y));return new t.Vector2(e.x+n.x*s,e.y+n.y*s)}static ease(e,i,s,n,r){return"number"==typeof i&&"number"==typeof s?this.lerp(i,s,t.EaseHelper.ease(e,n,r)):i instanceof t.Vector2&&s instanceof t.Vector2?this.lerp(i,s,t.EaseHelper.ease(e,n,r)):i instanceof t.Rectangle&&s instanceof t.Rectangle?this.lerp(i,s,t.EaseHelper.ease(e,n,r)):void 0}static easeAngle(e,i,s,n,r){return this.angleLerp(i,s,t.EaseHelper.ease(e,n,r))}static fastSpring(e,i,s,n,r){return s.add(s.scale(-2*t.Time.deltaTime*n*r).add(i.sub(e).scale(t.Time.deltaTime*r*r))),e.add(s.scale(t.Time.deltaTime)),e}}}(es||(es={})),function(t){t.AnimCurve=class{get points(){return this._points}constructor(t){if(t.length<2)throw new Error("curve length must be >= 2");if(t.sort((t,e)=>t.t-e.t),0!==t[0].t)throw new Error("curve must start with 0");if(1!==t[t.length-1].t)throw new Error("curve must end with 1");this._points=t}lerp(e){for(let i=1;i<this._points.length;i++)if(e<=this._points[i].t){const s=t.MathHelper.map01(e,this._points[i-1].t,this._points[i].t);return t.MathHelper.lerp(this._points[i-1].value,this._points[i].value,s)}throw new Error("should never be here")}}}(es||(es={})),function(t){class e{constructor(t,e){this.func=t,this.context=e}}t.FuncPack=e;t.Emitter=class{constructor(){this._messageTable=new Map}addObserver(t,i,s){let n=this._messageTable.get(t);n||(n=[],this._messageTable.set(t,n)),this.hasObserver(t,i)||n.push(new e(i,s))}removeObserver(t,e){let i=this._messageTable.get(t);if(i){let t=i.findIndex(t=>t.func==e);-1!=t&&i.splice(t,1)}}emit(t,...e){let i=this._messageTable.get(t);if(i)for(let t of i)t.func.call(t.context,...e)}hasObserver(t,e){let i=this._messageTable.get(t);return!!i&&i.some(t=>t.func===e)}}}(es||(es={})),function(t){let e;!function(t){t[t.top=0]="top",t[t.bottom=1]="bottom",t[t.left=2]="left",t[t.right=3]="right"}(e=t.Edge||(t.Edge={}))}(es||(es={})),function(t){class e{static default(){return new e}constructor(){}equals(t,e){return"function"==typeof t.equals?t.equals(e):t===e}getHashCode(t){if("number"==typeof t)return this._getHashCodeForNumber(t);if("string"==typeof t)return this._getHashCodeForString(t);let e=385229220;return this.forOwn(t,t=>{"number"==typeof t?e+=this._getHashCodeForNumber(t):"string"==typeof t?e+=this._getHashCodeForString(t):"object"==typeof t&&this.forOwn(t,()=>{e+=this.getHashCode(t)})}),e}_getHashCodeForNumber(t){return t}_getHashCodeForString(t){let e=385229220;for(let i=0;i<t.length;i++)e=-1521134295*e^t.charCodeAt(i);return e}forOwn(t,e){t=Object(t),Object.keys(t).forEach(i=>e(t[i],i,t))}}t.EqualityComparer=e}(es||(es={})),function(t){t.Hash=class{static computeHash(...t){let e=2166136261;for(let i=0;i<t.length;i++)e=16777619*(e^t[i]);return e+=e<<13,e^=e>>7,e+=e<<3,e^=e>>17,e+=e<<5}}}(es||(es={})),function(t){class e{constructor(){this._listeners=[]}addListener(t,e){-1===this._listeners.findIndex(i=>i.callback===e&&i.caller===t)&&this._listeners.push({caller:t,callback:e})}removeListener(t,e){const i=this._listeners.findIndex(i=>i.callback===e&&i.caller===t);i>=0&&this._listeners.splice(i,1)}clearListener(){this._listeners=[]}clearListenerWithCaller(t){for(let e=this._listeners.length-1;e>=0;e--){this._listeners[e].caller===t&&this._listeners.splice(e,1)}}notify(...t){for(let e=this._listeners.length-1;e>=0;e--){const i=this._listeners[e];i.caller?i.callback.call(i.caller,...t):i.callback(...t)}}}t.Observable=e;t.ObservableT=class extends e{addListener(t,e){super.addListener(t,e)}removeListener(t,e){super.removeListener(t,e)}notify(t){super.notify(t)}};t.ObservableTT=class extends e{addListener(t,e){super.addListener(t,e)}removeListener(t,e){super.removeListener(t,e)}notify(t,e){super.notify(t,e)}};t.Command=class{constructor(t,i){this.bindAction(t,i),this._onExec=new e}bindAction(t,e){this._caller=t,this._action=e}dispatch(...t){this._action?(this._caller?this._action.call(this._caller,...t):this._action(...t),this._onExec.notify()):console.warn("command not bind with an action")}addListener(t,e){this._onExec.addListener(t,e)}removeListener(t,e){this._onExec.removeListener(t,e)}clearListener(){this._onExec.clearListener()}clearListenerWithCaller(t){this._onExec.clearListenerWithCaller(t)}};t.ValueChangeCommand=class{constructor(t){this._onValueChange=new e,this._value=t}get onValueChange(){return this._onValueChange}get value(){return this._value}set value(t){this._value=t}dispatch(t){if(t!==this._value){const e=this._value;this._value=t,this._onValueChange.notify(this._value,e)}}addListener(t,e){this._onValueChange.addListener(t,e)}removeListener(t,e){this._onValueChange.removeListener(t,e)}clearListener(){this._onValueChange.clearListener()}clearListenerWithCaller(t){this._onValueChange.clearListenerWithCaller(t)}}}(es||(es={})),function(t){t.Out=class{constructor(t=null){this.value=t}}}(es||(es={})),function(t){t.Ref=class{constructor(t){this.value=t}}}(es||(es={})),function(t){t.Screen=class{static get size(){return new t.Vector2(this.width,this.height)}static get center(){return new t.Vector2(this.width/2,this.height/2)}}}(es||(es={})),function(t){t.SubpixelNumber=class{update(t){this.remainder+=t;let e=Math.trunc(this.remainder);return this.remainder-=e,e}reset(){this.remainder=0}}}(es||(es={})),function(t){class e{constructor(){this.triangleIndices=[],this._triPrev=new Array(12),this._triNext=new Array(12)}static testPointTriangle(e,i,s,n){return!(t.Vector2Ext.cross(e.sub(i),s.sub(i))<0)&&(!(t.Vector2Ext.cross(e.sub(s),n.sub(s))<0)&&!(t.Vector2Ext.cross(e.sub(n),i.sub(n))<0))}triangulate(i,s=!0){let n=i.length;this.initialize(n);let r=0,o=0;for(;n>3&&r<500;){r++;let s=!0,a=i[this._triPrev[o]],l=i[o],h=i[this._triNext[o]];if(t.Vector2Ext.isTriangleCCW(a,l,h)){let t=this._triNext[this._triNext[o]];do{if(e.testPointTriangle(i[t],a,l,h)){s=!1;break}t=this._triNext[t]}while(t!=this._triPrev[o])}else s=!1;s?(this.triangleIndices.push(this._triPrev[o]),this.triangleIndices.push(o),this.triangleIndices.push(this._triNext[o]),this._triNext[this._triPrev[o]]=this._triNext[o],this._triPrev[this._triNext[o]]=this._triPrev[o],n--,o=this._triPrev[o]):o=this._triNext[o]}this.triangleIndices.push(this._triPrev[o]),this.triangleIndices.push(o),this.triangleIndices.push(this._triNext[o]),s||this.triangleIndices.reverse()}initialize(t){this.triangleIndices.length=0,this._triNext.length<t&&(this._triNext.reverse(),this._triNext.length=Math.max(2*this._triNext.length,t)),this._triPrev.length<t&&(this._triPrev.reverse(),this._triPrev.length=Math.max(2*this._triPrev.length,t));for(let e=0;e<t;e++)this._triPrev[e]=e-1,this._triNext[e]=e+1;this._triPrev[0]=t-1,this._triNext[t-1]=0}}t.Triangulator=e}(es||(es={})),function(t){const e=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];t.UUID=class{static randomUUID(){const t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&s|128]+e[s>>8&255]+"-"+e[s>>16&255]+e[s>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}}(es||(es={})),function(t){t.getClassName=function(t){return t.className||t.name}}(es||(es={})),function(t){let e;t.Stopwatch=class{constructor(t=i){this.getSystemTime=t,this._stopDuration=0,this._completeSlices=[]}getState(){return void 0===this._startSystemTime?e.IDLE:void 0===this._stopSystemTime?e.RUNNING:e.STOPPED}isIdle(){return this.getState()===e.IDLE}isRunning(){return this.getState()===e.RUNNING}isStopped(){return this.getState()===e.STOPPED}slice(){return this.recordPendingSlice()}getCompletedSlices(){return Array.from(this._completeSlices)}getCompletedAndPendingSlices(){return[...this._completeSlices,this.getPendingSlice()]}getPendingSlice(){return this.calculatePendingSlice()}getTime(){return this.caculateStopwatchTime()}reset(){this._startSystemTime=this._pendingSliceStartStopwatchTime=this._stopSystemTime=void 0,this._stopDuration=0,this._completeSlices=[]}start(t=!1){if(t&&this.reset(),void 0!==this._stopSystemTime){const t=this.getSystemTime()-this._stopSystemTime;this._stopDuration+=t,this._stopSystemTime=void 0}else if(void 0===this._startSystemTime){const t=this.getSystemTime();this._startSystemTime=t,this._pendingSliceStartStopwatchTime=0}}stop(t=!1){if(void 0===this._startSystemTime)return 0;const e=this.getSystemTimeOfCurrentStopwatchTime();return t&&this.recordPendingSlice(this.caculateStopwatchTime(e)),this._stopSystemTime=e,this.getTime()}calculatePendingSlice(t){return void 0===this._pendingSliceStartStopwatchTime?Object.freeze({startTime:0,endTime:0,duration:0}):(void 0===t&&(t=this.getTime()),Object.freeze({startTime:this._pendingSliceStartStopwatchTime,endTime:t,duration:t-this._pendingSliceStartStopwatchTime}))}caculateStopwatchTime(t){return void 0===this._startSystemTime?0:(void 0===t&&(t=this.getSystemTimeOfCurrentStopwatchTime()),t-this._startSystemTime-this._stopDuration)}getSystemTimeOfCurrentStopwatchTime(){return void 0===this._stopSystemTime?this.getSystemTime():this._stopSystemTime}recordPendingSlice(t){if(void 0!==this._pendingSliceStartStopwatchTime){void 0===t&&(t=this.getTime());const e=this.calculatePendingSlice(t);return this._pendingSliceStartStopwatchTime=e.endTime,this._completeSlices.push(e),e}return this.calculatePendingSlice()}},function(t){t.IDLE="IDLE",t.RUNNING="RUNNING",t.STOPPED="STOPPED"}(e||(e={})),t.setDefaultSystemTimeGetter=function(t=Date.now){i=t};let i=Date.now}(es||(es={})),function(t){t.Bag=class{constructor(t=64){this.size_=0,this.length=0,this.array=[],this.length=t}removeAt(t){const e=this.array[t];return this.array[t]=this.array[--this.size_],this.array[this.size_]=null,e}remove(t){let e,i;const s=this.size_;for(e=0;e<s;e++)if(t==(i=this.array[e]))return this.array[e]=this.array[--this.size_],this.array[this.size_]=null,!0;return!1}removeLast(){if(this.size_>0){const t=this.array[--this.size_];return this.array[this.size_]=null,t}return null}contains(t){let e,i;for(e=0,i=this.size_;i>e;e++)if(t===this.array[e])return!0;return!1}removeAll(t){let e,i,s,n,r,o=!1;for(e=0,s=t.size();e<s;e++)for(n=t[e],i=0;i<this.size_;i++)if(n===(r=this.array[i])){this.removeAt(i),i--,o=!0;break}return o}get(t){if(t>=this.length)throw new Error("ArrayIndexOutOfBoundsException");return this.array[t]}safeGet(t){return t>=this.length&&this.grow(7*t/4+1),this.array[t]}size(){return this.size_}getCapacity(){return this.length}isIndexWithinBounds(t){return t<this.getCapacity()}isEmpty(){return 0==this.size_}add(t){this.size_===this.length&&this.grow(),this.array[this.size_++]=t}set(t,e){t>=this.length&&this.grow(2*t),this.size_=t+1,this.array[t]=e}grow(t=1+~~(3*this.length/2)){this.length=~~t}ensureCapacity(t){t>=this.length&&this.grow(2*t)}clear(){let t,e;for(t=0,e=this.size_;t<e;t++)this.array[t]=null;this.size_=0}addAll(t){let e;for(e=0;t.size()>e;e++)this.add(t.get(e))}}}(es||(es={})),function(t){class e{constructor(t,e){this.element=t,this.next=e}}function i(t,e){return t===e}t.Node=e,t.defaultEquals=i;t.LinkedList=class{constructor(t=i){this.count=0,this.next=void 0,this.equalsFn=t,this.head=null}push(t){const i=new e(t);let s;if(null==this.head)this.head=i;else{for(s=this.head;null!=s.next;)s=s.next;s.next=i}this.count++}removeAt(t){if(t>=0&&t<this.count){let e=this.head;if(0===t)this.head=e.next;else{const i=this.getElementAt(t-1);e=i.next,i.next=e.next}return this.count--,e.element}}getElementAt(t){if(t>=0&&t<=this.count){let e=this.head;for(let i=0;i<t&&null!=e;i++)e=e.next;return e}}insert(t,i){if(i>=0&&i<=this.count){const s=new e(t);if(0===i)s.next=this.head,this.head=s;else{const t=this.getElementAt(i-1);s.next=t.next,t.next=s}return this.count++,!0}return!1}indexOf(t){let e=this.head;for(let i=0;i<this.count&&null!=e;i++){if(this.equalsFn(t,e.element))return i;e=e.next}return-1}remove(t){this.removeAt(this.indexOf(t))}clear(){this.head=void 0,this.count=0}size(){return this.count}isEmpty(){return 0===this.size()}getHead(){return this.head}toString(){if(null==this.head)return"";let t=`${this.head.element}`,e=this.head.next;for(let i=1;i<this.size()&&null!=e;i++)t=`${t}, ${e.element}`,e=e.next;return t}}}(es||(es={})),function(t){class e{static warmCache(t,e){if(this.checkCreate(t),(e-=this._objectQueue.get(t).length)>0)for(let i=0;i<e;i++)this._objectQueue.get(t).push([])}static trimCache(t,e){for(this.checkCreate(t);e>this._objectQueue.get(t).length;)this._objectQueue.get(t).splice(0,1)}static clearCache(t){this.checkCreate(t),this._objectQueue.get(t).length=0}static obtain(t){return this.checkCreate(t),this._objectQueue.get(t).length>0?this._objectQueue.get(t).shift():[]}static free(t,e){this.checkCreate(t),this._objectQueue.get(t).push(e),e.length=0}static checkCreate(t){this._objectQueue.has(t)||this._objectQueue.set(t,[])}}e._objectQueue=new Map,t.ListPool=e}(es||(es={})),function(t){t.Pair=class{constructor(t,e){this.first=t,this.second=e}clear(){this.first=this.second=null}equals(t){return this.first===t.first&&this.second===t.second}}}(es||(es={})),function(t){t.PairSet=class{constructor(){this._all=new Array}get all(){return this._all}has(t){return this._all.findIndex(e=>e.equals(t))>-1}add(t){this.has(t)||this._all.push(t)}remove(t){const e=this._all.findIndex(e=>e.equals(t));if(e>-1){const t=this._all[e];this._all[e]=this._all[this._all.length-1],this._all[this._all.length-1]=t,this._all=this._all.slice(0,this._all.length-1)}}clear(){this._all=[]}union(t){const e=t.all;if(e.length>0)for(let t=0;t<e.length;t++){const i=e[t];this.add(i)}}except(t){const e=t.all;if(e.length>0)for(let t=0;t<e.length;t++){const i=e[t];this.remove(i)}}}}(es||(es={})),function(t){class e{static warmCache(t,e){this.checkCreate(t);const i=this._objectQueue.get(t);if((e-=i.length)>0)for(let s=0;s<e;s++)i.push(new t)}static trimCache(t,e){this.checkCreate(t);const i=this._objectQueue.get(t);for(;e<i.length;)i.pop()}static clearCache(t){this.checkCreate(t),this._objectQueue.get(t).length=0}static obtain(t){this.checkCreate(t);const e=this._objectQueue.get(t);return e.length>0?e.pop():new t}static free(e,i){this.checkCreate(e),this._objectQueue.get(e).push(i),t.isIPoolable(i)&&i.reset()}static checkCreate(t){this._objectQueue.has(t)||this._objectQueue.set(t,[])}}e._objectQueue=new Map,t.Pool=e,t.isIPoolable=(t=>"function"==typeof t.reset)}(es||(es={})),function(t){t.Coroutine=class{static waitForSeconds(t){return e.waiter.wait(t)}};class e{constructor(){this.waitTime=0}wait(t){return e.waiter.waitTime=t,e.waiter}}e.waiter=new e,t.WaitForSeconds=e}(es||(es={})),function(t){class e{constructor(){this.waitTimer=0,this.useUnscaledDeltaTime=!1}stop(){this.isDone=!0}setUseUnscaledDeltaTime(t){return this.useUnscaledDeltaTime=t,this}prepareForUse(){this.isDone=!1}reset(){this.isDone=!0,this.waitTimer=0,this.waitForCoroutine=null,this.enumerator=null,this.useUnscaledDeltaTime=!1}}t.CoroutineImpl=e;t.CoroutineManager=class extends t.GlobalManager{constructor(){super(...arguments),this._unblockedCoroutines=[],this._shouldRunNextFrame=[]}clearAllCoroutines(){for(let i=0;i<this._unblockedCoroutines.length;i++)t.Pool.free(e,this._unblockedCoroutines[i]);for(let i=0;i<this._shouldRunNextFrame.length;i++)t.Pool.free(e,this._shouldRunNextFrame[i]);this._unblockedCoroutines.length=0,this._shouldRunNextFrame.length=0}startCoroutine(t){const e=this.getOrCreateCoroutine();return e.prepareForUse(),e.enumerator="function"==typeof t?t():t,this.tickCoroutine(e)?(this.addCoroutine(e),e):null}getOrCreateCoroutine(){const i=t.Pool.obtain(e);return i.prepareForUse(),i}addCoroutine(t){this._isInUpdate?this._shouldRunNextFrame.push(t):this._unblockedCoroutines.push(t)}update(){this._isInUpdate=!0;const i=this._unblockedCoroutines,s=this._shouldRunNextFrame;for(let n=i.length-1;n>=0;n--){const r=i[n];if(r.isDone){t.Pool.free(e,r),i.splice(n,1);continue}const o=r.waitForCoroutine;if(null!=o){if(!o.isDone){s.push(r);continue}r.waitForCoroutine=null}const a=r.waitTimer;a>0?(r.waitTimer=a-(r.useUnscaledDeltaTime?t.Time.unscaledDeltaTime:t.Time.deltaTime),s.push(r)):this.tickCoroutine(r)&&s.push(r)}i.push(...s),s.length=0,this._isInUpdate=!1}tickCoroutine(i){const{enumerator:s}=i,{value:n,done:r}=s.next();return r||i.isDone?(t.Pool.free(e,i),!1):!(n&&(n instanceof t.WaitForSeconds?(i.waitTimer=n.waitTime,0):"number"==typeof n?(i.waitTimer=n,0):"string"==typeof n?"break"===n&&(t.Pool.free(e,i),1):"function"==typeof n?(i.waitForCoroutine=this.startCoroutine(n),0):n instanceof e&&(i.waitForCoroutine=n,0)))}}}(es||(es={})),function(t){t.MaxRectsBinPack=class{constructor(t,e,i=!0){this.binWidth=0,this.binHeight=0,this.usedRectangles=[],this.freeRectangles=[],this.init(t,e,i)}init(e,i,s=!0){this.binWidth=e,this.binHeight=i,this.allowRotations=s;let n=new t.Rectangle;n.x=0,n.y=0,n.width=e,n.height=i,this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(n)}insert(e,i){let s=new t.Rectangle,n=new t.Ref(0),r=new t.Ref(0);if(0==(s=this.findPositionForNewNodeBestAreaFit(e,i,n,r)).height)return s;let o=this.freeRectangles.length;for(let e=0;e<o;++e)this.splitFreeNode(this.freeRectangles[e],s)&&(new t.List(this.freeRectangles).removeAt(e),--e,--o);return this.pruneFreeList(),this.usedRectangles.push(s),s}findPositionForNewNodeBestAreaFit(e,i,s,n){let r=new t.Rectangle;s.value=Number.MAX_VALUE;for(let t=0;t<this.freeRectangles.length;++t){let o=this.freeRectangles[t].width*this.freeRectangles[t].height-e*i;if(this.freeRectangles[t].width>=e&&this.freeRectangles[t].height>=i){let a=Math.abs(this.freeRectangles[t].width-e),l=Math.abs(this.freeRectangles[t].height-i),h=Math.min(a,l);(o<s.value||o==s.value&&h<n.value)&&(r.x=this.freeRectangles[t].x,r.y=this.freeRectangles[t].y,r.width=e,r.height=i,n.value=h,s.value=o)}if(this.allowRotations&&this.freeRectangles[t].width>=i&&this.freeRectangles[t].height>=e){let a=Math.abs(this.freeRectangles[t].width-i),l=Math.abs(this.freeRectangles[t].height-e),h=Math.min(a,l);(o<s.value||o==s.value&&h<n.value)&&(r.x=this.freeRectangles[t].x,r.y=this.freeRectangles[t].y,r.width=i,r.height=e,n.value=h,s.value=o)}return r}}splitFreeNode(t,e){if(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)return!1;if(e.x<t.x+t.width&&e.x+e.width>t.x){if(e.y>t.y&&e.y<t.y+t.height){let i=t;i.height=e.y-i.y,this.freeRectangles.push(i)}if(e.y+e.height<t.y+t.height){let i=t;i.y=e.y+e.height,i.height=t.y+t.height-(e.y+e.height),this.freeRectangles.push(i)}}if(e.y<t.y+t.height&&e.y+e.height>t.y){if(e.x>t.x&&e.x<t.x+t.width){let i=t;i.width=e.x-i.x,this.freeRectangles.push(i)}if(e.x+e.width<t.x+t.width){let i=t;i.x=e.x+e.width,i.width=t.x+t.width-(e.x+e.width),this.freeRectangles.push(i)}}return!0}pruneFreeList(){for(let e=0;e<this.freeRectangles.length;++e)for(let i=e+1;i<this.freeRectangles.length;++i){if(this.isContainedIn(this.freeRectangles[e],this.freeRectangles[i])){new t.List(this.freeRectangles).removeAt(e),--e;break}this.isContainedIn(this.freeRectangles[i],this.freeRectangles[e])&&(new t.List(this.freeRectangles).removeAt(i),--i)}}isContainedIn(t,e){return t.x>=e.x&&t.y>=e.y&&t.x+t.width<=e.x+e.width&&t.y+t.height<=e.y+e.height}}}(es||(es={})),function(t){t.ArrayUtils=class{static bubbleSort(t){let e=!1;for(let i=0;i<t.length;i++){e=!1;for(let s=t.length-1;s>i;s--)if(t[s]<t[s-1]){let i=t[s];t[s]=t[s-1],t[s-1]=i,e=!0}if(!e)break}}static insertionSort(t){let e=t.length;for(let s=1;s<e;s++){let e=t[s];for(var i=s;i>0&&t[i-1]>e;i--)t[i]=t[i-1];t[i]=e}}static binarySearch(t,e){let i=0,s=t.length,n=i+s>>1;for(;i<s;)e<=t[n]?s=n:e>=t[n]&&(i=n+1),n=i+s>>1;return t[i]==e?i:-1}static findElementIndex(t,e){let i=t.length;for(let s=0;s<i;++s)if(t[s]==e)return s;return null}static getMaxElementIndex(t){let e=0,i=t.length;for(let s=1;s<i;s++)t[s]>t[e]&&(e=s);return e}static getMinElementIndex(t){let e=0,i=t.length;for(let s=1;s<i;s++)t[s]<t[e]&&(e=s);return e}static getUniqueAry(t){let e=[],i=[],s=t.length;for(let i=0;i<s;++i){let s=t[i];-1==e.indexOf(s)&&e.push(s)}for(let t=(s=e.length)-1;t>=0;--t)i.unshift(e[t]);return i}static getDifferAry(t,e){t=this.getUniqueAry(t),e=this.getUniqueAry(e);let i=t.concat(e),s={},n=[],r=i.length;for(let t=0;t<r;++t)s[i[t]]?s[i[t]]instanceof Object&&s[i[t]].count++:(s[i[t]]={},s[i[t]].count=0,s[i[t]].key=i[t],s[i[t]].count++);for(let t in s)2!=s[t].count&&n.unshift(s[t].key);return n}static swap(t,e,i){let s=t[e];t[e]=t[i],t[i]=s}static clearList(t){if(t)for(let e=t.length-1;e>=0;e-=1)t.splice(e,1)}static cloneList(t){return t?t.slice(0,t.length):null}static equals(t,e){if(t==e)return!0;let i=t.length;if(i!=e.length)return!1;for(;i--;)if(t[i]!=e[i])return!1;return!0}static insert(t,e,i){if(!t)return null;let s=t.length;if(e>s&&(e=s),e<0&&(e=0),e==s)t.push(i);else if(0==e)t.unshift(i);else{for(let i=s-1;i>=e;i-=1)t[i+1]=t[i];t[e]=i}return i}static shuffle(e){let i=e.length;for(;i>1;){i--;let s=t.RandomUtils.randint(0,i+1),n=e[s];e[s]=e[i],e[i]=n}}static addIfNotPresent(e,i){return!new t.List(e).contains(i)&&(e.push(i),!0)}static lastItem(t){return t[t.length-1]}static randomItem(e){return e[t.RandomUtils.randint(0,e.length-1)]}static randomItems(e,i,s){let n=new Set;for(;n.size!=s;){let t=this.randomItem(i);n.has(t)||n.add(t)}let r=t.ListPool.obtain(e);return n.forEach(t=>r.push(t)),r}}}(es||(es={})),function(t){class e{static get nativeBase64(){return"function"==typeof window.atob}static decode(t){if(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(t);for(var e,i,s,n,r,o,a=[],l=0;l<t.length;)e=this._keyStr.indexOf(t.charAt(l++))<<2|(n=this._keyStr.indexOf(t.charAt(l++)))>>4,i=(15&n)<<4|(r=this._keyStr.indexOf(t.charAt(l++)))>>2,s=(3&r)<<6|(o=this._keyStr.indexOf(t.charAt(l++))),a.push(String.fromCharCode(e)),64!==r&&a.push(String.fromCharCode(i)),64!==o&&a.push(String.fromCharCode(s));return a=a.join("")}static encode(t){if(t=t.replace(/\r\n/g,"\n"),!this.nativeBase64){for(var e,i,s,n,r,o,a,l=[],h=0;h<t.length;)n=(e=t.charCodeAt(h++))>>2,r=(3&e)<<4|(i=t.charCodeAt(h++))>>4,o=(15&i)<<2|(s=t.charCodeAt(h++))>>6,a=63&s,isNaN(i)?o=a=64:isNaN(s)&&(a=64),l.push(this._keyStr.charAt(n)),l.push(this._keyStr.charAt(r)),l.push(this._keyStr.charAt(o)),l.push(this._keyStr.charAt(a));return l=l.join("")}window.btoa(t)}static decodeBase64AsArray(t,i){i=i||1;var s,n,r,o=e.decode(t),a=new Uint32Array(o.length/i);for(s=0,r=o.length/i;s<r;s++)for(a[s]=0,n=i-1;n>=0;--n)a[s]+=o.charCodeAt(s*i+n)<<(n<<3);return a}static decompress(t,e,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}static decodeCSV(t){for(var e=t.replace("\n","").trim().split(","),i=[],s=0;s<e.length;s++)i.push(+e[s]);return i}}e._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.Base64Utils=e}(es||(es={})),function(t){t.EdgeExt=class{static oppositeEdge(e){switch(e){case t.Edge.bottom:return t.Edge.top;case t.Edge.top:return t.Edge.bottom;case t.Edge.left:return t.Edge.right;case t.Edge.right:return t.Edge.left}}static isHorizontal(e){return e==t.Edge.right||e==t.Edge.left}static isVertical(e){return e==t.Edge.top||e==t.Edge.bottom}}}(es||(es={})),function(t){t.NumberExtension=class{static toNumber(t){return void 0==t?0:Number(t)}}}(es||(es={})),function(t){t.RandomUtils=class{static randrange(t,e,i=1){if(0==i)throw new Error("step 不能为 0");let s=e-t;if(0==s)throw new Error("没有可用的范围("+t+","+e+")");s<0&&(s=t-e);let n=Math.floor((s+i-1)/i);return Math.floor(this.random()*n)*i+Math.min(t,e)}static randint(t,e){return(t=Math.floor(t))>(e=Math.floor(e))?t++:e++,this.randrange(t,e)}static randnum(t,e){return this.random()*(e-t)+t}static shuffle(t){return t.sort(this._randomCompare),t}static choice(t){if(!t.hasOwnProperty("length"))throw new Error("无法对此对象执行此操作");let e=Math.floor(this.random()*t.length);return t instanceof String?String(t).charAt(e):t[e]}static sample(t,e){let i=t.length;if(e<=0||i<e)throw new Error("采样数量不够");let s=[],n=[];for(let r=0;r<e;r++){let e=Math.floor(this.random()*i);for(;n.indexOf(e)>=0;)e=Math.floor(this.random()*i);s.push(t[e]),n.push(e)}return s}static random(){return Math.random()}static boolean(t=.5){return this.random()<t}static _randomCompare(t,e){return this.random()>.5?1:-1}}}(es||(es={})),function(t){t.RectangleExt=class{static getSide(e,i){switch(i){case t.Edge.top:return e.top;case t.Edge.bottom:return e.bottom;case t.Edge.left:return e.left;case t.Edge.right:return e.right}}static union(e,i){let s=new t.Rectangle(i.x,i.y,0,0),n=new t.Rectangle;return n.x=Math.min(e.x,s.x),n.y=Math.min(e.y,s.y),n.width=Math.max(e.right,s.right)-n.x,n.height=Math.max(e.bottom,s.bottom)-n.y,n}static getHalfRect(e,i){switch(i){case t.Edge.top:return new t.Rectangle(e.x,e.y,e.width,e.height/2);case t.Edge.bottom:return new t.Rectangle(e.x,e.y+e.height/2,e.width,e.height/2);case t.Edge.left:return new t.Rectangle(e.x,e.y,e.width/2,e.height);case t.Edge.right:return new t.Rectangle(e.x+e.width/2,e.y,e.width/2,e.height)}}static getRectEdgePortion(e,i,s=1){switch(i){case t.Edge.top:return new t.Rectangle(e.x,e.y,e.width,s);case t.Edge.bottom:return new t.Rectangle(e.x,e.y+e.height-s,e.width,s);case t.Edge.left:return new t.Rectangle(e.x,e.y,s,e.height);case t.Edge.right:return new t.Rectangle(e.x+e.width-s,e.y,s,e.height)}}static expandSide(e,i,s){switch(s=Math.abs(s),i){case t.Edge.top:e.y-=s,e.height+=s;break;case t.Edge.bottom:e.height+=s;break;case t.Edge.left:e.x-=s,e.width+=s;break;case t.Edge.right:e.width+=s}}static contract(t,e,i){t.x+=e,t.y+=i,t.width-=2*e,t.height-=2*i}static boundsFromPolygonVector(e){let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let t=0;t<e.length;t++){let o=e[t];o.x<i&&(i=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y)}return this.fromMinMaxVector(new t.Vector2(i,s),new t.Vector2(n,r))}static fromMinMaxVector(e,i){return new t.Rectangle(e.x,e.y,i.x-e.x,i.y-e.y)}static getSweptBroadphaseBounds(e,i,s){let n=t.Rectangle.empty;return n.x=i>0?e.x:e.x+i,n.y=s>0?e.y:e.y+s,n.width=i>0?i+e.width:e.width-i,n.height=s>0?s+e.height:e.height-s,n}collisionCheck(t,e,i,s){i.value=s.value=0;let n=e.x-(t.x+t.width),r=e.x+e.width-t.x,o=e.y-(t.y+t.height),a=e.y+e.height-t.y;return!(n>0||r<0||o>0||a<0||(i.value=Math.abs(n)<r?n:r,s.value=Math.abs(o)<a?o:a,Math.abs(i.value)<Math.abs(s.value)?s.value=0:i.value=0,0))}static getIntersectionDepth(e,i){let s=e.width/2,n=e.height/2,r=i.width/2,o=i.height/2,a=new t.Vector2(e.left+s,e.top+n),l=new t.Vector2(i.left+r,i.top+o),h=a.x-l.x,c=a.y-l.y,u=s+r,d=n+o;if(Math.abs(h)>=u||Math.abs(c)>=d)return t.Vector2.zero;let m=h>0?u-h:-u-h,p=c>0?d-c:-d-c;return new t.Vector2(m,p)}static getClosestPointOnBoundsToOrigin(e){let i=this.getMax(e),s=Math.abs(e.location.x),n=new t.Vector2(e.location.x,0);return Math.abs(i.x)<s&&(s=Math.abs(i.x),n.x=i.x,n.y=0),Math.abs(i.y)<s&&(s=Math.abs(i.y),n.x=0,n.y=i.y),Math.abs(e.location.y)<s&&(s=Math.abs(e.location.y),n.x=0,n.y=e.location.y),n}static getClosestPointOnRectangleToPoint(e,i){let s=t.Vector2.zero;return s.x=t.MathHelper.clamp(i.x,e.left,e.right),s.y=t.MathHelper.clamp(i.y,e.top,e.bottom),s}static getClosestPointOnRectangleBorderToPoint(e,i){let s=t.Vector2.zero;if(s.x=t.MathHelper.clamp(t.MathHelper.toInt(i.x),e.left,e.right),s.y=t.MathHelper.clamp(t.MathHelper.toInt(i.y),e.top,e.bottom),e.contains(s.x,s.y)){let t=e.x-e.left,i=e.right-s.x,n=s.y-e.top,r=e.bottom-s.y,o=Math.min(t,i,n,r);o==n?s.y=e.top:o==r?s.y=e.bottom:o==t?(s.x,e.left):s.x=e.right}return s}static getMax(e){return new t.Vector2(e.right,e.bottom)}static getCenter(e){return new t.Vector2(e.x+e.width/2,e.y+e.height/2)}static boundsFromPolygonPoints(e){let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let t=0;t<e.length;t++){let o=e[t];o.x<i&&(i=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y)}return this.fromMinMaxVector(new t.Vector2(t.MathHelper.toInt(i),t.MathHelper.toInt(s)),new t.Vector2(t.MathHelper.toInt(n),t.MathHelper.toInt(r)))}static calculateBounds(e,i,s,n,r,o,a,l){if(0==o)e.x=t.MathHelper.toInt(i.x+s.x-n.x*r.x),e.y=t.MathHelper.toInt(i.y+s.y-n.y*r.y),e.width=t.MathHelper.toInt(a*r.x),e.height=t.MathHelper.toInt(l*r.y);else{let h,c=i.x+s.x,u=i.y+s.y,d=new t.Matrix2D;t.Matrix2D.createTranslation(-c-n.x,-u-n.y,d),t.Matrix2D.createScale(r.x,r.y,h),d=d.multiply(h),t.Matrix2D.createRotation(o,h),d=d.multiply(h),t.Matrix2D.createTranslation(c,u,h),d=d.multiply(h);let m=new t.Vector2(c,u),p=new t.Vector2(c+a,u),g=new t.Vector2(c,u+l),y=new t.Vector2(c+a,u+l);t.Vector2Ext.transformR(m,d,m),t.Vector2Ext.transformR(p,d,p),t.Vector2Ext.transformR(g,d,g),t.Vector2Ext.transformR(y,d,y);let f=t.MathHelper.toInt(Math.min(m.x,y.x,p.x,g.x)),_=t.MathHelper.toInt(Math.max(m.x,y.x,p.x,g.x)),T=t.MathHelper.toInt(Math.min(m.y,y.y,p.y,g.y)),x=t.MathHelper.toInt(Math.max(m.y,y.y,p.y,g.y));e.location=new t.Vector2(f,T),e.width=t.MathHelper.toInt(_-f),e.height=t.MathHelper.toInt(x-T)}}static scale(e,i){e.x=t.MathHelper.toInt(e.x*i.x),e.y=t.MathHelper.toInt(e.y*i.y),e.width=t.MathHelper.toInt(e.width*i.x),e.height=t.MathHelper.toInt(e.height*i.y)}static translate(t,e){t.location.addEqual(e)}}}(es||(es={})),function(t){t.TextureUtils=class{static premultiplyAlpha(t){let e=t[0];for(let i=0;i<t.length;i+=4)if(255!=e[i+3]){let t=e[i+3]/255;e[i+0]=e[i+0]*t,e[i+1]=e[i+1]*t,e[i+2]=e[i+2]*t}}}}(es||(es={})),function(t){t.TypeUtils=class{static getType(t){return t.constructor}}}(es||(es={})),function(t){t.Vector2Ext=class{static isTriangleCCW(t,e,i){return this.cross(e.sub(t),i.sub(e))<0}static halfVector(){return new t.Vector2(.5,.5)}static cross(t,e){return t.y*e.x-t.x*e.y}static perpendicular(e,i){return new t.Vector2(-1*(i.y-e.y),i.x-e.x)}static perpendicularFlip(e){return new t.Vector2(-e.y,e.x)}static angle(e,i){return this.normalize(e),this.normalize(i),Math.acos(t.MathHelper.clamp(e.dot(i),-1,1))*t.MathHelper.Rad2Deg}static angleBetween(t,e,i){const s=e.sub(t),n=i.sub(t);return this.angle(s,n)}static getRayIntersection(e,i,s,n,r=t.Vector2.zero){let o=i.y-e.y,a=i.x-e.x,l=n.y-s.y,h=n.x-s.x;if(o*h==l*a)return r.x=Number.NaN,r.y=Number.NaN,!1;let c=((s.y-e.y)*a*h+o*h*e.x-l*a*s.x)/(o*h-l*a),u=e.y+o/a*(c-e.x);return r.x=c,r.y=u,!0}static normalize(e){let i=Math.sqrt(e.x*e.x+e.y*e.y);i>t.MathHelper.Epsilon?e.divideScaler(i):e.x=e.y=0}static transformA(t,e,i,s,n,r){for(let o=0;o<r;o++){let r=t[e+o],a=s[n+o];a.x=r.x*i.m11+r.y*i.m21+i.m31,a.y=r.x*i.m12+r.y*i.m22+i.m32,s[n+o]=a}}static transformR(e,i,s=t.Vector2.zero){let n=e.x*i.m11+e.y*i.m21+i.m31,r=e.x*i.m12+e.y*i.m22+i.m32;s.x=n,s.y=r}static transform(t,e,i){this.transformA(t,0,e,i,0,t.length)}static round(e){return new t.Vector2(Math.round(e.x),Math.round(e.y))}}}(es||(es={})),function(t){t.Enumerable=class{static range(e,i){let s=new t.List;for(;i--;)s.add(e++);return s}static repeat(e,i){let s=new t.List;for(;i--;)s.add(e);return s}}}(es||(es={})),function(t){t.isObj=(t=>!!t&&"object"==typeof t),t.negate=(t=>(...e)=>!t(...e)),t.composeComparers=((t,e)=>(i,s)=>t(i,s)||e(i,s)),t.keyComparer=((t,e)=>(i,s)=>{const n=t(i),r=t(s);return n>r?e?-1:1:n<r?e?1:-1:0})}(es||(es={})),function(t){class e{constructor(t=[]){this._elements=t}add(t){this._elements.push(t)}append(t){this.add(t)}prepend(t){this._elements.unshift(t)}addRange(t){this._elements.push(...t)}aggregate(t,e){return this._elements.reduce(t,e)}all(t){return this._elements.every(t)}any(t){return t?this._elements.some(t):this._elements.length>0}average(t){const e=this.sum(t),i=this.count(t);return 0===i?NaN:e/i}cast(){return new e(this._elements)}clear(){this._elements.length=0}concat(t){return new e(this._elements.concat(t.toArray()))}contains(t){return this.any(e=>e===t)}count(t){return t?this.where(t).count():this._elements.length}defaultIfEmpty(t){return this.count()?this:new e([t])}distinctBy(t){const i=this.groupBy(t);return Object.keys(i).reduce((t,e)=>(t.add(i[e][0]),t),new e)}elementAt(t){if(t<this.count()&&t>=0)return this._elements[t];throw new Error("ArgumentOutOfRangeException: index is less than 0 or greater than or equal to the number of elements in source.")}elementAtOrDefault(t){return t<this.count()&&t>=0?this._elements[t]:null}except(t){return this.where(e=>!t.contains(e))}first(t){if(this.count())return t?this.where(t).first():this._elements[0];throw new Error("InvalidOperationException: The source sequence is empty.")}firstOrDefault(t){return this.count(t)?this.first(t):void 0}forEach(t){return this._elements.forEach(t)}groupBy(t,e=(t=>t)){return this.aggregate((i,s)=>{const n=t(s),r=i[n],o=e(s);return r?r.push(o):i[n]=[o],i},{})}groupJoin(t,e,i,s){return this.select(n=>s(n,t.where(t=>e(n)===i(t))))}indexOf(t){return this._elements.indexOf(t)}insert(t,e){if(t<0||t>this._elements.length)throw new Error("Index is out of range.");this._elements.splice(t,0,e)}intersect(t){return this.where(e=>t.contains(e))}join(t,e,i,s){return this.selectMany(n=>t.where(t=>i(t)===e(n)).select(t=>s(n,t)))}last(t){if(this.count())return t?this.where(t).last():this._elements[this.count()-1];throw Error("InvalidOperationException: The source sequence is empty.")}lastOrDefault(t){return this.count(t)?this.last(t):void 0}max(t){return Math.max(...this._elements.map(t||(t=>t)))}min(t){return Math.min(...this._elements.map(t||(t=>t)))}ofType(t){let e;switch(t){case Number:e="number";break;case String:e="string";break;case Boolean:e=typeof!0;break;case Function:e="function";break;default:e=null}return null===e?this.where(e=>e instanceof t).cast():this.where(t=>typeof t===e).cast()}orderBy(e,s=t.keyComparer(e,!1)){return new i(this._elements,s)}orderByDescending(e,s=t.keyComparer(e,!0)){const n=this._elements.slice();return n.sort(s),new i(n,s)}thenBy(t){return this.orderBy(t)}thenByDescending(t){return this.orderByDescending(t)}remove(t){const e=this.indexOf(t);return-1!==e&&(this.removeAt(e),!0)}removeAll(i){const s=this.where(t.negate(i)).toArray();return new e(s)}removeAt(t){this._elements.splice(t,1)}reverse(){return new e(this._elements.reverse())}select(t){const i=this._elements.map(t);return new e(i)}selectMany(t){return this.aggregate((e,i,s)=>{const n=this.select(t).elementAt(s);return e.addRange(n.toArray())},new e)}sequenceEqual(t){return this.all(e=>t.contains(e))}single(t){if(1!==this.count(t))throw new Error("The collection does not contain exactly one element.");return this.first(t)}singleOrDefault(t){return this.count(t)?this.single(t):void 0}skip(t){return new e(this._elements.slice(Math.max(0,t)))}skipLast(t){return new e(this._elements.slice(0,-Math.max(0,t)))}skipWhile(t){return this.skip(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}sum(t){return t?this.select(t).sum():this.aggregate((t,e)=>t+=+e,0)}take(t){return new e(this._elements.slice(0,Math.max(0,t)))}takeLast(t){return new e(this._elements.slice(-Math.max(0,t)))}takeWhile(t){return this.take(this.aggregate(e=>t(this.elementAt(e))?++e:e,0))}toArray(){return this._elements}toDictionary(t,i){return this.aggregate((e,s,n)=>(e[this.select(t).elementAt(n).toString()]=i?this.select(i).elementAt(n):s,e.add({Key:this.select(t).elementAt(n),Value:i?this.select(i).elementAt(n):s}),e),new e)}toSet(){let t=new Set;for(let e of this._elements)t.add(e);return t}toLookup(t,e){return this.groupBy(t,e)}where(t){return new e(this._elements.filter(t))}zip(t,e){return t.count()<this.count()?t.select((t,i)=>e(this.elementAt(i),t)):this.select((i,s)=>e(i,t.elementAt(s)))}}t.List=e;class i extends e{constructor(t,e){super(t),this._comparer=e,this._elements.sort(this._comparer)}thenBy(e){return new i(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!1)))}thenByDescending(e){return new i(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!0)))}}t.OrderedList=i}(es||(es={})),function(t){t.EndPoint=class{constructor(){this.position=t.Vector2.zero,this.begin=!1,this.segment=null,this.angle=0}};t.EndPointComparer=class{compare(t,e){return t.angle>e.angle?1:t.angle<e.angle?-1:!t.begin&&e.begin?1:t.begin&&!e.begin?-1:0}}}(es||(es={})),function(t){t.Segment=class{constructor(){this.p1=null,this.p2=null}}}(es||(es={})),function(t){class e{constructor(e,i){this.lineCountForCircleApproximation=10,this._radius=0,this._origin=t.Vector2.zero,this._isSpotLight=!1,this._spotStartAngle=0,this._spotEndAngle=0,this._endPoints=[],this._segments=[],this._origin=e,this._radius=i,this._radialComparer=new t.EndPointComparer}addColliderOccluder(e){if(e instanceof t.BoxCollider&&0==e.rotation)this.addSquareOccluder(e.bounds);else if(e instanceof t.PolygonCollider){let i=e.shape;for(let e=0;e<i.points.length;e++){let s=e-1;0==e&&(s+=i.points.length),this.addLineOccluder(t.Vector2.add(i.points[s],i.position),t.Vector2.add(i.points[e],i.position))}}else e instanceof t.CircleCollider&&this.addCircleOccluder(e.absolutePosition,e.radius)}addCircleOccluder(e,i){let s=e.sub(this._origin),n=Math.atan2(s.y,s.x),r=Math.PI/this.lineCountForCircleApproximation,o=n+t.MathHelper.PiOver2,a=t.MathHelper.angleToVector(o,i).addEqual(e);for(let s=1;s<this.lineCountForCircleApproximation;s++){let n=t.MathHelper.angleToVector(o+s*r,i).addEqual(e);this.addLineOccluder(a,n),a=n}}addLineOccluder(t,e){this.addSegment(t,e)}addSquareOccluder(e){let i=new t.Vector2(e.right,e.top),s=new t.Vector2(e.left,e.bottom),n=new t.Vector2(e.right,e.bottom);this.addSegment(e.location,i),this.addSegment(i,n),this.addSegment(n,s),this.addSegment(s,e.location)}addSegment(e,i){let s=new t.Segment,n=new t.EndPoint,r=new t.EndPoint;n.position=e,n.segment=s,r.position=i,r.segment=s,s.p1=n,s.p2=r,this._segments.push(s),this._endPoints.push(n),this._endPoints.push(r)}clearOccluders(){this._segments.length=0,this._endPoints.length=0}begin(t,e){this._origin=t,this._radius=e,this._isSpotLight=!1}end(){let i=t.ListPool.obtain(t.Vector2);this.updateSegments(),this._endPoints.sort(this._radialComparer.compare);let s=0;for(let t=0;t<2;t++)for(let n of this._endPoints){let r=0==e._openSegments.size()?null:e._openSegments.getHead().element;if(n.begin){let t=e._openSegments.getHead();for(;null!=t&&this.isSegmentInFrontOf(n.segment,t.element,this._origin);)t=t.next;null==t?e._openSegments.push(n.segment):e._openSegments.insert(n.segment,e._openSegments.indexOf(t.element))}else e._openSegments.remove(n.segment);let o=null;0!=e._openSegments.size()&&(o=e._openSegments.getHead().element),r!=o&&(1==t&&(!this._isSpotLight||e.between(s,this._spotStartAngle,this._spotEndAngle)&&e.between(n.angle,this._spotStartAngle,this._spotEndAngle))&&this.addTriangle(i,s,n.angle,r),s=n.angle)}return e._openSegments.clear(),this.clearOccluders(),i}addTriangle(i,s,n,r){let o=this._origin.clone(),a=new t.Vector2(this._origin.x+Math.cos(s),this._origin.y+Math.sin(s)),l=t.Vector2.zero,h=t.Vector2.zero;null!=r?(l.x=r.p1.position.x,l.y=r.p1.position.y,h.x=r.p2.position.x,h.y=r.p2.position.y):(l.x=this._origin.x+Math.cos(s)*this._radius*2,l.y=this._origin.y+Math.sin(s)*this._radius*2,h.x=this._origin.x+Math.cos(n)*this._radius*2,h.y=this._origin.y+Math.sin(n)*this._radius*2);let c=e.lineLineIntersection(l,h,o,a);a.x=this._origin.x+Math.cos(n),a.y=this._origin.y+Math.sin(n);let u=e.lineLineIntersection(l,h,o,a);i.push(c),i.push(u)}static lineLineIntersection(e,i,s,n){let r=((n.x-s.x)*(e.y-s.y)-(n.y-s.y)*(e.x-s.x))/((n.y-s.y)*(i.x-e.x)-(n.x-s.x)*(i.y-e.y));return new t.Vector2(e.x+r*(i.x-e.x),e.y+r*(i.y-e.y))}static between(t,e,i){return t=(360+t%360)%360,(e=(36e5+e)%360)<(i=(36e5+i)%360)?e<=t&&t<=i:e<=t||t<=i}loadRectangleBoundaries(){this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y-this._radius)),this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y+this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y+this._radius)),this.addSegment(new t.Vector2(this._origin.x-this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x-this._radius,this._origin.y+this._radius)),this.addSegment(new t.Vector2(this._origin.x+this._radius,this._origin.y-this._radius),new t.Vector2(this._origin.x+this._radius,this._origin.y+this._radius))}isSegmentInFrontOf(t,i,s){let n=e.isLeftOf(t.p2.position,t.p1.position,e.interpolate(i.p1.position,i.p2.position,.01)),r=e.isLeftOf(t.p2.position,t.p1.position,e.interpolate(i.p2.position,i.p1.position,.01)),o=e.isLeftOf(t.p2.position,t.p1.position,s),a=e.isLeftOf(i.p2.position,i.p1.position,e.interpolate(t.p1.position,t.p2.position,.01)),l=e.isLeftOf(i.p2.position,i.p1.position,e.interpolate(t.p2.position,t.p1.position,.01)),h=e.isLeftOf(i.p2.position,i.p1.position,s);return a==l&&l!=h||n==r&&r==o}static interpolate(e,i,s){return new t.Vector2(e.x*(1-s)+i.x*s,e.y*(1-s)+i.y*s)}static isLeftOf(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)<0}updateSegments(){for(let t of this._segments){t.p1.angle=Math.atan2(t.p1.position.y-this._origin.y,t.p1.position.x-this._origin.x),t.p2.angle=Math.atan2(t.p2.position.y-this._origin.y,t.p2.position.x-this._origin.x);let e=t.p2.angle-t.p1.angle;e<=-Math.PI&&(e+=2*Math.PI),e>Math.PI&&(e-=2*Math.PI),t.p1.begin=e>0,t.p2.begin=!t.p1.begin}this._isSpotLight&&(this._spotStartAngle=this._segments[0].p2.angle,this._spotEndAngle=this._segments[1].p2.angle)}}e._cornerCache=[],e._openSegments=new t.LinkedList,t.VisibilityComputer=e}(es||(es={})),function(t){t.Timer=class{constructor(){this._timeInSeconds=0,this._repeats=!1,this._isDone=!1,this._elapsedTime=0}getContext(){return this.context}reset(){this._elapsedTime=0}stop(){this._isDone=!0}tick(){return!this._isDone&&this._elapsedTime>this._timeInSeconds&&(this._elapsedTime-=this._timeInSeconds,this._onTime(this),this._isDone||this._repeats||(this._isDone=!0)),this._elapsedTime+=t.Time.deltaTime,this._isDone}initialize(t,e,i,s){this._timeInSeconds=t,this._repeats=e,this.context=i,this._onTime=s.bind(i)}unload(){this.context=null,this._onTime=null}}}(es||(es={})),function(t){t.TimerManager=class extends t.GlobalManager{constructor(){super(...arguments),this._timers=[]}update(){for(let t=this._timers.length-1;t>=0;t--)this._timers[t].tick()&&(this._timers[t].unload(),this._timers.splice(t,1))}schedule(e,i,s,n){let r=new t.Timer;return r.initialize(e,i,s,n),this._timers.push(r),r}}}(es||(es={}));